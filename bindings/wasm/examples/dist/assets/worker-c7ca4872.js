class On{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(r);i!==-1&&s.splice(i,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let i=0,a=s.length;i<a;i++)s[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Ut extends On{constructor(e,r,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class Hf extends On{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(r=>r.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(r=>r.getChild())}disconnectParents(e,r){let n=this.listParentEdges(e);return r&&(n=n.filter(s=>r(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,r,n,s){return this._registerEdge(new Ut(e,r,n,s))}_registerEdge(e){this._edges.add(e);const r=e.getParent();this._parentEdges.has(r)||this._parentEdges.set(r,new Set),this._parentEdges.get(r).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function rr(){return rr=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},rr.apply(this,arguments)}function Tn(t){return t instanceof Ut}function Kt(t){return Array.isArray(t)&&t[0]instanceof Ut}function Jt(t){return!!(Xf(t)&&Wf(t)instanceof Ut)}function Wf(t){for(const e in t)return t[e]}function Xf(t){return!!t&&Object.getPrototypeOf(t)===Object.prototype}const ie=Symbol("attributes"),Ft=Symbol("immutableKeys");class Fn extends On{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[ie]=void 0,this[Ft]=void 0,this.graph=e,this[Ft]=new Set,this[ie]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof Fn){const i=this.graph.createEdge(n,this,s);i.addEventListener("dispose",()=>s.dispose()),this[Ft].add(n),r[n]=i}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[ie]){const s=this[ie][n];if(Tn(s)){const i=s;i.getChild()===e&&this.setRef(n,r,i.getAttributes())}else if(Kt(s)){const a=s.find(o=>o.getChild()===e);if(a){const o=a.getAttributes();this.removeRef(n,e).addRef(n,r,o)}}else if(Jt(s)){const i=s;for(const a in i){const o=i[a];o.getChild()===e&&this.setRefMap(n,a,r,o.getAttributes())}}}return this}get(e){return this[ie][e]}set(e,r){return this[ie][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[ie][e];return r?r.getChild():null}setRef(e,r,n){if(this[Ft].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[ie][e];if(s&&s.dispose(),!r)return this;const i=this.graph.createEdge(e,this,r,n);return i.addEventListener("dispose",()=>{delete this[ie][e],this.dispatchEvent({type:"change",attribute:e})}),this[ie][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[ie][e].map(n=>n.getChild())}addRef(e,r,n){const s=this.graph.createEdge(e,this,r,n),i=this[ie][e];return i.push(s),s.addEventListener("dispose",()=>{const a=i.filter(o=>o!==s);i.length=0;for(const o of a)i.push(o);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){return this[ie][e].filter(i=>i.getChild()===r).forEach(i=>i.dispose()),this}listRefMapKeys(e){return Object.keys(this[ie][e])}listRefMapValues(e){return Object.values(this[ie][e]).map(r=>r.getChild())}getRefMap(e,r){const n=this[ie][e];return n[r]?n[r].getChild():null}setRefMap(e,r,n,s){const i=this[ie][e],a=i[r];if(a&&a.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const o=this.graph.createEdge(e,this,n,rr({},s,{key:r}));return o.addEventListener("dispose",()=>{delete i[r],this.dispatchEvent({type:"change",attribute:e,key:r})}),i[r]=o,this.dispatchEvent({type:"change",attribute:e,key:r})}dispatchEvent(e){return super.dispatchEvent(rr({},e,{target:this})),this.graph.dispatchEvent(rr({},e,{target:this,type:`node:${e.type}`})),this}}const si="v3.3.1",Lt="@glb.bin";var U,Pr,$e,ze,bt;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(U||(U={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(Pr||(Pr={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}($e||($e={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(ze||(ze={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(bt||(bt={}));const Ur={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var br,Mn=typeof Float32Array<"u"?Float32Array:Array;function mn(t){return Math.hypot(t[0],t[1],t[2])}function Yf(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/(a=a||1),t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function Kf(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=t.propertyType===U.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const i=s.getMesh();if(!i)return;const a=Jf(i,s.getWorldMatrix());En(a.min,e),En(a.max,e)});return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),br=new Mn(3),Mn!=Float32Array&&(br[0]=0,br[1]=0,br[2]=0);function Jf(t,e){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let i=[0,0,0],a=[0,0,0];for(let o=0;o<s.getCount();o++)i=s.getElement(o,i),a=Yf(a,i,e),En(a,r)}return r}function En(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}class Y{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let r=0;for(const i of e)r+=i.byteLength;const n=new Uint8Array(r);let s=0;for(const i of e)n.set(i,s),s+=i.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let i=e.byteLength;i<n;i++)s[i]=r;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let Oe=class{static hexToFactor(e,r){e=Math.floor(e);const n=r;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(r,r)}static factorToHex(e){const r=[...e],[n,s,i]=this.convertLinearToSRGB(e,r);return 255*n<<16^255*s<<8^255*i<<0}static convertSRGBToLinear(e,r){const n=e,s=r;for(let i=0;i<3;i++)s[i]=n[i]<.04045?.0773993808*n[i]:Math.pow(.9478672986*n[i]+.0521327014,2.4);return r}static convertLinearToSRGB(e,r){const n=e,s=r;for(let i=0;i<3;i++)s[i]=n[i]<.0031308?12.92*n[i]:1.055*Math.pow(n[i],.41666)-.055;return r}},ii=class ai{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return Y.decodeText(e.slice(12,16))===ai.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}};ii.PNG_FRIED_CHUNK_NAME="CgBI";let We=class{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=this.getSize(e,r);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function Qf(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}We.impls={"image/jpeg":new class{match(t){return t.length>=3&&t[0]===255&&t[1]===216&&t[2]===255}getSize(t){let e,r,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),Qf(n,e),r=n.getUint8(e+1),r===192||r===193||r===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new ii};let Bt=class{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return We.mimeTypeToExtension(r)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function Ds(t){return Object.prototype.toString.call(t)==="[object Object]"}function _t(t){if(Ds(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return Ds(r)!==!1&&Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")!==!1}var wn;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(wn||(wn={}));let it=class Qt{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Qt.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Qt.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Qt.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Qt.Verbosity.ERROR&&console.error(e)}};function Zf(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=e[8],v=e[9],T=e[10],E=e[11],A=e[12],h=e[13],_=e[14],d=e[15],y=r[0],M=r[1],b=r[2],O=r[3];return t[0]=y*n+M*o+b*m+O*A,t[1]=y*s+M*c+b*v+O*h,t[2]=y*i+M*u+b*T+O*_,t[3]=y*a+M*p+b*E+O*d,t[4]=(y=r[4])*n+(M=r[5])*o+(b=r[6])*m+(O=r[7])*A,t[5]=y*s+M*c+b*v+O*h,t[6]=y*i+M*u+b*T+O*_,t[7]=y*a+M*p+b*E+O*d,t[8]=(y=r[8])*n+(M=r[9])*o+(b=r[10])*m+(O=r[11])*A,t[9]=y*s+M*c+b*v+O*h,t[10]=y*i+M*u+b*T+O*_,t[11]=y*a+M*p+b*E+O*d,t[12]=(y=r[12])*n+(M=r[13])*o+(b=r[14])*m+(O=r[15])*A,t[13]=y*s+M*c+b*v+O*h,t[14]=y*i+M*u+b*T+O*_,t[15]=y*a+M*p+b*E+O*d,t}it.Verbosity=wn,it.DEFAULT_INSTANCE=new it(it.Verbosity.INFO);let he=class Rn{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,r){return Rn.decodeNormalizedInt(e,r)}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,r){return Rn.encodeNormalizedInt(e,r)}static decompose(e,r,n,s){let i=mn([e[0],e[1],e[2]]);const a=mn([e[4],e[5],e[6]]),o=mn([e[8],e[9],e[10]]);var c,u,p,m,v,T,E,A,h,_,d,y,M,b,O,L,P;((u=(c=e)[0])*(E=c[5])-(p=c[1])*(T=c[4]))*((y=c[10])*(P=c[15])-(M=c[11])*(L=c[14]))-(u*(A=c[6])-(m=c[2])*T)*((d=c[9])*P-M*(O=c[13]))+(u*(h=c[7])-(v=c[3])*T)*(d*L-y*O)+(p*A-m*E)*((_=c[8])*P-M*(b=c[12]))-(p*h-v*E)*(_*L-y*b)+(m*h-v*A)*(_*O-d*b)<0&&(i=-i),r[0]=e[12],r[1]=e[13],r[2]=e[14];const V=e.slice(),G=1/i,j=1/a,H=1/o;V[0]*=G,V[1]*=G,V[2]*=G,V[4]*=j,V[5]*=j,V[6]*=j,V[8]*=H,V[9]*=H,V[10]*=H,function(z,D){var q=new Mn(3);(function(jt,Le){var Xr=Le[4],Ye=Le[5],ft=Le[6],Yr=Le[8],Kr=Le[9],ke=Le[10];jt[0]=Math.hypot(Le[0],Le[1],Le[2]),jt[1]=Math.hypot(Xr,Ye,ft),jt[2]=Math.hypot(Yr,Kr,ke)})(q,D);var Z=1/q[0],re=1/q[1],J=1/q[2],X=D[0]*Z,oe=D[1]*re,de=D[2]*J,we=D[4]*Z,Te=D[5]*re,Ue=D[6]*J,ot=D[8]*Z,ct=D[9]*re,nt=D[10]*J,fr=X+Te+nt,pe=0;fr>0?(pe=2*Math.sqrt(fr+1),z[3]=.25*pe,z[0]=(Ue-ct)/pe,z[1]=(ot-de)/pe,z[2]=(oe-we)/pe):X>Te&&X>nt?(pe=2*Math.sqrt(1+X-Te-nt),z[3]=(Ue-ct)/pe,z[0]=.25*pe,z[1]=(oe+we)/pe,z[2]=(ot+de)/pe):Te>nt?(pe=2*Math.sqrt(1+Te-X-nt),z[3]=(ot-de)/pe,z[0]=(oe+we)/pe,z[1]=.25*pe,z[2]=(Ue+ct)/pe):(pe=2*Math.sqrt(1+nt-X-Te),z[3]=(oe-we)/pe,z[0]=(ot+de)/pe,z[1]=(Ue+ct)/pe,z[2]=.25*pe)}(n,V),s[0]=i,s[1]=a,s[2]=o}static compose(e,r,n,s){const i=s,a=r[0],o=r[1],c=r[2],u=r[3],p=a+a,m=o+o,v=c+c,T=a*p,E=a*m,A=a*v,h=o*m,_=o*v,d=c*v,y=u*p,M=u*m,b=u*v,O=n[0],L=n[1],P=n[2];return i[0]=(1-(h+d))*O,i[1]=(E+b)*O,i[2]=(A-M)*O,i[3]=0,i[4]=(E-b)*L,i[5]=(1-(T+d))*L,i[6]=(_+y)*L,i[7]=0,i[8]=(A+M)*P,i[9]=(_-y)*P,i[10]=(1-(T+h))*P,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}};function el(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function tl(t,e){if(!!t!=!!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function rl(t,e){if(!!t!=!!e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s in t){const i=t[s],a=e[s];if(!!i!=!!a)return!1;const o=i.getChild(),c=a.getChild();if(o!==c&&!o.equals(c))return!1}return!0}function oi(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function ci(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!_t(t)||!_t(e))return t===e;const r=t,n=e;let s,i=0,a=0;for(s in r)i++;for(s in n)a++;if(i!==a)return!1;for(s in r){const o=r[s],c=n[s];if(Lr(o)&&Lr(c)){if(!oi(o,c))return!1}else if(_t(o)&&_t(c)){if(!ci(o,c))return!1}else if(o!==c)return!1}return!0}function Lr(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const $s=new Set,nl=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},sl=function(){for(let t=0;t<999;t++){const e=nl();if(!$s.has(e))return $s.add(e),e}return""},Ps="https://null.example";let nr=class{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return Bt.basename(new URL(e,Ps).pathname)}static extension(e){return Bt.extension(new URL(e,Ps).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let i=0;i<s.length;i++)s[i]!=="."&&(s[i]===".."?n.pop():n.push(s[i]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};nr.DEFAULT_INIT={},nr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const rt=t=>t,il=new Set;let Dn=class extends Fn{constructor(e,r=""){super(e),this[ie].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,rt)}copy(e,r=rt){for(const n in this[ie]){const s=this[ie][n];if(s instanceof Ut)this[Ft].has(n)||s.dispose();else if(Kt(s))for(const i of s)i.dispose();else if(Jt(s))for(const i in s)s[i].dispose()}for(const n in e[ie]){const s=this[ie][n],i=e[ie][n];if(i instanceof Ut)this[Ft].has(n)?s.getChild().copy(r(i.getChild()),r):this.setRef(n,r(i.getChild()),i.getAttributes());else if(Kt(i))for(const a of i)this.addRef(n,r(a.getChild()),a.getAttributes());else if(Jt(i))for(const a in i){const o=i[a];this.setRefMap(n,a,r(o.getChild()),o.getAttributes())}else this[ie][n]=_t(i)?JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.slice():i}return this}equals(e,r=il){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[ie]){if(r.has(n))continue;const s=this[ie][n],i=e[ie][n];if(Tn(s)||Tn(i)){if(!el(s,i))return!1}else if(Kt(s)||Kt(i)){if(!tl(s,i))return!1}else if(Jt(s)||Jt(i)){if(!rl(s,i))return!1}else if(_t(s)||_t(i)){if(!ci(s,i))return!1}else if(Lr(s)||Lr(i)){if(!oi(s,i))return!1}else if(s!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}},Ne=class extends Dn{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r.t(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}},W=class ce extends Ne{constructor(...e){super(...e),this.i=he.identity,this.o=he.identity}init(){this.propertyType=U.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:ce.Type.SCALAR,componentType:ce.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,r=rt){return super.copy(e,r),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case ce.Type.SCALAR:return 1;case ce.Type.VEC2:return 2;case ce.Type.VEC3:return 3;case ce.Type.VEC4:case ce.Type.MAT2:return 4;case ce.Type.MAT3:return 9;case ce.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case ce.ComponentType.BYTE:case ce.ComponentType.UNSIGNED_BYTE:return 1;case ce.ComponentType.SHORT:case ce.ComponentType.UNSIGNED_SHORT:return 2;case ce.ComponentType.UNSIGNED_INT:case ce.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getElementSize();this.getMin(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMin(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.min(e[a],o))}return e}getMaxNormalized(e){const r=this.getElementSize();this.getMax(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=-1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.max(e[a],o))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return ce.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=r=>he.decodeNormalizedInt(r,this.get("componentType")),this.i=r=>he.encodeNormalizedInt(r,this.get("componentType"))):(this.o=he.identity,this.i=he.identity),this}getScalar(e){const r=this.getElementSize();return this.o(this.get("array")[e*r])}setScalar(e,r){return this.get("array")[e*this.getElementSize()]=this.i(r),this}getElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let i=0;i<n;i++)r[i]=this.o(s[e*n+i]);return r}setElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let i=0;i<n;i++)s[e*n+i]=this.i(r[i]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(r){switch(r.constructor){case Float32Array:return ce.ComponentType.FLOAT;case Uint32Array:return ce.ComponentType.UNSIGNED_INT;case Uint16Array:return ce.ComponentType.UNSIGNED_SHORT;case Uint8Array:return ce.ComponentType.UNSIGNED_BYTE;case Int16Array:return ce.ComponentType.SHORT;case Int8Array:return ce.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):ce.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}};W.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},W.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};let fi=class extends Ne{init(){this.propertyType=U.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}},$n=class extends Ne{init(){this.propertyType=U.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};$n.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let Gr=class li extends Ne{init(){this.propertyType=U.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:li.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:$e.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:$e.OTHER})}};Gr.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let ui=class extends Ne{init(){this.propertyType=U.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},cr=class hi extends Ne{init(){this.propertyType=U.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:hi.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};cr.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let ye=class extends Dn{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};ye.EXTENSION_NAME=void 0;let ge=class _n extends Ne{init(){this.propertyType=U.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:_n.WrapMode.REPEAT,wrapT:_n.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};ge.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ge.MagFilter={NEAREST:9728,LINEAR:9729},ge.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Ir,G:Ar,B:Sr,A:al}=ze;let at=class pi extends Ne{init(){this.propertyType=U.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:pi.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new ge(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new ge(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new ge(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new ge(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new ge(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Oe.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const r=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Oe.hexToFactor(e,r))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Ir|Ar|Sr|al,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Oe.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const r=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Oe.hexToFactor(e,r))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Ir|Ar|Sr,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Ir|Ar|Sr})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Ir})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Ar|Sr})}};at.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let gi=class extends Ne{init(){this.propertyType=U.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},di=class extends Ne{constructor(...e){super(...e),this.u=null}init(){this.propertyType=U.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,r=rt){if(r===rt)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return he.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return he.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return he.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return he.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return he.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)Zf(n,n,r.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const r=this[ie].children;return r[r.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===U.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}},ir=class mi extends Ne{init(){this.propertyType=U.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:mi.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:$e.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:$e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};ir.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let ol=class extends Dn{init(){this.propertyType=U.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:$e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function Se(){return Se=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Se.apply(this,arguments)}let vi=class extends Ne{init(){this.propertyType=U.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,r=rt){if(r===rt)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}},yi=class extends Ne{init(){this.propertyType=U.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:$e.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}},xi=class extends Ne{init(){this.propertyType=U.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||We.extensionToMimeType(Bt.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=We.extensionToMimeType(Bt.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Y.assertView(e))}getSize(){const e=this.get("image");return e?We.getSize(e,this.getMimeType()):null}},Ti=class extends Ne{init(){this.propertyType=U.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${si}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",r=>{this.l(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=rt){if(r===rt)throw new Error("Root cannot be copied.");this.set("asset",Se({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Se({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}l(e){return e instanceof vi?this.addRef("scenes",e):e instanceof di?this.addRef("nodes",e):e instanceof cr?this.addRef("cameras",e):e instanceof yi?this.addRef("skins",e):e instanceof gi?this.addRef("meshes",e):e instanceof at?this.addRef("materials",e):e instanceof xi?this.addRef("textures",e):e instanceof fi?this.addRef("animations",e):e instanceof W?this.addRef("accessors",e):e instanceof ui&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},Pn=class Or{static fromGraph(e){return Or.m.get(e)||null}constructor(){this.v=new Hf,this.T=new Ti(this.v),this.M=it.DEFAULT_INSTANCE,Or.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new Or().setLogger(this.M).merge(this)}merge(e){for(const i of e.getRoot().listExtensionsUsed()){const a=this.createExtension(i.constructor);i.isRequired()&&a.setRequired(!0)}const r=new Set,n=new Map;r.add(e.T),n.set(e.T,this.T);for(const i of e.v.listEdges())for(const a of[i.getParent(),i.getChild()]){if(r.has(a))continue;let o;o=a.propertyType===U.TEXTURE_INFO?a:new a.constructor(this.v),n.set(a,o),r.add(a)}const s=i=>{const a=n.get(i);if(!a)throw new Error("Could resolve property.");return a};for(const i of r){const a=n.get(i);if(!a)throw new Error("Could resolve property.");a.propertyType!==U.TEXTURE_INFO&&a.copy(i,s)}return this}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===r)||new e(this)}createScene(e=""){return new vi(this.v,e)}createNode(e=""){return new di(this.v,e)}createCamera(e=""){return new cr(this.v,e)}createSkin(e=""){return new yi(this.v,e)}createMesh(e=""){return new gi(this.v,e)}createPrimitive(){return new ir(this.v)}createPrimitiveTarget(e=""){return new ol(this.v,e)}createMaterial(e=""){return new at(this.v,e)}createTexture(e=""){return new xi(this.v,e)}createAnimation(e=""){return new fi(this.v,e)}createAnimationChannel(e=""){return new $n(this.v,e)}createAnimationSampler(e=""){return new Gr(this.v,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new W(this.v,e).setBuffer(r)}createBuffer(e=""){return new ui(this.v,e)}};Pn.m=new WeakMap;let fe=class{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=n=>{const s=n,i=s.target;i instanceof ye&&i.extensionName===this.extensionName&&(s.type==="node:create"&&this.I(i),s.type==="node:dispose"&&this.N(i))};const r=e.getGraph();r.addEventListener("node:create",this.S),r.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}};fe.EXTENSION_NAME=void 0;let cl=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}};const Us={logger:it.DEFAULT_INSTANCE,extensions:[],dependencies:{}};let fl=class{static read(e,r=Us){const n=Se({},Us,r),{json:s}=e,i=new Pn().setLogger(n.logger);this.validate(e,n);const a=new cl(e),o=s.asset,c=i.getRoot().getAsset();o.copyright&&(c.copyright=o.copyright),o.extras&&(c.extras=o.extras),s.extras!==void 0&&i.getRoot().setExtras(Se({},s.extras));const u=s.extensionsUsed||[],p=s.extensionsRequired||[];for(const d of n.extensions)if(u.includes(d.EXTENSION_NAME)){const y=i.createExtension(d).setRequired(p.includes(d.EXTENSION_NAME));for(const M of y.readDependencies)y.install(M,n.dependencies[M])}const m=s.buffers||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(U.BUFFER)).forEach(d=>d.preread(a,U.BUFFER)),a.buffers=m.map(d=>{const y=i.createBuffer(d.name);return d.extras&&y.setExtras(d.extras),d.uri&&d.uri.indexOf("__")!==0&&y.setURI(d.uri),y}),a.bufferViewBuffers=(s.bufferViews||[]).map((d,y)=>{if(!a.bufferViews[y]){const M=e.json.buffers[d.buffer];a.bufferViews[y]=Y.toView(M.uri?e.resources[M.uri]:e.resources[Lt],d.byteOffset||0,d.byteLength)}return a.buffers[d.buffer]});const v=s.accessors||[];a.accessors=v.map(d=>{const y=i.createAccessor(d.name,a.bufferViewBuffers[d.bufferView]).setType(d.type);return d.extras&&y.setExtras(d.extras),d.normalized!==void 0&&y.setNormalized(d.normalized),d.bufferView===void 0||y.setArray(Nr(d,a)),y});const T=s.images||[],E=s.textures||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(U.TEXTURE)).forEach(d=>d.preread(a,U.TEXTURE)),a.textures=T.map(d=>{const y=i.createTexture(d.name);if(d.extras&&y.setExtras(d.extras),d.bufferView!==void 0){const M=s.bufferViews[d.bufferView],b=e.json.buffers[M.buffer],O=M.byteOffset||0,L=(b.uri?e.resources[b.uri]:e.resources[Lt]).slice(O,O+M.byteLength);y.setImage(L)}else d.uri!==void 0&&(y.setImage(e.resources[d.uri]),d.uri.indexOf("__")!==0&&y.setURI(d.uri));if(d.mimeType!==void 0)y.setMimeType(d.mimeType);else if(d.uri){const M=Bt.extension(d.uri);y.setMimeType(We.extensionToMimeType(M))}return y}),a.materials=(s.materials||[]).map(d=>{const y=i.createMaterial(d.name);d.extras&&y.setExtras(d.extras),d.alphaMode!==void 0&&y.setAlphaMode(d.alphaMode),d.alphaCutoff!==void 0&&y.setAlphaCutoff(d.alphaCutoff),d.doubleSided!==void 0&&y.setDoubleSided(d.doubleSided);const M=d.pbrMetallicRoughness||{};if(M.baseColorFactor!==void 0&&y.setBaseColorFactor(M.baseColorFactor),d.emissiveFactor!==void 0&&y.setEmissiveFactor(d.emissiveFactor),M.metallicFactor!==void 0&&y.setMetallicFactor(M.metallicFactor),M.roughnessFactor!==void 0&&y.setRoughnessFactor(M.roughnessFactor),M.baseColorTexture!==void 0){const b=M.baseColorTexture;y.setBaseColorTexture(a.textures[E[b.index].source]),a.setTextureInfo(y.getBaseColorTextureInfo(),b)}if(d.emissiveTexture!==void 0){const b=d.emissiveTexture;y.setEmissiveTexture(a.textures[E[b.index].source]),a.setTextureInfo(y.getEmissiveTextureInfo(),b)}if(d.normalTexture!==void 0){const b=d.normalTexture;y.setNormalTexture(a.textures[E[b.index].source]),a.setTextureInfo(y.getNormalTextureInfo(),b),d.normalTexture.scale!==void 0&&y.setNormalScale(d.normalTexture.scale)}if(d.occlusionTexture!==void 0){const b=d.occlusionTexture;y.setOcclusionTexture(a.textures[E[b.index].source]),a.setTextureInfo(y.getOcclusionTextureInfo(),b),d.occlusionTexture.strength!==void 0&&y.setOcclusionStrength(d.occlusionTexture.strength)}if(M.metallicRoughnessTexture!==void 0){const b=M.metallicRoughnessTexture;y.setMetallicRoughnessTexture(a.textures[E[b.index].source]),a.setTextureInfo(y.getMetallicRoughnessTextureInfo(),b)}return y});const A=s.meshes||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(U.PRIMITIVE)).forEach(d=>d.preread(a,U.PRIMITIVE)),a.meshes=A.map(d=>{const y=i.createMesh(d.name);return d.extras&&y.setExtras(d.extras),d.weights!==void 0&&y.setWeights(d.weights),(d.primitives||[]).forEach(M=>{const b=i.createPrimitive();M.extras&&b.setExtras(M.extras),M.material!==void 0&&b.setMaterial(a.materials[M.material]),M.mode!==void 0&&b.setMode(M.mode);for(const[L,P]of Object.entries(M.attributes||{}))b.setAttribute(L,a.accessors[P]);M.indices!==void 0&&b.setIndices(a.accessors[M.indices]);const O=d.extras&&d.extras.targetNames||[];(M.targets||[]).forEach((L,P)=>{const V=O[P]||P.toString(),G=i.createPrimitiveTarget(V);for(const[j,H]of Object.entries(L))G.setAttribute(j,a.accessors[H]);b.addTarget(G)}),y.addPrimitive(b)}),y}),a.cameras=(s.cameras||[]).map(d=>{const y=i.createCamera(d.name).setType(d.type);if(d.extras&&y.setExtras(d.extras),d.type===cr.Type.PERSPECTIVE){const M=d.perspective;y.setYFov(M.yfov),y.setZNear(M.znear),M.zfar!==void 0&&y.setZFar(M.zfar),M.aspectRatio!==void 0&&y.setAspectRatio(M.aspectRatio)}else{const M=d.orthographic;y.setZNear(M.znear).setZFar(M.zfar).setXMag(M.xmag).setYMag(M.ymag)}return y});const h=s.nodes||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(U.NODE)).forEach(d=>d.preread(a,U.NODE)),a.nodes=h.map(d=>{const y=i.createNode(d.name);if(d.extras&&y.setExtras(d.extras),d.translation!==void 0&&y.setTranslation(d.translation),d.rotation!==void 0&&y.setRotation(d.rotation),d.scale!==void 0&&y.setScale(d.scale),d.matrix!==void 0){const M=[0,0,0],b=[0,0,0,1],O=[1,1,1];he.decompose(d.matrix,M,b,O),y.setTranslation(M),y.setRotation(b),y.setScale(O)}return d.weights!==void 0&&y.setWeights(d.weights),y}),a.skins=(s.skins||[]).map(d=>{const y=i.createSkin(d.name);d.extras&&y.setExtras(d.extras),d.inverseBindMatrices!==void 0&&y.setInverseBindMatrices(a.accessors[d.inverseBindMatrices]),d.skeleton!==void 0&&y.setSkeleton(a.nodes[d.skeleton]);for(const M of d.joints)y.addJoint(a.nodes[M]);return y}),h.map((d,y)=>{const M=a.nodes[y];(d.children||[]).forEach(b=>M.addChild(a.nodes[b])),d.mesh!==void 0&&M.setMesh(a.meshes[d.mesh]),d.camera!==void 0&&M.setCamera(a.cameras[d.camera]),d.skin!==void 0&&M.setSkin(a.skins[d.skin])}),a.animations=(s.animations||[]).map(d=>{const y=i.createAnimation(d.name);d.extras&&y.setExtras(d.extras);const M=(d.samplers||[]).map(b=>{const O=i.createAnimationSampler().setInput(a.accessors[b.input]).setOutput(a.accessors[b.output]).setInterpolation(b.interpolation||Gr.Interpolation.LINEAR);return b.extras&&O.setExtras(b.extras),y.addSampler(O),O});return(d.channels||[]).forEach(b=>{const O=i.createAnimationChannel().setSampler(M[b.sampler]).setTargetPath(b.target.path);b.target.node!==void 0&&O.setTargetNode(a.nodes[b.target.node]),b.extras&&O.setExtras(b.extras),y.addChannel(O)}),y});const _=s.scenes||[];return i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(U.SCENE)).forEach(d=>d.preread(a,U.SCENE)),a.scenes=_.map(d=>{const y=i.createScene(d.name);return d.extras&&y.setExtras(d.extras),(d.nodes||[]).map(M=>a.nodes[M]).forEach(M=>y.addChild(M)),y}),s.scene!==void 0&&i.getRoot().setDefaultScene(a.scenes[s.scene]),i.getRoot().listExtensionsUsed().forEach(d=>d.read(a)),v.forEach((d,y)=>{const M=a.accessors[y],b=!!d.sparse,O=!d.bufferView&&!M.getArray();(b||O)&&M.setSparse(!0).setArray(function(L,P){const V=Ur[L.componentType],G=W.getElementSize(L.type);let j;j=L.bufferView!==void 0?Nr(L,P):new V(L.count*G);const H=L.sparse;if(!H)return j;const z=H.count,D=Se({},L,H.indices,{count:z,type:"SCALAR"}),q=Se({},L,H.values,{count:z}),Z=Nr(D,P),re=Nr(q,P);for(let J=0;J<D.count;J++)for(let X=0;X<G;X++)j[Z[J]*G+X]=re[J*G+X];return j}(d,a))}),i}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(i=>i.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(i=>i.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}};function Nr(t,e){const r=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=Ur[t.componentType],i=W.getElementSize(t.type),a=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==i*a)return function(c,u){const p=u.bufferViews[c.bufferView],m=u.jsonDoc.json.bufferViews[c.bufferView],v=Ur[c.componentType],T=W.getElementSize(c.type),E=v.BYTES_PER_ELEMENT,A=c.byteOffset||0,h=new v(c.count*T),_=new DataView(p.buffer,p.byteOffset,p.byteLength),d=m.byteStride;for(let y=0;y<c.count;y++)for(let M=0;M<T;M++){const b=A+y*d+M*E;let O;switch(c.componentType){case W.ComponentType.FLOAT:O=_.getFloat32(b,!0);break;case W.ComponentType.UNSIGNED_INT:O=_.getUint32(b,!0);break;case W.ComponentType.UNSIGNED_SHORT:O=_.getUint16(b,!0);break;case W.ComponentType.UNSIGNED_BYTE:O=_.getUint8(b);break;case W.ComponentType.SHORT:O=_.getInt16(b,!0);break;case W.ComponentType.BYTE:O=_.getInt8(b);break;default:throw new Error(`Unexpected componentType "${c.componentType}".`)}h[y*T+M]=O}return h}(t,e);const o=r.byteOffset+(t.byteOffset||0);return new s(r.buffer.slice(o,o+t.count*i*a))}var sr;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(sr||(sr={}));let Xe=class{constructor(e,r,n){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),i=s.listBuffers().length,a=s.listTextures().length;this.bufferURIGenerator=new Ls(i>1,()=>n.basename||"buffer"),this.imageURIGenerator=new Ls(a>1,o=>function(c,u){const p=c.getGraph().listParentEdges(u).find(m=>m.getParent()!==c.getRoot());return p?p.getName().replace(/texture$/i,""):""}(e,o)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},a=JSON.stringify(i);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(a)};return r.getTexCoord()!==0&&(o.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(o.extras=r.getExtras()),this.textureInfoDefMap.set(r,o),o}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===bt.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=We.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=r}}getAccessorUsage(e){const r=this.C.get(e);if(r)return r;if(e.getSparse())return $e.SPARSE;for(const n of this.O.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==U.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return $e.OTHER}addAccessorToUsageGroup(e,r){const n=this.C.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this.C.set(e,r),this}listAccessorUsageGroups(){const e={};for(const[r,n]of Array.from(this.C.entries()))e[n]=e[n]||[],e[n].push(r);return e}};Xe.BufferViewTarget=sr,Xe.BufferViewUsage=$e,Xe.USAGE_TO_TARGET={[$e.ARRAY_BUFFER]:sr.ARRAY_BUFFER,[$e.ELEMENT_ARRAY_BUFFER]:sr.ELEMENT_ARRAY_BUFFER};let Ls=class{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}return`${this.basename(e)}.${r}`}};const{BufferViewUsage:Cr}=Xe,{UNSIGNED_INT:ll,UNSIGNED_SHORT:ul,UNSIGNED_BYTE:hl}=W.ComponentType;let pl=class{static write(e,r){const n=e.getRoot(),s={asset:Se({generator:`glTF-Transform ${si}`},n.getAsset()),extras:Se({},n.getExtras())},i={json:s,resources:{}},a=new Xe(e,i,r),o=r.logger||it.DEFAULT_INSTANCE,c=new Set(r.extensions.map(h=>h.EXTENSION_NAME)),u=e.getRoot().listExtensionsUsed().filter(h=>c.has(h.extensionName)),p=e.getRoot().listExtensionsRequired().filter(h=>c.has(h.extensionName));u.length<e.getRoot().listExtensionsUsed().length&&o.warn("Some extensions were not registered for I/O, and will not be written.");for(const h of u)for(const _ of h.writeDependencies)h.install(_,r.dependencies[_]);function m(h,_,d,y){const M=[];let b=0;for(const L of h){const P=a.createAccessorDef(L);P.bufferView=s.bufferViews.length;const V=L.getArray(),G=Y.pad(Y.toView(V));P.byteOffset=b,b+=G.byteLength,M.push(G),a.accessorIndexMap.set(L,s.accessors.length),s.accessors.push(P)}const O={buffer:_,byteOffset:d,byteLength:Y.concat(M).byteLength};return y&&(O.target=y),s.bufferViews.push(O),{buffers:M,byteLength:b}}function v(h,_,d){const y=h[0].getCount();let M=0;for(const P of h){const V=a.createAccessorDef(P);V.bufferView=s.bufferViews.length,V.byteOffset=M;const G=P.getElementSize(),j=P.getComponentSize();M+=Y.padNumber(G*j),a.accessorIndexMap.set(P,s.accessors.length),s.accessors.push(V)}const b=y*M,O=new ArrayBuffer(b),L=new DataView(O);for(let P=0;P<y;P++){let V=0;for(const G of h){const j=G.getElementSize(),H=G.getComponentSize(),z=G.getComponentType(),D=G.getArray();for(let q=0;q<j;q++){const Z=P*M+V+q*H,re=D[P*j+q];switch(z){case W.ComponentType.FLOAT:L.setFloat32(Z,re,!0);break;case W.ComponentType.BYTE:L.setInt8(Z,re);break;case W.ComponentType.SHORT:L.setInt16(Z,re,!0);break;case W.ComponentType.UNSIGNED_BYTE:L.setUint8(Z,re);break;case W.ComponentType.UNSIGNED_SHORT:L.setUint16(Z,re,!0);break;case W.ComponentType.UNSIGNED_INT:L.setUint32(Z,re,!0);break;default:throw new Error("Unexpected component type: "+z)}}V+=Y.padNumber(j*H)}}return s.bufferViews.push({buffer:_,byteOffset:d,byteLength:b,byteStride:M,target:Xe.BufferViewTarget.ARRAY_BUFFER}),{byteLength:b,buffers:[new Uint8Array(O)]}}function T(h,_,d){const y=[];let M=0;const b=new Map;let O=-1/0;for(const z of h){const D=a.createAccessorDef(z);s.accessors.push(D),a.accessorIndexMap.set(z,s.accessors.length-1);const q=[],Z=[],re=[],J=new Array(z.getElementSize()).fill(0);for(let we=0,Te=z.getCount();we<Te;we++)if(z.getElement(we,re),!he.eq(re,J,0)){O=Math.max(we,O),q.push(we);for(let Ue=0;Ue<re.length;Ue++)Z.push(re[Ue])}const X=q.length,oe={accessorDef:D,count:X};if(b.set(z,oe),X===0)continue;if(X>z.getCount()/3){const we=(100*q.length/z.getCount()).toFixed(1);o.warn(`Sparse accessor with many non-zero elements (${we}%) may increase file size.`)}const de=Ur[z.getComponentType()];oe.indices=q,oe.values=new de(Z)}if(!Number.isFinite(O))return{buffers:y,byteLength:M};const L=O<255?Uint8Array:O<65535?Uint16Array:Uint32Array,P=O<255?hl:O<65535?ul:ll,V={buffer:_,byteOffset:d+M,byteLength:0};for(const z of h){const D=b.get(z);if(D.count===0)continue;D.indicesByteOffset=V.byteLength;const q=Y.pad(Y.toView(new L(D.indices)));y.push(q),M+=q.byteLength,V.byteLength+=q.byteLength}s.bufferViews.push(V);const G=s.bufferViews.length-1,j={buffer:_,byteOffset:d+M,byteLength:0};for(const z of h){const D=b.get(z);if(D.count===0)continue;D.valuesByteOffset=j.byteLength;const q=Y.pad(Y.toView(D.values));y.push(q),M+=q.byteLength,j.byteLength+=q.byteLength}s.bufferViews.push(j);const H=s.bufferViews.length-1;for(const z of h){const D=b.get(z);D.count!==0&&(D.accessorDef.sparse={count:D.count,indices:{bufferView:G,byteOffset:D.indicesByteOffset,componentType:P},values:{bufferView:H,byteOffset:D.valuesByteOffset}})}return{buffers:y,byteLength:M}}const E=new Map;for(const h of e.getGraph().listEdges()){if(h.getParent()===n)continue;const _=h.getChild();if(_ instanceof W){const d=E.get(_)||[];d.push(h),E.set(_,d)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map((h,_)=>{const d=a.createPropertyDef(h);h.getMimeType()&&(d.mimeType=h.getMimeType());const y=h.getImage();return y&&a.createImageData(d,y,h),a.imageIndexMap.set(h,_),d}),u.filter(h=>h.prewriteTypes.includes(U.ACCESSOR)).forEach(h=>h.prewrite(a,U.ACCESSOR)),n.listAccessors().forEach(h=>{const _=a.accessorUsageGroupedByParent,d=a.accessorParents;if(a.accessorIndexMap.has(h))return;const y=E.get(h)||[],M=a.getAccessorUsage(h);if(a.addAccessorToUsageGroup(h,M),_.has(M)){const b=y[0].getParent(),O=d.get(b)||new Set;O.add(h),d.set(b,O)}}),u.filter(h=>h.prewriteTypes.includes(U.BUFFER)).forEach(h=>h.prewrite(a,U.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||a.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach((h,_)=>{const d=a.createPropertyDef(h),y=a.accessorUsageGroupedByParent,M=a.accessorParents,b=h.listParents().filter(j=>j instanceof W),O=new Set(b),L=[],P=s.buffers.length;let V=0;const G=a.listAccessorUsageGroups();for(const j in G)if(y.has(j))for(const H of Array.from(M.values())){const z=Array.from(H).filter(D=>O.has(D)).filter(D=>a.getAccessorUsage(D)===j);if(z.length)if(j!==Cr.ARRAY_BUFFER||r.vertexLayout===Pr.INTERLEAVED){const D=j===Cr.ARRAY_BUFFER?v(z,P,V):m(z,P,V);V+=D.byteLength,L.push(...D.buffers)}else for(const D of z){const q=v([D],P,V);V+=q.byteLength,L.push(...q.buffers)}}else{const H=G[j].filter(q=>O.has(q));if(!H.length)continue;const z=j===Cr.ELEMENT_ARRAY_BUFFER?Xe.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,D=j===Cr.SPARSE?T(H,P,V):m(H,P,V,z);V+=D.byteLength,L.push(...D.buffers)}if(a.imageBufferViews.length&&_===0){for(let j=0;j<a.imageBufferViews.length;j++)if(s.bufferViews[s.images[j].bufferView].byteOffset=V,V+=a.imageBufferViews[j].byteLength,L.push(a.imageBufferViews[j]),V%8){const H=8-V%8;V+=H,L.push(new Uint8Array(H))}}if(a.otherBufferViews.has(h))for(const j of a.otherBufferViews.get(h))s.bufferViews.push({buffer:P,byteOffset:V,byteLength:j.byteLength}),a.otherBufferViewsIndexMap.set(j,s.bufferViews.length-1),V+=j.byteLength,L.push(j);if(V){let j;r.format===bt.GLB?j=Lt:(j=a.bufferURIGenerator.createURI(h,"bin"),d.uri=j),d.byteLength=V,i.resources[j]=Y.concat(L)}s.buffers.push(d),a.bufferIndexMap.set(h,_)}),n.listAccessors().find(h=>!h.getBuffer())&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=n.listMaterials().map((h,_)=>{const d=a.createPropertyDef(h);if(h.getAlphaMode()!==at.AlphaMode.OPAQUE&&(d.alphaMode=h.getAlphaMode()),h.getAlphaMode()===at.AlphaMode.MASK&&(d.alphaCutoff=h.getAlphaCutoff()),h.getDoubleSided()&&(d.doubleSided=!0),d.pbrMetallicRoughness={},he.eq(h.getBaseColorFactor(),[1,1,1,1])||(d.pbrMetallicRoughness.baseColorFactor=h.getBaseColorFactor()),he.eq(h.getEmissiveFactor(),[0,0,0])||(d.emissiveFactor=h.getEmissiveFactor()),h.getRoughnessFactor()!==1&&(d.pbrMetallicRoughness.roughnessFactor=h.getRoughnessFactor()),h.getMetallicFactor()!==1&&(d.pbrMetallicRoughness.metallicFactor=h.getMetallicFactor()),h.getBaseColorTexture()){const y=h.getBaseColorTexture(),M=h.getBaseColorTextureInfo();d.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(y,M)}if(h.getEmissiveTexture()){const y=h.getEmissiveTexture(),M=h.getEmissiveTextureInfo();d.emissiveTexture=a.createTextureInfoDef(y,M)}if(h.getNormalTexture()){const y=h.getNormalTexture(),M=h.getNormalTextureInfo(),b=a.createTextureInfoDef(y,M);h.getNormalScale()!==1&&(b.scale=h.getNormalScale()),d.normalTexture=b}if(h.getOcclusionTexture()){const y=h.getOcclusionTexture(),M=h.getOcclusionTextureInfo(),b=a.createTextureInfoDef(y,M);h.getOcclusionStrength()!==1&&(b.strength=h.getOcclusionStrength()),d.occlusionTexture=b}if(h.getMetallicRoughnessTexture()){const y=h.getMetallicRoughnessTexture(),M=h.getMetallicRoughnessTextureInfo();d.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(y,M)}return a.materialIndexMap.set(h,_),d}),s.meshes=n.listMeshes().map((h,_)=>{const d=a.createPropertyDef(h);let y=null;return d.primitives=h.listPrimitives().map(M=>{const b={attributes:{}};b.mode=M.getMode();const O=M.getMaterial();O&&(b.material=a.materialIndexMap.get(O)),Object.keys(M.getExtras()).length&&(b.extras=M.getExtras());const L=M.getIndices();L&&(b.indices=a.accessorIndexMap.get(L));for(const P of M.listSemantics())b.attributes[P]=a.accessorIndexMap.get(M.getAttribute(P));for(const P of M.listTargets()){const V={};for(const G of P.listSemantics())V[G]=a.accessorIndexMap.get(P.getAttribute(G));b.targets=b.targets||[],b.targets.push(V)}return M.listTargets().length&&!y&&(y=M.listTargets().map(P=>P.getName())),b}),h.getWeights().length&&(d.weights=h.getWeights()),y&&(d.extras=d.extras||{},d.extras.targetNames=y),a.meshIndexMap.set(h,_),d}),s.cameras=n.listCameras().map((h,_)=>{const d=a.createPropertyDef(h);if(d.type=h.getType(),d.type===cr.Type.PERSPECTIVE){d.perspective={znear:h.getZNear(),zfar:h.getZFar(),yfov:h.getYFov()};const y=h.getAspectRatio();y!==null&&(d.perspective.aspectRatio=y)}else d.orthographic={znear:h.getZNear(),zfar:h.getZFar(),xmag:h.getXMag(),ymag:h.getYMag()};return a.cameraIndexMap.set(h,_),d}),s.nodes=n.listNodes().map((h,_)=>{const d=a.createPropertyDef(h);return he.eq(h.getTranslation(),[0,0,0])||(d.translation=h.getTranslation()),he.eq(h.getRotation(),[0,0,0,1])||(d.rotation=h.getRotation()),he.eq(h.getScale(),[1,1,1])||(d.scale=h.getScale()),h.getWeights().length&&(d.weights=h.getWeights()),a.nodeIndexMap.set(h,_),d}),s.skins=n.listSkins().map((h,_)=>{const d=a.createPropertyDef(h),y=h.getInverseBindMatrices();y&&(d.inverseBindMatrices=a.accessorIndexMap.get(y));const M=h.getSkeleton();return M&&(d.skeleton=a.nodeIndexMap.get(M)),d.joints=h.listJoints().map(b=>a.nodeIndexMap.get(b)),a.skinIndexMap.set(h,_),d}),n.listNodes().forEach((h,_)=>{const d=s.nodes[_],y=h.getMesh();y&&(d.mesh=a.meshIndexMap.get(y));const M=h.getCamera();M&&(d.camera=a.cameraIndexMap.get(M));const b=h.getSkin();b&&(d.skin=a.skinIndexMap.get(b)),h.listChildren().length>0&&(d.children=h.listChildren().map(O=>a.nodeIndexMap.get(O)))}),s.animations=n.listAnimations().map((h,_)=>{const d=a.createPropertyDef(h),y=new Map;return d.samplers=h.listSamplers().map((M,b)=>{const O=a.createPropertyDef(M);return O.input=a.accessorIndexMap.get(M.getInput()),O.output=a.accessorIndexMap.get(M.getOutput()),O.interpolation=M.getInterpolation(),y.set(M,b),O}),d.channels=h.listChannels().map(M=>{const b=a.createPropertyDef(M);return b.sampler=y.get(M.getSampler()),b.target={node:a.nodeIndexMap.get(M.getTargetNode()),path:M.getTargetPath()},b}),a.animationIndexMap.set(h,_),d}),s.scenes=n.listScenes().map((h,_)=>{const d=a.createPropertyDef(h);return d.nodes=h.listChildren().map(y=>a.nodeIndexMap.get(y)),a.sceneIndexMap.set(h,_),d});const A=n.getDefaultScene();return A&&(s.scene=n.listScenes().indexOf(A)),s.extensionsUsed=u.map(h=>h.extensionName),s.extensionsRequired=p.map(h=>h.extensionName),u.forEach(h=>h.write(a)),function(h){const _=[];for(const d in h){const y=h[d];(Array.isArray(y)&&y.length===0||y===null||y===""||y&&typeof y=="object"&&Object.keys(y).length===0)&&_.push(d)}for(const d of _)delete h[d]}(s),i}};var Br;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(Br||(Br={}));let gl=class{constructor(){this.M=it.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=Pr.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const r of e)this.h.add(r),r.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=Bs(r)?this.P(r):{json:JSON.parse(Y.decodeText(r)),resources:{}};return await this.L(n,this.dirname(e)),this.j(n),n}async readJSON(e){return e=this.D(e),this.j(e),fl.read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const r=this.P(Y.assertView(e));this.j(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>function(i,a){return a.uri!==void 0&&!(a.uri in i.resources)}(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(i,a){return a.uri!==void 0&&!(a.uri in i.resources)&&a.bufferView===void 0}(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(Y.assertView(e)))}async writeJSON(e,r={}){if(r.format===bt.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return pl.write(e,{format:r.format||bt.GLTF,basename:r.basename||"",logger:this.M,vertexLayout:this.U,dependencies:Se({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:bt.GLB}),s=new Uint32Array([1179937895,2,12]),i=JSON.stringify(r),a=Y.pad(Y.encodeText(i),32),o=Y.toView(new Uint32Array([a.byteLength,1313821514])),c=Y.concat([o,a]);s[s.length-1]+=c.byteLength;const u=Object.values(n)[0];if(!u||!u.byteLength)return Y.concat([Y.toView(s),c]);const p=Y.pad(u,0),m=Y.toView(new Uint32Array([p.byteLength,5130562])),v=Y.concat([m,p]);return s[s.length-1]+=v.byteLength,Y.concat([Y.toView(s),c,v])}async L(e,r){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(i){const a=i.uri;if(!a||a.match(/data:/))return Promise.resolve();e.resources[a]=await n.readURI(n.resolve(r,a),"view"),n.lastReadBytes+=e.resources[a].byteLength});await Promise.all(s)}j(e){function r(n){if(n.uri){if(n.uri in e.resources)Y.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${sl()}.${Bt.extension(n.uri)}`;e.resources[s]=Y.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(n)}),(e.json.buffers||[]).forEach(r)}D(e){const{images:r,buffers:n}=e.json;return e={json:Se({},e.json),resources:Se({},e.resources)},r&&(e.json.images=r.map(s=>Se({},s))),n&&(e.json.buffers=n.map(s=>Se({},s))),e}P(e){if(!Bs(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Br.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=Y.decodeText(Y.toView(e,20,n)),i=JSON.parse(s),a=20+n;if(e.byteLength<=a)return{json:i,resources:{}};const o=new Uint32Array(e.buffer,e.byteOffset+a,2);if(o[1]!==Br.BIN)throw new Error("Expected GLB BIN in second chunk.");const c=Y.toView(e,a+8,o[0]);return{json:i,resources:{[Lt]:c}}}};function Bs(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}let dl=class extends gl{constructor(e=nr.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,r){const n=await fetch(e,this.k);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return nr.resolve(e,r)}dirname(e){return nr.dirname(e)}};const ml=0,vl=0,yl=0,xl=2,Tl=0,Ml=163,El=166,wl=0,Rl=2,_l=1,bl=64,Il=0;class Al{constructor(){this.vkFormat=Il,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=ml,this.levels=[],this.dataFormatDescriptor=[{vendorId:yl,descriptorType:vl,descriptorBlockSize:0,versionNumber:xl,colorModel:Tl,colorPrimaries:_l,transferFunction:Rl,flags:wl,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Yt{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const Ie=[171,75,84,88,32,50,48,187,13,10,26,10];function Vs(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function vn(t){const e=new Uint8Array(t.buffer,t.byteOffset,Ie.length);if(e[0]!==Ie[0]||e[1]!==Ie[1]||e[2]!==Ie[2]||e[3]!==Ie[3]||e[4]!==Ie[4]||e[5]!==Ie[5]||e[6]!==Ie[6]||e[7]!==Ie[7]||e[8]!==Ie[8]||e[9]!==Ie[9]||e[10]!==Ie[10]||e[11]!==Ie[11])throw new Error("Missing KTX 2.0 identifier.");const r=new Al,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Yt(t,Ie.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const i=s._nextUint32();r.supercompressionScheme=s._nextUint32();const a=s._nextUint32(),o=s._nextUint32(),c=s._nextUint32(),u=s._nextUint32(),p=s._nextUint64(),m=s._nextUint64(),v=i*3*8,T=new Yt(t,Ie.length+n,v,!0);for(let oe=0;oe<i;oe++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+T._nextUint64(),T._nextUint64()),uncompressedByteLength:T._nextUint64()});const E=new Yt(t,a,o,!0),A={vendorId:E._skip(4)._nextUint16(),descriptorType:E._nextUint16(),versionNumber:E._nextUint16(),descriptorBlockSize:E._nextUint16(),colorModel:E._nextUint8(),colorPrimaries:E._nextUint8(),transferFunction:E._nextUint8(),flags:E._nextUint8(),texelBlockDimension:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],bytesPlane:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],samples:[]},h=6,_=4,d=(A.descriptorBlockSize/4-h)/_;for(let oe=0;oe<d;oe++){const de={bitOffset:E._nextUint16(),bitLength:E._nextUint8(),channelType:E._nextUint8(),samplePosition:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};de.channelType&bl?(de.sampleLower=E._nextInt32(),de.sampleUpper=E._nextInt32()):(de.sampleLower=E._nextUint32(),de.sampleUpper=E._nextUint32()),A.samples[oe]=de}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(A);const y=new Yt(t,c,u,!0);for(;y._offset<u;){const oe=y._nextUint32(),de=y._scan(oe),we=Vs(de),Te=y._scan(oe-de.byteLength);r.keyValue[we]=we.match(/^ktx/i)?Vs(Te):Te,y._offset%4&&y._skip(4-y._offset%4)}if(m<=0)return r;const M=new Yt(t,p,m,!0),b=M._nextUint16(),O=M._nextUint16(),L=M._nextUint32(),P=M._nextUint32(),V=M._nextUint32(),G=M._nextUint32(),j=[];for(let oe=0;oe<i;oe++)j.push({imageFlags:M._nextUint32(),rgbSliceByteOffset:M._nextUint32(),rgbSliceByteLength:M._nextUint32(),alphaSliceByteOffset:M._nextUint32(),alphaSliceByteLength:M._nextUint32()});const H=p+M._offset,z=H+L,D=z+P,q=D+V,Z=new Uint8Array(t.buffer,t.byteOffset+H,L),re=new Uint8Array(t.buffer,t.byteOffset+z,P),J=new Uint8Array(t.buffer,t.byteOffset+D,V),X=new Uint8Array(t.buffer,t.byteOffset+q,G);return r.globalData={endpointCount:b,selectorCount:O,imageDescs:j,endpointsData:Z,selectorsData:re,tablesData:J,extendedData:X},r}const Un="EXT_mesh_gpu_instancing",bn="EXT_meshopt_compression",Mi="KHR_draco_mesh_compression",Ln="KHR_lights_punctual",Bn="KHR_materials_anisotropy",Vn="KHR_materials_clearcoat",jn="KHR_materials_emissive_strength",zn="KHR_materials_ior",kn="KHR_materials_iridescence",Gn="KHR_materials_pbrSpecularGlossiness",qn="KHR_materials_sheen",Hn="KHR_materials_specular",Wn="KHR_materials_transmission",Xn="KHR_materials_unlit",Yn="KHR_materials_volume",It="KHR_materials_variants",Kn="KHR_texture_transform",Vr="KHR_xmp_json_ld",In="INSTANCE_ATTRIBUTE";class Ei extends ye{init(){this.extensionName=Un,this.propertyType="InstancedMesh",this.parentTypes=[U.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:In})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Ei.EXTENSION_NAME=Un;const pt=Un;class wi extends fe{constructor(...e){super(...e),this.extensionName=pt,this.provideTypes=[U.NODE],this.prewriteTypes=[U.ACCESSOR]}createInstancedMesh(){return new Ei(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((r,n)=>{if(!r.extensions||!r.extensions[pt])return;const s=r.extensions[pt],i=this.createInstancedMesh();for(const a in s.attributes)i.setAttribute(a,e.accessors[s.attributes[a]]);e.nodes[n].setExtension(pt,i)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(In);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,In);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(pt);if(s){const i=e.nodeIndexMap.get(n),a=r.json.nodes[i],o={attributes:{}};s.listSemantics().forEach(c=>{const u=s.getAttribute(c);o.attributes[c]=e.accessorIndexMap.get(u)}),a.extensions=a.extensions||{},a.extensions[pt]=o}}),this}}function tt(){return tt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tt.apply(this,arguments)}var ar,Dt,ve;wi.EXTENSION_NAME=pt,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(ar||(ar={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(Dt||(Dt={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(ve||(ve={}));const{BYTE:Sl,SHORT:js,FLOAT:Nl}=W.ComponentType,{encodeNormalizedInt:zs,decodeNormalizedInt:yn}=he;function Cl(t,e,r,n){const{filter:s,bits:i}=n,a={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==Dt.ATTRIBUTES)return a;if(s!==ve.NONE){let o=t.getNormalized()?function(c){const u=c.getComponentType(),p=c.getArray(),m=new Float32Array(p.length);for(let v=0;v<p.length;v++)m[v]=yn(p[v],u);return m}(t):new Float32Array(a.array);switch(s){case ve.EXPONENTIAL:a.byteStride=4*t.getElementSize(),a.componentType=Nl,a.normalized=!1,a.array=e.encodeFilterExp(o,t.getCount(),a.byteStride,i);break;case ve.OCTAHEDRAL:a.byteStride=i>8?8:4,a.componentType=i>8?js:Sl,a.normalized=!0,o=t.getElementSize()===3?function(c){const u=new Float32Array(4*c.length/3);for(let p=0,m=c.length/3;p<m;p++)u[4*p]=c[3*p],u[4*p+1]=c[3*p+1],u[4*p+2]=c[3*p+2];return u}(o):o,a.array=e.encodeFilterOct(o,t.getCount(),a.byteStride,i);break;case ve.QUATERNION:a.byteStride=8,a.componentType=js,a.normalized=!0,a.array=e.encodeFilterQuat(o,t.getCount(),a.byteStride,i);break;default:throw new Error("Invalid filter.")}a.min=t.getMin([]),a.max=t.getMax([]),t.getNormalized()&&(a.min=a.min.map(c=>yn(c,t.getComponentType())),a.max=a.max.map(c=>yn(c,t.getComponentType()))),a.normalized&&(a.min=a.min.map(c=>zs(c,a.componentType)),a.max=a.max.map(c=>zs(c,a.componentType)))}else a.byteStride%4&&(a.array=function(o,c){const u=Y.padNumber(o.BYTES_PER_ELEMENT*c)/o.BYTES_PER_ELEMENT,p=new o.constructor(o.length/c*u);for(let m=0;m*c<o.length;m++)for(let v=0;v<c;v++)p[m*u+v]=o[m*c+v];return p}(a.array,t.getElementSize()),a.byteStride=a.array.byteLength/t.getCount());return a}function Ol(t,e){return e===Xe.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(r=>r instanceof ir&&r.getMode()===ir.Mode.TRIANGLES)?Dt.TRIANGLES:Dt.INDICES:Dt.ATTRIBUTES}function Fl(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof Ti));for(const n of r){const s=n.getName(),i=n.getAttributes().key||"";if(s==="indices")return{filter:ve.NONE};if(s==="attributes"){if(i==="POSITION")return{filter:ve.NONE};if(i==="TEXCOORD_0")return{filter:ve.NONE};if(i==="NORMAL")return{filter:ve.OCTAHEDRAL,bits:8};if(i==="TANGENT")return{filter:ve.OCTAHEDRAL,bits:8};if(i.startsWith("JOINTS_"))return{filter:ve.NONE};if(i.startsWith("WEIGHTS_"))return{filter:ve.NONE}}if(s==="output"){const a=Ri(t);return a==="rotation"?{filter:ve.QUATERNION,bits:16}:a==="translation"||a==="scale"?{filter:ve.EXPONENTIAL,bits:12}:{filter:ve.NONE}}if(s==="input")return{filter:ve.NONE};if(s==="inverseBindMatrices")return{filter:ve.NONE}}return{filter:ve.NONE}}function Ri(t){for(const e of t.listParents())if(e instanceof Gr){for(const r of e.listParents())if(r instanceof $n)return r.getTargetPath()}return null}const Ae=bn,ks={method:ar.QUANTIZE};class An extends fe{constructor(...e){super(...e),this.extensionName=Ae,this.prereadTypes=[U.BUFFER,U.PRIMITIVE],this.prewriteTypes=[U.BUFFER,U.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=ks,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=tt({},ks,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Ae}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Ae}]: Missing WASM support.`)}return r===U.BUFFER?this._prereadBuffers(e):r===U.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[Ae])return;const i=n.extensions[Ae],a=i.byteOffset||0,o=i.byteLength||0,c=i.count,u=i.byteStride,p=new Uint8Array(c*u),m=r.json.buffers[i.buffer],v=Y.toView(m.uri?r.resources[m.uri]:r.resources[Lt],a,o);this._decoder.decodeGltfBuffer(p,c,u,v,i.mode,i.filter),e.bufferViews[s]=p})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[Ae]&&(s=r.json.buffers[n.buffer]).extensions&&s.extensions[bn]&&s.extensions[bn].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[Ae].buffer])})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof W&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===U.ACCESSOR?this._prewriteAccessors(e):r===U.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,i=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(i);this._encoderFallbackBuffer=i,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const o of this.document.getRoot().listAccessors()){if(Ri(o)==="weights"||o.getSparse())continue;const c=e.getAccessorUsage(o),u=Ol(o,c),p=s.method===ar.FILTER?Fl(o,this.document):{filter:ve.NONE},m=Cl(o,n,u,p),{array:v,byteStride:T}=m,E=o.getBuffer();if(!E)throw new Error(`${Ae}: Missing buffer for accessor.`);const A=this.document.getRoot().listBuffers().indexOf(E),h=[c,u,p.filter,T,A].join(":");let _=this._encoderBufferViews[h],d=this._encoderBufferViewData[h],y=this._encoderBufferViewAccessors[h];_&&d||(y=this._encoderBufferViewAccessors[h]=[],d=this._encoderBufferViewData[h]=[],_=this._encoderBufferViews[h]={buffer:a,target:Xe.USAGE_TO_TARGET[c],byteOffset:0,byteLength:0,byteStride:c===Xe.BufferViewUsage.ARRAY_BUFFER?T:void 0,extensions:{[Ae]:{buffer:A,byteOffset:0,byteLength:0,mode:u,filter:p.filter!==ve.NONE?p.filter:void 0,byteStride:T,count:0}}});const M=e.createAccessorDef(o);M.componentType=m.componentType,M.normalized=m.normalized,M.byteOffset=_.byteLength,M.min&&m.min&&(M.min=m.min),M.max&&m.max&&(M.max=m.max),e.accessorIndexMap.set(o,r.accessors.length),r.accessors.push(M),y.push(M),d.push(new Uint8Array(v.buffer,v.byteOffset,v.byteLength)),_.byteLength+=v.byteLength,_.extensions.EXT_meshopt_compression.count+=o.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],i=this._encoderBufferViewData[n],a=this.document.getRoot().listBuffers()[s.extensions[Ae].buffer],o=e.otherBufferViews.get(a)||[],{count:c,byteStride:u,mode:p}=s.extensions[Ae],m=Y.concat(i),v=r.encodeGltfBuffer(m,c,u,p),T=Y.pad(v);s.extensions[Ae].byteLength=v.byteLength,i.length=0,i.push(T),o.push(T),e.otherBufferViews.set(a,o)}}write(e){let r=0;for(const a in this._encoderBufferViews){const o=this._encoderBufferViews[a],c=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[a][0]),u=this._encoderBufferViewAccessors[a];for(const v of u)v.bufferView=c;const p=e.jsonDoc.json.bufferViews[c],m=p.byteOffset||0;Object.assign(p,o),p.byteOffset=r,p.extensions[Ae].byteOffset=m,r+=Y.padNumber(o.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),i=e.jsonDoc.json.buffers[s];return i.byteLength=r,i.extensions={[Ae]:{fallback:!0}},n.dispose(),this}}An.EXTENSION_NAME=Ae,An.EncoderMethod=ar;const Zt="EXT_texture_avif";class Dl{match(e){return e.length>=12&&Y.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=Gs(r,0);if(!n)return null;let s=n.end;for(;n=Gs(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class _i extends fe{constructor(...e){super(...e),this.extensionName=Zt,this.prereadTypes=[U.TEXTURE]}static register(){We.registerFormat("image/avif",new Dl)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Zt]&&(r.source=r.extensions[Zt].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Zt]={source:i.source},delete i.source)})}}),this}}function Gs(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:Y.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}_i.EXTENSION_NAME=Zt;const er="EXT_texture_webp";class $l{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=Y.decodeText(e.slice(0,4)),n=Y.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<s.byteLength;){const a=Y.decodeText(new Uint8Array([s.getUint8(i),s.getUint8(i+1),s.getUint8(i+2),s.getUint8(i+3)])),o=s.getUint32(i+4,!0);if(a==="VP8 ")return[16383&s.getInt16(i+14,!0),16383&s.getInt16(i+16,!0)];if(a==="VP8L"){const c=s.getUint8(i+9),u=s.getUint8(i+10),p=s.getUint8(i+11);return[1+((63&u)<<8|c),1+((15&s.getUint8(i+12))<<10|p<<2|(192&u)>>6)]}i+=8+o+o%2}return null}getChannels(e){return 4}}class bi extends fe{constructor(...e){super(...e),this.extensionName=er,this.prereadTypes=[U.TEXTURE]}static register(){We.registerFormat("image/webp",new $l)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[er]&&(r.source=r.extensions[er].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[er]={source:i.source},delete i.source)})}}),this}}bi.EXTENSION_NAME=er;const qs=Mi;let Ee,Ii,Ai,Ce;function Pl(t,e){const r=new Ee.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==Ee.TRIANGULAR_MESH)throw new Error(`[${qs}] Unknown geometry type.`);const n=new Ee.Mesh;if(!t.DecodeBufferToMesh(r,n).ok()||n.ptr===0)throw new Error(`[${qs}] Decoding failure.`);return n}finally{Ee.destroy(r)}}function Ul(t,e){const r=3*e.num_faces();let n,s;if(e.num_points()<=65534){const i=r*Uint16Array.BYTES_PER_ELEMENT;n=Ee._malloc(i),t.GetTrianglesUInt16Array(e,i,n),s=new Uint16Array(Ee.HEAPU16.buffer,n,r).slice()}else{const i=r*Uint32Array.BYTES_PER_ELEMENT;n=Ee._malloc(i),t.GetTrianglesUInt32Array(e,i,n),s=new Uint32Array(Ee.HEAPU32.buffer,n,r).slice()}return Ee._free(n),s}function Ll(t,e,r,n){const s=Ai[n.componentType],i=Ii[n.componentType],a=r.num_components(),o=e.num_points()*a,c=o*i.BYTES_PER_ELEMENT,u=Ee._malloc(c);t.GetAttributeDataArrayForAllPoints(e,r,s,c,u);const p=new i(Ee.HEAPF32.buffer,u,o).slice();return Ee._free(u),p}var or,Pe;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})(or||(or={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(Pe||(Pe={}));const Si={[Pe.POSITION]:14,[Pe.NORMAL]:10,[Pe.COLOR]:8,[Pe.TEX_COORD]:12,[Pe.GENERIC]:12},Hs={decodeSpeed:5,encodeSpeed:5,method:or.EDGEBREAKER,quantizationBits:Si,quantizationVolume:"mesh"};function Bl(t,e=Hs){const r=tt({},Hs,e);r.quantizationBits=tt({},Si,e.quantizationBits);const n=new Ce.Encoder,s=new Ce.MeshBuilder,i=new Ce.Mesh,a={},o=new Ce.DracoInt8Array,c=t.listTargets().length>0;let u=!1;for(const h of t.listSemantics()){const _=t.getAttribute(h);if(_.getSparse()){u=!0;continue}const d=Vl(h),y=jl(s,_.getComponentType(),i,Ce[d],_.getCount(),_.getElementSize(),_.getArray());if(y===-1)throw new Error(`Error compressing "${h}" attribute.`);if(a[h]=y,r.quantizationVolume==="mesh"||h!=="POSITION")n.SetAttributeQuantization(Ce[d],r.quantizationBits[d]);else{if(typeof r.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:M}=r,b=Math.max(M.max[0]-M.min[0],M.max[1]-M.min[1],M.max[2]-M.min[2]);n.SetAttributeExplicitQuantization(Ce[d],r.quantizationBits[d],_.getElementSize(),M.min,b)}}}const p=t.getIndices();if(!p)throw new Fr("Primitive must have indices.");s.AddFacesToMesh(i,p.getCount()/3,p.getArray()),n.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),n.SetTrackEncodedProperties(!0),n.SetEncodingMethod(r.method===or.SEQUENTIAL||c||u?Ce.MESH_SEQUENTIAL_ENCODING:Ce.MESH_EDGEBREAKER_ENCODING);const m=n.EncodeMeshToDracoBuffer(i,o);if(m<=0)throw new Fr("Error applying Draco compression.");const v=new Uint8Array(m);for(let h=0;h<m;++h)v[h]=o.GetValue(h);const T=t.getAttribute("POSITION").getCount(),E=n.GetNumberOfEncodedPoints(),A=3*n.GetNumberOfEncodedFaces();if((c||u)&&E!==T)throw new Fr('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return Ce.destroy(o),Ce.destroy(i),Ce.destroy(s),Ce.destroy(n),{numVertices:E,numIndices:A,data:v,attributeIDs:a}}function Vl(t){return t==="POSITION"?Pe.POSITION:t==="NORMAL"?Pe.NORMAL:t.startsWith("COLOR_")?Pe.COLOR:t.startsWith("TEXCOORD_")?Pe.TEX_COORD:Pe.GENERIC}function jl(t,e,r,n,s,i,a){switch(e){case W.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,i,a);case W.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,i,a);case W.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,i,a);case W.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,i,a);case W.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,i,a);case W.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,i,a);default:throw new Error(`Unexpected component type, "${e}".`)}}class Fr extends Error{}const me=Mi;class Sn extends fe{constructor(...e){super(...e),this.extensionName=me,this.prereadTypes=[U.PRIMITIVE],this.prewriteTypes=[U.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,Ee=this._decoderModule,Ii={[W.ComponentType.FLOAT]:Float32Array,[W.ComponentType.UNSIGNED_INT]:Uint32Array,[W.ComponentType.UNSIGNED_SHORT]:Uint16Array,[W.ComponentType.UNSIGNED_BYTE]:Uint8Array,[W.ComponentType.SHORT]:Int16Array,[W.ComponentType.BYTE]:Int8Array},Ai={[W.ComponentType.FLOAT]:Ee.DT_FLOAT32,[W.ComponentType.UNSIGNED_INT]:Ee.DT_UINT32,[W.ComponentType.UNSIGNED_SHORT]:Ee.DT_UINT16,[W.ComponentType.UNSIGNED_BYTE]:Ee.DT_UINT8,[W.ComponentType.SHORT]:Ee.DT_INT16,[W.ComponentType.BYTE]:Ee.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=r,Ce=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${me}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const i=n.json.meshes||[];for(const a of i)for(const o of a.primitives){if(!o.extensions||!o.extensions[me])continue;const c=o.extensions[me];let[u,p]=s.get(c.bufferView)||[];if(!p||!u){const m=n.json.bufferViews[c.bufferView],v=n.json.buffers[m.buffer],T=Y.toView(v.uri?n.resources[v.uri]:n.resources[Lt],m.byteOffset||0,m.byteLength);u=new this._decoderModule.Decoder,p=Pl(u,T),s.set(c.bufferView,[u,p]),r.debug(`[${me}] Decompressed ${T.byteLength} bytes.`)}for(const m in o.attributes){const v=e.jsonDoc.json.accessors[o.attributes[m]],T=u.GetAttributeByUniqueId(p,c.attributes[m]),E=Ll(u,p,T,v);e.accessors[o.attributes[m]].setArray(E)}o.indices!==void 0&&e.accessors[o.indices].setArray(Ul(u,p))}}finally{for(const[i,a]of Array.from(s.values()))this._decoderModule.destroy(i),this._decoderModule.destroy(a)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${me}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${me}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(o){const c=o.getLogger(),u=new Set,p=new Set;for(const h of o.getRoot().listMeshes())for(const _ of h.listPrimitives())_.getIndices()?_.getMode()!==ir.Mode.TRIANGLES?(p.add(_),c.warn(`[${me}] Skipping Draco compression on non-TRIANGLES primitive.`)):u.add(_):(p.add(_),c.warn(`[${me}] Skipping Draco compression on non-indexed primitive.`));const m=o.getRoot().listAccessors(),v=new Map;for(let h=0;h<m.length;h++)v.set(m[h],h);const T=new Map,E=new Set,A=new Map;for(const h of Array.from(u)){let _=Ws(h,v);if(E.has(_))A.set(h,_);else{if(T.has(h.getIndices())){const d=h.getIndices(),y=d.clone();v.set(y,o.getRoot().listAccessors().length-1),h.swap(d,y)}for(const d of h.listAttributes())if(T.has(d)){const y=d.clone();v.set(y,o.getRoot().listAccessors().length-1),h.swap(d,y)}_=Ws(h,v),E.add(_),A.set(h,_),T.set(h.getIndices(),_);for(const d of h.listAttributes())T.set(d,_)}}for(const h of Array.from(T.keys())){const _=new Set(h.listParents().map(d=>d.propertyType));if(_.size!==2||!_.has(U.PRIMITIVE)||!_.has(U.ROOT))throw new Error(`[${me}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const h of Array.from(u)){const _=A.get(h),d=h.getIndices();if(T.get(d)!==_||h.listAttributes().some(y=>T.get(y)!==_))throw new Error(`[${me}] Draco primitives must share all, or no, accessors.`)}for(const h of Array.from(p)){const _=h.getIndices();if(T.has(_)||h.listAttributes().some(d=>T.has(d)))throw new Error(`[${me}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return A}(this.document),i=new Map;let a="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${me}]: quantizationVolume=scene requires exactly 1 scene.`):a=Kf(this.document.getRoot().listScenes().pop()));for(const o of Array.from(s.keys())){const c=s.get(o);if(!c)throw new Error("Unexpected primitive.");if(i.has(c)){i.set(c,i.get(c));continue}const u=o.getIndices(),p=e.jsonDoc.json.accessors;let m;try{m=Bl(o,tt({},this._encoderOptions,{quantizationVolume:a}))}catch(E){if(E instanceof Fr){n.warn(`[${me}]: ${E.message} Skipping primitive compression.`);continue}throw E}i.set(c,m);const v=e.createAccessorDef(u);v.count=m.numIndices,e.accessorIndexMap.set(u,p.length),p.push(v);for(const E of o.listSemantics()){const A=o.getAttribute(E);if(m.attributeIDs[E]===void 0)continue;const h=e.createAccessorDef(A);h.count=m.numVertices,e.accessorIndexMap.set(A,p.length),p.push(h)}const T=o.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(T)||e.otherBufferViews.set(T,[]),e.otherBufferViews.get(T).push(m.data)}return n.debug(`[${me}] Compressed ${s.size} primitives.`),e.extensionData[me]={primitiveHashMap:s,primitiveEncodingMap:i},this}write(e){const r=e.extensionData[me];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let i=0;i<n.listPrimitives().length;i++){const a=n.listPrimitives()[i],o=s.primitives[i],c=r.primitiveHashMap.get(a);if(!c)continue;const u=r.primitiveEncodingMap.get(c);u&&(o.extensions=o.extensions||{},o.extensions[me]={bufferView:e.otherBufferViewsIndexMap.get(u.data),attributes:u.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==me),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==me)}return this}}function Ws(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}Sn.EXTENSION_NAME=me,Sn.EncoderMethod=or;class Vt extends ye{init(){this.extensionName=Ln,this.propertyType="Light",this.parentTypes=[U.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:Vt.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Oe.factorToHex(this.getColor())}setColorHex(e){const r=this.getColor().slice();return Oe.hexToFactor(e,r),this.setColor(r)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}Vt.EXTENSION_NAME=Ln,Vt.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const qe=Ln;class Ni extends fe{constructor(...e){super(...e),this.extensionName=qe}createLight(e=""){return new Vt(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[qe])return this;const n=(r.json.extensions[qe].lights||[]).map(s=>{var i,a;const o=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&o.setColor(s.color),s.intensity!==void 0&&o.setIntensity(s.intensity),s.range!==void 0&&o.setRange(s.range),((i=s.spot)==null?void 0:i.innerConeAngle)!==void 0&&o.setInnerConeAngle(s.spot.innerConeAngle),((a=s.spot)==null?void 0:a.outerConeAngle)!==void 0&&o.setOuterConeAngle(s.spot.outerConeAngle),o});return r.json.nodes.forEach((s,i)=>{s.extensions&&s.extensions[qe]&&e.nodes[i].setExtension(qe,n[s.extensions[qe].light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const i of this.properties){const a=i,o={type:a.getType()};he.eq(a.getColor(),[1,1,1])||(o.color=a.getColor()),a.getIntensity()!==1&&(o.intensity=a.getIntensity()),a.getRange()!=null&&(o.range=a.getRange()),a.getName()&&(o.name=a.getName()),a.getType()===Vt.Type.SPOT&&(o.spot={innerConeAngle:a.getInnerConeAngle(),outerConeAngle:a.getOuterConeAngle()}),n.push(o),s.set(a,n.length-1)}return this.document.getRoot().listNodes().forEach(i=>{const a=i.getExtension(qe);if(a){const o=e.nodeIndexMap.get(i),c=r.json.nodes[o];c.extensions=c.extensions||{},c.extensions[qe]={light:s.get(a)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[qe]={lights:n},this}}Ni.EXTENSION_NAME=qe;const{R:zl,G:kl,B:Gl}=ze;class Ci extends ye{init(){this.extensionName=Bn,this.propertyType="Anisotropy",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new ge(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:zl|kl|Gl})}}Ci.EXTENSION_NAME=Bn;const gt=Bn;class Oi extends fe{constructor(...e){super(...e),this.extensionName=gt}createAnisotropy(){return new Ci(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[gt]){const a=this.createAnisotropy();e.materials[i].setExtension(gt,a);const o=s.extensions[gt];if(o.anisotropyStrength!==void 0&&a.setAnisotropyStrength(o.anisotropyStrength),o.anisotropyRotation!==void 0&&a.setAnisotropyRotation(o.anisotropyRotation),o.anisotropyTexture!==void 0){const c=o.anisotropyTexture;a.setAnisotropyTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getAnisotropyTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(gt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[gt]={};if(s.getAnisotropyStrength()>0&&(o.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(o.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const c=s.getAnisotropyTexture(),u=s.getAnisotropyTextureInfo();o.anisotropyTexture=e.createTextureInfoDef(c,u)}}}),this}}Oi.EXTENSION_NAME=gt;const{R:Xs,G:Ys,B:ql}=ze;class Fi extends ye{init(){this.extensionName=Vn,this.propertyType="Clearcoat",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new ge(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new ge(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new ge(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Xs})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Ys})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Xs|Ys|ql})}}Fi.EXTENSION_NAME=Vn;const dt=Vn;class Di extends fe{constructor(...e){super(...e),this.extensionName=dt}createClearcoat(){return new Fi(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[dt]){const a=this.createClearcoat();e.materials[i].setExtension(dt,a);const o=s.extensions[dt];if(o.clearcoatFactor!==void 0&&a.setClearcoatFactor(o.clearcoatFactor),o.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(o.clearcoatRoughnessFactor),o.clearcoatTexture!==void 0){const c=o.clearcoatTexture;a.setClearcoatTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatTextureInfo(),c)}if(o.clearcoatRoughnessTexture!==void 0){const c=o.clearcoatRoughnessTexture;a.setClearcoatRoughnessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),c)}if(o.clearcoatNormalTexture!==void 0){const c=o.clearcoatNormalTexture;a.setClearcoatNormalTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),c),c.scale!==void 0&&a.setClearcoatNormalScale(c.scale)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(dt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[dt]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const c=s.getClearcoatTexture(),u=s.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(c,u)}if(s.getClearcoatRoughnessTexture()){const c=s.getClearcoatRoughnessTexture(),u=s.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(c,u)}if(s.getClearcoatNormalTexture()){const c=s.getClearcoatNormalTexture(),u=s.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(c,u),s.getClearcoatNormalScale()!==1&&(o.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}Di.EXTENSION_NAME=dt;class $i extends ye{init(){this.extensionName=jn,this.propertyType="EmissiveStrength",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}$i.EXTENSION_NAME=jn;const mt=jn;class Pi extends fe{constructor(...e){super(...e),this.extensionName=mt}createEmissiveStrength(){return new $i(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[mt]){const s=this.createEmissiveStrength();e.materials[n].setExtension(mt,s);const i=r.extensions[mt];i.emissiveStrength!==void 0&&s.setEmissiveStrength(i.emissiveStrength)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(mt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[mt]={emissiveStrength:s.getEmissiveStrength()}}}),this}}Pi.EXTENSION_NAME=mt;class Ui extends ye{init(){this.extensionName=zn,this.propertyType="IOR",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}Ui.EXTENSION_NAME=zn;const vt=zn;class Li extends fe{constructor(...e){super(...e),this.extensionName=vt}createIOR(){return new Ui(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[vt]){const s=this.createIOR();e.materials[n].setExtension(vt,s);const i=r.extensions[vt];i.ior!==void 0&&s.setIOR(i.ior)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(vt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[vt]={ior:s.getIOR()}}}),this}}Li.EXTENSION_NAME=vt;const{R:Hl,G:Wl}=ze;class Bi extends ye{init(){this.extensionName=kn,this.propertyType="Iridescence",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new ge(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new ge(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Hl})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Wl})}}Bi.EXTENSION_NAME=kn;const yt=kn;class Vi extends fe{constructor(...e){super(...e),this.extensionName=yt}createIridescence(){return new Bi(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[yt]){const a=this.createIridescence();e.materials[i].setExtension(yt,a);const o=s.extensions[yt];if(o.iridescenceFactor!==void 0&&a.setIridescenceFactor(o.iridescenceFactor),o.iridescenceIor!==void 0&&a.setIridescenceIOR(o.iridescenceIor),o.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(o.iridescenceThicknessMaximum),o.iridescenceTexture!==void 0){const c=o.iridescenceTexture;a.setIridescenceTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getIridescenceTextureInfo(),c)}if(o.iridescenceThicknessTexture!==void 0){const c=o.iridescenceThicknessTexture;a.setIridescenceThicknessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(yt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[yt]={};if(s.getIridescenceFactor()>0&&(o.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(o.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(o.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(o.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const c=s.getIridescenceTexture(),u=s.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(c,u)}if(s.getIridescenceThicknessTexture()){const c=s.getIridescenceThicknessTexture(),u=s.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(c,u)}}}),this}}Vi.EXTENSION_NAME=yt;const{R:Ks,G:Js,B:Qs,A:Zs}=ze;class ji extends ye{init(){this.extensionName=Gn,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new ge(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new ge(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Oe.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const r=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Oe.hexToFactor(e,r))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Ks|Js|Qs|Zs,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Ks|Js|Qs|Zs})}}ji.EXTENSION_NAME=Gn;const xt=Gn;class zi extends fe{constructor(...e){super(...e),this.extensionName=xt}createPBRSpecularGlossiness(){return new ji(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[xt]){const a=this.createPBRSpecularGlossiness();e.materials[i].setExtension(xt,a);const o=s.extensions[xt];if(o.diffuseFactor!==void 0&&a.setDiffuseFactor(o.diffuseFactor),o.specularFactor!==void 0&&a.setSpecularFactor(o.specularFactor),o.glossinessFactor!==void 0&&a.setGlossinessFactor(o.glossinessFactor),o.diffuseTexture!==void 0){const c=o.diffuseTexture;a.setDiffuseTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getDiffuseTextureInfo(),c)}if(o.specularGlossinessTexture!==void 0){const c=o.specularGlossinessTexture;a.setSpecularGlossinessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(xt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[xt]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const c=s.getDiffuseTexture(),u=s.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(c,u)}if(s.getSpecularGlossinessTexture()){const c=s.getSpecularGlossinessTexture(),u=s.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(c,u)}}}),this}}zi.EXTENSION_NAME=xt;const{R:Xl,G:Yl,B:Kl,A:Jl}=ze;class ki extends ye{init(){this.extensionName=qn,this.propertyType="Sheen",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new ge(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new ge(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Oe.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const r=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Oe.hexToFactor(e,r))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Xl|Yl|Kl,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Jl})}}ki.EXTENSION_NAME=qn;const Tt=qn;class Gi extends fe{constructor(...e){super(...e),this.extensionName=Tt}createSheen(){return new ki(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Tt]){const a=this.createSheen();e.materials[i].setExtension(Tt,a);const o=s.extensions[Tt];if(o.sheenColorFactor!==void 0&&a.setSheenColorFactor(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(o.sheenRoughnessFactor),o.sheenColorTexture!==void 0){const c=o.sheenColorTexture;a.setSheenColorTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSheenColorTextureInfo(),c)}if(o.sheenRoughnessTexture!==void 0){const c=o.sheenRoughnessTexture;a.setSheenRoughnessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Tt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Tt]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const c=s.getSheenColorTexture(),u=s.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(c,u)}if(s.getSheenRoughnessTexture()){const c=s.getSheenRoughnessTexture(),u=s.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(c,u)}}}),this}}Gi.EXTENSION_NAME=Tt;const{R:Ql,G:Zl,B:eu,A:tu}=ze;class qi extends ye{init(){this.extensionName=Hn,this.propertyType="Specular",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new ge(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new ge(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Oe.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const r=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Oe.hexToFactor(e,r))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:tu})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Ql|Zl|eu,isColor:!0})}}qi.EXTENSION_NAME=Hn;const Mt=Hn;class Hi extends fe{constructor(...e){super(...e),this.extensionName=Mt}createSpecular(){return new qi(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Mt]){const a=this.createSpecular();e.materials[i].setExtension(Mt,a);const o=s.extensions[Mt];if(o.specularFactor!==void 0&&a.setSpecularFactor(o.specularFactor),o.specularColorFactor!==void 0&&a.setSpecularColorFactor(o.specularColorFactor),o.specularTexture!==void 0){const c=o.specularTexture;a.setSpecularTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularTextureInfo(),c)}if(o.specularColorTexture!==void 0){const c=o.specularColorTexture;a.setSpecularColorTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularColorTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Mt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Mt]={};if(s.getSpecularFactor()!==1&&(o.specularFactor=s.getSpecularFactor()),he.eq(s.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const c=s.getSpecularTexture(),u=s.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(c,u)}if(s.getSpecularColorTexture()){const c=s.getSpecularColorTexture(),u=s.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(c,u)}}}),this}}Hi.EXTENSION_NAME=Mt;const{R:ru}=ze;class Wi extends ye{init(){this.extensionName=Wn,this.propertyType="Transmission",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new ge(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:ru})}}Wi.EXTENSION_NAME=Wn;const Et=Wn;class Xi extends fe{constructor(...e){super(...e),this.extensionName=Et}createTransmission(){return new Wi(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Et]){const a=this.createTransmission();e.materials[i].setExtension(Et,a);const o=s.extensions[Et];if(o.transmissionFactor!==void 0&&a.setTransmissionFactor(o.transmissionFactor),o.transmissionTexture!==void 0){const c=o.transmissionTexture;a.setTransmissionTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getTransmissionTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Et);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Et]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const c=s.getTransmissionTexture(),u=s.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(c,u)}}}),this}}Xi.EXTENSION_NAME=Et;class Yi extends ye{init(){this.extensionName=Xn,this.propertyType="Unlit",this.parentTypes=[U.MATERIAL]}}Yi.EXTENSION_NAME=Xn;const Ot=Xn;class Jn extends fe{constructor(...e){super(...e),this.extensionName=Ot}createUnlit(){return new Yi(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{r.extensions&&r.extensions[Ot]&&e.materials[n].setExtension(Ot,this.createUnlit())}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(Ot)){const s=e.materialIndexMap.get(n),i=r.json.materials[s];i.extensions=i.extensions||{},i.extensions[Ot]={}}}),this}}Jn.EXTENSION_NAME=Ot;class Ki extends ye{init(){this.extensionName=It,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Ki.EXTENSION_NAME=It;class Ji extends ye{init(){this.extensionName=It,this.propertyType="MappingList",this.parentTypes=[U.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Ji.EXTENSION_NAME=It;class Nn extends ye{init(){this.extensionName=It,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Nn.EXTENSION_NAME=It;const He=It;class Qi extends fe{constructor(...e){super(...e),this.extensionName=He}createMappingList(){return new Ji(this.document.getGraph())}createVariant(e=""){return new Nn(this.document.getGraph(),e)}createMapping(){return new Ki(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Nn)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[He])return this;const n=(r.json.extensions[He].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(r.json.meshes||[]).forEach((s,i)=>{const a=e.meshes[i];(s.primitives||[]).forEach((o,c)=>{if(!o.extensions||!o.extensions[He])return;const u=this.createMappingList(),p=o.extensions[He];for(const m of p.mappings){const v=this.createMapping();m.material!==void 0&&v.setMaterial(e.materials[m.material]);for(const T of m.variants||[])v.addVariant(n[T]);u.addMapping(v)}a.listPrimitives()[c].setExtension(He,u)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],i=new Map;for(const a of n)i.set(a,s.length),s.push(e.createPropertyDef(a));for(const a of this.document.getRoot().listMeshes()){const o=e.meshIndexMap.get(a);a.listPrimitives().forEach((c,u)=>{const p=c.getExtension(He);if(!p)return;const m=e.jsonDoc.json.meshes[o].primitives[u],v=p.listMappings().map(T=>{const E=e.createPropertyDef(T),A=T.getMaterial();return A&&(E.material=e.materialIndexMap.get(A)),E.variants=T.listVariants().map(h=>i.get(h)),E});m.extensions=m.extensions||{},m.extensions[He]={mappings:v}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[He]={variants:s},this}}Qi.EXTENSION_NAME=He;const{G:nu}=ze;class Zi extends ye{init(){this.extensionName=Yn,this.propertyType="Volume",this.parentTypes=[U.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new ge(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:nu})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Oe.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const r=this.getAttenuationColor().slice();return this.set("attenuationColor",Oe.hexToFactor(e,r))}}Zi.EXTENSION_NAME=Yn;const wt=Yn;class ea extends fe{constructor(...e){super(...e),this.extensionName=wt}createVolume(){return new Zi(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[wt]){const a=this.createVolume();e.materials[i].setExtension(wt,a);const o=s.extensions[wt];if(o.thicknessFactor!==void 0&&a.setThicknessFactor(o.thicknessFactor),o.attenuationDistance!==void 0&&a.setAttenuationDistance(o.attenuationDistance),o.attenuationColor!==void 0&&a.setAttenuationColor(o.attenuationColor),o.thicknessTexture!==void 0){const c=o.thicknessTexture;a.setThicknessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getThicknessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(wt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[wt]={};if(s.getThicknessFactor()>0&&(o.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(o.attenuationDistance=s.getAttenuationDistance()),he.eq(s.getAttenuationColor(),[1,1,1])||(o.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const c=s.getThicknessTexture(),u=s.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(c,u)}}}),this}}ea.EXTENSION_NAME=wt;const ta="KHR_mesh_quantization";class ra extends fe{constructor(...e){super(...e),this.extensionName=ta}read(e){return this}write(e){return this}}ra.EXTENSION_NAME=ta;const tr="KHR_texture_basisu";class su{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=vn(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const r=vn(e).dataFormatDescriptor[0];if(r.colorModel===Ml)return r.samples.length===2&&(15&r.samples[1].channelType)==15?4:3;if(r.colorModel===El)return(15&r.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const r=vn(e),n=this.getChannels(e)>3;let s=0;for(let i=0;i<r.levels.length;i++){const a=r.levels[i];s+=a.uncompressedByteLength?a.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,i)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,i)))/4)*(n?16:8)}return s}}class na extends fe{constructor(...e){super(...e),this.extensionName=tr,this.prereadTypes=[U.TEXTURE]}static register(){We.registerFormat("image/ktx2",new su)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{r.extensions&&r.extensions[tr]&&(r.source=r.extensions[tr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[tr]={source:i.source},delete i.source)})}}),this}}na.EXTENSION_NAME=tr;class sa extends ye{init(){this.extensionName=Kn,this.propertyType="Transform",this.parentTypes=[U.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}sa.EXTENSION_NAME=Kn;const Rt=Kn;class ia extends fe{constructor(...e){super(...e),this.extensionName=Rt}createTransform(){return new sa(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Rt])continue;const s=this.createTransform(),i=n.extensions[Rt];i.offset!==void 0&&s.setOffset(i.offset),i.rotation!==void 0&&s.setRotation(i.rotation),i.scale!==void 0&&s.setScale(i.scale),i.texCoord!==void 0&&s.setTexCoord(i.texCoord),r.setExtension(Rt,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const i=n.getExtension(Rt);if(!i)continue;s.extensions=s.extensions||{};const a={},o=he.eq;o(i.getOffset(),[0,0])||(a.offset=i.getOffset()),i.getRotation()!==0&&(a.rotation=i.getRotation()),o(i.getScale(),[1,1])||(a.scale=i.getScale()),i.getTexCoord()!=null&&(a.texCoord=i.getTexCoord()),s.extensions[Rt]=a}return this}}ia.EXTENSION_NAME=Rt;const iu=[U.ROOT,U.SCENE,U.NODE,U.MESH,U.MATERIAL,U.TEXTURE,U.ANIMATION];class aa extends ye{init(){this.extensionName=Vr,this.propertyType="Packet",this.parentTypes=iu}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",tt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=tt({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){return tt({"@context":xn(this.get("context"))},xn(this.get("properties")))}fromJSONLD(e){const r=(e=xn(e))["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${Vr}: Missing context for term, "${e}".`)}}function xn(t){return JSON.parse(JSON.stringify(t))}aa.EXTENSION_NAME=Vr;const Ze=Vr;class oa extends fe{constructor(...e){super(...e),this.extensionName=Ze}createPacket(){return new aa(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[Ze];if(!n||!n.packets)return this;const s=e.jsonDoc.json,i=this.document.getRoot(),a=n.packets.map(u=>this.createPacket().fromJSONLD(u)),o=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],c=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let u=0;u<o.length;u++){const p=o[u]||[];for(let m=0;m<p.length;m++){const v=p[m];v.extensions&&v.extensions[Ze]&&c[u][m].setExtension(Ze,a[v.extensions[Ze].packet])}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const i of s.listParents()){let a;switch(i.propertyType){case U.ROOT:a=r.asset;break;case U.SCENE:a=r.scenes[e.sceneIndexMap.get(i)];break;case U.NODE:a=r.nodes[e.nodeIndexMap.get(i)];break;case U.MESH:a=r.meshes[e.meshIndexMap.get(i)];break;case U.MATERIAL:a=r.materials[e.materialIndexMap.get(i)];break;case U.TEXTURE:a=r.images[e.imageIndexMap.get(i)];break;case U.ANIMATION:a=r.animations[e.animationIndexMap.get(i)];break;default:a=null,this.document.getLogger().warn(`[${Ze}]: Unsupported parent property, "${i.propertyType}"`)}a&&(a.extensions=a.extensions||{},a.extensions[Ze]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[Ze]={packets:n}),this}}oa.EXTENSION_NAME=Ze;const ca=[Sn,Ni,Oi,Di,Pi,Li,Vi,zi,Hi,Gi,Xi,Jn,Qi,ea,ra,na,ia,oa];[...ca];var k=1e-6,K=typeof Float32Array<"u"?Float32Array:Array,je=Math.random;function fa(t){K=t}var au=Math.PI/180;function ou(t){return t*au}function cu(t,e){return Math.abs(t-e)<=k*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var fu=Object.freeze({__proto__:null,get ARRAY_TYPE(){return K},EPSILON:k,RANDOM:je,equals:cu,setMatrixArrayType:fa,toRadian:ou});function lu(){var t=new K(4);return K!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function uu(t){var e=new K(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function hu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function pu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function gu(t,e,r,n){var s=new K(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function du(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function mu(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function vu(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*i-s*n;return a?(a=1/a,t[0]=i*a,t[1]=-n*a,t[2]=-s*a,t[3]=r*a,t):null}function yu(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function xu(t){return t[0]*t[3]-t[2]*t[1]}function la(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],u=r[2],p=r[3];return t[0]=n*o+i*c,t[1]=s*o+a*c,t[2]=n*u+i*p,t[3]=s*u+a*p,t}function Tu(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+i*o,t[1]=s*c+a*o,t[2]=n*-o+i*c,t[3]=s*-o+a*c,t}function Mu(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1];return t[0]=n*o,t[1]=s*o,t[2]=i*c,t[3]=a*c,t}function Eu(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function wu(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Ru(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function _u(t){return Math.hypot(t[0],t[1],t[2],t[3])}function bu(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function Iu(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function ua(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Au(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Su(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],u=e[3];return Math.abs(r-a)<=k*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=k*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=k*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-u)<=k*Math.max(1,Math.abs(i),Math.abs(u))}function Nu(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Cu(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var Ou=la,Fu=ua,Du=Object.freeze({__proto__:null,LDU:bu,add:Iu,adjoint:yu,clone:uu,copy:hu,create:lu,determinant:xu,equals:Su,exactEquals:Au,frob:_u,fromRotation:Eu,fromScaling:wu,fromValues:gu,identity:pu,invert:vu,mul:Ou,multiply:la,multiplyScalar:Nu,multiplyScalarAndAdd:Cu,rotate:Tu,scale:Mu,set:du,str:Ru,sub:Fu,subtract:ua,transpose:mu});function $u(){var t=new K(6);return K!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function Pu(t){var e=new K(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Uu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Lu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Bu(t,e,r,n,s,i){var a=new K(6);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a[4]=s,a[5]=i,a}function Vu(t,e,r,n,s,i,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t}function ju(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=r*i-n*s;return c?(c=1/c,t[0]=i*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t[4]=(s*o-i*a)*c,t[5]=(n*a-r*o)*c,t):null}function zu(t){return t[0]*t[3]-t[1]*t[2]}function ha(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=r[0],p=r[1],m=r[2],v=r[3],T=r[4],E=r[5];return t[0]=n*u+i*p,t[1]=s*u+a*p,t[2]=n*m+i*v,t[3]=s*m+a*v,t[4]=n*T+i*E+o,t[5]=s*T+a*E+c,t}function ku(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=Math.sin(r),p=Math.cos(r);return t[0]=n*p+i*u,t[1]=s*p+a*u,t[2]=n*-u+i*p,t[3]=s*-u+a*p,t[4]=o,t[5]=c,t}function Gu(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=r[0],p=r[1];return t[0]=n*u,t[1]=s*u,t[2]=i*p,t[3]=a*p,t[4]=o,t[5]=c,t}function qu(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=r[0],p=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=n*u+i*p+o,t[5]=s*u+a*p+c,t}function Hu(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function Wu(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Xu(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Yu(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Ku(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function Ju(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function pa(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Qu(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Zu(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function eh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function th(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=e[0],u=e[1],p=e[2],m=e[3],v=e[4],T=e[5];return Math.abs(r-c)<=k*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=k*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-p)<=k*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(i-m)<=k*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-v)<=k*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-T)<=k*Math.max(1,Math.abs(o),Math.abs(T))}var rh=ha,nh=pa,sh=Object.freeze({__proto__:null,add:Ju,clone:Pu,copy:Uu,create:$u,determinant:zu,equals:th,exactEquals:eh,frob:Ku,fromRotation:Hu,fromScaling:Wu,fromTranslation:Xu,fromValues:Bu,identity:Lu,invert:ju,mul:rh,multiply:ha,multiplyScalar:Qu,multiplyScalarAndAdd:Zu,rotate:ku,scale:Gu,set:Vu,str:Yu,sub:nh,subtract:pa,translate:qu});function ga(){var t=new K(9);return K!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ih(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function ah(t){var e=new K(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function oh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ch(t,e,r,n,s,i,a,o,c){var u=new K(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=s,u[5]=i,u[6]=a,u[7]=o,u[8]=c,u}function fh(t,e,r,n,s,i,a,o,c,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t}function lh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function uh(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function hh(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],p=e[8],m=p*a-o*u,v=-p*i+o*c,T=u*i-a*c,E=r*m+n*v+s*T;return E?(E=1/E,t[0]=m*E,t[1]=(-p*n+s*u)*E,t[2]=(o*n-s*a)*E,t[3]=v*E,t[4]=(p*r-s*c)*E,t[5]=(-o*r+s*i)*E,t[6]=T*E,t[7]=(-u*r+n*c)*E,t[8]=(a*r-n*i)*E,t):null}function ph(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],p=e[8];return t[0]=a*p-o*u,t[1]=s*u-n*p,t[2]=n*o-s*a,t[3]=o*c-i*p,t[4]=r*p-s*c,t[5]=s*i-r*o,t[6]=i*u-a*c,t[7]=n*c-r*u,t[8]=r*a-n*i,t}function gh(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],u=t[8];return e*(u*i-a*c)+r*(-u*s+a*o)+n*(c*s-i*o)}function da(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=e[8],v=r[0],T=r[1],E=r[2],A=r[3],h=r[4],_=r[5],d=r[6],y=r[7],M=r[8];return t[0]=v*n+T*a+E*u,t[1]=v*s+T*o+E*p,t[2]=v*i+T*c+E*m,t[3]=A*n+h*a+_*u,t[4]=A*s+h*o+_*p,t[5]=A*i+h*c+_*m,t[6]=d*n+y*a+M*u,t[7]=d*s+y*o+M*p,t[8]=d*i+y*c+M*m,t}function dh(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=e[8],v=r[0],T=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=o,t[5]=c,t[6]=v*n+T*a+u,t[7]=v*s+T*o+p,t[8]=v*i+T*c+m,t}function mh(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=e[8],v=Math.sin(r),T=Math.cos(r);return t[0]=T*n+v*a,t[1]=T*s+v*o,t[2]=T*i+v*c,t[3]=T*a-v*n,t[4]=T*o-v*s,t[5]=T*c-v*i,t[6]=u,t[7]=p,t[8]=m,t}function vh(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function yh(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function xh(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Th(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Mh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Eh(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,u=r*a,p=n*a,m=n*o,v=s*a,T=s*o,E=s*c,A=i*a,h=i*o,_=i*c;return t[0]=1-m-E,t[3]=p-_,t[6]=v+h,t[1]=p+_,t[4]=1-u-E,t[7]=T-A,t[2]=v-h,t[5]=T+A,t[8]=1-u-m,t}function wh(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],p=e[8],m=e[9],v=e[10],T=e[11],E=e[12],A=e[13],h=e[14],_=e[15],d=r*o-n*a,y=r*c-s*a,M=r*u-i*a,b=n*c-s*o,O=n*u-i*o,L=s*u-i*c,P=p*A-m*E,V=p*h-v*E,G=p*_-T*E,j=m*h-v*A,H=m*_-T*A,z=v*_-T*h,D=d*z-y*H+M*j+b*G-O*V+L*P;return D?(D=1/D,t[0]=(o*z-c*H+u*j)*D,t[1]=(c*G-a*z-u*V)*D,t[2]=(a*H-o*G+u*P)*D,t[3]=(s*H-n*z-i*j)*D,t[4]=(r*z-s*G+i*V)*D,t[5]=(n*G-r*H-i*P)*D,t[6]=(A*L-h*O+_*b)*D,t[7]=(h*M-E*L-_*y)*D,t[8]=(E*O-A*M+_*d)*D,t):null}function Rh(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function _h(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function bh(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ih(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function ma(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Ah(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Sh(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Nh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Ch(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],p=t[8],m=e[0],v=e[1],T=e[2],E=e[3],A=e[4],h=e[5],_=e[6],d=e[7],y=e[8];return Math.abs(r-m)<=k*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-v)<=k*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(s-T)<=k*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(i-E)<=k*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-A)<=k*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-h)<=k*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(c-_)<=k*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-d)<=k*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(p-y)<=k*Math.max(1,Math.abs(p),Math.abs(y))}var Oh=da,Fh=ma,Dh=Object.freeze({__proto__:null,add:Ih,adjoint:ph,clone:ah,copy:oh,create:ga,determinant:gh,equals:Ch,exactEquals:Nh,frob:bh,fromMat2d:Mh,fromMat4:ih,fromQuat:Eh,fromRotation:xh,fromScaling:Th,fromTranslation:yh,fromValues:ch,identity:lh,invert:hh,mul:Oh,multiply:da,multiplyScalar:Ah,multiplyScalarAndAdd:Sh,normalFromMat4:wh,projection:Rh,rotate:mh,scale:vh,set:fh,str:_h,sub:Fh,subtract:ma,translate:dh,transpose:uh});function $h(){var t=new K(16);return K!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ph(t){var e=new K(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Uh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Lh(t,e,r,n,s,i,a,o,c,u,p,m,v,T,E,A){var h=new K(16);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=s,h[5]=i,h[6]=a,h[7]=o,h[8]=c,h[9]=u,h[10]=p,h[11]=m,h[12]=v,h[13]=T,h[14]=E,h[15]=A,h}function Bh(t,e,r,n,s,i,a,o,c,u,p,m,v,T,E,A,h){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t[9]=p,t[10]=m,t[11]=v,t[12]=T,t[13]=E,t[14]=A,t[15]=h,t}function va(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Vh(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],i=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=s,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function jh(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],p=e[8],m=e[9],v=e[10],T=e[11],E=e[12],A=e[13],h=e[14],_=e[15],d=r*o-n*a,y=r*c-s*a,M=r*u-i*a,b=n*c-s*o,O=n*u-i*o,L=s*u-i*c,P=p*A-m*E,V=p*h-v*E,G=p*_-T*E,j=m*h-v*A,H=m*_-T*A,z=v*_-T*h,D=d*z-y*H+M*j+b*G-O*V+L*P;return D?(D=1/D,t[0]=(o*z-c*H+u*j)*D,t[1]=(s*H-n*z-i*j)*D,t[2]=(A*L-h*O+_*b)*D,t[3]=(v*O-m*L-T*b)*D,t[4]=(c*G-a*z-u*V)*D,t[5]=(r*z-s*G+i*V)*D,t[6]=(h*M-E*L-_*y)*D,t[7]=(p*L-v*M+T*y)*D,t[8]=(a*H-o*G+u*P)*D,t[9]=(n*G-r*H-i*P)*D,t[10]=(E*O-A*M+_*d)*D,t[11]=(m*M-p*O-T*d)*D,t[12]=(o*V-a*j-c*P)*D,t[13]=(r*j-n*V+s*P)*D,t[14]=(A*y-E*b-h*d)*D,t[15]=(p*b-m*y+v*d)*D,t):null}function zh(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],p=e[8],m=e[9],v=e[10],T=e[11],E=e[12],A=e[13],h=e[14],_=e[15];return t[0]=o*(v*_-T*h)-m*(c*_-u*h)+A*(c*T-u*v),t[1]=-(n*(v*_-T*h)-m*(s*_-i*h)+A*(s*T-i*v)),t[2]=n*(c*_-u*h)-o*(s*_-i*h)+A*(s*u-i*c),t[3]=-(n*(c*T-u*v)-o*(s*T-i*v)+m*(s*u-i*c)),t[4]=-(a*(v*_-T*h)-p*(c*_-u*h)+E*(c*T-u*v)),t[5]=r*(v*_-T*h)-p*(s*_-i*h)+E*(s*T-i*v),t[6]=-(r*(c*_-u*h)-a*(s*_-i*h)+E*(s*u-i*c)),t[7]=r*(c*T-u*v)-a*(s*T-i*v)+p*(s*u-i*c),t[8]=a*(m*_-T*A)-p*(o*_-u*A)+E*(o*T-u*m),t[9]=-(r*(m*_-T*A)-p*(n*_-i*A)+E*(n*T-i*m)),t[10]=r*(o*_-u*A)-a*(n*_-i*A)+E*(n*u-i*o),t[11]=-(r*(o*T-u*m)-a*(n*T-i*m)+p*(n*u-i*o)),t[12]=-(a*(m*h-v*A)-p*(o*h-c*A)+E*(o*v-c*m)),t[13]=r*(m*h-v*A)-p*(n*h-s*A)+E*(n*v-s*m),t[14]=-(r*(o*h-c*A)-a*(n*h-s*A)+E*(n*c-s*o)),t[15]=r*(o*v-c*m)-a*(n*v-s*m)+p*(n*c-s*o),t}function kh(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],u=t[8],p=t[9],m=t[10],v=t[11],T=t[12],E=t[13],A=t[14],h=t[15],_=e*a-r*i,d=e*o-n*i,y=e*c-s*i,M=r*o-n*a,b=r*c-s*a,O=n*c-s*o,L=u*E-p*T,P=u*A-m*T,V=u*h-v*T,G=p*A-m*E,j=p*h-v*E,H=m*h-v*A;return _*H-d*j+y*G+M*V-b*P+O*L}function ya(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=e[8],v=e[9],T=e[10],E=e[11],A=e[12],h=e[13],_=e[14],d=e[15],y=r[0],M=r[1],b=r[2],O=r[3];return t[0]=y*n+M*o+b*m+O*A,t[1]=y*s+M*c+b*v+O*h,t[2]=y*i+M*u+b*T+O*_,t[3]=y*a+M*p+b*E+O*d,y=r[4],M=r[5],b=r[6],O=r[7],t[4]=y*n+M*o+b*m+O*A,t[5]=y*s+M*c+b*v+O*h,t[6]=y*i+M*u+b*T+O*_,t[7]=y*a+M*p+b*E+O*d,y=r[8],M=r[9],b=r[10],O=r[11],t[8]=y*n+M*o+b*m+O*A,t[9]=y*s+M*c+b*v+O*h,t[10]=y*i+M*u+b*T+O*_,t[11]=y*a+M*p+b*E+O*d,y=r[12],M=r[13],b=r[14],O=r[15],t[12]=y*n+M*o+b*m+O*A,t[13]=y*s+M*c+b*v+O*h,t[14]=y*i+M*u+b*T+O*_,t[15]=y*a+M*p+b*E+O*d,t}function Gh(t,e,r){var n=r[0],s=r[1],i=r[2],a,o,c,u,p,m,v,T,E,A,h,_;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*i+e[12],t[13]=e[1]*n+e[5]*s+e[9]*i+e[13],t[14]=e[2]*n+e[6]*s+e[10]*i+e[14],t[15]=e[3]*n+e[7]*s+e[11]*i+e[15]):(a=e[0],o=e[1],c=e[2],u=e[3],p=e[4],m=e[5],v=e[6],T=e[7],E=e[8],A=e[9],h=e[10],_=e[11],t[0]=a,t[1]=o,t[2]=c,t[3]=u,t[4]=p,t[5]=m,t[6]=v,t[7]=T,t[8]=E,t[9]=A,t[10]=h,t[11]=_,t[12]=a*n+p*s+E*i+e[12],t[13]=o*n+m*s+A*i+e[13],t[14]=c*n+v*s+h*i+e[14],t[15]=u*n+T*s+_*i+e[15]),t}function qh(t,e,r){var n=r[0],s=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Hh(t,e,r,n){var s=n[0],i=n[1],a=n[2],o=Math.hypot(s,i,a),c,u,p,m,v,T,E,A,h,_,d,y,M,b,O,L,P,V,G,j,H,z,D,q;return o<k?null:(o=1/o,s*=o,i*=o,a*=o,c=Math.sin(r),u=Math.cos(r),p=1-u,m=e[0],v=e[1],T=e[2],E=e[3],A=e[4],h=e[5],_=e[6],d=e[7],y=e[8],M=e[9],b=e[10],O=e[11],L=s*s*p+u,P=i*s*p+a*c,V=a*s*p-i*c,G=s*i*p-a*c,j=i*i*p+u,H=a*i*p+s*c,z=s*a*p+i*c,D=i*a*p-s*c,q=a*a*p+u,t[0]=m*L+A*P+y*V,t[1]=v*L+h*P+M*V,t[2]=T*L+_*P+b*V,t[3]=E*L+d*P+O*V,t[4]=m*G+A*j+y*H,t[5]=v*G+h*j+M*H,t[6]=T*G+_*j+b*H,t[7]=E*G+d*j+O*H,t[8]=m*z+A*D+y*q,t[9]=v*z+h*D+M*q,t[10]=T*z+_*D+b*q,t[11]=E*z+d*D+O*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Wh(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[4],a=e[5],o=e[6],c=e[7],u=e[8],p=e[9],m=e[10],v=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+u*n,t[5]=a*s+p*n,t[6]=o*s+m*n,t[7]=c*s+v*n,t[8]=u*s-i*n,t[9]=p*s-a*n,t[10]=m*s-o*n,t[11]=v*s-c*n,t}function Xh(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],u=e[8],p=e[9],m=e[10],v=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-u*n,t[1]=a*s-p*n,t[2]=o*s-m*n,t[3]=c*s-v*n,t[8]=i*n+u*s,t[9]=a*n+p*s,t[10]=o*n+m*s,t[11]=c*n+v*s,t}function Yh(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],u=e[4],p=e[5],m=e[6],v=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+u*n,t[1]=a*s+p*n,t[2]=o*s+m*n,t[3]=c*s+v*n,t[4]=u*s-i*n,t[5]=p*s-a*n,t[6]=m*s-o*n,t[7]=v*s-c*n,t}function Kh(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Jh(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qh(t,e,r){var n=r[0],s=r[1],i=r[2],a=Math.hypot(n,s,i),o,c,u;return a<k?null:(a=1/a,n*=a,s*=a,i*=a,o=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=n*n*u+c,t[1]=s*n*u+i*o,t[2]=i*n*u-s*o,t[3]=0,t[4]=n*s*u-i*o,t[5]=s*s*u+c,t[6]=i*s*u+n*o,t[7]=0,t[8]=n*i*u+s*o,t[9]=s*i*u-n*o,t[10]=i*i*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Zh(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ep(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xa(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=n+n,c=s+s,u=i+i,p=n*o,m=n*c,v=n*u,T=s*c,E=s*u,A=i*u,h=a*o,_=a*c,d=a*u;return t[0]=1-(T+A),t[1]=m+d,t[2]=v-_,t[3]=0,t[4]=m-d,t[5]=1-(p+A),t[6]=E+h,t[7]=0,t[8]=v+_,t[9]=E-h,t[10]=1-(p+T),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function rp(t,e){var r=new K(3),n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=n*n+s*s+i*i+a*a;return m>0?(r[0]=(o*a+p*n+c*i-u*s)*2/m,r[1]=(c*a+p*s+u*n-o*i)*2/m,r[2]=(u*a+p*i+o*s-c*n)*2/m):(r[0]=(o*a+p*n+c*i-u*s)*2,r[1]=(c*a+p*s+u*n-o*i)*2,r[2]=(u*a+p*i+o*s-c*n)*2),xa(t,e,r),t}function Ta(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ma(t,e){var r=e[0],n=e[1],s=e[2],i=e[4],a=e[5],o=e[6],c=e[8],u=e[9],p=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(c,u,p),t}function Ea(t,e){var r=new K(3);Ma(r,e);var n=1/r[0],s=1/r[1],i=1/r[2],a=e[0]*n,o=e[1]*s,c=e[2]*i,u=e[4]*n,p=e[5]*s,m=e[6]*i,v=e[8]*n,T=e[9]*s,E=e[10]*i,A=a+p+E,h=0;return A>0?(h=Math.sqrt(A+1)*2,t[3]=.25*h,t[0]=(m-T)/h,t[1]=(v-c)/h,t[2]=(o-u)/h):a>p&&a>E?(h=Math.sqrt(1+a-p-E)*2,t[3]=(m-T)/h,t[0]=.25*h,t[1]=(o+u)/h,t[2]=(v+c)/h):p>E?(h=Math.sqrt(1+p-a-E)*2,t[3]=(v-c)/h,t[0]=(o+u)/h,t[1]=.25*h,t[2]=(m+T)/h):(h=Math.sqrt(1+E-a-p)*2,t[3]=(o-u)/h,t[0]=(v+c)/h,t[1]=(m+T)/h,t[2]=.25*h),t}function np(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=s+s,u=i+i,p=a+a,m=s*c,v=s*u,T=s*p,E=i*u,A=i*p,h=a*p,_=o*c,d=o*u,y=o*p,M=n[0],b=n[1],O=n[2];return t[0]=(1-(E+h))*M,t[1]=(v+y)*M,t[2]=(T-d)*M,t[3]=0,t[4]=(v-y)*b,t[5]=(1-(m+h))*b,t[6]=(A+_)*b,t[7]=0,t[8]=(T+d)*O,t[9]=(A-_)*O,t[10]=(1-(m+E))*O,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function sp(t,e,r,n,s){var i=e[0],a=e[1],o=e[2],c=e[3],u=i+i,p=a+a,m=o+o,v=i*u,T=i*p,E=i*m,A=a*p,h=a*m,_=o*m,d=c*u,y=c*p,M=c*m,b=n[0],O=n[1],L=n[2],P=s[0],V=s[1],G=s[2],j=(1-(A+_))*b,H=(T+M)*b,z=(E-y)*b,D=(T-M)*O,q=(1-(v+_))*O,Z=(h+d)*O,re=(E+y)*L,J=(h-d)*L,X=(1-(v+A))*L;return t[0]=j,t[1]=H,t[2]=z,t[3]=0,t[4]=D,t[5]=q,t[6]=Z,t[7]=0,t[8]=re,t[9]=J,t[10]=X,t[11]=0,t[12]=r[0]+P-(j*P+D*V+re*G),t[13]=r[1]+V-(H*P+q*V+J*G),t[14]=r[2]+G-(z*P+Z*V+X*G),t[15]=1,t}function ip(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,u=r*a,p=n*a,m=n*o,v=s*a,T=s*o,E=s*c,A=i*a,h=i*o,_=i*c;return t[0]=1-m-E,t[1]=p+_,t[2]=v-h,t[3]=0,t[4]=p-_,t[5]=1-u-E,t[6]=T+A,t[7]=0,t[8]=v+h,t[9]=T-A,t[10]=1-u-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ap(t,e,r,n,s,i,a){var o=1/(r-e),c=1/(s-n),u=1/(i-a);return t[0]=i*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(s+n)*c,t[10]=(a+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*u,t[15]=0,t}function wa(t,e,r,n,s){var i=1/Math.tan(e/2),a;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(n-s),t[10]=(s+n)*a,t[14]=2*s*n*a):(t[10]=-1,t[14]=-2*n),t}var op=wa;function cp(t,e,r,n,s){var i=1/Math.tan(e/2),a;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(n-s),t[10]=s*a,t[14]=s*n*a):(t[10]=-1,t[14]=-n),t}function fp(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),u=2/(s+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((a-o)*c*.5),t[9]=(s-i)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function Ra(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),u=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=(a+i)*u,t[15]=1,t}var lp=Ra;function up(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),u=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=i*u,t[15]=1,t}function hp(t,e,r,n){var s,i,a,o,c,u,p,m,v,T,E=e[0],A=e[1],h=e[2],_=n[0],d=n[1],y=n[2],M=r[0],b=r[1],O=r[2];return Math.abs(E-M)<k&&Math.abs(A-b)<k&&Math.abs(h-O)<k?va(t):(p=E-M,m=A-b,v=h-O,T=1/Math.hypot(p,m,v),p*=T,m*=T,v*=T,s=d*v-y*m,i=y*p-_*v,a=_*m-d*p,T=Math.hypot(s,i,a),T?(T=1/T,s*=T,i*=T,a*=T):(s=0,i=0,a=0),o=m*a-v*i,c=v*s-p*a,u=p*i-m*s,T=Math.hypot(o,c,u),T?(T=1/T,o*=T,c*=T,u*=T):(o=0,c=0,u=0),t[0]=s,t[1]=o,t[2]=p,t[3]=0,t[4]=i,t[5]=c,t[6]=m,t[7]=0,t[8]=a,t[9]=u,t[10]=v,t[11]=0,t[12]=-(s*E+i*A+a*h),t[13]=-(o*E+c*A+u*h),t[14]=-(p*E+m*A+v*h),t[15]=1,t)}function pp(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=n[0],c=n[1],u=n[2],p=s-r[0],m=i-r[1],v=a-r[2],T=p*p+m*m+v*v;T>0&&(T=1/Math.sqrt(T),p*=T,m*=T,v*=T);var E=c*v-u*m,A=u*p-o*v,h=o*m-c*p;return T=E*E+A*A+h*h,T>0&&(T=1/Math.sqrt(T),E*=T,A*=T,h*=T),t[0]=E,t[1]=A,t[2]=h,t[3]=0,t[4]=m*h-v*A,t[5]=v*E-p*h,t[6]=p*A-m*E,t[7]=0,t[8]=p,t[9]=m,t[10]=v,t[11]=0,t[12]=s,t[13]=i,t[14]=a,t[15]=1,t}function gp(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function dp(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function mp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function _a(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function vp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function yp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function xp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Tp(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],p=t[8],m=t[9],v=t[10],T=t[11],E=t[12],A=t[13],h=t[14],_=t[15],d=e[0],y=e[1],M=e[2],b=e[3],O=e[4],L=e[5],P=e[6],V=e[7],G=e[8],j=e[9],H=e[10],z=e[11],D=e[12],q=e[13],Z=e[14],re=e[15];return Math.abs(r-d)<=k*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-y)<=k*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-M)<=k*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(i-b)<=k*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-O)<=k*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(o-L)<=k*Math.max(1,Math.abs(o),Math.abs(L))&&Math.abs(c-P)<=k*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(u-V)<=k*Math.max(1,Math.abs(u),Math.abs(V))&&Math.abs(p-G)<=k*Math.max(1,Math.abs(p),Math.abs(G))&&Math.abs(m-j)<=k*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(v-H)<=k*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(T-z)<=k*Math.max(1,Math.abs(T),Math.abs(z))&&Math.abs(E-D)<=k*Math.max(1,Math.abs(E),Math.abs(D))&&Math.abs(A-q)<=k*Math.max(1,Math.abs(A),Math.abs(q))&&Math.abs(h-Z)<=k*Math.max(1,Math.abs(h),Math.abs(Z))&&Math.abs(_-re)<=k*Math.max(1,Math.abs(_),Math.abs(re))}var Mp=ya,Ep=_a,wp=Object.freeze({__proto__:null,add:mp,adjoint:zh,clone:Ph,copy:Uh,create:$h,determinant:kh,equals:Tp,exactEquals:xp,frob:dp,fromQuat:ip,fromQuat2:rp,fromRotation:Qh,fromRotationTranslation:xa,fromRotationTranslationScale:np,fromRotationTranslationScaleOrigin:sp,fromScaling:Jh,fromTranslation:Kh,fromValues:Lh,fromXRotation:Zh,fromYRotation:ep,fromZRotation:tp,frustum:ap,getRotation:Ea,getScaling:Ma,getTranslation:Ta,identity:va,invert:jh,lookAt:hp,mul:Mp,multiply:ya,multiplyScalar:vp,multiplyScalarAndAdd:yp,ortho:lp,orthoNO:Ra,orthoZO:up,perspective:op,perspectiveFromFieldOfView:fp,perspectiveNO:wa,perspectiveZO:cp,rotate:Hh,rotateX:Wh,rotateY:Xh,rotateZ:Yh,scale:qh,set:Bh,str:gp,sub:Ep,subtract:_a,targetTo:pp,translate:Gh,transpose:Vh});function Qn(){var t=new K(3);return K!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Rp(t){var e=new K(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ba(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Cn(t,e,r){var n=new K(3);return n[0]=t,n[1]=e,n[2]=r,n}function _p(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function bp(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function Ip(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Ia(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Aa(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Sa(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Ap(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Sp(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Np(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Cp(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Op(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Fp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Dp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Na(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(r,n,s)}function Ca(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function Oa(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function $p(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Pp(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Fa(t,e){var r=e[0],n=e[1],s=e[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Zn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Dr(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2];return t[0]=s*c-i*o,t[1]=i*a-n*c,t[2]=n*o-s*a,t}function Up(t,e,r,n){var s=e[0],i=e[1],a=e[2];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t}function Lp(t,e,r,n,s,i){var a=i*i,o=a*(2*i-3)+1,c=a*(i-2)+i,u=a*(i-1),p=a*(3-2*i);return t[0]=e[0]*o+r[0]*c+n[0]*u+s[0]*p,t[1]=e[1]*o+r[1]*c+n[1]*u+s[1]*p,t[2]=e[2]*o+r[2]*c+n[2]*u+s[2]*p,t}function Bp(t,e,r,n,s,i){var a=1-i,o=a*a,c=i*i,u=o*a,p=3*i*o,m=3*c*a,v=c*i;return t[0]=e[0]*u+r[0]*p+n[0]*m+s[0]*v,t[1]=e[1]*u+r[1]*p+n[1]*m+s[1]*v,t[2]=e[2]*u+r[2]*p+n[2]*m+s[2]*v,t}function Vp(t,e){e=e||1;var r=je()*2*Math.PI,n=je()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function jp(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function zp(t,e,r){var n=e[0],s=e[1],i=e[2];return t[0]=n*r[0]+s*r[3]+i*r[6],t[1]=n*r[1]+s*r[4]+i*r[7],t[2]=n*r[2]+s*r[5]+i*r[8],t}function kp(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],u=e[2],p=s*u-i*c,m=i*o-n*u,v=n*c-s*o,T=s*v-i*m,E=i*p-n*v,A=n*m-s*p,h=a*2;return p*=h,m*=h,v*=h,T*=2,E*=2,A*=2,t[0]=o+p+T,t[1]=c+m+E,t[2]=u+v+A,t}function Gp(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function qp(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Hp(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Wp(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2],c=Math.sqrt(r*r+n*n+s*s),u=Math.sqrt(i*i+a*a+o*o),p=c*u,m=p&&Zn(t,e)/p;return Math.acos(Math.min(Math.max(m,-1),1))}function Xp(t){return t[0]=0,t[1]=0,t[2]=0,t}function Yp(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Kp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Jp(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2];return Math.abs(r-i)<=k*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=k*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-o)<=k*Math.max(1,Math.abs(s),Math.abs(o))}var Qp=Ia,Zp=Aa,eg=Sa,tg=Na,rg=Ca,Da=ba,ng=Oa,sg=function(){var t=Qn();return function(e,r,n,s,i,a){var o,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}(),ig=Object.freeze({__proto__:null,add:Ip,angle:Wp,bezier:Bp,ceil:Ap,clone:Rp,copy:_p,create:Qn,cross:Dr,dist:tg,distance:Na,div:eg,divide:Sa,dot:Zn,equals:Jp,exactEquals:Kp,floor:Sp,forEach:sg,fromValues:Cn,hermite:Lp,inverse:Pp,len:Da,length:ba,lerp:Up,max:Cp,min:Np,mul:Zp,multiply:Aa,negate:$p,normalize:Fa,random:Vp,rotateX:Gp,rotateY:qp,rotateZ:Hp,round:Op,scale:Fp,scaleAndAdd:Dp,set:bp,sqrDist:rg,sqrLen:ng,squaredDistance:Ca,squaredLength:Oa,str:Yp,sub:Qp,subtract:Ia,transformMat3:zp,transformMat4:jp,transformQuat:kp,zero:Xp});function $a(){var t=new K(4);return K!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Pa(t){var e=new K(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ua(t,e,r,n){var s=new K(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function La(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ba(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function Va(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function ja(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function za(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function ka(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function ag(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function og(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function cg(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function fg(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function lg(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Ga(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function ug(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function qa(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return Math.hypot(r,n,s,i)}function Ha(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+s*s+i*i}function es(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}function ts(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function hg(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function pg(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Wa(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=s*a,t[3]=i*a,t}function Xa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function gg(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],p=e[0],m=e[1],v=e[2],T=e[3];return t[0]=m*u-v*c+T*o,t[1]=-(p*u)+v*a-T*i,t[2]=p*c-m*a+T*s,t[3]=-(p*o)+m*i-v*s,t}function Ya(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t[3]=o+n*(r[3]-o),t}function dg(t,e){e=e||1;var r,n,s,i,a,o;do r=je()*2-1,n=je()*2-1,a=r*r+n*n;while(a>=1);do s=je()*2-1,i=je()*2-1,o=s*s+i*i;while(o>=1);var c=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*i*c,t}function mg(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*a,t[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*a,t[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*a,t[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*a,t}function vg(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2],u=r[3],p=u*n+o*i-c*s,m=u*s+c*n-a*i,v=u*i+a*s-o*n,T=-a*n-o*s-c*i;return t[0]=p*u+T*-a+m*-c-v*-o,t[1]=m*u+T*-o+v*-a-p*-c,t[2]=v*u+T*-c+p*-o-m*-a,t[3]=e[3],t}function yg(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function xg(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Ka(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Ja(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],u=e[3];return Math.abs(r-a)<=k*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=k*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=k*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-u)<=k*Math.max(1,Math.abs(i),Math.abs(u))}var Tg=ja,Mg=za,Eg=ka,wg=qa,Rg=Ha,_g=es,bg=ts,Ig=function(){var t=$a();return function(e,r,n,s,i,a){var o,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),Ag=Object.freeze({__proto__:null,add:Va,ceil:ag,clone:Pa,copy:La,create:$a,cross:gg,dist:wg,distance:qa,div:Eg,divide:ka,dot:Xa,equals:Ja,exactEquals:Ka,floor:og,forEach:Ig,fromValues:Ua,inverse:pg,len:_g,length:es,lerp:Ya,max:fg,min:cg,mul:Mg,multiply:za,negate:hg,normalize:Wa,random:dg,round:lg,scale:Ga,scaleAndAdd:ug,set:Ba,sqrDist:Rg,sqrLen:bg,squaredDistance:Ha,squaredLength:ts,str:xg,sub:Tg,subtract:ja,transformMat4:mg,transformQuat:vg,zero:yg});function jr(){var t=new K(4);return K!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Sg(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Qa(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function Ng(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>k?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function Cg(t,e){var r=ns(t,e);return Math.acos(2*r*r-1)}function Za(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],u=r[2],p=r[3];return t[0]=n*p+a*o+s*u-i*c,t[1]=s*p+a*c+i*o-n*u,t[2]=i*p+a*u+n*c-s*o,t[3]=a*p-n*o-s*c-i*u,t}function eo(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*o,t[1]=s*c+i*o,t[2]=i*c-s*o,t[3]=a*c-n*o,t}function to(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c-i*o,t[1]=s*c+a*o,t[2]=i*c+n*o,t[3]=a*c-s*o,t}function ro(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+s*o,t[1]=s*c-n*o,t[2]=i*c+a*o,t[3]=a*c-i*o,t}function Og(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function no(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=Math.exp(i),c=a>0?o*Math.sin(a)/a:0;return t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=o*Math.cos(a),t}function so(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=a>0?Math.atan2(a,i)/a:0;return t[0]=r*o,t[1]=n*o,t[2]=s*o,t[3]=.5*Math.log(r*r+n*n+s*s+i*i),t}function Fg(t,e,r){return so(t,e),ao(t,t,r),no(t,t),t}function $r(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=r[0],u=r[1],p=r[2],m=r[3],v,T,E,A,h;return T=s*c+i*u+a*p+o*m,T<0&&(T=-T,c=-c,u=-u,p=-p,m=-m),1-T>k?(v=Math.acos(T),E=Math.sin(v),A=Math.sin((1-n)*v)/E,h=Math.sin(n*v)/E):(A=1-n,h=n),t[0]=A*s+h*c,t[1]=A*i+h*u,t[2]=A*a+h*p,t[3]=A*o+h*m,t}function Dg(t){var e=je(),r=je(),n=je(),s=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*n),t[3]=i*Math.cos(2*Math.PI*n),t}function $g(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i,o=a?1/a:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-s*o,t[3]=i*o,t}function Pg(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function io(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[i*3+i]-e[a*3+a]+1),t[s]=.5*n,n=.5/n,t[3]=(e[i*3+a]-e[a*3+i])*n,t[i]=(e[i*3+s]+e[s*3+i])*n,t[a]=(e[a*3+s]+e[s*3+a])*n}return t}function Ug(t,e,r,n){var s=.5*Math.PI/180;e*=s,r*=s,n*=s;var i=Math.sin(e),a=Math.cos(e),o=Math.sin(r),c=Math.cos(r),u=Math.sin(n),p=Math.cos(n);return t[0]=i*c*p-a*o*u,t[1]=a*o*p+i*c*u,t[2]=a*c*u-i*o*p,t[3]=a*c*p+i*o*u,t}function Lg(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Bg=Pa,Vg=Ua,rs=La,jg=Ba,zg=Va,kg=Za,ao=Ga,ns=Xa,Gg=Ya,ss=es,qg=ss,is=ts,Hg=is,as=Wa,Wg=Ka,Xg=Ja,Yg=function(){var t=Qn(),e=Cn(1,0,0),r=Cn(0,1,0);return function(n,s,i){var a=Zn(s,i);return a<-.999999?(Dr(t,e,s),Da(t)<1e-6&&Dr(t,r,s),Fa(t,t),Qa(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Dr(t,s,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,as(n,n))}}(),Kg=function(){var t=jr(),e=jr();return function(r,n,s,i,a,o){return $r(t,n,a,o),$r(e,s,i,o),$r(r,t,e,2*o*(1-o)),r}}(),Jg=function(){var t=ga();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],as(e,io(e,t))}}(),Qg=Object.freeze({__proto__:null,add:zg,calculateW:Og,clone:Bg,conjugate:Pg,copy:rs,create:jr,dot:ns,equals:Xg,exactEquals:Wg,exp:no,fromEuler:Ug,fromMat3:io,fromValues:Vg,getAngle:Cg,getAxisAngle:Ng,identity:Sg,invert:$g,len:qg,length:ss,lerp:Gg,ln:so,mul:kg,multiply:Za,normalize:as,pow:Fg,random:Dg,rotateX:eo,rotateY:to,rotateZ:ro,rotationTo:Yg,scale:ao,set:jg,setAxes:Jg,setAxisAngle:Qa,slerp:$r,sqlerp:Kg,sqrLen:Hg,squaredLength:is,str:Lg});function Zg(){var t=new K(8);return K!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function ed(t){var e=new K(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function td(t,e,r,n,s,i,a,o){var c=new K(8);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=i,c[6]=a,c[7]=o,c}function rd(t,e,r,n,s,i,a){var o=new K(8);o[0]=t,o[1]=e,o[2]=r,o[3]=n;var c=s*.5,u=i*.5,p=a*.5;return o[4]=c*n+u*r-p*e,o[5]=u*n+p*t-c*r,o[6]=p*n+c*e-u*t,o[7]=-c*t-u*e-p*r,o}function oo(t,e,r){var n=r[0]*.5,s=r[1]*.5,i=r[2]*.5,a=e[0],o=e[1],c=e[2],u=e[3];return t[0]=a,t[1]=o,t[2]=c,t[3]=u,t[4]=n*u+s*c-i*o,t[5]=s*u+i*a-n*c,t[6]=i*u+n*o-s*a,t[7]=-n*a-s*o-i*c,t}function nd(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function sd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function id(t,e){var r=jr();Ea(r,e);var n=new K(3);return Ta(n,e),oo(t,r,n),t}function co(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ad(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function od(t,e,r,n,s,i,a,o,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t}var cd=rs;function fd(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var ld=rs;function ud(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function hd(t,e){var r=e[4],n=e[5],s=e[6],i=e[7],a=-e[0],o=-e[1],c=-e[2],u=e[3];return t[0]=(r*u+i*a+n*c-s*o)*2,t[1]=(n*u+i*o+s*a-r*c)*2,t[2]=(s*u+i*c+r*o-n*a)*2,t}function pd(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0]*.5,c=r[1]*.5,u=r[2]*.5,p=e[4],m=e[5],v=e[6],T=e[7];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=a*o+s*u-i*c+p,t[5]=a*c+i*o-n*u+m,t[6]=a*u+n*c-s*o+v,t[7]=-n*o-s*c-i*u+T,t}function gd(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=o*a+p*n+c*i-u*s,v=c*a+p*s+u*n-o*i,T=u*a+p*i+o*s-c*n,E=p*a-o*n-c*s-u*i;return eo(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=m*a+E*n+v*i-T*s,t[5]=v*a+E*s+T*n-m*i,t[6]=T*a+E*i+m*s-v*n,t[7]=E*a-m*n-v*s-T*i,t}function dd(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=o*a+p*n+c*i-u*s,v=c*a+p*s+u*n-o*i,T=u*a+p*i+o*s-c*n,E=p*a-o*n-c*s-u*i;return to(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=m*a+E*n+v*i-T*s,t[5]=v*a+E*s+T*n-m*i,t[6]=T*a+E*i+m*s-v*n,t[7]=E*a-m*n-v*s-T*i,t}function md(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],p=e[7],m=o*a+p*n+c*i-u*s,v=c*a+p*s+u*n-o*i,T=u*a+p*i+o*s-c*n,E=p*a-o*n-c*s-u*i;return ro(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=m*a+E*n+v*i-T*s,t[5]=v*a+E*s+T*n-m*i,t[6]=T*a+E*i+m*s-v*n,t[7]=E*a-m*n-v*s-T*i,t}function vd(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],u=e[2],p=e[3];return t[0]=o*a+p*n+c*i-u*s,t[1]=c*a+p*s+u*n-o*i,t[2]=u*a+p*i+o*s-c*n,t[3]=p*a-o*n-c*s-u*i,o=e[4],c=e[5],u=e[6],p=e[7],t[4]=o*a+p*n+c*i-u*s,t[5]=c*a+p*s+u*n-o*i,t[6]=u*a+p*i+o*s-c*n,t[7]=p*a-o*n-c*s-u*i,t}function yd(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],u=r[2],p=r[3];return t[0]=n*p+a*o+s*u-i*c,t[1]=s*p+a*c+i*o-n*u,t[2]=i*p+a*u+n*c-s*o,t[3]=a*p-n*o-s*c-i*u,o=r[4],c=r[5],u=r[6],p=r[7],t[4]=n*p+a*o+s*u-i*c,t[5]=s*p+a*c+i*o-n*u,t[6]=i*p+a*u+n*c-s*o,t[7]=a*p-n*o-s*c-i*u,t}function xd(t,e,r,n){if(Math.abs(n)<k)return co(t,e);var s=Math.hypot(r[0],r[1],r[2]);n=n*.5;var i=Math.sin(n),a=i*r[0]/s,o=i*r[1]/s,c=i*r[2]/s,u=Math.cos(n),p=e[0],m=e[1],v=e[2],T=e[3];t[0]=p*u+T*a+m*c-v*o,t[1]=m*u+T*o+v*a-p*c,t[2]=v*u+T*c+p*o-m*a,t[3]=T*u-p*a-m*o-v*c;var E=e[4],A=e[5],h=e[6],_=e[7];return t[4]=E*u+_*a+A*c-h*o,t[5]=A*u+_*o+h*a-E*c,t[6]=h*u+_*c+E*o-A*a,t[7]=_*u-E*a-A*o-h*c,t}function Td(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function fo(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[4],c=r[5],u=r[6],p=r[7],m=e[4],v=e[5],T=e[6],E=e[7],A=r[0],h=r[1],_=r[2],d=r[3];return t[0]=n*d+a*A+s*_-i*h,t[1]=s*d+a*h+i*A-n*_,t[2]=i*d+a*_+n*h-s*A,t[3]=a*d-n*A-s*h-i*_,t[4]=n*p+a*o+s*u-i*c+m*d+E*A+v*_-T*h,t[5]=s*p+a*c+i*o-n*u+v*d+E*h+T*A-m*_,t[6]=i*p+a*u+n*c-s*o+T*d+E*_+m*h-v*A,t[7]=a*p-n*o-s*c-i*u+E*d-m*A-v*h-T*_,t}var Md=fo;function Ed(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var lo=ns;function wd(t,e,r,n){var s=1-n;return lo(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function Rd(t,e){var r=qr(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function _d(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var uo=ss,bd=uo,qr=is,Id=qr;function Ad(t,e){var r=qr(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,i=e[2]/r,a=e[3]/r,o=e[4],c=e[5],u=e[6],p=e[7],m=n*o+s*c+i*u+a*p;t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=(o-n*m)/r,t[5]=(c-s*m)/r,t[6]=(u-i*m)/r,t[7]=(p-a*m)/r}return t}function Sd(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Nd(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Cd(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],p=e[0],m=e[1],v=e[2],T=e[3],E=e[4],A=e[5],h=e[6],_=e[7];return Math.abs(r-p)<=k*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-m)<=k*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-v)<=k*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(i-T)<=k*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(a-E)<=k*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-A)<=k*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(c-h)<=k*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(u-_)<=k*Math.max(1,Math.abs(u),Math.abs(_))}var Od=Object.freeze({__proto__:null,add:Td,clone:ed,conjugate:_d,copy:co,create:Zg,dot:lo,equals:Cd,exactEquals:Nd,fromMat4:id,fromRotation:sd,fromRotationTranslation:oo,fromRotationTranslationValues:rd,fromTranslation:nd,fromValues:td,getDual:fd,getReal:cd,getTranslation:hd,identity:ad,invert:Rd,len:bd,length:uo,lerp:wd,mul:Md,multiply:fo,normalize:Ad,rotateAroundAxis:xd,rotateByQuatAppend:vd,rotateByQuatPrepend:yd,rotateX:gd,rotateY:dd,rotateZ:md,scale:Ed,set:od,setDual:ud,setReal:ld,sqrLen:Id,squaredLength:qr,str:Sd,translate:pd});function ho(){var t=new K(2);return K!=Float32Array&&(t[0]=0,t[1]=0),t}function Fd(t){var e=new K(2);return e[0]=t[0],e[1]=t[1],e}function Dd(t,e){var r=new K(2);return r[0]=t,r[1]=e,r}function $d(t,e){return t[0]=e[0],t[1]=e[1],t}function Pd(t,e,r){return t[0]=e,t[1]=r,t}function Ud(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function po(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function go(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function mo(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Ld(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Bd(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Vd(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function jd(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function zd(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function kd(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Gd(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function vo(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function yo(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function xo(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function To(t){var e=t[0],r=t[1];return e*e+r*r}function qd(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Hd(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Wd(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function Xd(t,e){return t[0]*e[0]+t[1]*e[1]}function Yd(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Kd(t,e,r,n){var s=e[0],i=e[1];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t}function Jd(t,e){e=e||1;var r=je()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Qd(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function Zd(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function e1(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function t1(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function r1(t,e,r,n){var s=e[0]-r[0],i=e[1]-r[1],a=Math.sin(n),o=Math.cos(n);return t[0]=s*o-i*a+r[0],t[1]=s*a+i*o+r[1],t}function n1(t,e){var r=t[0],n=t[1],s=e[0],i=e[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(s*s+i*i),o=a&&(r*s+n*i)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function s1(t){return t[0]=0,t[1]=0,t}function i1(t){return"vec2("+t[0]+", "+t[1]+")"}function a1(t,e){return t[0]===e[0]&&t[1]===e[1]}function o1(t,e){var r=t[0],n=t[1],s=e[0],i=e[1];return Math.abs(r-s)<=k*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=k*Math.max(1,Math.abs(n),Math.abs(i))}var c1=xo,f1=po,l1=go,u1=mo,h1=vo,p1=yo,g1=To,d1=function(){var t=ho();return function(e,r,n,s,i,a){var o,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],i(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}}(),m1=Object.freeze({__proto__:null,add:Ud,angle:n1,ceil:Ld,clone:Fd,copy:$d,create:ho,cross:Yd,dist:h1,distance:vo,div:u1,divide:mo,dot:Xd,equals:o1,exactEquals:a1,floor:Bd,forEach:d1,fromValues:Dd,inverse:Hd,len:c1,length:xo,lerp:Kd,max:jd,min:Vd,mul:l1,multiply:go,negate:qd,normalize:Wd,random:Jd,rotate:r1,round:zd,scale:kd,scaleAndAdd:Gd,set:Pd,sqrDist:p1,sqrLen:g1,squaredDistance:yo,squaredLength:To,str:i1,sub:f1,subtract:po,transformMat2:Qd,transformMat2d:Zd,transformMat3:e1,transformMat4:t1,zero:s1}),Mo=Object.freeze({__proto__:null,glMatrix:fu,mat2:Du,mat2d:sh,mat3:Dh,mat4:wp,quat:Qg,quat2:Od,vec2:m1,vec3:ig,vec4:Ag}),v1=(()=>{var t=import.meta.url;return async function(r={}){var r=typeof r<"u"?r:{},n,s;r.ready=new Promise(function(f,l){n=f,s=l});var i=!1;r.setup=function(){if(i)return;i=!0;function f(w,I,F=$=>$){if(I)for(let $ of I)w.push_back(F($));return w}function l(w,I=F=>F){const F=[],$=w.size();for(let B=0;B<$;B++)F.push(I(w.get(B)));return F}function g(w){return w[0].length<3&&(w=[w]),f(new r.Vector2_vec2,w,I=>f(new r.Vector_vec2,I,F=>F instanceof Array?{x:F[0],y:F[1]}:F))}function x(w){for(let I=0;I<w.size();I++)w.get(I).delete();w.delete()}function R(w){return w[0]instanceof Array?{x:w[0][0],y:w[0][1],z:w[0][2]}:typeof w[0]=="number"?{x:w[0]||0,y:w[1]||0,z:w[2]||0}:w[0]}r.Manifold.prototype.warp=function(w){const I=wr(function($){const B=Ke($,"float"),Q=Ke($+4,"float"),te=Ke($+8,"float"),se=[B,Q,te];w(se),ur($,se[0],"float"),ur($+4,se[1],"float"),ur($+8,se[2],"float")},"vi"),F=this._Warp(I);return Rr(I),F},r.Manifold.prototype.setProperties=function(w,I){const F=this.numProp,$=wr(function(Q,te,se){const Me=[];for(let ne=0;ne<3;++ne)Me[ne]=Ke(Q+4*ne,"float");const _e=[];for(let ne=0;ne<F;++ne)_e[ne]=Ke(te+4*ne,"float");const De=[];for(let ne=0;ne<w;++ne)De[ne]=Ke(se+4*ne,"float");I(Me,_e,De);for(let ne=0;ne<w;++ne)ur(se+4*ne,De[ne],"float")},"viii"),B=this._SetProperties(w,$);return Rr($),B},r.Manifold.prototype.translate=function(...w){return this._Translate(R(w))},r.Manifold.prototype.rotate=function(w){return this._Rotate(...w)},r.Manifold.prototype.scale=function(w){return typeof w=="number"?this._Scale({x:w,y:w,z:w}):this._Scale(R([w]))},r.Manifold.prototype.mirror=function(w){return this._Mirror(R([w]))},r.Manifold.prototype.trimByPlane=function(w,I){return this._TrimByPlane(R([w]),I)},r.Manifold.prototype.decompose=function(){const w=this._Decompose(),I=l(w);return w.delete(),I},r.Manifold.prototype.getCurvature=function(){const w=this._getCurvature(),I=w.vertMeanCurvature,F=w.vertGaussianCurvature;return w.vertMeanCurvature=l(I),w.vertGaussianCurvature=l(F),I.delete(),F.delete(),w};class S{constructor({numProp:I=3,triVerts:F=new Uint32Array,vertProperties:$=new Float32Array,mergeFromVert:B,mergeToVert:Q,runIndex:te,runOriginalID:se,faceID:Me,halfedgeTangent:_e,runTransform:De}={}){this.numProp=I,this.triVerts=F,this.vertProperties=$,this.mergeFromVert=B,this.mergeToVert=Q,this.runIndex=te,this.runOriginalID=se,this.faceID=Me,this.halfedgeTangent=_e,this.runTransform=De}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:I,mesh:F}=r._Merge(this);return Object.assign(this,{...F}),I}verts(I){return this.triVerts.subarray(3*I,3*(I+1))}position(I){return this.vertProperties.subarray(numProp*I,numProp*I+3)}extras(I){return this.vertProperties.subarray(numProp*I+3,numProp*(I+1))}tangent(I){return this.halfedgeTangent.subarray(4*I,4*(I+1))}transform(I){const F=new Array(16);for(const $ of[0,1,2,3])for(const B of[0,1,2])F[4*$+B]=this.runTransform[12*I+3*$+B];return F[15]=1,F}}r.Mesh=S,r.Manifold.prototype.getMesh=function(w=[0,0,0]){return w instanceof Array&&(w={0:w[0],1:w[1],2:w[2]}),new S(this._GetMeshJS(w))},r.Manifold.prototype.boundingBox=function(){const w=this._boundingBox();return{min:["x","y","z"].map(I=>w.min[I]),max:["x","y","z"].map(I=>w.max[I])}},r.ManifoldError=function(I,...F){let $="Unknown error";switch(I){case r.status.NonFiniteVertex.value:$="Non-finite vertex";break;case r.status.NotManifold.value:$="Not manifold";break;case r.status.VertexOutOfBounds.value:$="Vertex index out of bounds";break;case r.status.PropertiesWrongLength.value:$="Properties have wrong length";break;case r.status.MissingPositionProperties.value:$="Less than three properties";break;case r.status.MergeVectorsDifferentLengths.value:$="Merge vectors have different lengths";break;case r.status.MergeIndexOutOfBounds.value:$="Merge index out of bounds";break;case r.status.TransformWrongLength.value:$="Transform vector has wrong length";break;case r.status.RunIndexWrongLength.value:$="Run index vector has wrong length";break;case r.status.FaceIDWrongLength.value:$="Face ID vector has wrong length";case r.status.InvalidConstruction.value:$="Manifold constructed with invalid parameters"}const B=Error.apply(this,[$,...F]);B.name=this.name="ManifoldError",this.message=B.message,this.stack=B.stack,this.code=I},r.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:r.ManifoldError,writable:!0,configurable:!0}});const C=r.Manifold;r.Manifold=function(w){const I=new C(w),F=I.status();if(F.value!==0)throw new r.ManifoldError(F.value);return I},r.Manifold.prototype=Object.create(C.prototype),r.cube=function(...w){let I;w.length==0?I={x:1,y:1,z:1}:typeof w[0]=="number"?I={x:w[0],y:w[0],z:w[0]}:I=R(w);const F=w[1]||!1;return r._Cube(I,F)},r.cylinder=function(w,I,F=-1,$=0,B=!1){return r._Cylinder(w,I,F,$,B)},r.sphere=function(w,I=0){return r._Sphere(w,I)},r.smooth=function(w,I=[]){const F=new r.Vector_smoothness;f(F,I);const $=r._Smooth(w,F);return F.delete(),$},r.extrude=function(w,I,F=0,$=0,B=[1,1]){B instanceof Array&&(B={x:B[0],y:B[1]});const Q=g(w),te=r._Extrude(Q,I,F,$,B);return x(Q),te},r.triangulate=function(w,I=-1){const F=g(w),$=l(r._Triangulate(F,I),B=>[B[0],B[1],B[2]]);return x(F),$},r.revolve=function(w,I=0){const F=g(w),$=r._Revolve(F,I);return x(F),$},r.compose=function(w){const I=new r.Vector_manifold;f(I,w);const F=r._Compose(I);return I.delete(),F},r.levelSet=function(w,I,F,$=0){const B={min:{x:I.min[0],y:I.min[1],z:I.min[2]},max:{x:I.max[0],y:I.max[1],z:I.max[2]}},Q=wr(function(se){const Me=Ke(se,"float"),_e=Ke(se+4,"float"),De=Ke(se+8,"float");return w([Me,_e,De])},"fi"),te=r._LevelSet(Q,B,F,$);return Rr(Q),te};function N(w){return function(...I){I.length==1&&(I=I[0]);const F=new r.Vector_manifold;for(const B of I)F.push_back(B);const $=r["_"+w+"N"](F);return F.delete(),$}}r.union=N("union"),r.difference=N("difference"),r.intersection=N("intersection")};var a=Object.assign({},r),o=typeof window=="object",c=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",p="";function m(f){return r.locateFile?r.locateFile(f,p):p+f}var v,T,E;if(u){const{createRequire:f}=await import("./__vite-browser-external-4ed993c7.js");var A=f(import.meta.url),h=A("fs"),_=A("path");c?p=_.dirname(p)+"/":p=A("url").fileURLToPath(new URL("./",self.location)),v=(l,g)=>(l=lr(l)?new URL(l):_.normalize(l),h.readFileSync(l,g?void 0:"utf8")),E=l=>{var g=v(l,!0);return g.buffer||(g=new Uint8Array(g)),g},T=(l,g,x)=>{l=lr(l)?new URL(l):_.normalize(l),h.readFile(l,function(R,S){R?x(R):g(S.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(l){if(!(l instanceof Oo))throw l});var d=process.version.match(/^v(\d+)\./)[1];d<15&&process.on("unhandledRejection",function(l){throw l}),r.inspect=function(){return"[Emscripten Module object]"}}else(o||c)&&(c?p=self.location.href:typeof document<"u"&&document.currentScript&&(p=document.currentScript.src),t&&(p=t),p.indexOf("blob:")!==0?p=p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1):p="",v=f=>{var l=new XMLHttpRequest;return l.open("GET",f,!1),l.send(null),l.responseText},c&&(E=f=>{var l=new XMLHttpRequest;return l.open("GET",f,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}),T=(f,l,g)=>{var x=new XMLHttpRequest;x.open("GET",f,!0),x.responseType="arraybuffer",x.onload=()=>{if(x.status==200||x.status==0&&x.response){l(x.response);return}g()},x.onerror=g,x.send(null)});r.print||console.log.bind(console);var y=r.printErr||console.warn.bind(console);Object.assign(r,a),a=null,r.arguments&&r.arguments,r.thisProgram&&r.thisProgram,r.quit&&r.quit;var M;r.wasmBinary&&(M=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ke("no native wasm support detected");var b,O=!1;function L(f,l){f||ke(l)}var P=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function V(f,l,g){for(var x=l+g,R=l;f[R]&&!(R>=x);)++R;if(R-l>16&&f.buffer&&P)return P.decode(f.subarray(l,R));for(var S="";l<R;){var C=f[l++];if(!(C&128)){S+=String.fromCharCode(C);continue}var N=f[l++]&63;if((C&224)==192){S+=String.fromCharCode((C&31)<<6|N);continue}var w=f[l++]&63;if((C&240)==224?C=(C&15)<<12|N<<6|w:C=(C&7)<<18|N<<12|w<<6|f[l++]&63,C<65536)S+=String.fromCharCode(C);else{var I=C-65536;S+=String.fromCharCode(55296|I>>10,56320|I&1023)}}return S}function G(f,l){return f?V(q,f,l):""}function j(f,l,g,x){if(!(x>0))return 0;for(var R=g,S=g+x-1,C=0;C<f.length;++C){var N=f.charCodeAt(C);if(N>=55296&&N<=57343){var w=f.charCodeAt(++C);N=65536+((N&1023)<<10)|w&1023}if(N<=127){if(g>=S)break;l[g++]=N}else if(N<=2047){if(g+1>=S)break;l[g++]=192|N>>6,l[g++]=128|N&63}else if(N<=65535){if(g+2>=S)break;l[g++]=224|N>>12,l[g++]=128|N>>6&63,l[g++]=128|N&63}else{if(g+3>=S)break;l[g++]=240|N>>18,l[g++]=128|N>>12&63,l[g++]=128|N>>6&63,l[g++]=128|N&63}}return l[g]=0,g-R}function H(f,l,g){return j(f,q,l,g)}function z(f){for(var l=0,g=0;g<f.length;++g){var x=f.charCodeAt(g);x<=127?l++:x<=2047?l+=2:x>=55296&&x<=57343?(l+=4,++g):l+=3}return l}var D,q,Z,re,J,X,oe,de;function we(){var f=b.buffer;r.HEAP8=D=new Int8Array(f),r.HEAP16=Z=new Int16Array(f),r.HEAP32=J=new Int32Array(f),r.HEAPU8=q=new Uint8Array(f),r.HEAPU16=re=new Uint16Array(f),r.HEAPU32=X=new Uint32Array(f),r.HEAPF32=oe=new Float32Array(f),r.HEAPF64=de=new Float64Array(f)}var Te,Ue=[],ot=[],ct=[];function nt(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)jt(r.preRun.shift());Qr(Ue)}function fr(){Qr(ot)}function pe(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Xr(r.postRun.shift());Qr(ct)}function jt(f){Ue.unshift(f)}function Le(f){ot.unshift(f)}function Xr(f){ct.unshift(f)}var Ye=0,ft=null;function Yr(f){Ye++,r.monitorRunDependencies&&r.monitorRunDependencies(Ye)}function Kr(f){if(Ye--,r.monitorRunDependencies&&r.monitorRunDependencies(Ye),Ye==0&&ft){var l=ft;ft=null,l()}}function ke(f){r.onAbort&&r.onAbort(f),f="Aborted("+f+")",y(f),O=!0,f+=". Build with -sASSERTIONS for more info.";var l=new WebAssembly.RuntimeError(f);throw s(l),l}var So="data:application/octet-stream;base64,";function cs(f){return f.startsWith(So)}function lr(f){return f.startsWith("file://")}var be;r.locateFile?(be="manifold.wasm",cs(be)||(be=m(be))):be=new URL("/assets/manifold-db7b3843.wasm",self.location).href;function fs(f){try{if(f==be&&M)return new Uint8Array(M);if(E)return E(f);throw"both async and sync fetching of the wasm failed"}catch(l){ke(l)}}function No(){if(!M&&(o||c)){if(typeof fetch=="function"&&!lr(be))return fetch(be,{credentials:"same-origin"}).then(function(f){if(!f.ok)throw"failed to load wasm binary file at '"+be+"'";return f.arrayBuffer()}).catch(function(){return fs(be)});if(T)return new Promise(function(f,l){T(be,function(g){f(new Uint8Array(g))},l)})}return Promise.resolve().then(function(){return fs(be)})}function Co(){var f={a:Ef};function l(C,N){var w=C.exports;r.asm=w,b=r.asm.ka,we(),Te=r.asm.pa,Le(r.asm.la),Kr()}Yr();function g(C){l(C.instance)}function x(C){return No().then(function(N){return WebAssembly.instantiate(N,f)}).then(function(N){return N}).then(C,function(N){y("failed to asynchronously prepare wasm: "+N),ke(N)})}function R(){return!M&&typeof WebAssembly.instantiateStreaming=="function"&&!cs(be)&&!lr(be)&&!u&&typeof fetch=="function"?fetch(be,{credentials:"same-origin"}).then(function(C){var N=WebAssembly.instantiateStreaming(C,f);return N.then(g,function(w){return y("wasm streaming compile failed: "+w),y("falling back to ArrayBuffer instantiation"),x(g)})}):x(g)}if(r.instantiateWasm)try{var S=r.instantiateWasm(f,l);return S}catch(C){y("Module.instantiateWasm callback failed with error: "+C),s(C)}return R().catch(s),{}}var At,Jr;function Oo(f){this.name="ExitStatus",this.message="Program terminated with exit("+f+")",this.status=f}function Qr(f){for(;f.length>0;)f.shift()(r)}function Ke(f,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":return D[f>>0];case"i8":return D[f>>0];case"i16":return Z[f>>1];case"i32":return J[f>>2];case"i64":return J[f>>2];case"float":return oe[f>>2];case"double":return de[f>>3];case"*":return X[f>>2];default:ke("invalid type for getValue: "+l)}return null}function ur(f,l,g="i8"){switch(g.endsWith("*")&&(g="*"),g){case"i1":D[f>>0]=l;break;case"i8":D[f>>0]=l;break;case"i16":Z[f>>1]=l;break;case"i32":J[f>>2]=l;break;case"i64":Jr=[l>>>0,(At=l,+Math.abs(At)>=1?At>0?(Math.min(+Math.floor(At/4294967296),4294967295)|0)>>>0:~~+Math.ceil((At-+(~~At>>>0))/4294967296)>>>0:0)],J[f>>2]=Jr[0],J[f+4>>2]=Jr[1];break;case"float":oe[f>>2]=l;break;case"double":de[f>>3]=l;break;case"*":X[f>>2]=l;break;default:ke("invalid type for setValue: "+g)}}var hr=[];function Fo(f){f.add_ref()}function Do(f){var l=new Zr(f);return l.get_caught()||l.set_caught(!0),l.set_rethrown(!1),hr.push(l),Fo(l),l.get_exception_ptr()}var St=0,zt=[];function ae(f){var l=zt[f];return l||(f>=zt.length&&(zt.length=f+1),zt[f]=l=Te.get(f)),l}function $o(f){if(f.release_ref()&&!f.get_rethrown()){var l=f.get_destructor();l&&ae(l)(f.excPtr),bs(f.excPtr)}}function Po(){_setThrew(0);var f=hr.pop();$o(f),St=0}function Zr(f){this.excPtr=f,this.ptr=f-24,this.set_type=function(l){X[this.ptr+4>>2]=l},this.get_type=function(){return X[this.ptr+4>>2]},this.set_destructor=function(l){X[this.ptr+8>>2]=l},this.get_destructor=function(){return X[this.ptr+8>>2]},this.set_refcount=function(l){J[this.ptr>>2]=l},this.set_caught=function(l){l=l?1:0,D[this.ptr+12>>0]=l},this.get_caught=function(){return D[this.ptr+12>>0]!=0},this.set_rethrown=function(l){l=l?1:0,D[this.ptr+13>>0]=l},this.get_rethrown=function(){return D[this.ptr+13>>0]!=0},this.init=function(l,g){this.set_adjusted_ptr(0),this.set_type(l),this.set_destructor(g),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var l=J[this.ptr>>2];J[this.ptr>>2]=l+1},this.release_ref=function(){var l=J[this.ptr>>2];return J[this.ptr>>2]=l-1,l===1},this.set_adjusted_ptr=function(l){X[this.ptr+16>>2]=l},this.get_adjusted_ptr=function(){return X[this.ptr+16>>2]},this.get_exception_ptr=function(){var l=Ss(this.get_type());if(l)return X[this.excPtr>>2];var g=this.get_adjusted_ptr();return g!==0?g:this.excPtr}}function Uo(f){throw St||(St=f),f}function ls(){var f=St;if(!f)return Xt(0),0;var l=new Zr(f);l.set_adjusted_ptr(f);var g=l.get_type();if(!g)return Xt(0),f;for(var x=0;x<arguments.length;x++){var R=arguments[x];if(R===0||R===g)break;var S=l.ptr+16;if(As(R,g,S))return Xt(R),f}return Xt(g),f}var Lo=ls,Bo=ls;function Vo(){var f=hr.pop();f||ke("no exception to throw");var l=f.excPtr;throw f.get_rethrown()||(hr.push(f),f.set_rethrown(!0),f.set_caught(!1)),St=l,l}function jo(f,l,g){var x=new Zr(f);throw x.init(l,g),St=f,f}var pr={};function en(f){for(;f.length;){var l=f.pop(),g=f.pop();g(l)}}function kt(f){return this.fromWireType(J[f>>2])}var Nt={},lt={},gr={},zo=48,ko=57;function dr(f){if(f===void 0)return"_unknown";f=f.replace(/[^a-zA-Z0-9_]/g,"$");var l=f.charCodeAt(0);return l>=zo&&l<=ko?"_"+f:f}function mr(f,l){return f=dr(f),new Function("body","return function "+f+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(l)}function tn(f,l){var g=mr(l,function(x){this.name=l,this.message=x;var R=new Error(x).stack;R!==void 0&&(this.stack=this.toString()+`
`+R.replace(/^Error(:[^\n]*)?\n/,""))});return g.prototype=Object.create(f.prototype),g.prototype.constructor=g,g.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},g}var us=void 0;function vr(f){throw new us(f)}function ut(f,l,g){f.forEach(function(N){gr[N]=l});function x(N){var w=g(N);w.length!==f.length&&vr("Mismatched type converter count");for(var I=0;I<f.length;++I)Ge(f[I],w[I])}var R=new Array(l.length),S=[],C=0;l.forEach((N,w)=>{lt.hasOwnProperty(N)?R[w]=lt[N]:(S.push(N),Nt.hasOwnProperty(N)||(Nt[N]=[]),Nt[N].push(()=>{R[w]=lt[N],++C,C===S.length&&x(R)}))}),S.length===0&&x(R)}function Go(f){var l=pr[f];delete pr[f];var g=l.rawConstructor,x=l.rawDestructor,R=l.fields,S=R.map(C=>C.getterReturnType).concat(R.map(C=>C.setterArgumentType));ut([f],S,C=>{var N={};return R.forEach((w,I)=>{var F=w.fieldName,$=C[I],B=w.getter,Q=w.getterContext,te=C[I+R.length],se=w.setter,Me=w.setterContext;N[F]={read:_e=>$.fromWireType(B(Q,_e)),write:(_e,De)=>{var ne=[];se(Me,_e,te.toWireType(ne,De)),en(ne)}}}),[{name:l.name,fromWireType:function(w){var I={};for(var F in N)I[F]=N[F].read(w);return x(w),I},toWireType:function(w,I){for(var F in N)if(!(F in I))throw new TypeError('Missing field:  "'+F+'"');var $=g();for(F in N)N[F].write($,I[F]);return w!==null&&w.push(x,$),$},argPackAdvance:8,readValueFromPointer:kt,destructorFunction:x}]})}function qo(f,l,g,x,R){}function yr(f){switch(f){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+f)}}function Ho(){for(var f=new Array(256),l=0;l<256;++l)f[l]=String.fromCharCode(l);hs=f}var hs=void 0;function Re(f){for(var l="",g=f;q[g];)l+=hs[q[g++]];return l}var Ct=void 0;function ee(f){throw new Ct(f)}function Ge(f,l,g={}){if(!("argPackAdvance"in l))throw new TypeError("registerType registeredInstance requires argPackAdvance");var x=l.name;if(f||ee('type "'+x+'" must have a positive integer typeid pointer'),lt.hasOwnProperty(f)){if(g.ignoreDuplicateRegistrations)return;ee("Cannot register type '"+x+"' twice")}if(lt[f]=l,delete gr[f],Nt.hasOwnProperty(f)){var R=Nt[f];delete Nt[f],R.forEach(S=>S())}}function Wo(f,l,g,x,R){var S=yr(g);l=Re(l),Ge(f,{name:l,fromWireType:function(C){return!!C},toWireType:function(C,N){return N?x:R},argPackAdvance:8,readValueFromPointer:function(C){var N;if(g===1)N=D;else if(g===2)N=Z;else if(g===4)N=J;else throw new TypeError("Unknown boolean type size: "+l);return this.fromWireType(N[C>>S])},destructorFunction:null})}function Xo(f){if(!(this instanceof st)||!(f instanceof st))return!1;for(var l=this.$$.ptrType.registeredClass,g=this.$$.ptr,x=f.$$.ptrType.registeredClass,R=f.$$.ptr;l.baseClass;)g=l.upcast(g),l=l.baseClass;for(;x.baseClass;)R=x.upcast(R),x=x.baseClass;return l===x&&g===R}function Yo(f){return{count:f.count,deleteScheduled:f.deleteScheduled,preservePointerOnDelete:f.preservePointerOnDelete,ptr:f.ptr,ptrType:f.ptrType,smartPtr:f.smartPtr,smartPtrType:f.smartPtrType}}function rn(f){function l(g){return g.$$.ptrType.registeredClass.name}ee(l(f)+" instance already deleted")}var nn=!1;function ps(f){}function Ko(f){f.smartPtr?f.smartPtrType.rawDestructor(f.smartPtr):f.ptrType.registeredClass.rawDestructor(f.ptr)}function gs(f){f.count.value-=1;var l=f.count.value===0;l&&Ko(f)}function ds(f,l,g){if(l===g)return f;if(g.baseClass===void 0)return null;var x=ds(f,l,g.baseClass);return x===null?null:g.downcast(x)}var ms={};function Jo(){return Object.keys(Ht).length}function Qo(){var f=[];for(var l in Ht)Ht.hasOwnProperty(l)&&f.push(Ht[l]);return f}var Gt=[];function sn(){for(;Gt.length;){var f=Gt.pop();f.$$.deleteScheduled=!1,f.delete()}}var qt=void 0;function Zo(f){qt=f,Gt.length&&qt&&qt(sn)}function ec(){r.getInheritedInstanceCount=Jo,r.getLiveInheritedInstances=Qo,r.flushPendingDeletes=sn,r.setDelayFunction=Zo}var Ht={};function tc(f,l){for(l===void 0&&ee("ptr should not be undefined");f.baseClass;)l=f.upcast(l),f=f.baseClass;return l}function rc(f,l){return l=tc(f,l),Ht[l]}function xr(f,l){(!l.ptrType||!l.ptr)&&vr("makeClassHandle requires ptr and ptrType");var g=!!l.smartPtrType,x=!!l.smartPtr;return g!==x&&vr("Both smartPtrType and smartPtr must be specified"),l.count={value:1},Wt(Object.create(f,{$$:{value:l}}))}function nc(f){var l=this.getPointee(f);if(!l)return this.destructor(f),null;var g=rc(this.registeredClass,l);if(g!==void 0){if(g.$$.count.value===0)return g.$$.ptr=l,g.$$.smartPtr=f,g.clone();var x=g.clone();return this.destructor(f),x}function R(){return this.isSmartPointer?xr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:l,smartPtrType:this,smartPtr:f}):xr(this.registeredClass.instancePrototype,{ptrType:this,ptr:f})}var S=this.registeredClass.getActualType(l),C=ms[S];if(!C)return R.call(this);var N;this.isConst?N=C.constPointerType:N=C.pointerType;var w=ds(l,this.registeredClass,N.registeredClass);return w===null?R.call(this):this.isSmartPointer?xr(N.registeredClass.instancePrototype,{ptrType:N,ptr:w,smartPtrType:this,smartPtr:f}):xr(N.registeredClass.instancePrototype,{ptrType:N,ptr:w})}function Wt(f){return typeof FinalizationRegistry>"u"?(Wt=l=>l,f):(nn=new FinalizationRegistry(l=>{gs(l.$$)}),Wt=l=>{var g=l.$$,x=!!g.smartPtr;if(x){var R={$$:g};nn.register(l,R,l)}return l},ps=l=>nn.unregister(l),Wt(f))}function sc(){if(this.$$.ptr||rn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var f=Wt(Object.create(Object.getPrototypeOf(this),{$$:{value:Yo(this.$$)}}));return f.$$.count.value+=1,f.$$.deleteScheduled=!1,f}function ic(){this.$$.ptr||rn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ee("Object already scheduled for deletion"),ps(this),gs(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ac(){return!this.$$.ptr}function oc(){return this.$$.ptr||rn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ee("Object already scheduled for deletion"),Gt.push(this),Gt.length===1&&qt&&qt(sn),this.$$.deleteScheduled=!0,this}function cc(){st.prototype.isAliasOf=Xo,st.prototype.clone=sc,st.prototype.delete=ic,st.prototype.isDeleted=ac,st.prototype.deleteLater=oc}function st(){}function vs(f,l,g){if(f[l].overloadTable===void 0){var x=f[l];f[l]=function(){return f[l].overloadTable.hasOwnProperty(arguments.length)||ee("Function '"+g+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+f[l].overloadTable+")!"),f[l].overloadTable[arguments.length].apply(this,arguments)},f[l].overloadTable=[],f[l].overloadTable[x.argCount]=x}}function an(f,l,g){r.hasOwnProperty(f)?((g===void 0||r[f].overloadTable!==void 0&&r[f].overloadTable[g]!==void 0)&&ee("Cannot register public name '"+f+"' twice"),vs(r,f,f),r.hasOwnProperty(g)&&ee("Cannot register multiple overloads of a function with the same number of arguments ("+g+")!"),r[f].overloadTable[g]=l):(r[f]=l,g!==void 0&&(r[f].numArguments=g))}function fc(f,l,g,x,R,S,C,N){this.name=f,this.constructor=l,this.instancePrototype=g,this.rawDestructor=x,this.baseClass=R,this.getActualType=S,this.upcast=C,this.downcast=N,this.pureVirtualFunctions=[]}function on(f,l,g){for(;l!==g;)l.upcast||ee("Expected null or instance of "+g.name+", got an instance of "+l.name),f=l.upcast(f),l=l.baseClass;return f}function lc(f,l){if(l===null)return this.isReference&&ee("null is not a valid "+this.name),0;l.$$||ee('Cannot pass "'+hn(l)+'" as a '+this.name),l.$$.ptr||ee("Cannot pass deleted object as a pointer of type "+this.name);var g=l.$$.ptrType.registeredClass,x=on(l.$$.ptr,g,this.registeredClass);return x}function uc(f,l){var g;if(l===null)return this.isReference&&ee("null is not a valid "+this.name),this.isSmartPointer?(g=this.rawConstructor(),f!==null&&f.push(this.rawDestructor,g),g):0;l.$$||ee('Cannot pass "'+hn(l)+'" as a '+this.name),l.$$.ptr||ee("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&l.$$.ptrType.isConst&&ee("Cannot convert argument of type "+(l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name)+" to parameter type "+this.name);var x=l.$$.ptrType.registeredClass;if(g=on(l.$$.ptr,x,this.registeredClass),this.isSmartPointer)switch(l.$$.smartPtr===void 0&&ee("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:l.$$.smartPtrType===this?g=l.$$.smartPtr:ee("Cannot convert argument of type "+(l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:g=l.$$.smartPtr;break;case 2:if(l.$$.smartPtrType===this)g=l.$$.smartPtr;else{var R=l.clone();g=this.rawShare(g,xe.toHandle(function(){R.delete()})),f!==null&&f.push(this.rawDestructor,g)}break;default:ee("Unsupporting sharing policy")}return g}function hc(f,l){if(l===null)return this.isReference&&ee("null is not a valid "+this.name),0;l.$$||ee('Cannot pass "'+hn(l)+'" as a '+this.name),l.$$.ptr||ee("Cannot pass deleted object as a pointer of type "+this.name),l.$$.ptrType.isConst&&ee("Cannot convert argument of type "+l.$$.ptrType.name+" to parameter type "+this.name);var g=l.$$.ptrType.registeredClass,x=on(l.$$.ptr,g,this.registeredClass);return x}function pc(f){return this.rawGetPointee&&(f=this.rawGetPointee(f)),f}function gc(f){this.rawDestructor&&this.rawDestructor(f)}function dc(f){f!==null&&f.delete()}function mc(){Je.prototype.getPointee=pc,Je.prototype.destructor=gc,Je.prototype.argPackAdvance=8,Je.prototype.readValueFromPointer=kt,Je.prototype.deleteObject=dc,Je.prototype.fromWireType=nc}function Je(f,l,g,x,R,S,C,N,w,I,F){this.name=f,this.registeredClass=l,this.isReference=g,this.isConst=x,this.isSmartPointer=R,this.pointeeType=S,this.sharingPolicy=C,this.rawGetPointee=N,this.rawConstructor=w,this.rawShare=I,this.rawDestructor=F,!R&&l.baseClass===void 0?x?(this.toWireType=lc,this.destructorFunction=null):(this.toWireType=hc,this.destructorFunction=null):this.toWireType=uc}function ys(f,l,g){r.hasOwnProperty(f)||vr("Replacing nonexistant public symbol"),r[f].overloadTable!==void 0&&g!==void 0?r[f].overloadTable[g]=l:(r[f]=l,r[f].argCount=g)}function vc(f,l,g){var x=r["dynCall_"+f];return g&&g.length?x.apply(null,[l].concat(g)):x.call(null,l)}function yc(f,l,g){if(f.includes("j"))return vc(f,l,g);var x=ae(l).apply(null,g);return x}function xc(f,l){var g=[];return function(){return g.length=0,Object.assign(g,arguments),yc(f,l,g)}}function Be(f,l){f=Re(f);function g(){return f.includes("j")?xc(f,l):ae(l)}var x=g();return typeof x!="function"&&ee("unknown function pointer with signature "+f+": "+l),x}var xs=void 0;function Ts(f){var l=Is(f),g=Re(l);return Qe(l),g}function Tr(f,l){var g=[],x={};function R(S){if(!x[S]&&!lt[S]){if(gr[S]){gr[S].forEach(R);return}g.push(S),x[S]=!0}}throw l.forEach(R),new xs(f+": "+g.map(Ts).join([", "]))}function Tc(f,l,g,x,R,S,C,N,w,I,F,$,B){F=Re(F),S=Be(R,S),N&&(N=Be(C,N)),I&&(I=Be(w,I)),B=Be($,B);var Q=dr(F);an(Q,function(){Tr("Cannot construct "+F+" due to unbound types",[x])}),ut([f,l,g],x?[x]:[],function(te){te=te[0];var se,Me;x?(se=te.registeredClass,Me=se.instancePrototype):Me=st.prototype;var _e=mr(Q,function(){if(Object.getPrototypeOf(this)!==De)throw new Ct("Use 'new' to construct "+F);if(ne.constructor_body===void 0)throw new Ct(F+" has no accessible constructor");var Fs=ne.constructor_body[arguments.length];if(Fs===void 0)throw new Ct("Tried to invoke ctor of "+F+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(ne.constructor_body).toString()+") parameters instead!");return Fs.apply(this,arguments)}),De=Object.create(Me,{constructor:{value:_e}});_e.prototype=De;var ne=new fc(F,_e,De,B,se,S,N,I),qf=new Je(F,ne,!0,!1,!1),Cs=new Je(F+"*",ne,!1,!1,!1),Os=new Je(F+" const*",ne,!1,!0,!1);return ms[f]={pointerType:Cs,constPointerType:Os},ys(Q,_e),[qf,Cs,Os]})}function cn(f,l){for(var g=[],x=0;x<f;x++)g.push(X[l+x*4>>2]);return g}function Ms(f,l){if(!(f instanceof Function))throw new TypeError("new_ called with constructor type "+typeof f+" which is not a function");var g=mr(f.name||"unknownFunctionName",function(){});g.prototype=f.prototype;var x=new g,R=f.apply(x,l);return R instanceof Object?R:x}function fn(f,l,g,x,R){var S=l.length;S<2&&ee("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var C=l[1]!==null&&g!==null,N=!1,w=1;w<l.length;++w)if(l[w]!==null&&l[w].destructorFunction===void 0){N=!0;break}for(var I=l[0].name!=="void",F="",$="",w=0;w<S-2;++w)F+=(w!==0?", ":"")+"arg"+w,$+=(w!==0?", ":"")+"arg"+w+"Wired";var B="return function "+dr(f)+"("+F+`) {
if (arguments.length !== `+(S-2)+`) {
throwBindingError('function `+f+" called with ' + arguments.length + ' arguments, expected "+(S-2)+` args!');
}
`;N&&(B+=`var destructors = [];
`);var Q=N?"destructors":"null",te=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],se=[ee,x,R,en,l[0],l[1]];C&&(B+="var thisWired = classParam.toWireType("+Q+`, this);
`);for(var w=0;w<S-2;++w)B+="var arg"+w+"Wired = argType"+w+".toWireType("+Q+", arg"+w+"); // "+l[w+2].name+`
`,te.push("argType"+w),se.push(l[w+2]);if(C&&($="thisWired"+($.length>0?", ":"")+$),B+=(I?"var rv = ":"")+"invoker(fn"+($.length>0?", ":"")+$+`);
`,N)B+=`runDestructors(destructors);
`;else for(var w=C?1:2;w<l.length;++w){var Me=w===1?"thisWired":"arg"+(w-2)+"Wired";l[w].destructorFunction!==null&&(B+=Me+"_dtor("+Me+"); // "+l[w].name+`
`,te.push(Me+"_dtor"),se.push(l[w].destructorFunction))}I&&(B+=`var ret = retType.fromWireType(rv);
return ret;
`),B+=`}
`,te.push(B);var _e=Ms(Function,te).apply(null,se);return _e}function Mc(f,l,g,x,R,S){L(l>0);var C=cn(l,g);R=Be(x,R),ut([],[f],function(N){N=N[0];var w="constructor "+N.name;if(N.registeredClass.constructor_body===void 0&&(N.registeredClass.constructor_body=[]),N.registeredClass.constructor_body[l-1]!==void 0)throw new Ct("Cannot register multiple constructors with identical number of parameters ("+(l-1)+") for class '"+N.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return N.registeredClass.constructor_body[l-1]=()=>{Tr("Cannot construct "+N.name+" due to unbound types",C)},ut([],C,function(I){return I.splice(1,0,null),N.registeredClass.constructor_body[l-1]=fn(w,I,null,R,S),[]}),[]})}function Ec(f,l,g,x,R,S,C,N){var w=cn(g,x);l=Re(l),S=Be(R,S),ut([],[f],function(I){I=I[0];var F=I.name+"."+l;l.startsWith("@@")&&(l=Symbol[l.substring(2)]),N&&I.registeredClass.pureVirtualFunctions.push(l);function $(){Tr("Cannot call "+F+" due to unbound types",w)}var B=I.registeredClass.instancePrototype,Q=B[l];return Q===void 0||Q.overloadTable===void 0&&Q.className!==I.name&&Q.argCount===g-2?($.argCount=g-2,$.className=I.name,B[l]=$):(vs(B,l,F),B[l].overloadTable[g-2]=$),ut([],w,function(te){var se=fn(F,te,I,S,C);return B[l].overloadTable===void 0?(se.argCount=g-2,B[l]=se):B[l].overloadTable[g-2]=se,[]}),[]})}var ln=[],Ve=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function un(f){f>4&&--Ve[f].refcount===0&&(Ve[f]=void 0,ln.push(f))}function wc(){for(var f=0,l=5;l<Ve.length;++l)Ve[l]!==void 0&&++f;return f}function Rc(){for(var f=5;f<Ve.length;++f)if(Ve[f]!==void 0)return Ve[f];return null}function _c(){r.count_emval_handles=wc,r.get_first_emval=Rc}var xe={toValue:f=>(f||ee("Cannot use deleted val. handle = "+f),Ve[f].value),toHandle:f=>{switch(f){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var l=ln.length?ln.pop():Ve.length;return Ve[l]={refcount:1,value:f},l}}}};function bc(f,l){l=Re(l),Ge(f,{name:l,fromWireType:function(g){var x=xe.toValue(g);return un(g),x},toWireType:function(g,x){return xe.toHandle(x)},argPackAdvance:8,readValueFromPointer:kt,destructorFunction:null})}function Ic(f,l,g){switch(l){case 0:return function(x){var R=g?D:q;return this.fromWireType(R[x])};case 1:return function(x){var R=g?Z:re;return this.fromWireType(R[x>>1])};case 2:return function(x){var R=g?J:X;return this.fromWireType(R[x>>2])};default:throw new TypeError("Unknown integer type: "+f)}}function Ac(f,l,g,x){var R=yr(g);l=Re(l);function S(){}S.values={},Ge(f,{name:l,constructor:S,fromWireType:function(C){return this.constructor.values[C]},toWireType:function(C,N){return N.value},argPackAdvance:8,readValueFromPointer:Ic(l,R,x),destructorFunction:null}),an(l,S)}function Mr(f,l){var g=lt[f];return g===void 0&&ee(l+" has unknown type "+Ts(f)),g}function Sc(f,l,g){var x=Mr(f,"enum");l=Re(l);var R=x.constructor,S=Object.create(x.constructor.prototype,{value:{value:g},constructor:{value:mr(x.name+"_"+l,function(){})}});R.values[g]=S,R[l]=S}function hn(f){if(f===null)return"null";var l=typeof f;return l==="object"||l==="array"||l==="function"?f.toString():""+f}function Nc(f,l){switch(l){case 2:return function(g){return this.fromWireType(oe[g>>2])};case 3:return function(g){return this.fromWireType(de[g>>3])};default:throw new TypeError("Unknown float type: "+f)}}function Cc(f,l,g){var x=yr(g);l=Re(l),Ge(f,{name:l,fromWireType:function(R){return R},toWireType:function(R,S){return S},argPackAdvance:8,readValueFromPointer:Nc(l,x),destructorFunction:null})}function Oc(f,l,g,x,R,S){var C=cn(l,g);f=Re(f),R=Be(x,R),an(f,function(){Tr("Cannot call "+f+" due to unbound types",C)},l-1),ut([],C,function(N){var w=[N[0],null].concat(N.slice(1));return ys(f,fn(f,w,null,R,S),l-1),[]})}function Fc(f,l,g){switch(l){case 0:return g?function(R){return D[R]}:function(R){return q[R]};case 1:return g?function(R){return Z[R>>1]}:function(R){return re[R>>1]};case 2:return g?function(R){return J[R>>2]}:function(R){return X[R>>2]};default:throw new TypeError("Unknown integer type: "+f)}}function Dc(f,l,g,x,R){l=Re(l);var S=yr(g),C=$=>$;if(x===0){var N=32-8*g;C=$=>$<<N>>>N}var w=l.includes("unsigned"),I=($,B)=>{},F;w?F=function($,B){return I(B,this.name),B>>>0}:F=function($,B){return I(B,this.name),B},Ge(f,{name:l,fromWireType:C,toWireType:F,argPackAdvance:8,readValueFromPointer:Fc(l,S,x!==0),destructorFunction:null})}function $c(f,l,g){var x=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],R=x[l];function S(C){C=C>>2;var N=X,w=N[C],I=N[C+1];return new R(N.buffer,I,w)}g=Re(g),Ge(f,{name:g,fromWireType:S,argPackAdvance:8,readValueFromPointer:S},{ignoreDuplicateRegistrations:!0})}function Pc(f,l){l=Re(l);var g=l==="std::string";Ge(f,{name:l,fromWireType:function(x){var R=X[x>>2],S=x+4,C;if(g)for(var N=S,w=0;w<=R;++w){var I=S+w;if(w==R||q[I]==0){var F=I-N,$=G(N,F);C===void 0?C=$:(C+=String.fromCharCode(0),C+=$),N=I+1}}else{for(var B=new Array(R),w=0;w<R;++w)B[w]=String.fromCharCode(q[S+w]);C=B.join("")}return Qe(x),C},toWireType:function(x,R){R instanceof ArrayBuffer&&(R=new Uint8Array(R));var S,C=typeof R=="string";C||R instanceof Uint8Array||R instanceof Uint8ClampedArray||R instanceof Int8Array||ee("Cannot pass non-string to std::string"),g&&C?S=z(R):S=R.length;var N=dn(4+S+1),w=N+4;if(X[N>>2]=S,g&&C)H(R,w,S+1);else if(C)for(var I=0;I<S;++I){var F=R.charCodeAt(I);F>255&&(Qe(w),ee("String has UTF-16 code units that do not fit in 8 bits")),q[w+I]=F}else for(var I=0;I<S;++I)q[w+I]=R[I];return x!==null&&x.push(Qe,N),N},argPackAdvance:8,readValueFromPointer:kt,destructorFunction:function(x){Qe(x)}})}var Es=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Uc(f,l){for(var g=f,x=g>>1,R=x+l/2;!(x>=R)&&re[x];)++x;if(g=x<<1,g-f>32&&Es)return Es.decode(q.subarray(f,g));for(var S="",C=0;!(C>=l/2);++C){var N=Z[f+C*2>>1];if(N==0)break;S+=String.fromCharCode(N)}return S}function Lc(f,l,g){if(g===void 0&&(g=2147483647),g<2)return 0;g-=2;for(var x=l,R=g<f.length*2?g/2:f.length,S=0;S<R;++S){var C=f.charCodeAt(S);Z[l>>1]=C,l+=2}return Z[l>>1]=0,l-x}function Bc(f){return f.length*2}function Vc(f,l){for(var g=0,x="";!(g>=l/4);){var R=J[f+g*4>>2];if(R==0)break;if(++g,R>=65536){var S=R-65536;x+=String.fromCharCode(55296|S>>10,56320|S&1023)}else x+=String.fromCharCode(R)}return x}function jc(f,l,g){if(g===void 0&&(g=2147483647),g<4)return 0;for(var x=l,R=x+g-4,S=0;S<f.length;++S){var C=f.charCodeAt(S);if(C>=55296&&C<=57343){var N=f.charCodeAt(++S);C=65536+((C&1023)<<10)|N&1023}if(J[l>>2]=C,l+=4,l+4>R)break}return J[l>>2]=0,l-x}function zc(f){for(var l=0,g=0;g<f.length;++g){var x=f.charCodeAt(g);x>=55296&&x<=57343&&++g,l+=4}return l}function kc(f,l,g){g=Re(g);var x,R,S,C,N;l===2?(x=Uc,R=Lc,C=Bc,S=()=>re,N=1):l===4&&(x=Vc,R=jc,C=zc,S=()=>X,N=2),Ge(f,{name:g,fromWireType:function(w){for(var I=X[w>>2],F=S(),$,B=w+4,Q=0;Q<=I;++Q){var te=w+4+Q*l;if(Q==I||F[te>>N]==0){var se=te-B,Me=x(B,se);$===void 0?$=Me:($+=String.fromCharCode(0),$+=Me),B=te+l}}return Qe(w),$},toWireType:function(w,I){typeof I!="string"&&ee("Cannot pass non-string to C++ string type "+g);var F=C(I),$=dn(4+F+l);return X[$>>2]=F>>N,R(I,$+4,F+l),w!==null&&w.push(Qe,$),$},argPackAdvance:8,readValueFromPointer:kt,destructorFunction:function(w){Qe(w)}})}function Gc(f,l,g,x,R,S){pr[f]={name:Re(l),rawConstructor:Be(g,x),rawDestructor:Be(R,S),fields:[]}}function qc(f,l,g,x,R,S,C,N,w,I){pr[f].fields.push({fieldName:Re(l),getterReturnType:g,getter:Be(x,R),getterContext:S,setterArgumentType:C,setter:Be(N,w),setterContext:I})}function Hc(f,l){l=Re(l),Ge(f,{isVoid:!0,name:l,argPackAdvance:0,fromWireType:function(){},toWireType:function(g,x){}})}function Wc(f,l,g){f=xe.toValue(f),l=Mr(l,"emval::as");var x=[],R=xe.toHandle(x);return X[g>>2]=R,l.toWireType(x,f)}function Xc(f){var l=[];return X[f>>2]=xe.toHandle(l),l}var Yc={};function pn(f){var l=Yc[f];return l===void 0?Re(f):l}var Er=[];function Kc(f,l,g,x,R){return f=Er[f],l=xe.toValue(l),g=pn(g),f(l,g,Xc(x),R)}function Jc(f,l,g,x){f=Er[f],l=xe.toValue(l),g=pn(g),f(l,g,null,x)}function Qc(f,l){return f=xe.toValue(f),l=xe.toValue(l),f==l}function Zc(f){var l=Er.length;return Er.push(f),l}function ef(f,l){for(var g=new Array(f),x=0;x<f;++x)g[x]=Mr(X[l+x*4>>2],"parameter "+x);return g}var ws=[];function tf(f,l){var g=ef(f,l),x=g[0],R=x.name+"_$"+g.slice(1).map(function(te){return te.name}).join("_")+"$",S=ws[R];if(S!==void 0)return S;for(var C=["retType"],N=[x],w="",I=0;I<f-1;++I)w+=(I!==0?", ":"")+"arg"+I,C.push("argType"+I),N.push(g[1+I]);for(var F=dr("methodCaller_"+R),$="return function "+F+`(handle, name, destructors, args) {
`,B=0,I=0;I<f-1;++I)$+="    var arg"+I+" = argType"+I+".readValueFromPointer(args"+(B?"+"+B:"")+`);
`,B+=g[I+1].argPackAdvance;$+="    var rv = handle[name]("+w+`);
`;for(var I=0;I<f-1;++I)g[I+1].deleteObject&&($+="    argType"+I+".deleteObject(arg"+I+`);
`);x.isVoid||($+=`    return retType.toWireType(destructors, rv);
`),$+=`};
`,C.push($);var Q=Ms(Function,C).apply(null,N);return S=Zc(Q),ws[R]=S,S}function rf(f,l){return f=xe.toValue(f),l=xe.toValue(l),xe.toHandle(f[l])}function nf(f){f>4&&(Ve[f].refcount+=1)}function sf(f){return xe.toHandle(pn(f))}function af(){return xe.toHandle({})}function of(f){var l=xe.toValue(f);en(l),un(f)}function cf(f,l,g){f=xe.toValue(f),l=xe.toValue(l),g=xe.toValue(g),f[l]=g}function ff(f,l){f=Mr(f,"_emval_take_value");var g=f.readValueFromPointer(l);return xe.toHandle(g)}function lf(){ke("")}function uf(f,l,g){q.copyWithin(f,l,l+g)}function hf(){return 2147483648}function pf(f){var l=b.buffer;try{return b.grow(f-l.byteLength+65535>>>16),we(),1}catch{}}function gf(f){var l=q.length;f=f>>>0;var g=hf();if(f>g)return!1;let x=(w,I)=>w+(I-w%I)%I;for(var R=1;R<=4;R*=2){var S=l*(1+.2/R);S=Math.min(S,f+100663296);var C=Math.min(g,x(Math.max(f,S),65536)),N=pf(C);if(N)return!0}return!1}function df(f){return f}function Rs(f,l){f<128?l.push(f):l.push(f%128|128,f>>7)}function mf(f){for(var l={i:"i32",j:"i32",f:"f32",d:"f64",p:"i32"},g={parameters:[],results:f[0]=="v"?[]:[l[f[0]]]},x=1;x<f.length;++x)g.parameters.push(l[f[x]]),f[x]==="j"&&g.parameters.push("i32");return g}function vf(f,l){var g=f.slice(0,1),x=f.slice(1),R={i:127,p:127,j:126,f:125,d:124};l.push(96),Rs(x.length,l);for(var S=0;S<x.length;++S)l.push(R[x[S]]);g=="v"?l.push(0):l.push(1,R[g])}function yf(f,l){if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(mf(l),f);var g=[1];vf(l,g);var x=[0,97,115,109,1,0,0,0,1];Rs(g.length,x),x.push.apply(x,g),x.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var R=new WebAssembly.Module(new Uint8Array(x)),S=new WebAssembly.Instance(R,{e:{f}}),C=S.exports.f;return C}function xf(f,l){if(ht)for(var g=f;g<f+l;g++){var x=ae(g);x&&ht.set(x,g)}}var ht=void 0;function Tf(f){return ht||(ht=new WeakMap,xf(0,Te.length)),ht.get(f)||0}var gn=[];function Mf(){if(gn.length)return gn.pop();try{Te.grow(1)}catch(f){throw f instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":f}return Te.length-1}function _s(f,l){Te.set(f,l),zt[f]=Te.get(f)}function wr(f,l){var g=Tf(f);if(g)return g;var x=Mf();try{_s(x,f)}catch(S){if(!(S instanceof TypeError))throw S;var R=yf(f,l);_s(x,R)}return ht.set(f,x),x}function Rr(f){ht.delete(ae(f)),gn.push(f)}us=r.InternalError=tn(Error,"InternalError"),Ho(),Ct=r.BindingError=tn(Error,"BindingError"),cc(),ec(),mc(),xs=r.UnboundTypeError=tn(Error,"UnboundTypeError"),_c();var Ef={E:Do,Z:Po,a:Lo,j:Bo,_:Vo,z:jo,d:Uo,aa:Go,Q:qo,U:Wo,v:Tc,u:Mc,h:Ec,T:bc,$:Ac,r:Sc,H:Cc,n:Oc,t:Dc,o:$c,G:Pc,C:kc,x:Gc,ba:qc,V:Hc,fa:Wc,O:Kc,ca:Jc,ha:un,ea:Qc,P:tf,ga:rf,da:nf,A:sf,J:af,ja:of,ia:cf,s:ff,B:lf,S:uf,R:gf,F:Af,w:If,c:Rf,g:bf,m:Cf,q:Ff,M:Vf,i:$f,b:wf,f:Sf,Y:Uf,D:Lf,W:Gf,N:Of,e:_f,k:Nf,y:Pf,L:jf,p:Bf,I:kf,l:Df,K:zf,X:df};Co();var dn=function(){return(dn=r.asm.ma).apply(null,arguments)},Qe=function(){return(Qe=r.asm.na).apply(null,arguments)},bs=function(){return(bs=r.asm.oa).apply(null,arguments)},Is=r.___getTypeName=function(){return(Is=r.___getTypeName=r.asm.qa).apply(null,arguments)};r.__embind_initialize_bindings=function(){return(r.__embind_initialize_bindings=r.asm.ra).apply(null,arguments)};var Xt=function(){return(Xt=r.asm.sa).apply(null,arguments)},le=function(){return(le=r.asm.ta).apply(null,arguments)},ue=function(){return(ue=r.asm.ua).apply(null,arguments)},As=function(){return(As=r.asm.va).apply(null,arguments)},Ss=function(){return(Ss=r.asm.wa).apply(null,arguments)};function wf(f,l){var g=le();try{ae(f)(l)}catch(x){if(ue(g),x!==x+0)throw x;_setThrew(1,0)}}function Rf(f,l){var g=le();try{return ae(f)(l)}catch(x){if(ue(g),x!==x+0)throw x;_setThrew(1,0)}}function _f(f,l,g,x){var R=le();try{ae(f)(l,g,x)}catch(S){if(ue(R),S!==S+0)throw S;_setThrew(1,0)}}function bf(f,l,g){var x=le();try{return ae(f)(l,g)}catch(R){if(ue(x),R!==R+0)throw R;_setThrew(1,0)}}function If(f,l,g,x,R,S){var C=le();try{return ae(f)(l,g,x,R,S)}catch(N){if(ue(C),N!==N+0)throw N;_setThrew(1,0)}}function Af(f,l,g,x){var R=le();try{return ae(f)(l,g,x)}catch(S){if(ue(R),S!==S+0)throw S;_setThrew(1,0)}}function Sf(f,l,g){var x=le();try{ae(f)(l,g)}catch(R){if(ue(x),R!==R+0)throw R;_setThrew(1,0)}}function Nf(f,l,g,x,R){var S=le();try{ae(f)(l,g,x,R)}catch(C){if(ue(S),C!==C+0)throw C;_setThrew(1,0)}}function Cf(f,l,g,x){var R=le();try{return ae(f)(l,g,x)}catch(S){if(ue(R),S!==S+0)throw S;_setThrew(1,0)}}function Of(f,l,g,x,R,S,C){var N=le();try{ae(f)(l,g,x,R,S,C)}catch(w){if(ue(N),w!==w+0)throw w;_setThrew(1,0)}}function Ff(f,l,g,x,R){var S=le();try{return ae(f)(l,g,x,R)}catch(C){if(ue(S),C!==C+0)throw C;_setThrew(1,0)}}function Df(f,l,g,x,R,S,C,N,w,I,F){var $=le();try{ae(f)(l,g,x,R,S,C,N,w,I,F)}catch(B){if(ue($),B!==B+0)throw B;_setThrew(1,0)}}function $f(f){var l=le();try{ae(f)()}catch(g){if(ue(l),g!==g+0)throw g;_setThrew(1,0)}}function Pf(f,l,g,x,R,S){var C=le();try{ae(f)(l,g,x,R,S)}catch(N){if(ue(C),N!==N+0)throw N;_setThrew(1,0)}}function Uf(f,l,g,x,R,S){var C=le();try{ae(f)(l,g,x,R,S)}catch(N){if(ue(C),N!==N+0)throw N;_setThrew(1,0)}}function Lf(f,l,g,x){var R=le();try{ae(f)(l,g,x)}catch(S){if(ue(R),S!==S+0)throw S;_setThrew(1,0)}}function Bf(f,l,g,x,R,S,C){var N=le();try{ae(f)(l,g,x,R,S,C)}catch(w){if(ue(N),w!==w+0)throw w;_setThrew(1,0)}}function Vf(f,l,g,x,R,S){var C=le();try{return ae(f)(l,g,x,R,S)}catch(N){if(ue(C),N!==N+0)throw N;_setThrew(1,0)}}function jf(f,l,g,x,R,S,C,N){var w=le();try{ae(f)(l,g,x,R,S,C,N)}catch(I){if(ue(w),I!==I+0)throw I;_setThrew(1,0)}}function zf(f,l,g,x,R,S,C,N,w,I,F,$,B){var Q=le();try{ae(f)(l,g,x,R,S,C,N,w,I,F,$,B)}catch(te){if(ue(Q),te!==te+0)throw te;_setThrew(1,0)}}function kf(f,l,g,x,R,S,C,N){var w=le();try{ae(f)(l,g,x,R,S,C,N)}catch(I){if(ue(w),I!==I+0)throw I;_setThrew(1,0)}}function Gf(f,l,g,x,R,S){var C=le();try{ae(f)(l,g,x,R,S)}catch(N){if(ue(C),N!==N+0)throw N;_setThrew(1,0)}}r.addFunction=wr,r.removeFunction=Rr;var _r;ft=function f(){_r||Ns(),_r||(ft=f)};function Ns(){if(Ye>0||(nt(),Ye>0))return;function f(){_r||(_r=!0,r.calledRun=!0,!O&&(fr(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),pe()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),f()},1)):f()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Ns(),r.ready}})();const et="EXT_manifold";class y1 extends ye{static EXTENSION_NAME=et;init(){this.EXTENSION_NAME=et,this.propertyType="ManifoldPrimitive",this.parentTypes=[U.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class Eo extends fe{extensionName=et;static EXTENSION_NAME=et;createManifoldPrimitive(){return new y1(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[et])return;const a=e.meshes[i],o=this.createManifoldPrimitive();a.setExtension(et,o);const c=s.extensions[et];if(c.manifoldPrimitive){let u=0;const p=[];p.push(u);for(const m of a.listPrimitives())u+=m.getIndices().getCount(),p.push(u);o.setRunIndex(p)}c.mergeIndices&&c.mergeValues&&o.setMerge(e.accessors[c.mergeIndices],e.accessors[c.mergeValues])}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(et);if(!s)return;const i=e.meshIndexMap.get(n),a=r.meshes[i],o=s.getRunIndex(),c=o.length-1;if(c!==a.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const u=e.accessorIndexMap.get(s.getMergeIndices()),p=e.accessorIndexMap.get(s.getMergeValues()),m=r.accessors[u],v=r.accessors[p],T=a.primitives[0],E={indices:e.accessorIndexMap.get(s.getIndices()),mode:T.mode,attributes:{POSITION:T.attributes.POSITION}},A=r.accessors[E.indices];if(A){m&&v&&(A.sparse={count:m.count,indices:{bufferView:m.bufferView,byteOffset:m.byteOffset,componentType:m.componentType},values:{bufferView:v.bufferView,byteOffset:v.byteOffset}});for(let h=0;h<c;++h){const _=r.accessors[a.primitives[h].indices];_.bufferView=A.bufferView,_.byteOffset=A.byteOffset+4*o[h],_.count=o[h+1]-o[h]}a.extensions=a.extensions||{},a.extensions[et]={manifoldPrimitive:E,mergeIndices:u,mergeValues:p}}}),this}}const x1={POSITION:{type:W.Type.VEC3,components:3},SKIP:{type:null,components:1},NORMAL:{type:W.Type.VEC3,components:3},TANGENT:{type:W.Type.VEC4,components:4},TEXCOORD_0:{type:W.Type.VEC2,components:2},TEXCOORD_1:{type:W.Type.VEC2,components:2},COLOR_0:{type:W.Type.VEC3,components:3},JOINTS_0:{type:W.Type.VEC4,components:4},WEIGHTS_0:{type:W.Type.VEC4,components:4}};function T1(t){return t.registerExtensions([Eo])}function ei(t,e,r,n){t.getRoot().listBuffers().length===0&&t.createBuffer();const s=t.getRoot().listBuffers()[0],i=t.createExtension(Eo),a=t.createMesh(),o=e.runIndex.length-1;for(let d=0;d<o;++d){const y=t.createAccessor("indices").setBuffer(s).setType(W.Type.SCALAR).setArray(new Uint32Array),M=t.createPrimitive().setIndices(y),b=n[d];b&&M.setMaterial(b),a.addPrimitive(M)}if(r.length<1||r[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');const c=e.numVert,u=e.numProp;let p=0;for(const d of r){if(d==="SKIP"){++p;continue}const y=x1[d];if(y==null)throw new Error(d+" is not a recognized attribute.");const M=y.components;if(p+M>u)throw new Error("Too many attribute channels.");const b=new Float32Array(M*c);for(let L=0;L<c;++L)for(let P=0;P<M;++P)b[M*L+P]=e.vertProperties[u*L+p+P];const O=t.createAccessor().setBuffer(s).setType(y.type).setArray(b);for(const L of a.listPrimitives())L.setAttribute(d,O);p+=M}const m=i.createManifoldPrimitive();a.setExtension("EXT_manifold",m);const v=t.createAccessor("indices").setBuffer(s).setType(W.Type.SCALAR).setArray(e.triVerts);m.setIndices(v),m.setRunIndex(e.runIndex);const T=[...Array(e.numVert).keys()];for(const[d,y]of e.mergeFromVert.entries())T[y]=e.mergeToVert[d];const E=[],A=[];for(const[d,y]of e.triVerts.entries()){const M=T[y];y!==M&&(E.push(d),A.push(M))}const h=t.createAccessor().setBuffer(s).setType(W.Type.SCALAR).setArray(new Uint32Array(E)),_=t.createAccessor().setBuffer(s).setType(W.Type.SCALAR).setArray(new Uint32Array(A));return m.setMerge(h,_),a}const Fe=await v1();Fe.setup();fa(Array);const wo=T1(new dl);wo.registerExtensions(ca);let os=!1;const Hr=new Map,Wr=new Map,Ro={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},_o={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0};function bo(t,e){const r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r}Fe.show=t=>bo(t,Hr);Fe.only=t=>(os=!0,bo(t,Wr));const $t=new Array,zr=new Map,Pt=new Map;function M1(){os=!1,Hr.clear(),Wr.clear(),$t.length=0,zr.clear(),Pt.clear()}class E1{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,$t.push(this)}clone(e){const r={...this};return r._parent=e,$t.push(r),r}get parent(){return this._parent}}Fe.GLTFNode=E1;Fe.setMaterial=(t,e)=>{const r=t.originalID();if(r<0){console.warn(t," is not an original - call asOriginal() before setting a material.");return}zr.set(r,e)};const w1=["add","subtract","intersect","trimByPlane","refine","warp","setProperties","transform","translate","rotate","scale","mirror","asOriginal","decompose"],Io=["cube","cylinder","sphere","tetrahedron","extrude","revolve","union","difference","intersection","compose","levelSet","smooth","show","only"],R1=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","Mesh","GLTFNode","setMaterial"],ti=Io.concat(R1),kr=new Array;for(const t of w1){const e=Fe.Manifold.prototype[t];Fe.Manifold.prototype["_"+t]=e,Fe.Manifold.prototype[t]=function(...r){const n=this["_"+t](...r);return kr.push(n),n}}for(const t of Io){const e=Fe[t];Fe[t]=function(...r){const n=e(...r);return kr.push(n),n}}Fe.cleanup=function(){for(const t of kr)if(t instanceof Array)for(const e of t)e.delete();else t.delete();kr.length=0};postMessage(null);const _1=console.log;console.log=function(...t){let e="";for(const r of t)r==null?e+="undefined":typeof r=="object"?e+=JSON.stringify(r,null,4):e+=r.toString();postMessage({log:e}),_1(...t)};onmessage=async t=>{const e=t.data+`
return exportGLB(typeof result === "undefined" ? undefined : result);
`;try{await new Function("exportGLB","glMatrix","module",...ti,e)(A1,Mo,Fe,...ti.map(n=>Fe[n]))}catch(r){console.log(r.toString()),postMessage({objectURL:null})}finally{Fe.cleanup(),M1()}};function b1(t,e){const r=t.createNode(e.name);if(e.translation&&r.setTranslation(e.translation),e.rotation){const{quat:n}=Mo,s=Math.PI/180,i=n.create();n.rotateX(i,i,s*e.rotation[0]),n.rotateY(i,i,s*e.rotation[1]),n.rotateZ(i,i,s*e.rotation[2]),r.setRotation(i)}return e.scale&&r.setScale(e.scale),r}function Ao(t){return t==null?{}:(t.material==null&&(t.material=Ao(t.parent)),t.material)}function I1(t,{roughness:e=.2,metallic:r=1,baseColorFactor:n=[1,1,0],alpha:s=1,unlit:i=!1,name:a=""}={}){const o=t.createMaterial(a);if(i){const c=t.createExtension(Jn).createUnlit();o.setExtension("KHR_materials_unlit",c)}return s<1&&o.setAlphaMode(at.AlphaMode.BLEND).setDoubleSided(!0),o.setRoughnessFactor(e).setMetallicFactor(r).setBaseColorFactor([...n,s])}function ri(t,e){return Pt.has(e)||Pt.set(e,I1(t,e)),Pt.get(e)}function ni(t,e,r,n={}){console.log(`Triangles: ${r.numTri().toLocaleString()}`);const s=r.boundingBox(),i=[0,0,0];for(let m=0;m<3;m++)i[m]=Math.round((s.max[m]-s.min[m])*10)/10;console.log(`Bounding Box: X = ${i[0].toLocaleString()} mm, Y = ${i[1].toLocaleString()} mm, Z = ${i[2].toLocaleString()} mm`);const a=Math.round(r.getProperties().volume/10);console.log(`Genus: ${r.genus().toLocaleString()}, Volume: ${(a/100).toLocaleString()} cm^3`);const o=r.getMesh(),c=new Array;for(const m of o.runOriginalID)c.push(zr.get(m)||n);const u=["POSITION"];c[0].attributes!=null&&u.push(...c[0].attributes);const p=c.map(m=>(os&&(m=_o),ri(t,m)));e.setMesh(ei(t,o,u,p));for(const[m,v]of o.runOriginalID.entries()){let T=Hr.get(v),E=!1;if(T==null&&(E=!0,T=Wr.get(v)),T==null)continue;const A=E?zr.get(v)||n:Ro,h=t.createNode("debug").setMesh(ei(t,T,u,[ri(t,A)])).setMatrix(o.transform(m));e.addChild(h)}}async function A1(t){const e=new Pn,r=Math.sqrt(2)/2,n=1/1e3,s=e.createNode("wrapper").setRotation([-r,0,0,r]).setScale([n,n,n]);if(e.createScene().addChild(s),Hr.size>0){const o=e.createMaterial().setBaseColorFactor([1,0,0,.25]).setAlphaMode(at.AlphaMode.BLEND).setDoubleSided(!0).setMetallicFactor(0);Pt.set(Ro,o)}if(Wr.size>0){const o=e.createMaterial().setBaseColorFactor([.5,.5,.5,.25]).setAlphaMode(at.AlphaMode.BLEND).setDoubleSided(!0).setMetallicFactor(0);Pt.set(_o,o)}if($t.length>0){const o=new Map;for(const c of $t){const u=b1(e,c);o.set(c,u),c.manifold!=null&&ni(e,u,c.manifold,Ao(c))}for(const c of $t){const u=o.get(c);c.parent==null?s.addChild(u):o.get(c.parent).addChild(u)}}else{const o=e.createNode("result");ni(e,o,t),s.addChild(o)}const i=await wo.writeBinary(e),a=new Blob([i],{type:"application/octet-stream"});postMessage({objectURL:URL.createObjectURL(a)})}
