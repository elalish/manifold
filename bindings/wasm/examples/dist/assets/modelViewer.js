import"./modulepreload-polyfill.js";import{b as O,D,v,e as y,f as S,r as L,g as B,w as U,z as k}from"./gltf-io.js";import{M as E}from"./manifold.js";const M=O(new D),e=new v,s=await E();s.setup();const h=["POSITION","TEXCOORD_0"],p=new Map;async function b(t,r,i){const l=[],n=await M.read(t);await n.transform(y());const u=n.getRoot().listNodes(),d=[];for(const o of u){S(o);const a=[],c=L(o.getMesh(),r,a);c.runOriginalID=[];const w=s.reserveIDs(a.length);for(let f=0;f<a.length;++f)c.runOriginalID.push(w+f),d.push(w+f);l.push(s.Manifold(new s.Mesh(c)))}const I=e.getRoot().listMaterials().length;e.merge(n),e.getRoot().listScenes().forEach(o=>o.dispose()),e.getRoot().listBuffers().forEach(o=>o.dispose());for(const[o,a]of d.entries()){const c=e.getRoot().listMaterials()[I+o];i.set(a,c)}return s.union(l)}const j=await b("/models/space.glb",h,p),q=await b("/models/moon.glb",h,p),g=e.createNode();e.createScene().addChild(g);function R(t){C(s[t](j,q))}document.querySelector("select").onchange=function(t){R(t.target.value)};R("difference");const N=document.querySelector("model-viewer");let m=null;const z=document.querySelector("#download");z.onclick=function(){const t=document.createElement("a");t.download="manifold.glb",t.href=m,t.click()};async function C(t){const r=t.rotate([-90,0,0]).getMesh();B(g.getMesh());const i=[];for(const d of r.runOriginalID)i.push(p.get(d));const l=U(e,r,h,i);g.setMesh(l),await e.transform(k());const n=await M.writeBinary(e),u=new Blob([n],{type:"application/octet-stream"});URL.revokeObjectURL(m),m=URL.createObjectURL(u),N.src=m}
