import"./modulepreload-polyfill.js";import{K as te,h as j,s as oe,T as Z,E as Te,c as er,S as kt,I as Yt,l as Ut,a as ei,M as Ee,P as ut,n as pe,y as ti,t as ni,X as ri,d as De,b as ii,D as si,r as oi,w as ai,z as ci}from"./gltf-io.js";import{M as ui}from"./manifold.js";const li=0,fi=0,di=0,hi=2,pi=0,xi=163,gi=166,_i=0,mi=2,Ti=1,yi=64,wi=0;class bi{constructor(){this.vkFormat=wi,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=li,this.levels=[],this.dataFormatDescriptor=[{vendorId:di,descriptorType:fi,descriptorBlockSize:0,versionNumber:hi,colorModel:pi,colorPrimaries:Ti,transferFunction:mi,flags:_i,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class tt{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const le=[171,75,84,88,32,50,48,187,13,10,26,10];function En(r){return typeof TextDecoder<"u"?new TextDecoder().decode(r):Buffer.from(r).toString("utf8")}function At(r){const e=new Uint8Array(r.buffer,r.byteOffset,le.length);if(e[0]!==le[0]||e[1]!==le[1]||e[2]!==le[2]||e[3]!==le[3]||e[4]!==le[4]||e[5]!==le[5]||e[6]!==le[6]||e[7]!==le[7]||e[8]!==le[8]||e[9]!==le[9]||e[10]!==le[10]||e[11]!==le[11])throw new Error("Missing KTX 2.0 identifier.");const t=new bi,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new tt(r,le.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const o=i._nextUint32();t.supercompressionScheme=i._nextUint32();const s=i._nextUint32(),a=i._nextUint32(),f=i._nextUint32(),d=i._nextUint32(),p=i._nextUint64(),_=i._nextUint64(),w=o*3*8,b=new tt(r,le.length+n,w,!0);for(let F=0;F<o;F++)t.levels.push({levelData:new Uint8Array(r.buffer,r.byteOffset+b._nextUint64(),b._nextUint64()),uncompressedByteLength:b._nextUint64()});const l=new tt(r,s,a,!0),m={vendorId:l._skip(4)._nextUint16(),descriptorType:l._nextUint16(),versionNumber:l._nextUint16(),descriptorBlockSize:l._nextUint16(),colorModel:l._nextUint8(),colorPrimaries:l._nextUint8(),transferFunction:l._nextUint8(),flags:l._nextUint8(),texelBlockDimension:[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],bytesPlane:[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],samples:[]},c=6,u=4,x=(m.descriptorBlockSize/4-c)/u;for(let F=0;F<x;F++){const ie={bitOffset:l._nextUint16(),bitLength:l._nextUint8(),channelType:l._nextUint8(),samplePosition:[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};ie.channelType&yi?(ie.sampleLower=l._nextInt32(),ie.sampleUpper=l._nextInt32()):(ie.sampleLower=l._nextUint32(),ie.sampleUpper=l._nextUint32()),m.samples[F]=ie}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(m);const g=new tt(r,f,d,!0);for(;g._offset<d;){const F=g._nextUint32(),ie=g._scan(F),$=En(ie),V=g._scan(F-ie.byteLength);t.keyValue[$]=$.match(/^ktx/i)?En(V):V,g._offset%4&&g._skip(4-g._offset%4)}if(_<=0)return t;const h=new tt(r,p,_,!0),E=h._nextUint16(),y=h._nextUint16(),T=h._nextUint32(),S=h._nextUint32(),O=h._nextUint32(),R=h._nextUint32(),v=[];for(let F=0;F<o;F++)v.push({imageFlags:h._nextUint32(),rgbSliceByteOffset:h._nextUint32(),rgbSliceByteLength:h._nextUint32(),alphaSliceByteOffset:h._nextUint32(),alphaSliceByteLength:h._nextUint32()});const I=p+h._offset,k=I+T,B=k+S,z=B+O,U=new Uint8Array(r.buffer,r.byteOffset+I,T),W=new Uint8Array(r.buffer,r.byteOffset+k,S),de=new Uint8Array(r.buffer,r.byteOffset+B,O),ne=new Uint8Array(r.buffer,r.byteOffset+z,R);return t.globalData={endpointCount:E,selectorCount:y,imageDescs:v,endpointsData:U,selectorsData:W,tablesData:de,extendedData:ne},t}const Qt="EXT_mesh_gpu_instancing",Ot="EXT_meshopt_compression",tr="KHR_draco_mesh_compression",Jt="KHR_lights_punctual",en="KHR_materials_anisotropy",tn="KHR_materials_clearcoat",nn="KHR_materials_emissive_strength",rn="KHR_materials_ior",sn="KHR_materials_iridescence",on="KHR_materials_pbrSpecularGlossiness",an="KHR_materials_sheen",cn="KHR_materials_specular",un="KHR_materials_transmission",ln="KHR_materials_unlit",fn="KHR_materials_volume",$e="KHR_materials_variants",dn="KHR_texture_transform",yt="KHR_xmp_json_ld",Ft="INSTANCE_ATTRIBUTE";let nr=class extends oe{init(){this.extensionName=Qt,this.propertyType="InstancedMesh",this.parentTypes=[j.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ft})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};nr.EXTENSION_NAME=Qt;const Me=Qt;let rr=class extends Z{constructor(...e){super(...e),this.extensionName=Me,this.provideTypes=[j.NODE],this.prewriteTypes=[j.ACCESSOR]}createInstancedMesh(){return new nr(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,n)=>{if(!t.extensions||!t.extensions[Me])return;const i=t.extensions[Me],o=this.createInstancedMesh();for(const s in i.attributes)o.setAttribute(s,e.accessors[i.attributes[s]]);e.nodes[n].setExtension(Me,o)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Ft);for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,Ft);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(Me);if(i){const o=e.nodeIndexMap.get(n),s=t.json.nodes[o],a={attributes:{}};i.listSemantics().forEach(f=>{const d=i.getAttribute(f);a.attributes[f]=e.accessorIndexMap.get(d)}),s.extensions=s.extensions||{},s.extensions[Me]=a}}),this}};function Re(){return Re=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Re.apply(this,arguments)}var at,qe,Q;rr.EXTENSION_NAME=Me,function(r){r.QUANTIZE="quantize",r.FILTER="filter"}(at||(at={})),function(r){r.ATTRIBUTES="ATTRIBUTES",r.TRIANGLES="TRIANGLES",r.INDICES="INDICES"}(qe||(qe={})),function(r){r.NONE="NONE",r.OCTAHEDRAL="OCTAHEDRAL",r.QUATERNION="QUATERNION",r.EXPONENTIAL="EXPONENTIAL"}(Q||(Q={}));const{BYTE:Ei,SHORT:In,FLOAT:Ii}=te.ComponentType,{encodeNormalizedInt:vn,decodeNormalizedInt:Nt}=ut;function vi(r,e,t,n){const{filter:i,bits:o}=n,s={array:r.getArray(),byteStride:r.getElementSize()*r.getComponentSize(),componentType:r.getComponentType(),normalized:r.getNormalized()};if(t!==qe.ATTRIBUTES)return s;if(i!==Q.NONE){let a=r.getNormalized()?function(f){const d=f.getComponentType(),p=f.getArray(),_=new Float32Array(p.length);for(let w=0;w<p.length;w++)_[w]=Nt(p[w],d);return _}(r):new Float32Array(s.array);switch(i){case Q.EXPONENTIAL:s.byteStride=4*r.getElementSize(),s.componentType=Ii,s.normalized=!1,s.array=e.encodeFilterExp(a,r.getCount(),s.byteStride,o);break;case Q.OCTAHEDRAL:s.byteStride=o>8?8:4,s.componentType=o>8?In:Ei,s.normalized=!0,a=r.getElementSize()===3?function(f){const d=new Float32Array(4*f.length/3);for(let p=0,_=f.length/3;p<_;p++)d[4*p]=f[3*p],d[4*p+1]=f[3*p+1],d[4*p+2]=f[3*p+2];return d}(a):a,s.array=e.encodeFilterOct(a,r.getCount(),s.byteStride,o);break;case Q.QUATERNION:s.byteStride=8,s.componentType=In,s.normalized=!0,s.array=e.encodeFilterQuat(a,r.getCount(),s.byteStride,o);break;default:throw new Error("Invalid filter.")}s.min=r.getMin([]),s.max=r.getMax([]),r.getNormalized()&&(s.min=s.min.map(f=>Nt(f,r.getComponentType())),s.max=s.max.map(f=>Nt(f,r.getComponentType()))),s.normalized&&(s.min=s.min.map(f=>vn(f,s.componentType)),s.max=s.max.map(f=>vn(f,s.componentType)))}else s.byteStride%4&&(s.array=function(a,f){const d=Te.padNumber(a.BYTES_PER_ELEMENT*f)/a.BYTES_PER_ELEMENT,p=new a.constructor(a.length/f*d);for(let _=0;_*f<a.length;_++)for(let w=0;w<f;w++)p[_*d+w]=a[_*f+w];return p}(s.array,r.getElementSize()),s.byteStride=s.array.byteLength/r.getCount());return s}function Ri(r,e){return e===kt.BufferViewUsage.ELEMENT_ARRAY_BUFFER?r.listParents().some(t=>t instanceof Ut&&t.getMode()===Ut.Mode.TRIANGLES)?qe.TRIANGLES:qe.INDICES:qe.ATTRIBUTES}function Si(r,e){const t=e.getGraph().listParentEdges(r).filter(n=>!(n.getParent()instanceof ti));for(const n of t){const i=n.getName(),o=n.getAttributes().key||"";if(i==="indices")return{filter:Q.NONE};if(i==="attributes"){if(o==="POSITION")return{filter:Q.NONE};if(o==="TEXCOORD_0")return{filter:Q.NONE};if(o==="NORMAL")return{filter:Q.OCTAHEDRAL,bits:8};if(o==="TANGENT")return{filter:Q.OCTAHEDRAL,bits:8};if(o.startsWith("JOINTS_"))return{filter:Q.NONE};if(o.startsWith("WEIGHTS_"))return{filter:Q.NONE}}if(i==="output"){const s=ir(r);return s==="rotation"?{filter:Q.QUATERNION,bits:16}:s==="translation"||s==="scale"?{filter:Q.EXPONENTIAL,bits:12}:{filter:Q.NONE}}if(i==="input")return{filter:Q.NONE};if(i==="inverseBindMatrices")return{filter:Q.NONE}}return{filter:Q.NONE}}function ir(r){for(const e of r.listParents())if(e instanceof ni){for(const t of e.listParents())if(t instanceof ri)return t.getTargetPath()}return null}const fe=Ot,Rn={method:at.QUANTIZE};let Bt=class extends Z{constructor(...e){super(...e),this.extensionName=fe,this.prereadTypes=[j.BUFFER,j.PRIMITIVE],this.prewriteTypes=[j.BUFFER,j.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=Rn,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=Re({},Rn,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${fe}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${fe}]: Missing WASM support.`)}return t===j.BUFFER?this._prereadBuffers(e):t===j.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,i)=>{if(!n.extensions||!n.extensions[fe])return;const o=n.extensions[fe],s=o.byteOffset||0,a=o.byteLength||0,f=o.count,d=o.byteStride,p=new Uint8Array(f*d),_=t.json.buffers[o.buffer],w=Te.toView(_.uri?t.resources[_.uri]:t.resources[er],s,a);this._decoder.decodeGltfBuffer(p,f,d,w,o.mode,o.filter),e.bufferViews[i]=p})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var i;n.extensions&&n.extensions[fe]&&(i=t.json.buffers[n.buffer]).extensions&&i.extensions[Ot]&&i.extensions[Ot].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[fe].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const i of t.listParents())i instanceof te&&i.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===j.ACCESSOR?this._prewriteAccessors(e):t===j.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,i=this._encoderOptions,o=this.document.createBuffer(),s=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const a of this.document.getRoot().listAccessors()){if(ir(a)==="weights"||a.getSparse())continue;const f=e.getAccessorUsage(a),d=Ri(a,f),p=i.method===at.FILTER?Si(a,this.document):{filter:Q.NONE},_=vi(a,n,d,p),{array:w,byteStride:b}=_,l=a.getBuffer();if(!l)throw new Error(`${fe}: Missing buffer for accessor.`);const m=this.document.getRoot().listBuffers().indexOf(l),c=[f,d,p.filter,b,m].join(":");let u=this._encoderBufferViews[c],x=this._encoderBufferViewData[c],g=this._encoderBufferViewAccessors[c];u&&x||(g=this._encoderBufferViewAccessors[c]=[],x=this._encoderBufferViewData[c]=[],u=this._encoderBufferViews[c]={buffer:s,target:kt.USAGE_TO_TARGET[f],byteOffset:0,byteLength:0,byteStride:f===kt.BufferViewUsage.ARRAY_BUFFER?b:void 0,extensions:{[fe]:{buffer:m,byteOffset:0,byteLength:0,mode:d,filter:p.filter!==Q.NONE?p.filter:void 0,byteStride:b,count:0}}});const h=e.createAccessorDef(a);h.componentType=_.componentType,h.normalized=_.normalized,h.byteOffset=u.byteLength,h.min&&_.min&&(h.min=_.min),h.max&&_.max&&(h.max=_.max),e.accessorIndexMap.set(a,t.accessors.length),t.accessors.push(h),g.push(h),x.push(new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),u.byteLength+=w.byteLength,u.extensions.EXT_meshopt_compression.count+=a.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const i=this._encoderBufferViews[n],o=this._encoderBufferViewData[n],s=this.document.getRoot().listBuffers()[i.extensions[fe].buffer],a=e.otherBufferViews.get(s)||[],{count:f,byteStride:d,mode:p}=i.extensions[fe],_=Te.concat(o),w=t.encodeGltfBuffer(_,f,d,p),b=Te.pad(w);i.extensions[fe].byteLength=w.byteLength,o.length=0,o.push(b),a.push(b),e.otherBufferViews.set(s,a)}}write(e){let t=0;for(const s in this._encoderBufferViews){const a=this._encoderBufferViews[s],f=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[s][0]),d=this._encoderBufferViewAccessors[s];for(const w of d)w.bufferView=f;const p=e.jsonDoc.json.bufferViews[f],_=p.byteOffset||0;Object.assign(p,a),p.byteOffset=t,p.extensions[fe].byteOffset=_,t+=Te.padNumber(a.byteLength)}const n=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(n),o=e.jsonDoc.json.buffers[i];return o.byteLength=t,o.extensions={[fe]:{fallback:!0}},n.dispose(),this}};Bt.EXTENSION_NAME=fe,Bt.EncoderMethod=at;const rt="EXT_texture_avif";let Ai=class{match(e){return e.length>=12&&Te.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=Sn(t,0);if(!n)return null;let i=n.end;for(;n=Sn(t,i);)if(n.type==="meta")i=n.start+4;else if(n.type==="iprp"||n.type==="ipco")i=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;i=n.end}return null}getChannels(e){return 4}},sr=class extends Z{constructor(...e){super(...e),this.extensionName=rt,this.prereadTypes=[j.TEXTURE]}static register(){Yt.registerFormat("image/avif",new Ai)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[rt]&&(t.source=t.extensions[rt].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[rt]={source:o.source},delete o.source)})}}),this}};function Sn(r,e){if(r.byteLength<4+e)return null;const t=r.getUint32(e);return r.byteLength<t+e||t<8?null:{type:Te.decodeText(new Uint8Array(r.buffer,r.byteOffset+e+4,4)),start:e+8,end:e+t}}sr.EXTENSION_NAME=rt;const it="EXT_texture_webp";let Ni=class{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Te.decodeText(e.slice(0,4)),n=Te.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const i=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<i.byteLength;){const s=Te.decodeText(new Uint8Array([i.getUint8(o),i.getUint8(o+1),i.getUint8(o+2),i.getUint8(o+3)])),a=i.getUint32(o+4,!0);if(s==="VP8 ")return[16383&i.getInt16(o+14,!0),16383&i.getInt16(o+16,!0)];if(s==="VP8L"){const f=i.getUint8(o+9),d=i.getUint8(o+10),p=i.getUint8(o+11);return[1+((63&d)<<8|f),1+((15&i.getUint8(o+12))<<10|p<<2|(192&d)>>6)]}o+=8+a+a%2}return null}getChannels(e){return 4}},or=class extends Z{constructor(...e){super(...e),this.extensionName=it,this.prereadTypes=[j.TEXTURE]}static register(){Yt.registerFormat("image/webp",new Ni)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[it]&&(t.source=t.extensions[it].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[it]={source:o.source},delete o.source)})}}),this}};or.EXTENSION_NAME=it;const An=tr;let re,ar,cr,he;function Di(r,e){const t=new re.DecoderBuffer;try{if(t.Init(e,e.length),r.GetEncodedGeometryType(t)!==re.TRIANGULAR_MESH)throw new Error(`[${An}] Unknown geometry type.`);const n=new re.Mesh;if(!r.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${An}] Decoding failure.`);return n}finally{re.destroy(t)}}function Mi(r,e){const t=3*e.num_faces();let n,i;if(e.num_points()<=65534){const o=t*Uint16Array.BYTES_PER_ELEMENT;n=re._malloc(o),r.GetTrianglesUInt16Array(e,o,n),i=new Uint16Array(re.HEAPU16.buffer,n,t).slice()}else{const o=t*Uint32Array.BYTES_PER_ELEMENT;n=re._malloc(o),r.GetTrianglesUInt32Array(e,o,n),i=new Uint32Array(re.HEAPU32.buffer,n,t).slice()}return re._free(n),i}function Ci(r,e,t,n){const i=cr[n.componentType],o=ar[n.componentType],s=t.num_components(),a=e.num_points()*s,f=a*o.BYTES_PER_ELEMENT,d=re._malloc(f);r.GetAttributeDataArrayForAllPoints(e,t,i,f,d);const p=new o(re.HEAPF32.buffer,d,a).slice();return re._free(d),p}var ct,ge;(function(r){r[r.EDGEBREAKER=1]="EDGEBREAKER",r[r.SEQUENTIAL=0]="SEQUENTIAL"})(ct||(ct={})),function(r){r.POSITION="POSITION",r.NORMAL="NORMAL",r.COLOR="COLOR",r.TEX_COORD="TEX_COORD",r.GENERIC="GENERIC"}(ge||(ge={}));const ur={[ge.POSITION]:14,[ge.NORMAL]:10,[ge.COLOR]:8,[ge.TEX_COORD]:12,[ge.GENERIC]:12},Nn={decodeSpeed:5,encodeSpeed:5,method:ct.EDGEBREAKER,quantizationBits:ur,quantizationVolume:"mesh"};function ki(r,e=Nn){const t=Re({},Nn,e);t.quantizationBits=Re({},ur,e.quantizationBits);const n=new he.Encoder,i=new he.MeshBuilder,o=new he.Mesh,s={},a=new he.DracoInt8Array,f=r.listTargets().length>0;let d=!1;for(const c of r.listSemantics()){const u=r.getAttribute(c);if(u.getSparse()){d=!0;continue}const x=Ui(c),g=Oi(i,u.getComponentType(),o,he[x],u.getCount(),u.getElementSize(),u.getArray());if(g===-1)throw new Error(`Error compressing "${c}" attribute.`);if(s[c]=g,t.quantizationVolume==="mesh"||c!=="POSITION")n.SetAttributeQuantization(he[x],t.quantizationBits[x]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:h}=t,E=Math.max(h.max[0]-h.min[0],h.max[1]-h.min[1],h.max[2]-h.min[2]);n.SetAttributeExplicitQuantization(he[x],t.quantizationBits[x],u.getElementSize(),h.min,E)}}}const p=r.getIndices();if(!p)throw new dt("Primitive must have indices.");i.AddFacesToMesh(o,p.getCount()/3,p.getArray()),n.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),n.SetTrackEncodedProperties(!0),n.SetEncodingMethod(t.method===ct.SEQUENTIAL||f||d?he.MESH_SEQUENTIAL_ENCODING:he.MESH_EDGEBREAKER_ENCODING);const _=n.EncodeMeshToDracoBuffer(o,a);if(_<=0)throw new dt("Error applying Draco compression.");const w=new Uint8Array(_);for(let c=0;c<_;++c)w[c]=a.GetValue(c);const b=r.getAttribute("POSITION").getCount(),l=n.GetNumberOfEncodedPoints(),m=3*n.GetNumberOfEncodedFaces();if((f||d)&&l!==b)throw new dt('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return he.destroy(a),he.destroy(o),he.destroy(i),he.destroy(n),{numVertices:l,numIndices:m,data:w,attributeIDs:s}}function Ui(r){return r==="POSITION"?ge.POSITION:r==="NORMAL"?ge.NORMAL:r.startsWith("COLOR_")?ge.COLOR:r.startsWith("TEXCOORD_")?ge.TEX_COORD:ge.GENERIC}function Oi(r,e,t,n,i,o,s){switch(e){case te.ComponentType.UNSIGNED_BYTE:return r.AddUInt8Attribute(t,n,i,o,s);case te.ComponentType.BYTE:return r.AddInt8Attribute(t,n,i,o,s);case te.ComponentType.UNSIGNED_SHORT:return r.AddUInt16Attribute(t,n,i,o,s);case te.ComponentType.SHORT:return r.AddInt16Attribute(t,n,i,o,s);case te.ComponentType.UNSIGNED_INT:return r.AddUInt32Attribute(t,n,i,o,s);case te.ComponentType.FLOAT:return r.AddFloatAttribute(t,n,i,o,s);default:throw new Error(`Unexpected component type, "${e}".`)}}class dt extends Error{}const Y=tr;class Lt extends Z{constructor(...e){super(...e),this.extensionName=Y,this.prereadTypes=[j.PRIMITIVE],this.prewriteTypes=[j.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,re=this._decoderModule,ar={[te.ComponentType.FLOAT]:Float32Array,[te.ComponentType.UNSIGNED_INT]:Uint32Array,[te.ComponentType.UNSIGNED_SHORT]:Uint16Array,[te.ComponentType.UNSIGNED_BYTE]:Uint8Array,[te.ComponentType.SHORT]:Int16Array,[te.ComponentType.BYTE]:Int8Array},cr={[te.ComponentType.FLOAT]:re.DT_FLOAT32,[te.ComponentType.UNSIGNED_INT]:re.DT_UINT32,[te.ComponentType.UNSIGNED_SHORT]:re.DT_UINT16,[te.ComponentType.UNSIGNED_BYTE]:re.DT_UINT8,[te.ComponentType.SHORT]:re.DT_INT16,[te.ComponentType.BYTE]:re.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,he=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Y}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,i=new Map;try{const o=n.json.meshes||[];for(const s of o)for(const a of s.primitives){if(!a.extensions||!a.extensions[Y])continue;const f=a.extensions[Y];let[d,p]=i.get(f.bufferView)||[];if(!p||!d){const _=n.json.bufferViews[f.bufferView],w=n.json.buffers[_.buffer],b=Te.toView(w.uri?n.resources[w.uri]:n.resources[er],_.byteOffset||0,_.byteLength);d=new this._decoderModule.Decoder,p=Di(d,b),i.set(f.bufferView,[d,p]),t.debug(`[${Y}] Decompressed ${b.byteLength} bytes.`)}for(const _ in a.attributes){const w=e.jsonDoc.json.accessors[a.attributes[_]],b=d.GetAttributeByUniqueId(p,f.attributes[_]),l=Ci(d,p,b,w);e.accessors[a.attributes[_]].setArray(l)}a.indices!==void 0&&e.accessors[a.indices].setArray(Mi(d,p))}}finally{for(const[o,s]of Array.from(i.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(s)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Y}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Y}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=function(a){const f=a.getLogger(),d=new Set,p=new Set;for(const c of a.getRoot().listMeshes())for(const u of c.listPrimitives())u.getIndices()?u.getMode()!==Ut.Mode.TRIANGLES?(p.add(u),f.warn(`[${Y}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(u):(p.add(u),f.warn(`[${Y}] Skipping Draco compression on non-indexed primitive.`));const _=a.getRoot().listAccessors(),w=new Map;for(let c=0;c<_.length;c++)w.set(_[c],c);const b=new Map,l=new Set,m=new Map;for(const c of Array.from(d)){let u=Dn(c,w);if(l.has(u))m.set(c,u);else{if(b.has(c.getIndices())){const x=c.getIndices(),g=x.clone();w.set(g,a.getRoot().listAccessors().length-1),c.swap(x,g)}for(const x of c.listAttributes())if(b.has(x)){const g=x.clone();w.set(g,a.getRoot().listAccessors().length-1),c.swap(x,g)}u=Dn(c,w),l.add(u),m.set(c,u),b.set(c.getIndices(),u);for(const x of c.listAttributes())b.set(x,u)}}for(const c of Array.from(b.keys())){const u=new Set(c.listParents().map(x=>x.propertyType));if(u.size!==2||!u.has(j.PRIMITIVE)||!u.has(j.ROOT))throw new Error(`[${Y}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const c of Array.from(d)){const u=m.get(c),x=c.getIndices();if(b.get(x)!==u||c.listAttributes().some(g=>b.get(g)!==u))throw new Error(`[${Y}] Draco primitives must share all, or no, accessors.`)}for(const c of Array.from(p)){const u=c.getIndices();if(b.has(u)||c.listAttributes().some(x=>b.has(x)))throw new Error(`[${Y}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return m}(this.document),o=new Map;let s="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Y}]: quantizationVolume=scene requires exactly 1 scene.`):s=ei(this.document.getRoot().listScenes().pop()));for(const a of Array.from(i.keys())){const f=i.get(a);if(!f)throw new Error("Unexpected primitive.");if(o.has(f)){o.set(f,o.get(f));continue}const d=a.getIndices(),p=e.jsonDoc.json.accessors;let _;try{_=ki(a,Re({},this._encoderOptions,{quantizationVolume:s}))}catch(l){if(l instanceof dt){n.warn(`[${Y}]: ${l.message} Skipping primitive compression.`);continue}throw l}o.set(f,_);const w=e.createAccessorDef(d);w.count=_.numIndices,e.accessorIndexMap.set(d,p.length),p.push(w);for(const l of a.listSemantics()){const m=a.getAttribute(l);if(_.attributeIDs[l]===void 0)continue;const c=e.createAccessorDef(m);c.count=_.numVertices,e.accessorIndexMap.set(m,p.length),p.push(c)}const b=a.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(b)||e.otherBufferViews.set(b,[]),e.otherBufferViews.get(b).push(_.data)}return n.debug(`[${Y}] Compressed ${i.size} primitives.`),e.extensionData[Y]={primitiveHashMap:i,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[Y];for(const n of this.document.getRoot().listMeshes()){const i=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let o=0;o<n.listPrimitives().length;o++){const s=n.listPrimitives()[o],a=i.primitives[o],f=t.primitiveHashMap.get(s);if(!f)continue;const d=t.primitiveEncodingMap.get(f);d&&(a.extensions=a.extensions||{},a.extensions[Y]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(i=>i!==Y),n.extensionsRequired=(n.extensionsRequired||[]).filter(i=>i!==Y)}return this}}function Dn(r,e){const t=[],n=r.getIndices();t.push(e.get(n));for(const i of r.listAttributes())t.push(e.get(i));return t.sort().join("|")}Lt.EXTENSION_NAME=Y,Lt.EncoderMethod=ct;let wt=class lr extends oe{init(){this.extensionName=Jt,this.propertyType="Light",this.parentTypes=[j.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:lr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Ee.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return Ee.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}};wt.EXTENSION_NAME=Jt,wt.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const we=Jt;let fr=class extends Z{constructor(...e){super(...e),this.extensionName=we}createLight(e=""){return new wt(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[we])return this;const n=(t.json.extensions[we].lights||[]).map(i=>{var o,s;const a=this.createLight().setName(i.name||"").setType(i.type);return i.color!==void 0&&a.setColor(i.color),i.intensity!==void 0&&a.setIntensity(i.intensity),i.range!==void 0&&a.setRange(i.range),((o=i.spot)==null?void 0:o.innerConeAngle)!==void 0&&a.setInnerConeAngle(i.spot.innerConeAngle),((s=i.spot)==null?void 0:s.outerConeAngle)!==void 0&&a.setOuterConeAngle(i.spot.outerConeAngle),a});return t.json.nodes.forEach((i,o)=>{i.extensions&&i.extensions[we]&&e.nodes[o].setExtension(we,n[i.extensions[we].light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],i=new Map;for(const o of this.properties){const s=o,a={type:s.getType()};ut.eq(s.getColor(),[1,1,1])||(a.color=s.getColor()),s.getIntensity()!==1&&(a.intensity=s.getIntensity()),s.getRange()!=null&&(a.range=s.getRange()),s.getName()&&(a.name=s.getName()),s.getType()===wt.Type.SPOT&&(a.spot={innerConeAngle:s.getInnerConeAngle(),outerConeAngle:s.getOuterConeAngle()}),n.push(a),i.set(s,n.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const s=o.getExtension(we);if(s){const a=e.nodeIndexMap.get(o),f=t.json.nodes[a];f.extensions=f.extensions||{},f.extensions[we]={light:i.get(s)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[we]={lights:n},this}};fr.EXTENSION_NAME=we;const{R:Fi,G:Bi,B:Li}=De;class dr extends oe{init(){this.extensionName=en,this.propertyType="Anisotropy",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new pe(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Fi|Bi|Li})}}dr.EXTENSION_NAME=en;const Ce=en;class hr extends Z{constructor(...e){super(...e),this.extensionName=Ce}createAnisotropy(){return new dr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Ce]){const s=this.createAnisotropy();e.materials[o].setExtension(Ce,s);const a=i.extensions[Ce];if(a.anisotropyStrength!==void 0&&s.setAnisotropyStrength(a.anisotropyStrength),a.anisotropyRotation!==void 0&&s.setAnisotropyRotation(a.anisotropyRotation),a.anisotropyTexture!==void 0){const f=a.anisotropyTexture;s.setAnisotropyTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getAnisotropyTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ce);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Ce]={};if(i.getAnisotropyStrength()>0&&(a.anisotropyStrength=i.getAnisotropyStrength()),i.getAnisotropyRotation()!==0&&(a.anisotropyRotation=i.getAnisotropyRotation()),i.getAnisotropyTexture()){const f=i.getAnisotropyTexture(),d=i.getAnisotropyTextureInfo();a.anisotropyTexture=e.createTextureInfoDef(f,d)}}}),this}}hr.EXTENSION_NAME=Ce;const{R:Mn,G:Cn,B:ji}=De;class pr extends oe{init(){this.extensionName=tn,this.propertyType="Clearcoat",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new pe(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new pe(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new pe(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Mn})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Cn})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Mn|Cn|ji})}}pr.EXTENSION_NAME=tn;const ke=tn;class xr extends Z{constructor(...e){super(...e),this.extensionName=ke}createClearcoat(){return new pr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[ke]){const s=this.createClearcoat();e.materials[o].setExtension(ke,s);const a=i.extensions[ke];if(a.clearcoatFactor!==void 0&&s.setClearcoatFactor(a.clearcoatFactor),a.clearcoatRoughnessFactor!==void 0&&s.setClearcoatRoughnessFactor(a.clearcoatRoughnessFactor),a.clearcoatTexture!==void 0){const f=a.clearcoatTexture;s.setClearcoatTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getClearcoatTextureInfo(),f)}if(a.clearcoatRoughnessTexture!==void 0){const f=a.clearcoatRoughnessTexture;s.setClearcoatRoughnessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),f)}if(a.clearcoatNormalTexture!==void 0){const f=a.clearcoatNormalTexture;s.setClearcoatNormalTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getClearcoatNormalTextureInfo(),f),f.scale!==void 0&&s.setClearcoatNormalScale(f.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(ke);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[ke]={clearcoatFactor:i.getClearcoatFactor(),clearcoatRoughnessFactor:i.getClearcoatRoughnessFactor()};if(i.getClearcoatTexture()){const f=i.getClearcoatTexture(),d=i.getClearcoatTextureInfo();a.clearcoatTexture=e.createTextureInfoDef(f,d)}if(i.getClearcoatRoughnessTexture()){const f=i.getClearcoatRoughnessTexture(),d=i.getClearcoatRoughnessTextureInfo();a.clearcoatRoughnessTexture=e.createTextureInfoDef(f,d)}if(i.getClearcoatNormalTexture()){const f=i.getClearcoatNormalTexture(),d=i.getClearcoatNormalTextureInfo();a.clearcoatNormalTexture=e.createTextureInfoDef(f,d),i.getClearcoatNormalScale()!==1&&(a.clearcoatNormalTexture.scale=i.getClearcoatNormalScale())}}}),this}}xr.EXTENSION_NAME=ke;class gr extends oe{init(){this.extensionName=nn,this.propertyType="EmissiveStrength",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}gr.EXTENSION_NAME=nn;const Ue=nn;class _r extends Z{constructor(...e){super(...e),this.extensionName=Ue}createEmissiveStrength(){return new gr(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Ue]){const i=this.createEmissiveStrength();e.materials[n].setExtension(Ue,i);const o=t.extensions[Ue];o.emissiveStrength!==void 0&&i.setEmissiveStrength(o.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ue);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{},s.extensions[Ue]={emissiveStrength:i.getEmissiveStrength()}}}),this}}_r.EXTENSION_NAME=Ue;class mr extends oe{init(){this.extensionName=rn,this.propertyType="IOR",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}mr.EXTENSION_NAME=rn;const Oe=rn;class Tr extends Z{constructor(...e){super(...e),this.extensionName=Oe}createIOR(){return new mr(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Oe]){const i=this.createIOR();e.materials[n].setExtension(Oe,i);const o=t.extensions[Oe];o.ior!==void 0&&i.setIOR(o.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Oe);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{},s.extensions[Oe]={ior:i.getIOR()}}}),this}}Tr.EXTENSION_NAME=Oe;const{R:zi,G:Pi}=De;class yr extends oe{init(){this.extensionName=sn,this.propertyType="Iridescence",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new pe(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new pe(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:zi})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Pi})}}yr.EXTENSION_NAME=sn;const Fe=sn;class wr extends Z{constructor(...e){super(...e),this.extensionName=Fe}createIridescence(){return new yr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Fe]){const s=this.createIridescence();e.materials[o].setExtension(Fe,s);const a=i.extensions[Fe];if(a.iridescenceFactor!==void 0&&s.setIridescenceFactor(a.iridescenceFactor),a.iridescenceIor!==void 0&&s.setIridescenceIOR(a.iridescenceIor),a.iridescenceThicknessMinimum!==void 0&&s.setIridescenceThicknessMinimum(a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&s.setIridescenceThicknessMaximum(a.iridescenceThicknessMaximum),a.iridescenceTexture!==void 0){const f=a.iridescenceTexture;s.setIridescenceTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getIridescenceTextureInfo(),f)}if(a.iridescenceThicknessTexture!==void 0){const f=a.iridescenceThicknessTexture;s.setIridescenceThicknessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getIridescenceThicknessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Fe);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Fe]={};if(i.getIridescenceFactor()>0&&(a.iridescenceFactor=i.getIridescenceFactor()),i.getIridescenceIOR()!==1.3&&(a.iridescenceIor=i.getIridescenceIOR()),i.getIridescenceThicknessMinimum()!==100&&(a.iridescenceThicknessMinimum=i.getIridescenceThicknessMinimum()),i.getIridescenceThicknessMaximum()!==400&&(a.iridescenceThicknessMaximum=i.getIridescenceThicknessMaximum()),i.getIridescenceTexture()){const f=i.getIridescenceTexture(),d=i.getIridescenceTextureInfo();a.iridescenceTexture=e.createTextureInfoDef(f,d)}if(i.getIridescenceThicknessTexture()){const f=i.getIridescenceThicknessTexture(),d=i.getIridescenceThicknessTextureInfo();a.iridescenceThicknessTexture=e.createTextureInfoDef(f,d)}}}),this}}wr.EXTENSION_NAME=Fe;const{R:kn,G:Un,B:On,A:Fn}=De;class br extends oe{init(){this.extensionName=on,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new pe(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new pe(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Ee.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Ee.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:kn|Un|On|Fn,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:kn|Un|On|Fn})}}br.EXTENSION_NAME=on;const Be=on;class Er extends Z{constructor(...e){super(...e),this.extensionName=Be}createPBRSpecularGlossiness(){return new br(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Be]){const s=this.createPBRSpecularGlossiness();e.materials[o].setExtension(Be,s);const a=i.extensions[Be];if(a.diffuseFactor!==void 0&&s.setDiffuseFactor(a.diffuseFactor),a.specularFactor!==void 0&&s.setSpecularFactor(a.specularFactor),a.glossinessFactor!==void 0&&s.setGlossinessFactor(a.glossinessFactor),a.diffuseTexture!==void 0){const f=a.diffuseTexture;s.setDiffuseTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getDiffuseTextureInfo(),f)}if(a.specularGlossinessTexture!==void 0){const f=a.specularGlossinessTexture;s.setSpecularGlossinessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSpecularGlossinessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Be);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Be]={diffuseFactor:i.getDiffuseFactor(),specularFactor:i.getSpecularFactor(),glossinessFactor:i.getGlossinessFactor()};if(i.getDiffuseTexture()){const f=i.getDiffuseTexture(),d=i.getDiffuseTextureInfo();a.diffuseTexture=e.createTextureInfoDef(f,d)}if(i.getSpecularGlossinessTexture()){const f=i.getSpecularGlossinessTexture(),d=i.getSpecularGlossinessTextureInfo();a.specularGlossinessTexture=e.createTextureInfoDef(f,d)}}}),this}}Er.EXTENSION_NAME=Be;const{R:Gi,G:$i,B:Vi,A:Hi}=De;class Ir extends oe{init(){this.extensionName=an,this.propertyType="Sheen",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new pe(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new pe(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Ee.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Ee.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Gi|$i|Vi,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Hi})}}Ir.EXTENSION_NAME=an;const Le=an;class vr extends Z{constructor(...e){super(...e),this.extensionName=Le}createSheen(){return new Ir(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Le]){const s=this.createSheen();e.materials[o].setExtension(Le,s);const a=i.extensions[Le];if(a.sheenColorFactor!==void 0&&s.setSheenColorFactor(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&s.setSheenRoughnessFactor(a.sheenRoughnessFactor),a.sheenColorTexture!==void 0){const f=a.sheenColorTexture;s.setSheenColorTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSheenColorTextureInfo(),f)}if(a.sheenRoughnessTexture!==void 0){const f=a.sheenRoughnessTexture;s.setSheenRoughnessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSheenRoughnessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Le);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Le]={sheenColorFactor:i.getSheenColorFactor(),sheenRoughnessFactor:i.getSheenRoughnessFactor()};if(i.getSheenColorTexture()){const f=i.getSheenColorTexture(),d=i.getSheenColorTextureInfo();a.sheenColorTexture=e.createTextureInfoDef(f,d)}if(i.getSheenRoughnessTexture()){const f=i.getSheenRoughnessTexture(),d=i.getSheenRoughnessTextureInfo();a.sheenRoughnessTexture=e.createTextureInfoDef(f,d)}}}),this}}vr.EXTENSION_NAME=Le;const{R:Xi,G:Wi,B:Ki,A:qi}=De;class Rr extends oe{init(){this.extensionName=cn,this.propertyType="Specular",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new pe(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new pe(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Ee.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Ee.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:qi})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Xi|Wi|Ki,isColor:!0})}}Rr.EXTENSION_NAME=cn;const je=cn;class Sr extends Z{constructor(...e){super(...e),this.extensionName=je}createSpecular(){return new Rr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[je]){const s=this.createSpecular();e.materials[o].setExtension(je,s);const a=i.extensions[je];if(a.specularFactor!==void 0&&s.setSpecularFactor(a.specularFactor),a.specularColorFactor!==void 0&&s.setSpecularColorFactor(a.specularColorFactor),a.specularTexture!==void 0){const f=a.specularTexture;s.setSpecularTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSpecularTextureInfo(),f)}if(a.specularColorTexture!==void 0){const f=a.specularColorTexture;s.setSpecularColorTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSpecularColorTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(je);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[je]={};if(i.getSpecularFactor()!==1&&(a.specularFactor=i.getSpecularFactor()),ut.eq(i.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const f=i.getSpecularTexture(),d=i.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(f,d)}if(i.getSpecularColorTexture()){const f=i.getSpecularColorTexture(),d=i.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(f,d)}}}),this}}Sr.EXTENSION_NAME=je;const{R:Zi}=De;class Ar extends oe{init(){this.extensionName=un,this.propertyType="Transmission",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new pe(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Zi})}}Ar.EXTENSION_NAME=un;const ze=un;class Nr extends Z{constructor(...e){super(...e),this.extensionName=ze}createTransmission(){return new Ar(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[ze]){const s=this.createTransmission();e.materials[o].setExtension(ze,s);const a=i.extensions[ze];if(a.transmissionFactor!==void 0&&s.setTransmissionFactor(a.transmissionFactor),a.transmissionTexture!==void 0){const f=a.transmissionTexture;s.setTransmissionTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getTransmissionTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(ze);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[ze]={transmissionFactor:i.getTransmissionFactor()};if(i.getTransmissionTexture()){const f=i.getTransmissionTexture(),d=i.getTransmissionTextureInfo();a.transmissionTexture=e.createTextureInfoDef(f,d)}}}),this}}Nr.EXTENSION_NAME=ze;class Dr extends oe{init(){this.extensionName=ln,this.propertyType="Unlit",this.parentTypes=[j.MATERIAL]}}Dr.EXTENSION_NAME=ln;const We=ln;class Mr extends Z{constructor(...e){super(...e),this.extensionName=We}createUnlit(){return new Dr(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions[We]&&e.materials[n].setExtension(We,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(We)){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[We]={}}}),this}}Mr.EXTENSION_NAME=We;class Cr extends oe{init(){this.extensionName=$e,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Cr.EXTENSION_NAME=$e;class kr extends oe{init(){this.extensionName=$e,this.propertyType="MappingList",this.parentTypes=[j.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}kr.EXTENSION_NAME=$e;class jt extends oe{init(){this.extensionName=$e,this.propertyType="Variant",this.parentTypes=["MappingList"]}}jt.EXTENSION_NAME=$e;const be=$e;class Ur extends Z{constructor(...e){super(...e),this.extensionName=be}createMappingList(){return new kr(this.document.getGraph())}createVariant(e=""){return new jt(this.document.getGraph(),e)}createMapping(){return new Cr(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof jt)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[be])return this;const n=(t.json.extensions[be].variants||[]).map(i=>this.createVariant().setName(i.name||""));return(t.json.meshes||[]).forEach((i,o)=>{const s=e.meshes[o];(i.primitives||[]).forEach((a,f)=>{if(!a.extensions||!a.extensions[be])return;const d=this.createMappingList(),p=a.extensions[be];for(const _ of p.mappings){const w=this.createMapping();_.material!==void 0&&w.setMaterial(e.materials[_.material]);for(const b of _.variants||[])w.addVariant(n[b]);d.addMapping(w)}s.listPrimitives()[f].setExtension(be,d)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const i=[],o=new Map;for(const s of n)o.set(s,i.length),i.push(e.createPropertyDef(s));for(const s of this.document.getRoot().listMeshes()){const a=e.meshIndexMap.get(s);s.listPrimitives().forEach((f,d)=>{const p=f.getExtension(be);if(!p)return;const _=e.jsonDoc.json.meshes[a].primitives[d],w=p.listMappings().map(b=>{const l=e.createPropertyDef(b),m=b.getMaterial();return m&&(l.material=e.materialIndexMap.get(m)),l.variants=b.listVariants().map(c=>o.get(c)),l});_.extensions=_.extensions||{},_.extensions[be]={mappings:w}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[be]={variants:i},this}}Ur.EXTENSION_NAME=be;const{G:Yi}=De;class Or extends oe{init(){this.extensionName=fn,this.propertyType="Volume",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new pe(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Yi})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Ee.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",Ee.hexToFactor(e,t))}}Or.EXTENSION_NAME=fn;const Pe=fn;class Fr extends Z{constructor(...e){super(...e),this.extensionName=Pe}createVolume(){return new Or(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Pe]){const s=this.createVolume();e.materials[o].setExtension(Pe,s);const a=i.extensions[Pe];if(a.thicknessFactor!==void 0&&s.setThicknessFactor(a.thicknessFactor),a.attenuationDistance!==void 0&&s.setAttenuationDistance(a.attenuationDistance),a.attenuationColor!==void 0&&s.setAttenuationColor(a.attenuationColor),a.thicknessTexture!==void 0){const f=a.thicknessTexture;s.setThicknessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getThicknessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Pe);if(i){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Pe]={};if(i.getThicknessFactor()>0&&(a.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(a.attenuationDistance=i.getAttenuationDistance()),ut.eq(i.getAttenuationColor(),[1,1,1])||(a.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const f=i.getThicknessTexture(),d=i.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(f,d)}}}),this}}Fr.EXTENSION_NAME=Pe;const Br="KHR_mesh_quantization";class Lr extends Z{constructor(...e){super(...e),this.extensionName=Br}read(e){return this}write(e){return this}}Lr.EXTENSION_NAME=Br;const st="KHR_texture_basisu";class Qi{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=At(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=At(e).dataFormatDescriptor[0];if(t.colorModel===xi)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===gi)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=At(e),n=this.getChannels(e)>3;let i=0;for(let o=0;o<t.levels.length;o++){const s=t.levels[o];i+=s.uncompressedByteLength?s.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o)))/4)*(n?16:8)}return i}}class jr extends Z{constructor(...e){super(...e),this.extensionName=st,this.prereadTypes=[j.TEXTURE]}static register(){Yt.registerFormat("image/ktx2",new Qi)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions[st]&&(t.source=t.extensions[st].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const i=e.imageIndexMap.get(n);t.json.textures.forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[st]={source:o.source},delete o.source)})}}),this}}jr.EXTENSION_NAME=st;class zr extends oe{init(){this.extensionName=dn,this.propertyType="Transform",this.parentTypes=[j.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}zr.EXTENSION_NAME=dn;const Ge=dn;class Pr extends Z{constructor(...e){super(...e),this.extensionName=Ge}createTransform(){return new zr(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Ge])continue;const i=this.createTransform(),o=n.extensions[Ge];o.offset!==void 0&&i.setOffset(o.offset),o.rotation!==void 0&&i.setRotation(o.rotation),o.scale!==void 0&&i.setScale(o.scale),o.texCoord!==void 0&&i.setTexCoord(o.texCoord),t.setExtension(Ge,i)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,i]of t){const o=n.getExtension(Ge);if(!o)continue;i.extensions=i.extensions||{};const s={},a=ut.eq;a(o.getOffset(),[0,0])||(s.offset=o.getOffset()),o.getRotation()!==0&&(s.rotation=o.getRotation()),a(o.getScale(),[1,1])||(s.scale=o.getScale()),o.getTexCoord()!=null&&(s.texCoord=o.getTexCoord()),i.extensions[Ge]=s}return this}}Pr.EXTENSION_NAME=Ge;const Ji=[j.ROOT,j.SCENE,j.NODE,j.MESH,j.MATERIAL,j.TEXTURE,j.ANIMATION];class Gr extends oe{init(){this.extensionName=yt,this.propertyType="Packet",this.parentTypes=Ji}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",Re({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=Re({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return Re({"@context":Dt(this.get("context"))},Dt(this.get("properties")))}fromJSONLD(e){const t=(e=Dt(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${yt}: Missing context for term, "${e}".`)}}function Dt(r){return JSON.parse(JSON.stringify(r))}Gr.EXTENSION_NAME=yt;const Ie=yt;class $r extends Z{constructor(...e){super(...e),this.extensionName=Ie}createPacket(){return new Gr(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[Ie];if(!n||!n.packets)return this;const i=e.jsonDoc.json,o=this.document.getRoot(),s=n.packets.map(d=>this.createPacket().fromJSONLD(d)),a=[[i.asset],i.scenes,i.nodes,i.meshes,i.materials,i.images,i.animations],f=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let d=0;d<a.length;d++){const p=a[d]||[];for(let _=0;_<p.length;_++){const w=p[_];w.extensions&&w.extensions[Ie]&&f[d][_].setExtension(Ie,s[w.extensions[Ie].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const i of this.properties){n.push(i.toJSONLD());for(const o of i.listParents()){let s;switch(o.propertyType){case j.ROOT:s=t.asset;break;case j.SCENE:s=t.scenes[e.sceneIndexMap.get(o)];break;case j.NODE:s=t.nodes[e.nodeIndexMap.get(o)];break;case j.MESH:s=t.meshes[e.meshIndexMap.get(o)];break;case j.MATERIAL:s=t.materials[e.materialIndexMap.get(o)];break;case j.TEXTURE:s=t.images[e.imageIndexMap.get(o)];break;case j.ANIMATION:s=t.animations[e.animationIndexMap.get(o)];break;default:s=null,this.document.getLogger().warn(`[${Ie}]: Unsupported parent property, "${o.propertyType}"`)}s&&(s.extensions=s.extensions||{},s.extensions[Ie]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[Ie]={packets:n}),this}}$r.EXTENSION_NAME=Ie;const Vr=[Lt,fr,hr,xr,_r,Tr,wr,Er,Sr,vr,Nr,Mr,Ur,Fr,Lr,jr,Pr,$r];[...Vr];var Bn=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29];function q(){var r=this;function e(t,n){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--n>0);return i>>>1}r.build_tree=function(t){var n,i,o,s=r.dyn_tree,a=r.stat_desc.static_tree,f=r.stat_desc.elems,d=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<f;n++)s[2*n]!==0?(t.heap[++t.heap_len]=d=n,t.depth[n]=0):s[2*n+1]=0;for(;t.heap_len<2;)s[2*(o=t.heap[++t.heap_len]=d<2?++d:0)]=1,t.depth[o]=0,t.opt_len--,a&&(t.static_len-=a[2*o+1]);for(r.max_code=d,n=Math.floor(t.heap_len/2);n>=1;n--)t.pqdownheap(s,n);o=f;do n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],t.pqdownheap(s,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,s[2*o]=s[2*n]+s[2*i],t.depth[o]=Math.max(t.depth[n],t.depth[i])+1,s[2*n+1]=s[2*i+1]=o,t.heap[1]=o++,t.pqdownheap(s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(p){var _,w,b,l,m,c,u=r.dyn_tree,x=r.stat_desc.static_tree,g=r.stat_desc.extra_bits,h=r.stat_desc.extra_base,E=r.stat_desc.max_length,y=0;for(l=0;l<=15;l++)p.bl_count[l]=0;for(u[2*p.heap[p.heap_max]+1]=0,_=p.heap_max+1;_<573;_++)(l=u[2*u[2*(w=p.heap[_])+1]+1]+1)>E&&(l=E,y++),u[2*w+1]=l,w>r.max_code||(p.bl_count[l]++,m=0,w>=h&&(m=g[w-h]),p.opt_len+=(c=u[2*w])*(l+m),x&&(p.static_len+=c*(x[2*w+1]+m)));if(y!==0){do{for(l=E-1;p.bl_count[l]===0;)l--;p.bl_count[l]--,p.bl_count[l+1]+=2,p.bl_count[E]--,y-=2}while(y>0);for(l=E;l!==0;l--)for(w=p.bl_count[l];w!==0;)(b=p.heap[--_])>r.max_code||(u[2*b+1]!=l&&(p.opt_len+=(l-u[2*b+1])*u[2*b],u[2*b+1]=l),w--)}}(t),function(p,_,w){var b,l,m,c=[],u=0;for(b=1;b<=15;b++)c[b]=u=u+w[b-1]<<1;for(l=0;l<=_;l++)(m=p[2*l+1])!==0&&(p[2*l]=e(c[m]++,m))}(s,r.max_code,t.bl_count)}}function ae(r,e,t,n,i){var o=this;o.static_tree=r,o.extra_bits=e,o.extra_base=t,o.elems=n,o.max_length=i}function ye(r,e,t,n,i){var o=this;o.good_length=r,o.max_lazy=e,o.nice_length=t,o.max_chain=n,o.func=i}q._length_code=[0,1,2,3,4,5,6,7,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28],q.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],q.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],q.d_code=function(r){return r<256?Bn[r]:Bn[256+(r>>>7)]},q.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],q.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ae.static_ltree=[12,8,140,8,76,8,204,8,44,8,172,8,108,8,236,8,28,8,156,8,92,8,220,8,60,8,188,8,124,8,252,8,2,8,130,8,66,8,194,8,34,8,162,8,98,8,226,8,18,8,146,8,82,8,210,8,50,8,178,8,114,8,242,8,10,8,138,8,74,8,202,8,42,8,170,8,106,8,234,8,26,8,154,8,90,8,218,8,58,8,186,8,122,8,250,8,6,8,134,8,70,8,198,8,38,8,166,8,102,8,230,8,22,8,150,8,86,8,214,8,54,8,182,8,118,8,246,8,14,8,142,8,78,8,206,8,46,8,174,8,110,8,238,8,30,8,158,8,94,8,222,8,62,8,190,8,126,8,254,8,1,8,129,8,65,8,193,8,33,8,161,8,97,8,225,8,17,8,145,8,81,8,209,8,49,8,177,8,113,8,241,8,9,8,137,8,73,8,201,8,41,8,169,8,105,8,233,8,25,8,153,8,89,8,217,8,57,8,185,8,121,8,249,8,5,8,133,8,69,8,197,8,37,8,165,8,101,8,229,8,21,8,149,8,85,8,213,8,53,8,181,8,117,8,245,8,13,8,141,8,77,8,205,8,45,8,173,8,109,8,237,8,29,8,157,8,93,8,221,8,61,8,189,8,125,8,253,8,19,9,275,9,147,9,403,9,83,9,339,9,211,9,467,9,51,9,307,9,179,9,435,9,115,9,371,9,243,9,499,9,11,9,267,9,139,9,395,9,75,9,331,9,203,9,459,9,43,9,299,9,171,9,427,9,107,9,363,9,235,9,491,9,27,9,283,9,155,9,411,9,91,9,347,9,219,9,475,9,59,9,315,9,187,9,443,9,123,9,379,9,251,9,507,9,7,9,263,9,135,9,391,9,71,9,327,9,199,9,455,9,39,9,295,9,167,9,423,9,103,9,359,9,231,9,487,9,23,9,279,9,151,9,407,9,87,9,343,9,215,9,471,9,55,9,311,9,183,9,439,9,119,9,375,9,247,9,503,9,15,9,271,9,143,9,399,9,79,9,335,9,207,9,463,9,47,9,303,9,175,9,431,9,111,9,367,9,239,9,495,9,31,9,287,9,159,9,415,9,95,9,351,9,223,9,479,9,63,9,319,9,191,9,447,9,127,9,383,9,255,9,511,9,0,7,64,7,32,7,96,7,16,7,80,7,48,7,112,7,8,7,72,7,40,7,104,7,24,7,88,7,56,7,120,7,4,7,68,7,36,7,100,7,20,7,84,7,52,7,116,7,3,8,131,8,67,8,195,8,35,8,163,8,99,8,227,8],ae.static_dtree=[0,5,16,5,8,5,24,5,4,5,20,5,12,5,28,5,2,5,18,5,10,5,26,5,6,5,22,5,14,5,30,5,1,5,17,5,9,5,25,5,5,5,21,5,13,5,29,5,3,5,19,5,11,5,27,5,7,5,23,5],ae.static_l_desc=new ae(ae.static_ltree,q.extra_lbits,257,286,15),ae.static_d_desc=new ae(ae.static_dtree,q.extra_dbits,0,30,15),ae.static_bl_desc=new ae(null,q.extra_blbits,0,19,7);var me=[new ye(0,0,0,0,0),new ye(4,4,8,4,1),new ye(4,5,16,8,1),new ye(4,6,32,32,1),new ye(4,4,16,16,2),new ye(8,16,32,32,2),new ye(8,16,128,128,2),new ye(8,32,128,256,2),new ye(32,128,258,1024,2),new ye(32,258,258,4096,2)],lt=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function Ln(r,e,t,n){var i=r[2*e],o=r[2*t];return i<o||i==o&&n[e]<=n[t]}function es(){var r,e,t,n,i,o,s,a,f,d,p,_,w,b,l,m,c,u,x,g,h,E,y,T,S,O,R,v,I,k,B,z,U,W,de,ne,F,ie,$,V,ce,P=this,Ye=new q,Qe=new q,Rt=new q;function xn(){var D;for(D=0;D<286;D++)B[2*D]=0;for(D=0;D<30;D++)z[2*D]=0;for(D=0;D<19;D++)U[2*D]=0;B[512]=1,P.opt_len=P.static_len=0,ne=ie=0}function gn(D,A){var C,M,N=-1,L=D[1],G=0,H=7,X=4;for(L===0&&(H=138,X=3),D[2*(A+1)+1]=65535,C=0;C<=A;C++)M=L,L=D[2*(C+1)+1],++G<H&&M==L||(G<X?U[2*M]+=G:M!==0?(M!=N&&U[2*M]++,U[32]++):G<=10?U[34]++:U[36]++,G=0,N=M,L===0?(H=138,X=3):M==L?(H=6,X=3):(H=7,X=4))}function Ve(D){P.pending_buf[P.pending++]=D}function Je(D){Ve(255&D),Ve(D>>>8&255)}function ue(D,A){var C,M=A;ce>16-M?(Je(V|=(C=D)<<ce&65535),V=C>>>16-ce,ce+=M-16):(V|=D<<ce&65535,ce+=M)}function _e(D,A){var C=2*D;ue(65535&A[C],65535&A[C+1])}function _n(D,A){var C,M,N=-1,L=D[1],G=0,H=7,X=4;for(L===0&&(H=138,X=3),C=0;C<=A;C++)if(M=L,L=D[2*(C+1)+1],!(++G<H&&M==L)){if(G<X)do _e(M,U);while(--G!=0);else M!==0?(M!=N&&(_e(M,U),G--),_e(16,U),ue(G-3,2)):G<=10?(_e(17,U),ue(G-3,3)):(_e(18,U),ue(G-11,7));G=0,N=M,L===0?(H=138,X=3):M==L?(H=6,X=3):(H=7,X=4)}}function mn(){ce==16?(Je(V),V=0,ce=0):ce>=8&&(Ve(255&V),V>>>=8,ce-=8)}function et(D,A){var C,M,N;if(P.pending_buf[F+2*ne]=D>>>8&255,P.pending_buf[F+2*ne+1]=255&D,P.pending_buf[W+ne]=255&A,ne++,D===0?B[2*A]++:(ie++,D--,B[2*(q._length_code[A]+256+1)]++,z[2*q.d_code(D)]++),(8191&ne)==0&&R>2){for(C=8*ne,M=h-c,N=0;N<30;N++)C+=z[2*N]*(5+q.extra_dbits[N]);if(C>>>=3,ie<Math.floor(ne/2)&&C<Math.floor(M/2))return!0}return ne==de-1}function Tn(D,A){var C,M,N,L,G=0;if(ne!==0)do C=P.pending_buf[F+2*G]<<8&65280|255&P.pending_buf[F+2*G+1],M=255&P.pending_buf[W+G],G++,C===0?_e(M,D):(_e((N=q._length_code[M])+256+1,D),(L=q.extra_lbits[N])!==0&&ue(M-=q.base_length[N],L),C--,_e(N=q.d_code(C),A),(L=q.extra_dbits[N])!==0&&ue(C-=q.base_dist[N],L));while(G<ne);_e(256,D),$=D[513]}function yn(){ce>8?Je(V):ce>0&&Ve(255&V),V=0,ce=0}function wn(D,A,C){ue(0+(C?1:0),3),function(M,N,L){yn(),$=8,Je(N),Je(~N),P.pending_buf.set(a.subarray(M,M+N),P.pending),P.pending+=N}(D,A)}function Se(D){(function(A,C,M){var N,L,G=0;R>0?(Ye.build_tree(P),Qe.build_tree(P),G=function(){var H;for(gn(B,Ye.max_code),gn(z,Qe.max_code),Rt.build_tree(P),H=18;H>=3&&U[2*q.bl_order[H]+1]===0;H--);return P.opt_len+=3*(H+1)+5+5+4,H}(),(L=P.static_len+3+7>>>3)<=(N=P.opt_len+3+7>>>3)&&(N=L)):N=L=C+5,C+4<=N&&A!=-1?wn(A,C,M):L==N?(ue(2+(M?1:0),3),Tn(ae.static_ltree,ae.static_dtree)):(ue(4+(M?1:0),3),function(H,X,J){var ee;for(ue(H-257,5),ue(X-1,5),ue(J-4,4),ee=0;ee<J;ee++)ue(U[2*q.bl_order[ee]+1],3);_n(B,H-1),_n(z,X-1)}(Ye.max_code+1,Qe.max_code+1,G+1),Tn(B,z)),xn(),M&&yn()})(c>=0?c:-1,h-c,D),c=h,r.flush_pending()}function St(){var D,A,C,M;do{if((M=f-y-h)==0&&h===0&&y===0)M=i;else if(M==-1)M--;else if(h>=i+i-262){a.set(a.subarray(i,i+i),0),E-=i,h-=i,c-=i,C=D=w;do A=65535&p[--C],p[C]=A>=i?A-i:0;while(--D!=0);C=D=i;do A=65535&d[--C],d[C]=A>=i?A-i:0;while(--D!=0);M+=i}if(r.avail_in===0)return;D=r.read_buf(a,h+y,M),(y+=D)>=3&&(_=((_=255&a[h])<<m^255&a[h+1])&l)}while(y<262&&r.avail_in!==0)}function bn(D){var A,C,M=S,N=h,L=T,G=h>i-262?h-(i-262):0,H=k,X=s,J=h+258,ee=a[N+L-1],Ae=a[N+L];T>=I&&(M>>=2),H>y&&(H=y);do if(a[(A=D)+L]==Ae&&a[A+L-1]==ee&&a[A]==a[N]&&a[++A]==a[N+1]){N+=2,A++;do;while(a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&N<J);if(C=258-(J-N),N=J-258,C>L){if(E=D,L=C,C>=H)break;ee=a[N+L-1],Ae=a[N+L]}}while((D=65535&d[D&X])>G&&--M!=0);return L<=y?L:y}P.depth=[],P.bl_count=[],P.heap=[],B=[],z=[],U=[],P.pqdownheap=function(D,A){for(var C=P.heap,M=C[A],N=A<<1;N<=P.heap_len&&(N<P.heap_len&&Ln(D,C[N+1],C[N],P.depth)&&N++,!Ln(D,M,C[N],P.depth));)C[A]=C[N],A=N,N<<=1;C[A]=M},P.deflateInit=function(D,A,C,M,N,L){return M||(M=8),N||(N=8),L||(L=0),D.msg=null,A==-1&&(A=6),N<1||N>9||M!=8||C<9||C>15||A<0||A>9||L<0||L>2?-2:(D.dstate=P,s=(i=1<<(o=C))-1,l=(w=1<<(b=N+7))-1,m=Math.floor((b+3-1)/3),a=new Uint8Array(2*i),d=[],p=[],de=1<<N+6,P.pending_buf=new Uint8Array(4*de),t=4*de,F=Math.floor(de/2),W=3*de,R=A,v=L,function(G){return G.total_in=G.total_out=0,G.msg=null,P.pending=0,P.pending_out=0,e=113,n=0,Ye.dyn_tree=B,Ye.stat_desc=ae.static_l_desc,Qe.dyn_tree=z,Qe.stat_desc=ae.static_d_desc,Rt.dyn_tree=U,Rt.stat_desc=ae.static_bl_desc,V=0,ce=0,$=8,xn(),function(){var H;for(f=2*i,p[w-1]=0,H=0;H<w-1;H++)p[H]=0;O=me[R].max_lazy,I=me[R].good_length,k=me[R].nice_length,S=me[R].max_chain,h=0,c=0,y=0,u=T=2,g=0,_=0}(),0}(D))},P.deflateEnd=function(){return e!=42&&e!=113&&e!=666?-2:(P.pending_buf=null,p=null,d=null,a=null,P.dstate=null,e==113?-3:0)},P.deflateParams=function(D,A,C){var M=0;return A==-1&&(A=6),A<0||A>9||C<0||C>2?-2:(me[R].func!=me[A].func&&D.total_in!==0&&(M=D.deflate(1)),R!=A&&(O=me[R=A].max_lazy,I=me[R].good_length,k=me[R].nice_length,S=me[R].max_chain),v=C,M)},P.deflateSetDictionary=function(D,A,C){var M,N=C,L=0;if(!A||e!=42)return-2;if(N<3)return 0;for(N>i-262&&(L=C-(N=i-262)),a.set(A.subarray(L,L+N),0),h=N,c=N,_=((_=255&a[0])<<m^255&a[1])&l,M=0;M<=N-3;M++)d[M&s]=p[_=(_<<m^255&a[M+2])&l],p[_]=M;return 0},P.deflate=function(D,A){var C,M,N,L,G,H;if(A>4||A<0)return-2;if(!D.next_out||!D.next_in&&D.avail_in!==0||e==666&&A!=4)return D.msg=lt[4],-2;if(D.avail_out===0)return D.msg=lt[7],-5;if(r=D,L=n,n=A,e==42&&(M=8+(o-8<<4)<<8,(N=(R-1&255)>>1)>3&&(N=3),M|=N<<6,h!==0&&(M|=32),e=113,Ve((H=M+=31-M%31)>>8&255),Ve(255&H)),P.pending!==0){if(r.flush_pending(),r.avail_out===0)return n=-1,0}else if(r.avail_in===0&&A<=L&&A!=4)return r.msg=lt[7],-5;if(e==666&&r.avail_in!==0)return D.msg=lt[7],-5;if(r.avail_in!==0||y!==0||A!=0&&e!=666){switch(G=-1,me[R].func){case 0:G=function(X){var J,ee=65535;for(ee>t-5&&(ee=t-5);;){if(y<=1){if(St(),y===0&&X==0)return 0;if(y===0)break}if(h+=y,y=0,J=c+ee,(h===0||h>=J)&&(y=h-J,h=J,Se(!1),r.avail_out===0)||h-c>=i-262&&(Se(!1),r.avail_out===0))return 0}return Se(X==4),r.avail_out===0?X==4?2:0:X==4?3:1}(A);break;case 1:G=function(X){for(var J,ee=0;;){if(y<262){if(St(),y<262&&X==0)return 0;if(y===0)break}if(y>=3&&(ee=65535&p[_=(_<<m^255&a[h+2])&l],d[h&s]=p[_],p[_]=h),ee!==0&&(h-ee&65535)<=i-262&&v!=2&&(u=bn(ee)),u>=3)if(J=et(h-E,u-3),y-=u,u<=O&&y>=3){u--;do h++,ee=65535&p[_=(_<<m^255&a[h+2])&l],d[h&s]=p[_],p[_]=h;while(--u!=0);h++}else h+=u,u=0,_=((_=255&a[h])<<m^255&a[h+1])&l;else J=et(0,255&a[h]),y--,h++;if(J&&(Se(!1),r.avail_out===0))return 0}return Se(X==4),r.avail_out===0?X==4?2:0:X==4?3:1}(A);break;case 2:G=function(X){for(var J,ee,Ae=0;;){if(y<262){if(St(),y<262&&X==0)return 0;if(y===0)break}if(y>=3&&(Ae=65535&p[_=(_<<m^255&a[h+2])&l],d[h&s]=p[_],p[_]=h),T=u,x=E,u=2,Ae!==0&&T<O&&(h-Ae&65535)<=i-262&&(v!=2&&(u=bn(Ae)),u<=5&&(v==1||u==3&&h-E>4096)&&(u=2)),T>=3&&u<=T){ee=h+y-3,J=et(h-1-x,T-3),y-=T-1,T-=2;do++h<=ee&&(Ae=65535&p[_=(_<<m^255&a[h+2])&l],d[h&s]=p[_],p[_]=h);while(--T!=0);if(g=0,u=2,h++,J&&(Se(!1),r.avail_out===0))return 0}else if(g!==0){if((J=et(0,255&a[h-1]))&&Se(!1),h++,y--,r.avail_out===0)return 0}else g=1,h++,y--}return g!==0&&(J=et(0,255&a[h-1]),g=0),Se(X==4),r.avail_out===0?X==4?2:0:X==4?3:1}(A)}if(G!=2&&G!=3||(e=666),G==0||G==2)return r.avail_out===0&&(n=-1),0;if(G==1){if(A==1)ue(2,3),_e(256,ae.static_ltree),mn(),1+$+10-ce<9&&(ue(2,3),_e(256,ae.static_ltree),mn()),$=7;else if(wn(0,0,!1),A==3)for(C=0;C<w;C++)p[C]=0;if(r.flush_pending(),r.avail_out===0)return n=-1,0}}return A!=4?0:1}}function Hr(){var r=this;r.next_in_index=0,r.next_out_index=0,r.avail_in=0,r.total_in=0,r.avail_out=0,r.total_out=0}function Xr(r){var e=new Hr,t=512,n=new Uint8Array(t),i=r?r.level:-1;i===void 0&&(i=-1),e.deflateInit(i),e.next_out=n,this.append=function(o,s){var a,f=[],d=0,p=0,_=0;if(o.length){e.next_in_index=0,e.next_in=o,e.avail_in=o.length;do{if(e.next_out_index=0,e.avail_out=t,e.deflate(0)!=0)throw new Error("deflating: "+e.msg);e.next_out_index&&f.push(e.next_out_index==t?new Uint8Array(n):new Uint8Array(n.subarray(0,e.next_out_index))),_+=e.next_out_index,s&&e.next_in_index>0&&e.next_in_index!=d&&(s(e.next_in_index),d=e.next_in_index)}while(e.avail_in>0||e.avail_out===0);return a=new Uint8Array(_),f.forEach(function(w){a.set(w,p),p+=w.length}),a}},this.flush=function(){var o,s,a=[],f=0,d=0;do{if(e.next_out_index=0,e.avail_out=t,(o=e.deflate(4))!=1&&o!=0)throw new Error("deflating: "+e.msg);t-e.avail_out>0&&a.push(new Uint8Array(n.subarray(0,e.next_out_index))),d+=e.next_out_index}while(e.avail_in>0||e.avail_out===0);return e.deflateEnd(),s=new Uint8Array(d),a.forEach(function(p){s.set(p,f),f+=p.length}),s}}Hr.prototype={deflateInit:function(r,e){var t=this;return t.dstate=new es,e||(e=15),t.dstate.deflateInit(t,r,e)},deflate:function(r){var e=this;return e.dstate?e.dstate.deflate(e,r):-2},deflateEnd:function(){var r=this;if(!r.dstate)return-2;var e=r.dstate.deflateEnd();return r.dstate=null,e},deflateParams:function(r,e){var t=this;return t.dstate?t.dstate.deflateParams(t,r,e):-2},deflateSetDictionary:function(r,e){var t=this;return t.dstate?t.dstate.deflateSetDictionary(t,r,e):-2},read_buf:function(r,e,t){var n=this,i=n.avail_in;return i>t&&(i=t),i===0?0:(n.avail_in-=i,r.set(n.next_in.subarray(n.next_in_index,n.next_in_index+i),e),n.next_in_index+=i,n.total_in+=i,i)},flush_pending:function(){var r=this,e=r.dstate.pending;e>r.avail_out&&(e=r.avail_out),e!==0&&(r.next_out.set(r.dstate.pending_buf.subarray(r.dstate.pending_out,r.dstate.pending_out+e),r.next_out_index),r.next_out_index+=e,r.dstate.pending_out+=e,r.total_out+=e,r.avail_out-=e,r.dstate.pending-=e,r.dstate.pending===0&&(r.dstate.pending_out=0))}},self._zipjs_Deflater=Xr;var xe=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],ts=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],ns=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],rs=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],is=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],ss=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],os=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function zt(){var r,e,t,n,i,o;function s(f,d,p,_,w,b,l,m,c,u,x){var g,h,E,y,T,S,O,R,v,I,k,B,z,U,W;I=0,T=p;do t[f[d+I]]++,I++,T--;while(T!==0);if(t[0]==p)return l[0]=-1,m[0]=0,0;for(R=m[0],S=1;S<=15&&t[S]===0;S++);for(O=S,R<S&&(R=S),T=15;T!==0&&t[T]===0;T--);for(E=T,R>T&&(R=T),m[0]=R,U=1<<S;S<T;S++,U<<=1)if((U-=t[S])<0)return-3;if((U-=t[T])<0)return-3;for(t[T]+=U,o[1]=S=0,I=1,z=2;--T!=0;)o[z]=S+=t[I],z++,I++;T=0,I=0;do(S=f[d+I])!==0&&(x[o[S]++]=T),I++;while(++T<p);for(p=o[E],o[0]=T=0,I=0,y=-1,B=-R,i[0]=0,k=0,W=0;O<=E;O++)for(g=t[O];g--!=0;){for(;O>B+R;){if(y++,W=(W=E-(B+=R))>R?R:W,(h=1<<(S=O-B))>g+1&&(h-=g+1,z=O,S<W))for(;++S<W&&!((h<<=1)<=t[++z]);)h-=t[z];if(u[0]+(W=1<<S)>1440)return-3;i[y]=k=u[0],u[0]+=W,y!==0?(o[y]=T,n[0]=S,n[1]=R,n[2]=k-i[y-1]-(S=T>>>B-R),c.set(n,3*(i[y-1]+S))):l[0]=k}for(n[1]=O-B,I>=p?n[0]=192:x[I]<_?(n[0]=x[I]<256?0:96,n[2]=x[I++]):(n[0]=b[x[I]-_]+16+64,n[2]=w[x[I++]-_]),h=1<<O-B,S=T>>>B;S<W;S+=h)c.set(n,3*(k+S));for(S=1<<O-1;T&S;S>>>=1)T^=S;for(T^=S,v=(1<<B)-1;(T&v)!=o[y];)y--,v=(1<<(B-=R))-1}return U!==0&&E!=1?-5:0}function a(f){var d;for(r||(r=[],e=[],t=new Int32Array(16),n=[],i=new Int32Array(15),o=new Int32Array(16)),e.length<f&&(e=[]),d=0;d<f;d++)e[d]=0;for(d=0;d<16;d++)t[d]=0;for(d=0;d<3;d++)n[d]=0;i.set(t.subarray(0,15),0),o.set(t.subarray(0,16),0)}this.inflate_trees_bits=function(f,d,p,_,w){var b;return a(19),r[0]=0,(b=s(f,0,19,19,null,null,p,d,_,r,e))==-3?w.msg="oversubscribed dynamic bit lengths tree":b!=-5&&d[0]!==0||(w.msg="incomplete dynamic bit lengths tree",b=-3),b},this.inflate_trees_dynamic=function(f,d,p,_,w,b,l,m,c){var u;return a(288),r[0]=0,(u=s(p,0,f,257,rs,is,b,_,m,r,e))!=0||_[0]===0?(u==-3?c.msg="oversubscribed literal/length tree":u!=-4&&(c.msg="incomplete literal/length tree",u=-3),u):(a(288),(u=s(p,f,d,0,ss,os,l,w,m,r,e))!=0||w[0]===0&&f>257?(u==-3?c.msg="oversubscribed distance tree":u==-5?(c.msg="incomplete distance tree",u=-3):u!=-4&&(c.msg="empty distance tree with lengths",u=-3),u):0)}}function as(){var r,e,t,n,i=this,o=0,s=0,a=0,f=0,d=0,p=0,_=0,w=0,b=0,l=0;function m(c,u,x,g,h,E,y,T){var S,O,R,v,I,k,B,z,U,W,de,ne,F,ie,$,V;B=T.next_in_index,z=T.avail_in,I=y.bitb,k=y.bitk,W=(U=y.write)<y.read?y.read-U-1:y.end-U,de=xe[c],ne=xe[u];do{for(;k<20;)z--,I|=(255&T.read_byte(B++))<<k,k+=8;if((v=(O=x)[V=3*((R=g)+(S=I&de))])!==0)for(;;){if(I>>=O[V+1],k-=O[V+1],(16&v)!=0){for(F=O[V+2]+(I&xe[v&=15]),I>>=v,k-=v;k<15;)z--,I|=(255&T.read_byte(B++))<<k,k+=8;for(v=(O=h)[V=3*((R=E)+(S=I&ne))];;){if(I>>=O[V+1],k-=O[V+1],(16&v)!=0){for(v&=15;k<v;)z--,I|=(255&T.read_byte(B++))<<k,k+=8;if(ie=O[V+2]+(I&xe[v]),I>>=v,k-=v,W-=F,U>=ie)U-($=U-ie)>0&&2>U-$?(y.window[U++]=y.window[$++],y.window[U++]=y.window[$++],F-=2):(y.window.set(y.window.subarray($,$+2),U),U+=2,$+=2,F-=2);else{$=U-ie;do $+=y.end;while($<0);if(F>(v=y.end-$)){if(F-=v,U-$>0&&v>U-$)do y.window[U++]=y.window[$++];while(--v!=0);else y.window.set(y.window.subarray($,$+v),U),U+=v,$+=v,v=0;$=0}}if(U-$>0&&F>U-$)do y.window[U++]=y.window[$++];while(--F!=0);else y.window.set(y.window.subarray($,$+F),U),U+=F,$+=F,F=0;break}if(64&v)return T.msg="invalid distance code",z+=F=k>>3<(F=T.avail_in-z)?k>>3:F,B-=F,k-=F<<3,y.bitb=I,y.bitk=k,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,-3;S+=O[V+2],v=O[V=3*(R+(S+=I&xe[v]))]}break}if(64&v)return 32&v?(z+=F=k>>3<(F=T.avail_in-z)?k>>3:F,B-=F,k-=F<<3,y.bitb=I,y.bitk=k,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,1):(T.msg="invalid literal/length code",z+=F=k>>3<(F=T.avail_in-z)?k>>3:F,B-=F,k-=F<<3,y.bitb=I,y.bitk=k,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,-3);if(S+=O[V+2],(v=O[V=3*(R+(S+=I&xe[v]))])===0){I>>=O[V+1],k-=O[V+1],y.window[U++]=O[V+2],W--;break}}else I>>=O[V+1],k-=O[V+1],y.window[U++]=O[V+2],W--}while(W>=258&&z>=10);return z+=F=k>>3<(F=T.avail_in-z)?k>>3:F,B-=F,k-=F<<3,y.bitb=I,y.bitk=k,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,0}i.init=function(c,u,x,g,h,E){r=0,_=c,w=u,t=x,b=g,n=h,l=E,e=null},i.proc=function(c,u,x){var g,h,E,y,T,S,O,R=0,v=0,I=0;for(I=u.next_in_index,y=u.avail_in,R=c.bitb,v=c.bitk,S=(T=c.write)<c.read?c.read-T-1:c.end-T;;)switch(r){case 0:if(S>=258&&y>=10&&(c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,x=m(_,w,t,b,n,l,c,u),I=u.next_in_index,y=u.avail_in,R=c.bitb,v=c.bitk,S=(T=c.write)<c.read?c.read-T-1:c.end-T,x!=0)){r=x==1?7:9;break}a=_,e=t,s=b,r=1;case 1:for(g=a;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}if(R>>>=e[1+(h=3*(s+(R&xe[g])))],v-=e[h+1],(E=e[h])===0){f=e[h+2],r=6;break}if(16&E){d=15&E,o=e[h+2],r=2;break}if(!(64&E)){a=E,s=h/3+e[h+2];break}if(32&E){r=7;break}return r=9,u.msg="invalid literal/length code",x=-3,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);case 2:for(g=d;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}o+=R&xe[g],R>>=g,v-=g,a=w,e=n,s=l,r=3;case 3:for(g=a;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}if(R>>=e[1+(h=3*(s+(R&xe[g])))],v-=e[h+1],(16&(E=e[h]))!=0){d=15&E,p=e[h+2],r=4;break}if(!(64&E)){a=E,s=h/3+e[h+2];break}return r=9,u.msg="invalid distance code",x=-3,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);case 4:for(g=d;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}p+=R&xe[g],R>>=g,v-=g,r=5;case 5:for(O=T-p;O<0;)O+=c.end;for(;o!==0;){if(S===0&&(T==c.end&&c.read!==0&&(S=(T=0)<c.read?c.read-T-1:c.end-T),S===0&&(c.write=T,x=c.inflate_flush(u,x),S=(T=c.write)<c.read?c.read-T-1:c.end-T,T==c.end&&c.read!==0&&(S=(T=0)<c.read?c.read-T-1:c.end-T),S===0)))return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);c.window[T++]=c.window[O++],S--,O==c.end&&(O=0),o--}r=0;break;case 6:if(S===0&&(T==c.end&&c.read!==0&&(S=(T=0)<c.read?c.read-T-1:c.end-T),S===0&&(c.write=T,x=c.inflate_flush(u,x),S=(T=c.write)<c.read?c.read-T-1:c.end-T,T==c.end&&c.read!==0&&(S=(T=0)<c.read?c.read-T-1:c.end-T),S===0)))return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,c.window[T++]=f,S--,r=0;break;case 7:if(v>7&&(v-=8,y++,I--),c.write=T,x=c.inflate_flush(u,x),S=(T=c.write)<c.read?c.read-T-1:c.end-T,c.read!=c.write)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);r=8;case 8:return x=1,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);case 9:return x=-3,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);default:return x=-2,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x)}},i.free=function(){}}zt.inflate_trees_fixed=function(r,e,t,n){return r[0]=9,e[0]=5,t[0]=ts,n[0]=ns,0};var jn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function cs(r,e){var t,n=this,i=0,o=0,s=0,a=0,f=[0],d=[0],p=new as,_=0,w=new Int32Array(4320),b=new zt;n.bitk=0,n.bitb=0,n.window=new Uint8Array(e),n.end=e,n.read=0,n.write=0,n.reset=function(l,m){m&&(m[0]=0),i==6&&p.free(l),i=0,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(r,null),n.inflate_flush=function(l,m){var c,u,x;return u=l.next_out_index,(c=((x=n.read)<=n.write?n.write:n.end)-x)>l.avail_out&&(c=l.avail_out),c!==0&&m==-5&&(m=0),l.avail_out-=c,l.total_out+=c,l.next_out.set(n.window.subarray(x,x+c),u),u+=c,(x+=c)==n.end&&(x=0,n.write==n.end&&(n.write=0),(c=n.write-x)>l.avail_out&&(c=l.avail_out),c!==0&&m==-5&&(m=0),l.avail_out-=c,l.total_out+=c,l.next_out.set(n.window.subarray(x,x+c),u),u+=c,x+=c),l.next_out_index=u,n.read=x,m},n.proc=function(l,m){var c,u,x,g,h,E,y,T;for(g=l.next_in_index,h=l.avail_in,u=n.bitb,x=n.bitk,y=(E=n.write)<n.read?n.read-E-1:n.end-E;;)switch(i){case 0:for(;x<3;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);m=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}switch(_=1&(c=7&u),c>>>1){case 0:u>>>=3,u>>>=c=7&(x-=3),x-=c,i=1;break;case 1:var S=[],O=[],R=[[]],v=[[]];zt.inflate_trees_fixed(S,O,R,v),p.init(S[0],O[0],R[0],0,v[0],0),u>>>=3,x-=3,i=6;break;case 2:u>>>=3,x-=3,i=3;break;case 3:return u>>>=3,x-=3,i=9,l.msg="invalid block type",m=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m)}break;case 1:for(;x<32;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);m=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if((~u>>>16&65535)!=(65535&u))return i=9,l.msg="invalid stored block lengths",m=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);o=65535&u,u=x=0,i=o!==0?2:_!==0?7:0;break;case 2:if(h===0||y===0&&(E==n.end&&n.read!==0&&(y=(E=0)<n.read?n.read-E-1:n.end-E),y===0&&(n.write=E,m=n.inflate_flush(l,m),y=(E=n.write)<n.read?n.read-E-1:n.end-E,E==n.end&&n.read!==0&&(y=(E=0)<n.read?n.read-E-1:n.end-E),y===0)))return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);if(m=0,(c=o)>h&&(c=h),c>y&&(c=y),n.window.set(l.read_buf(g,c),E),g+=c,h-=c,E+=c,y-=c,(o-=c)!=0)break;i=_!==0?7:0;break;case 3:for(;x<14;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);m=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if(s=c=16383&u,(31&c)>29||(c>>5&31)>29)return i=9,l.msg="too many length or distance symbols",m=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);if(c=258+(31&c)+(c>>5&31),!t||t.length<c)t=[];else for(T=0;T<c;T++)t[T]=0;u>>>=14,x-=14,a=0,i=4;case 4:for(;a<4+(s>>>10);){for(;x<3;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);m=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}t[jn[a++]]=7&u,u>>>=3,x-=3}for(;a<19;)t[jn[a++]]=0;if(f[0]=7,(c=b.inflate_trees_bits(t,f,d,w,l))!=0)return(m=c)==-3&&(t=null,i=9),n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);a=0,i=5;case 5:for(;!(a>=258+(31&(c=s))+(c>>5&31));){var I,k;for(c=f[0];x<c;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);m=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if((k=w[3*(d[0]+(u&xe[c=w[3*(d[0]+(u&xe[c]))+1]]))+2])<16)u>>>=c,x-=c,t[a++]=k;else{for(T=k==18?7:k-14,I=k==18?11:3;x<c+T;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);m=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if(x-=c,I+=(u>>>=c)&xe[T],u>>>=T,x-=T,(T=a)+I>258+(31&(c=s))+(c>>5&31)||k==16&&T<1)return t=null,i=9,l.msg="invalid bit length repeat",m=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);k=k==16?t[T-1]:0;do t[T++]=k;while(--I!=0);a=T}}d[0]=-1;var B=[],z=[],U=[],W=[];if(B[0]=9,z[0]=6,(c=b.inflate_trees_dynamic(257+(31&(c=s)),1+(c>>5&31),t,B,z,U,W,w,l))!=0)return c==-3&&(t=null,i=9),m=c,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);p.init(B[0],z[0],w,U[0],w,W[0]),i=6;case 6:if(n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,(m=p.proc(n,l,m))!=1)return n.inflate_flush(l,m);if(m=0,p.free(l),g=l.next_in_index,h=l.avail_in,u=n.bitb,x=n.bitk,y=(E=n.write)<n.read?n.read-E-1:n.end-E,_===0){i=0;break}i=7;case 7:if(n.write=E,m=n.inflate_flush(l,m),y=(E=n.write)<n.read?n.read-E-1:n.end-E,n.read!=n.write)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);i=8;case 8:return m=1,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);case 9:return m=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m);default:return m=-2,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,m)}},n.free=function(l){n.reset(l,null),n.window=null,w=null},n.set_dictionary=function(l,m,c){n.window.set(l.subarray(m,m+c),0),n.read=n.write=c},n.sync_point=function(){return i==1?1:0}}var us=[0,0,255,255];function ls(){var r=this;function e(t){return t&&t.istate?(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=7,t.istate.blocks.reset(t,null),0):-2}r.mode=0,r.method=0,r.was=[0],r.need=0,r.marker=0,r.wbits=0,r.inflateEnd=function(t){return r.blocks&&r.blocks.free(t),r.blocks=null,0},r.inflateInit=function(t,n){return t.msg=null,r.blocks=null,n<8||n>15?(r.inflateEnd(t),-2):(r.wbits=n,t.istate.blocks=new cs(t,1<<n),e(t),0)},r.inflate=function(t,n){var i,o;if(!t||!t.istate||!t.next_in)return-2;for(n=n==4?-5:0,i=-5;;)switch(t.istate.mode){case 0:if(t.avail_in===0)return i;if(i=n,t.avail_in--,t.total_in++,(15&(t.istate.method=t.read_byte(t.next_in_index++)))!=8){t.istate.mode=13,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=13,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(t.avail_in===0)return i;if(i=n,t.avail_in--,t.total_in++,o=255&t.read_byte(t.next_in_index++),((t.istate.method<<8)+o)%31!=0){t.istate.mode=13,t.msg="incorrect header check",t.istate.marker=5;break}if(!(32&o)){t.istate.mode=7;break}t.istate.mode=2;case 2:if(t.avail_in===0)return i;i=n,t.avail_in--,t.total_in++,t.istate.need=(255&t.read_byte(t.next_in_index++))<<24&4278190080,t.istate.mode=3;case 3:if(t.avail_in===0)return i;i=n,t.avail_in--,t.total_in++,t.istate.need+=(255&t.read_byte(t.next_in_index++))<<16&16711680,t.istate.mode=4;case 4:if(t.avail_in===0)return i;i=n,t.avail_in--,t.total_in++,t.istate.need+=(255&t.read_byte(t.next_in_index++))<<8&65280,t.istate.mode=5;case 5:return t.avail_in===0?i:(i=n,t.avail_in--,t.total_in++,t.istate.need+=255&t.read_byte(t.next_in_index++),t.istate.mode=6,2);case 6:return t.istate.mode=13,t.msg="need dictionary",t.istate.marker=0,-2;case 7:if((i=t.istate.blocks.proc(t,i))==-3){t.istate.mode=13,t.istate.marker=0;break}if(i==0&&(i=n),i!=1)return i;i=n,t.istate.blocks.reset(t,t.istate.was),t.istate.mode=12;case 12:return 1;case 13:return-3;default:return-2}},r.inflateSetDictionary=function(t,n,i){var o=0,s=i;return t&&t.istate&&t.istate.mode==6?(s>=1<<t.istate.wbits&&(o=i-(s=(1<<t.istate.wbits)-1)),t.istate.blocks.set_dictionary(n,o,s),t.istate.mode=7,0):-2},r.inflateSync=function(t){var n,i,o,s,a;if(!t||!t.istate)return-2;if(t.istate.mode!=13&&(t.istate.mode=13,t.istate.marker=0),(n=t.avail_in)===0)return-5;for(i=t.next_in_index,o=t.istate.marker;n!==0&&o<4;)t.read_byte(i)==us[o]?o++:o=t.read_byte(i)!==0?0:4-o,i++,n--;return t.total_in+=i-t.next_in_index,t.next_in_index=i,t.avail_in=n,t.istate.marker=o,o!=4?-3:(s=t.total_in,a=t.total_out,e(t),t.total_in=s,t.total_out=a,t.istate.mode=7,0)},r.inflateSyncPoint=function(t){return t&&t.istate&&t.istate.blocks?t.istate.blocks.sync_point():-2}}function Wr(){}function Kr(){var r=new Wr,e=new Uint8Array(512),t=!1;r.inflateInit(),r.next_out=e,this.append=function(n,i){var o,s,a=[],f=0,d=0,p=0;if(n.length!==0){r.next_in_index=0,r.next_in=n,r.avail_in=n.length;do{if(r.next_out_index=0,r.avail_out=512,r.avail_in!==0||t||(r.next_in_index=0,t=!0),o=r.inflate(0),t&&o===-5){if(r.avail_in!==0)throw new Error("inflating: bad input")}else if(o!==0&&o!==1)throw new Error("inflating: "+r.msg);if((t||o===1)&&r.avail_in===n.length)throw new Error("inflating: bad input");r.next_out_index&&a.push(r.next_out_index===512?new Uint8Array(e):new Uint8Array(e.subarray(0,r.next_out_index))),p+=r.next_out_index,i&&r.next_in_index>0&&r.next_in_index!=f&&(i(r.next_in_index),f=r.next_in_index)}while(r.avail_in>0||r.avail_out===0);return s=new Uint8Array(p),a.forEach(function(_){s.set(_,d),d+=_.length}),s}},this.flush=function(){r.inflateEnd()}}Wr.prototype={inflateInit:function(r){var e=this;return e.istate=new ls,r||(r=15),e.istate.inflateInit(e,r)},inflate:function(r){var e=this;return e.istate?e.istate.inflate(e,r):-2},inflateEnd:function(){var r=this;if(!r.istate)return-2;var e=r.istate.inflateEnd(r);return r.istate=null,e},inflateSync:function(){var r=this;return r.istate?r.istate.inflateSync(r):-2},inflateSetDictionary:function(r,e){var t=this;return t.istate?t.istate.inflateSetDictionary(t,r,e):-2},read_byte:function(r){return this.next_in.subarray(r,r+1)[0]},read_buf:function(r,e){return this.next_in.subarray(r,r+e)}},self._zipjs_Inflater=Kr;var hn,nt="File format is not recognized.",zn="Error while reading zip file.";try{hn=new Blob([new DataView(new ArrayBuffer(0))]).size===0}catch{}function ht(){this.crc=-1}function Pt(){}function Ne(r,e){var t,n;return t=new ArrayBuffer(r),n=new Uint8Array(t),e&&n.set(e,0),{buffer:t,array:n,view:new DataView(t)}}function pt(){}function Gt(r){var e,t=this;t.size=0,t.init=function(n,i){var o=new Blob([r],{type:"text/plain"});(e=new bt(o)).init(function(){t.size=e.size,n()},i)},t.readUint8Array=function(n,i,o,s){e.readUint8Array(n,i,o,s)}}function $t(r){var e,t=this;t.size=0,t.init=function(n){for(var i=r.length;r.charAt(i-1)=="=";)i--;e=r.indexOf(",")+1,t.size=Math.floor(.75*(i-e)),n()},t.readUint8Array=function(n,i,o){var s,a=Ne(i),f=4*Math.floor(n/3),d=4*Math.ceil((n+i)/3),p=self.atob(r.substring(f+e,d+e)),_=n-3*Math.floor(f/4);for(s=_;s<_+i;s++)a.array[s-_]=p.charCodeAt(s);o(a.array)}}function bt(r){var e=this;e.size=0,e.init=function(t){e.size=r.size,t()},e.readUint8Array=function(t,n,i,o){var s=new FileReader;s.onload=function(a){i(new Uint8Array(a.target.result))},s.onerror=o;try{s.readAsArrayBuffer(function(a,f,d){if(f<0||d<0||f+d>a.size)throw new RangeError("offset:"+f+", length:"+d+", size:"+a.size);return a.slice?a.slice(f,f+d):a.webkitSlice?a.webkitSlice(f,f+d):a.mozSlice?a.mozSlice(f,f+d):a.msSlice?a.msSlice(f,f+d):void 0}(r,t,n))}catch(a){o(a)}}}function ot(){}function Vt(r){var e,t=this;t.init=function(n){e=new Blob([],{type:"text/plain"}),n()},t.writeUint8Array=function(n,i){e=new Blob([e,hn?n:n.buffer],{type:"text/plain"}),i()},t.getData=function(n,i){var o=new FileReader;o.onload=function(s){n(s.target.result)},o.onerror=i,o.readAsText(e,r)}}function Ht(r){var e=this,t="",n="";e.init=function(i){t+="data:"+(r||"")+";base64,",i()},e.writeUint8Array=function(i,o){var s,a=n.length,f=n;for(n="",s=0;s<3*Math.floor((a+i.length)/3)-a;s++)f+=String.fromCharCode(i[s]);for(;s<i.length;s++)n+=String.fromCharCode(i[s]);f.length>2?t+=self.btoa(f):n=f,o()},e.getData=function(i){i(t+self.btoa(n))}}function Xt(r){var e,t=this;t.init=function(n){e=new Blob([],{type:r}),n()},t.writeUint8Array=function(n,i){e=new Blob([e,hn?n:n.buffer],{type:r}),i()},t.getData=function(n){n(e)}}function Wt(r,e,t,n,i,o,s,a,f,d){var p,_,w,b=0,l=e.sn;function m(){r.removeEventListener("message",c,!1),a(_,w)}function c(x){var g=x.data,h=g.data,E=g.error;if(E)return E.toString=function(){return"Error: "+this.message},void f(E);if(g.sn===l)switch(typeof g.codecTime=="number"&&(r.codecTime+=g.codecTime),typeof g.crcTime=="number"&&(r.crcTime+=g.crcTime),g.type){case"append":h?(_+=h.length,n.writeUint8Array(h,function(){u()},d)):u();break;case"flush":w=g.crc,h?(_+=h.length,n.writeUint8Array(h,function(){m()},d)):m();break;case"progress":s&&s(p+g.loaded,o);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",g)}}function u(){(p=524288*b)<=o?t.readUint8Array(i+p,Math.min(524288,o-p),function(x){s&&s(p,o);var g=p===0?e:{sn:l};g.type="append",g.data=x;try{r.postMessage(g,[x.buffer])}catch{r.postMessage(g)}b++},f):r.postMessage({sn:l,type:"flush"})}_=0,r.addEventListener("message",c,!1),u()}function Kt(r,e,t,n,i,o,s,a,f,d){var p,_=0,w=0,b=o==="input",l=o==="output",m=new ht;(function c(){var u;if((p=524288*_)<i)e.readUint8Array(n+p,Math.min(524288,i-p),function(x){var g;try{g=r.append(x,function(h){s&&s(p+h,i)})}catch(h){return void f(h)}g?(w+=g.length,t.writeUint8Array(g,function(){_++,setTimeout(c,1)},d),l&&m.append(g)):(_++,setTimeout(c,1)),b&&m.append(x),s&&s(p,i)},f);else{try{u=r.flush()}catch(x){return void f(x)}u?(l&&m.append(u),w+=u.length,t.writeUint8Array(u,function(){a(w,m.get())},d)):a(w,m.get())}})()}function Pn(r,e,t,n,i,o,s,a,f,d,p){var _="input";K.useWebWorkers&&s?Wt(r,{sn:e,codecClass:"_zipjs_NOOP",crcType:_},t,n,i,o,f,a,d,p):Kt(new Pt,t,n,i,o,_,f,a,d,p)}function Gn(r){var e,t,n="",i=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(e=0;e<r.length;e++)n+=(t=255&r.charCodeAt(e))>127?i[t-128]:String.fromCharCode(t);return n}function $n(r){return decodeURIComponent(escape(r))}function Vn(r){var e,t="";for(e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t}function Hn(r,e,t,n,i){r.version=e.view.getUint16(t,!0),r.bitFlag=e.view.getUint16(t+2,!0),r.compressionMethod=e.view.getUint16(t+4,!0),r.lastModDateRaw=e.view.getUint32(t+6,!0),r.lastModDate=function(o){var s=(4294901760&o)>>16,a=65535&o;try{return new Date(1980+((65024&s)>>9),((480&s)>>5)-1,31&s,(63488&a)>>11,(2016&a)>>5,2*(31&a),0)}catch{}}(r.lastModDateRaw),(1&r.bitFlag)!=1?((n||(8&r.bitFlag)!=8)&&(r.crc32=e.view.getUint32(t+10,!0),r.compressedSize=e.view.getUint32(t+14,!0),r.uncompressedSize=e.view.getUint32(t+18,!0)),r.compressedSize!==4294967295&&r.uncompressedSize!==4294967295?(r.filenameLength=e.view.getUint16(t+22,!0),r.extraFieldLength=e.view.getUint16(t+24,!0)):i("File is using Zip64 (4gb+ file size).")):i("File contains encrypted entry.")}function Xn(r){return unescape(encodeURIComponent(r))}function Wn(r){var e,t=[];for(e=0;e<r.length;e++)t.push(r.charCodeAt(e));return t}ht.prototype.append=function(r){for(var e=0|this.crc,t=this.table,n=0,i=0|r.length;n<i;n++)e=e>>>8^t[255&(e^r[n])];this.crc=e},ht.prototype.get=function(){return~this.crc},ht.prototype.table=function(){var r,e,t,n=[];for(r=0;r<256;r++){for(t=r,e=0;e<8;e++)1&t?t=t>>>1^3988292384:t>>>=1;n[r]=t}return n}(),Pt.prototype.append=function(r,e){return r},Pt.prototype.flush=function(){},(Gt.prototype=new pt).constructor=Gt,($t.prototype=new pt).constructor=$t,(bt.prototype=new pt).constructor=bt,ot.prototype.getData=function(r){r(this.data)},(Vt.prototype=new ot).constructor=Vt,(Ht.prototype=new ot).constructor=Ht,(Xt.prototype=new ot).constructor=Xt;var fs={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function Kn(r,e,t){if(K.workerScripts===null||K.workerScriptsPath===null){var n,i,o;if(K.workerScripts){if(n=K.workerScripts[r],!Array.isArray(n))return void t(new Error("zip.workerScripts."+r+" is not an array!"));i=n,o=document.createElement("a"),n=i.map(function(f){return o.href=f,o.href})}else(n=fs[r].slice(0))[0]=(K.workerScriptsPath||"")+n[0];var s=new Worker(n[0]);s.codecTime=s.crcTime=0,s.postMessage({type:"importScripts",scripts:n.slice(1)}),s.addEventListener("message",function f(d){var p=d.data;if(p.error)return s.terminate(),void t(p.error);p.type==="importScripts"&&(s.removeEventListener("message",f),s.removeEventListener("error",a),e(s))}),s.addEventListener("error",a)}else t(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function a(f){s.terminate(),t(f)}}function qn(r){console.error(r)}const K={Reader:pt,Writer:ot,BlobReader:bt,Data64URIReader:$t,TextReader:Gt,BlobWriter:Xt,Data64URIWriter:Ht,TextWriter:Vt,createReader:function(r,e,t){r.init(function(){(function(n,i,o){var s=0;function a(){}a.prototype.getData=function(d,p,_,w){var b=this;function l(u,x){w&&!function(g){var h=Ne(4);return h.view.setUint32(0,g),b.crc32==h.view.getUint32(0)}(x)?o("CRC failed."):d.getData(function(g){p(g)})}function m(u){o(u||"Error while reading file data.")}function c(u){o(u||"Error while writing file data.")}n.readUint8Array(b.offset,30,function(u){var x,g=Ne(u.length,u);g.view.getUint32(0)==1347093252?(Hn(b,g,4,!1,o),x=b.offset+30+b.filenameLength+b.extraFieldLength,d.init(function(){b.compressionMethod===0?Pn(b._worker,s++,n,d,x,b.compressedSize,w,l,_,m,c):function(h,E,y,T,S,O,R,v,I,k,B){var z=R?"output":"none";K.useWebWorkers?Wt(h,{sn:E,codecClass:"_zipjs_Inflater",crcType:z},y,T,S,O,I,v,k,B):Kt(new Kr,y,T,S,O,z,I,v,k,B)}(b._worker,s++,n,d,x,b.compressedSize,w,l,_,m,c)},c)):o(nt)},m)};var f={getEntries:function(d){var p=this._worker;(function(_){function w(b,l){n.readUint8Array(n.size-b,b,function(m){for(var c=m.length-22;c>=0;c--)if(m[c]===80&&m[c+1]===75&&m[c+2]===5&&m[c+3]===6)return void _(new DataView(m.buffer,c,22));l()},function(){o(zn)})}n.size<22?o(nt):w(22,function(){w(Math.min(65558,n.size),function(){o(nt)})})})(function(_){var w,b;w=_.getUint32(16,!0),b=_.getUint16(8,!0),w<0||w>=n.size?o(nt):n.readUint8Array(w,n.size-w,function(l){var m,c,u,x,g=0,h=[],E=Ne(l.length,l);for(m=0;m<b;m++){if((c=new a)._worker=p,E.view.getUint32(g)!=1347092738)return void o(nt);Hn(c,E,g+6,!0,o),c.commentLength=E.view.getUint16(g+32,!0),c.directory=(16&E.view.getUint8(g+38))==16,c.offset=E.view.getUint32(g+42,!0),u=Vn(E.array.subarray(g+46,g+46+c.filenameLength)),c.filename=(2048&c.bitFlag)==2048?$n(u):Gn(u),c.directory||c.filename.charAt(c.filename.length-1)!="/"||(c.directory=!0),x=Vn(E.array.subarray(g+46+c.filenameLength+c.extraFieldLength,g+46+c.filenameLength+c.extraFieldLength+c.commentLength)),c.comment=(2048&c.bitFlag)==2048?$n(x):Gn(x),h.push(c),g+=46+c.filenameLength+c.extraFieldLength+c.commentLength}d(h)},function(){o(zn)})})},close:function(d){this._worker&&(this._worker.terminate(),this._worker=null),d&&d()},_worker:null};K.useWebWorkers?Kn("inflater",function(d){f._worker=d,i(f)},function(d){o(d)}):i(f)})(r,e,t)},t=t||qn)},createWriter:function(r,e,t,n){n=!!n,r.init(function(){(function(i,o,s,a){var f={},d=[],p=0,_=0;function w(m){s(m||"Error while writing zip file.")}function b(m){s(m||"Error while reading file data.")}var l={add:function(m,c,u,x,g){var h,E,y,T=this._worker;function S(R,v){var I=Ne(16);p+=R||0,I.view.setUint32(0,1347094280),v!==void 0&&(h.view.setUint32(10,v,!0),I.view.setUint32(4,v,!0)),c&&(I.view.setUint32(8,R,!0),h.view.setUint32(14,R,!0),I.view.setUint32(12,c.size,!0),h.view.setUint32(18,c.size,!0)),i.writeUint8Array(I.array,function(){p+=16,u()},w)}function O(){var R;g=g||{},m=m.trim(),g.directory&&m.charAt(m.length-1)!="/"&&(m+="/"),f.hasOwnProperty(m)?s("File already exists."):(E=Wn(Xn(m)),d.push(m),y=g.lastModDate||new Date,h=Ne(26),f[m]={headerArray:h.array,directory:g.directory,filename:E,offset:p,comment:Wn(Xn(g.comment||""))},h.view.setUint32(0,335546376),g.version&&h.view.setUint8(0,g.version),a||g.level===0||g.directory||h.view.setUint16(4,2048),h.view.setUint16(6,(y.getHours()<<6|y.getMinutes())<<5|y.getSeconds()/2,!0),h.view.setUint16(8,(y.getFullYear()-1980<<4|y.getMonth()+1)<<5|y.getDate(),!0),h.view.setUint16(22,E.length,!0),(R=Ne(30+E.length)).view.setUint32(0,1347093252),R.array.set(h.array,4),R.array.set(E,30),p+=R.array.length,i.writeUint8Array(R.array,function(){c?a||g.level===0?Pn(T,_++,c,i,0,c.size,!0,S,x,b,w):function(v,I,k,B,z,U,W,de,ne){var F="input";K.useWebWorkers?Wt(v,{sn:I,options:{level:z},codecClass:"_zipjs_Deflater",crcType:F},k,B,0,k.size,W,U,de,ne):Kt(new Xr,k,B,0,k.size,F,W,U,de,ne)}(T,_++,c,i,g.level,S,x,b,w):S()},w))}c?c.init(O,b):O()},close:function(m){this._worker&&(this._worker.terminate(),this._worker=null);var c,u,x,g=0,h=0;for(u=0;u<d.length;u++)g+=46+(x=f[d[u]]).filename.length+x.comment.length;for(c=Ne(g+22),u=0;u<d.length;u++)x=f[d[u]],c.view.setUint32(h,1347092738),c.view.setUint16(h+4,5120),c.array.set(x.headerArray,h+6),c.view.setUint16(h+32,x.comment.length,!0),x.directory&&c.view.setUint8(h+38,16),c.view.setUint32(h+42,x.offset,!0),c.array.set(x.filename,h+46),c.array.set(x.comment,h+46+x.filename.length),h+=46+x.filename.length+x.comment.length;c.view.setUint32(h,1347093766),c.view.setUint16(h+8,d.length,!0),c.view.setUint16(h+10,d.length,!0),c.view.setUint32(h+12,g,!0),c.view.setUint32(h+16,p,!0),i.writeUint8Array(c.array,function(){i.getData(m)},w)},_worker:null};K.useWebWorkers?Kn("deflater",function(m){l._worker=m,o(l)},function(m){s(m)}):o(l)})(r,e,t,n)},t=t||qn)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null};var He,se,Mt=K.TextWriter,xt=K.BlobWriter,Ct=K.Data64URIWriter,Zn=K.TextReader,qt=K.BlobReader,Yn=K.Data64URIReader,ds=K.createReader,hs=K.createWriter;function ft(r){var e,t=this;t.size=0,t.init=function(n){t.size=r.uncompressedSize,n()},t.readUint8Array=function(n,i,o,s){(function(a){t.data?a():r.getData(new xt,function(f){t.data=f,e=new qt(f),a()},null,t.checkCrc32)})(function(){e.readUint8Array(n,i,o,s)})}}function Qn(r){var e=0;return function t(n){e+=n.uncompressedSize||0,n.children.forEach(t)}(r),e}function Zt(r,e,t){var n=0;function i(){++n<r.children.length?o(r.children[n]):e()}function o(s){s.directory?Zt(s,i,t):(s.reader=new s.Reader(s.data,t),s.reader.init(function(){s.uncompressedSize=s.reader.size,i()}))}r.children.length?o(r.children[n]):e()}function Jn(r){var e=r.parent.children;e.forEach(function(t,n){t.id==r.id&&e.splice(n,1)})}function gt(r){r.entries=[],r.root=new Ze(r)}function Xe(r,e,t,n){if(r.directory)return n?new Ze(r.fs,e,t,r):new Et(r.fs,e,t,r);throw"Parent entry is not a directory."}function Ke(){}function Et(r,e,t,n){var i=this;Ke.prototype.init.call(i,r,e,t,n),i.Reader=t.Reader,i.Writer=t.Writer,i.data=t.data,t.getData&&(i.getData=t.getData)}function Ze(r,e,t,n){Ke.prototype.init.call(this,r,e,t,n),this.directory=!0}function qr(){gt(this)}(ft.prototype=new K.Reader).constructor=ft,ft.prototype.checkCrc32=!1,(Ke.prototype={init:function(r,e,t,n){var i=this;if(r.root&&n&&n.getChildByName(e))throw"Entry filename already exists.";t||(t={}),i.fs=r,i.name=e,i.id=r.entries.length,i.parent=n,i.children=[],i.zipVersion=t.zipVersion||20,i.uncompressedSize=0,r.entries.push(i),n&&i.parent.children.push(i)},getFileEntry:function(r,e,t,n,i){var o=this;Zt(o,function(){(function(s,a,f,d,p,_,w){var b=0;a.directory?function l(m,c,u,x,g,h){var E=0;(function y(){var T=c.children[E];T?function(S){function O(R){b+=S.uncompressedSize||0,l(R,S,function(){E++,y()},x,g,h)}S.directory?m.getDirectory(S.name,{create:!0},O,g):m.getFile(S.name,{create:!0},function(R){S.getData(new K.FileWriter(R,K.getMimeType(S.name)),O,function(v){x&&x(b+v,h)},w)},g)}(T):u()})()}(s,a,f,d,p,_):a.getData(new K.FileWriter(s,K.getMimeType(a.name)),f,d,w)})(r,o,e,t,n,Qn(o),i)},n)},moveTo:function(r){var e=this;if(!r.directory)throw"Target entry is not a directory.";if(r.isDescendantOf(e))throw"Entry is a ancestor of target entry.";if(e!=r){if(r.getChildByName(e.name))throw"Entry filename already exists.";Jn(e),e.parent=r,r.children.push(e)}},getFullname:function(){for(var r=this.name,e=this.parent;e;)r=(e.name?e.name+"/":"")+r,e=e.parent;return r},isDescendantOf:function(r){for(var e=this.parent;e&&e.id!=r.id;)e=e.parent;return!!e}}).constructor=Ke,Et.prototype=He=new Ke,He.constructor=Et,He.getData=function(r,e,t,n){var i=this;!r||r.constructor==i.Writer&&i.data?e(i.data):(i.reader||(i.reader=new i.Reader(i.data,n)),i.reader.init(function(){r.init(function(){(function(o,s,a,f,d){var p=0;(function _(){var w=524288*p;f&&f(w,o.size),w<o.size?o.readUint8Array(w,Math.min(524288,o.size-w),function(b){s.writeUint8Array(new Uint8Array(b),function(){p++,_()})},d):s.getData(a)})()})(i.reader,r,e,t,n)},n)}))},He.getText=function(r,e,t,n){this.getData(new Mt(n),r,e,t)},He.getBlob=function(r,e,t,n){this.getData(new xt(r),e,t,n)},He.getData64URI=function(r,e,t,n){this.getData(new Ct(r),e,t,n)},Ze.prototype=se=new Ke,se.constructor=Ze,se.addDirectory=function(r){return Xe(this,r,null,!0)},se.addText=function(r,e){return Xe(this,r,{data:e,Reader:Zn,Writer:Mt})},se.addBlob=function(r,e){return Xe(this,r,{data:e,Reader:qt,Writer:xt})},se.addData64URI=function(r,e){return Xe(this,r,{data:e,Reader:Yn,Writer:Ct})},se.addFileEntry=function(r,e,t){(function(n,i,o,s){i.isDirectory?function a(f,d,p){(function(_,w){_.isDirectory&&_.createReader().readEntries(w),_.isFile&&w([])})(d,function(_){var w=0;(function b(){var l=_[w];l?function(m){function c(u){a(u,m,function(){w++,b()})}m.isDirectory&&c(f.addDirectory(m.name)),m.isFile&&m.file(function(u){var x=f.addBlob(m.name,u);x.uncompressedSize=u.size,c(x)},s)}(l):p()})()})}(n,i,o):i.file(function(a){n.addBlob(i.name,a),o()},s)})(this,r,e,t)},se.addData=function(r,e){return Xe(this,r,e)},se.importBlob=function(r,e,t){this.importZip(new qt(r),e,t)},se.importText=function(r,e,t){this.importZip(new Zn(r),e,t)},se.importData64URI=function(r,e,t){this.importZip(new Yn(r),e,t)},se.exportBlob=function(r,e,t){this.exportZip(new xt("application/zip"),r,e,t)},se.exportText=function(r,e,t){this.exportZip(new Mt,r,e,t)},se.exportFileEntry=function(r,e,t,n){this.exportZip(new K.FileWriter(r,"application/zip"),e,t,n)},se.exportData64URI=function(r,e,t){this.exportZip(new Ct("application/zip"),r,e,t)},se.importZip=function(r,e,t){var n=this;ds(r,function(i){i.getEntries(function(o){o.forEach(function(s){var a=n,f=s.filename.split("/"),d=f.pop();f.forEach(function(p){a=a.getChildByName(p)||new Ze(n.fs,p,null,a)}),s.directory||Xe(a,d,{data:s,Reader:ft})}),e()})},t)},se.exportZip=function(r,e,t,n){var i=this;Zt(i,function(){hs(r,function(o){(function(s,a,f,d,p){var _=0;(function w(b,l,m,c,u){var x=0;(function g(){var h=l.children[x];h?b.add(h.getFullname(),h.reader,function(){_+=h.uncompressedSize||0,w(b,h,function(){x++,g()},c,u)},function(E){c&&c(_+E,u)},{directory:h.directory,version:h.zipVersion}):m()})()})(s,a,f,d,p)})(o,i,function(){o.close(e)},t,Qn(i))},n)},n)},se.getChildByName=function(r){var e,t;for(e=0;e<this.children.length;e++)if((t=this.children[e]).name==r)return t},qr.prototype={remove:function(r){Jn(r),this.entries[r.id]=null},find:function(r){var e,t=r.split("/"),n=this.root;for(e=0;n&&e<t.length;e++)n=n.getChildByName(t[e]);return n},getById:function(r){return this.entries[r]},importBlob:function(r,e,t){gt(this),this.root.importBlob(r,e,t)},importText:function(r,e,t){gt(this),this.root.importText(r,e,t)},importData64URI:function(r,e,t){gt(this),this.root.importData64URI(r,e,t)},exportBlob:function(r,e,t){this.root.exportBlob(r,e,t)},exportText:function(r,e,t){this.root.exportText(r,e,t)},exportFileEntry:function(r,e,t,n){this.root.exportFileEntry(r,e,t,n)},exportData64URI:function(r,e,t){this.root.exportData64URI(r,e,t)}},K.getMimeType=function(){return"application/octet-stream"};var ps={FS:qr,ZipDirectoryEntry:Ze,ZipFileEntry:Et};K.useWebWorkers=!1;var xs=function(){function r(t,n){this.el=t,this.inputEl=n,this.listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),t.addEventListener("dragover",this._onDragover,!1),t.addEventListener("drop",this._onDrop,!1),n.addEventListener("change",this._onSelect)}var e=r.prototype;return e.on=function(t,n){return this.listeners[t].push(n),this},e._emit=function(t,n){return this.listeners[t].forEach(function(i){return i(n)}),this},e.destroy=function(){var t=this.el,n=this.inputEl;t.removeEventListener("dragover",this._onDragover,!1),t.removeEventListener("drop",this._onDrop,!1),n.removeEventListener("change",this._onSelect),delete this.el,delete this.inputEl,delete this.listeners},e._onDrop=function(t){t.stopPropagation(),t.preventDefault(),this._emit("dropstart");var n=Array.from(t.dataTransfer.files||[]),i=Array.from(t.dataTransfer.items||[]);if(n.length!==0||i.length!==0)if(i.length>0){var o=i.map(function(s){return s.webkitGetAsEntry()}).filter(function(s){return s!==null});o.length>0&&(o[0].name.match(/\.zip$/)?this._loadZip(i[0].getAsFile()):this._loadNextEntry(new Map,o))}else n.length===1&&n[0].name.match(/\.zip$/)&&this._loadZip(n[0]),this._emit("drop",{files:new Map(n.map(function(s){return[s.name,s]}))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")},e._onDragover=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},e._onSelect=function(t){this._emit("dropstart");var n=[].slice.call(this.inputEl.files);if(n.length===1&&this._isZip(n[0]))this._loadZip(n[0]);else{var i=new Map;n.forEach(function(o){return i.set(o.webkitRelativePath||o.name,o)}),this._emit("drop",{files:i})}},e._loadNextEntry=function(t,n){var i=this,o=n.pop();if(o)if(o.isFile)o.file(function(a){t.set(o.fullPath,a),i._loadNextEntry(t,n)},function(){return console.error("Could not load file: %s",o.fullPath)});else if(o.isDirectory){var s=o.createReader();s.readEntries(function a(f){f.length?(n=n.concat(f),s.readEntries(a)):i._loadNextEntry(t,n)})}else console.warn("Unknown asset type: "+o.fullPath),this._loadNextEntry(t,n);else this._emit("drop",{files:t})},e._loadZip=function(t){var n=this,i=[],o=new Map,s=new ps.FS,a=function f(d){d.directory?d.children.forEach(f):d.name[0]!=="."&&i.push(new Promise(function(p){d.getData(new K.BlobWriter,function(_){_.name=d.name,o.set(d.getFullname(),_),p()})}))};s.importBlob(t,function(){a(s.root),Promise.all(i).then(function(){n._emit("drop",{files:o,archive:t})})})},e._isZip=function(t){return t.type==="application/zip"||t.name.match(/\.zip$/)},e._fail=function(t){this._emit("droperror",{message:t})},r}();const pn=ii(new si);pn.registerExtensions(Vr);const _t=await ui();_t.setup();const Zr=document.querySelector("model-viewer"),gs=document.querySelector("#input"),Yr=document.querySelector("#download"),ve=document.querySelector("#viewFinal"),_s=new xs(Zr,gs);let mt=null,It=null,Tt=!0,vt=!1;_s.on("drop",async({files:r})=>{for(const[e,t]of r)if(t.name.toLowerCase().match(/\.(gltf|glb)$/)){URL.revokeObjectURL(mt),mt=URL.createObjectURL(t),await ms(await Ts(mt)),Qr();break}});function Qr(){Tt?(ve.checked=!0,ve.disabled=!0):vt?(ve.checked=!1,ve.disabled=!1):(ve.checked=!1,ve.disabled=!0),Jr()}ve.onclick=Jr;function Jr(){Zr.src=ve.checked?It:mt,Yr.disabled=!ve.checked}Yr.onclick=function(){const r=document.createElement("a");r.download="manifold.glb",r.href=It,r.click()};async function ms(r){if(URL.revokeObjectURL(It),!vt)return;const e=await pn.writeBinary(r),t=new Blob([e],{type:"application/octet-stream"});It=URL.createObjectURL(t)}async function Ts(r){Tt=!1,vt=!1,Qr(),Tt=!0;const e=await pn.read(r),t=e.getRoot().listNodes();for(const n of t){const i=[],o=n.getMesh();if(!o)continue;const s=[],a=oi(o,i,s);a.runOriginalID=[];const f=_t.reserveIDs(s.length);for(let p=0;p<s.length;++p)a.runOriginalID.push(f+p);const d=new _t.Mesh(a);o.dispose(),d.merge();try{const p=_t.Manifold(d);n.setMesh(ai(e,p.getMesh(),i,s)),p.delete(),vt=!0}catch(p){console.log(o.getName(),p),Tt=!1}}return await e.transform(ci()),e}
