function go(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Os={exports:{}},Ai;function Xc(){return Ai||(Ai=1,(function(r){(e=>{var t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,o=(m,w)=>{for(var S in w)t(m,S,{get:w[S],enumerable:!0})},a=(m,w,S,H)=>{if(w&&typeof w=="object"||typeof w=="function")for(let ie of s(w))!i.call(m,ie)&&ie!==S&&t(m,ie,{get:()=>w[ie],enumerable:!(H=n(w,ie))||H.enumerable});return m},u=m=>a(t({},"__esModule",{value:!0}),m),f=(m,w,S)=>new Promise((H,ie)=>{var ce=Y=>{try{xe(S.next(Y))}catch(Fe){ie(Fe)}},te=Y=>{try{xe(S.throw(Y))}catch(Fe){ie(Fe)}},xe=Y=>Y.done?H(Y.value):Promise.resolve(Y.value).then(ce,te);xe((S=S.apply(m,w)).next())}),y={};o(y,{analyzeMetafile:()=>jr,analyzeMetafileSync:()=>vs,build:()=>Hn,buildSync:()=>tr,context:()=>Fn,default:()=>Bt,formatMessages:()=>er,formatMessagesSync:()=>xs,initialize:()=>ws,stop:()=>Es,transform:()=>fn,transformSync:()=>hn,version:()=>gr}),e.exports=u(y);function E(m){let w=H=>{if(H===null)S.write8(0);else if(typeof H=="boolean")S.write8(1),S.write8(+H);else if(typeof H=="number")S.write8(2),S.write32(H|0);else if(typeof H=="string")S.write8(3),S.write(N(H));else if(H instanceof Uint8Array)S.write8(4),S.write(H);else if(H instanceof Array){S.write8(5),S.write32(H.length);for(let ie of H)w(ie)}else{let ie=Object.keys(H);S.write8(6),S.write32(ie.length);for(let ce of ie)S.write(N(ce)),w(H[ce])}},S=new T;return S.write32(0),S.write32(m.id<<1|+!m.isRequest),w(m.value),U(S.buf,S.len-4,0),S.buf.subarray(0,S.len)}function d(m){let w=()=>{switch(S.read8()){case 0:return null;case 1:return!!S.read8();case 2:return S.read32();case 3:return V(S.read());case 4:return S.read();case 5:{let te=S.read32(),xe=[];for(let Y=0;Y<te;Y++)xe.push(w());return xe}case 6:{let te=S.read32(),xe={};for(let Y=0;Y<te;Y++)xe[V(S.read())]=w();return xe}default:throw new Error("Invalid packet")}},S=new T(m),H=S.read32(),ie=(H&1)===0;H>>>=1;let ce=w();if(S.ptr!==m.length)throw new Error("Invalid packet");return{id:H,isRequest:ie,value:ce}}var T=class{constructor(m=new Uint8Array(1024)){this.buf=m,this.len=0,this.ptr=0}_write(m){if(this.len+m>this.buf.length){let w=new Uint8Array((this.len+m)*2);w.set(this.buf),this.buf=w}return this.len+=m,this.len-m}write8(m){let w=this._write(1);this.buf[w]=m}write32(m){let w=this._write(4);U(this.buf,m,w)}write(m){let w=this._write(4+m.length);U(this.buf,m.length,w),this.buf.set(m,w+4)}_read(m){if(this.ptr+m>this.buf.length)throw new Error("Invalid packet");return this.ptr+=m,this.ptr-m}read8(){return this.buf[this._read(1)]}read32(){return x(this.buf,this._read(4))}read(){let m=this.read32(),w=new Uint8Array(m),S=this._read(w.length);return w.set(this.buf.subarray(S,S+m)),w}},N,V,W;if(typeof TextEncoder<"u"&&typeof TextDecoder<"u"){let m=new TextEncoder,w=new TextDecoder;N=S=>m.encode(S),V=S=>w.decode(S),W='new TextEncoder().encode("")'}else if(typeof Buffer<"u")N=m=>Buffer.from(m),V=m=>{let{buffer:w,byteOffset:S,byteLength:H}=m;return Buffer.from(w,S,H).toString()},W='Buffer.from("")';else throw new Error("No UTF-8 codec found");if(!(N("")instanceof Uint8Array))throw new Error(`Invariant violation: "${W} instanceof Uint8Array" is incorrectly false

This indicates that your JavaScript environment is broken. You cannot use
esbuild in this environment because esbuild relies on this invariant. This
is not a problem with esbuild. You need to fix your environment instead.
`);function x(m,w){return m[w++]|m[w++]<<8|m[w++]<<16|m[w++]<<24}function U(m,w,S){m[S++]=w,m[S++]=w>>8,m[S++]=w>>16,m[S++]=w>>24}var _=JSON.stringify,C="warning",F="silent";function B(m,w){const S=[];for(const H of m){if(Ve(H,w),H.indexOf(",")>=0)throw new Error(`Invalid ${w}: ${H}`);S.push(H)}return S.join(",")}var p=()=>null,R=m=>typeof m=="boolean"?null:"a boolean",b=m=>typeof m=="string"?null:"a string",$=m=>m instanceof RegExp?null:"a RegExp object",Q=m=>typeof m=="number"&&m===(m|0)?null:"an integer",ee=m=>typeof m=="number"&&m===(m|0)&&m>=0&&m<=65535?null:"a valid port number",fe=m=>typeof m=="function"?null:"a function",Ee=m=>Array.isArray(m)?null:"an array",me=m=>Array.isArray(m)&&m.every(w=>typeof w=="string")?null:"an array of strings",be=m=>typeof m=="object"&&m!==null&&!Array.isArray(m)?null:"an object",Ie=m=>typeof m=="object"&&m!==null?null:"an array or an object",He=m=>m instanceof WebAssembly.Module?null:"a WebAssembly.Module",We=m=>typeof m=="object"&&!Array.isArray(m)?null:"an object or null",kt=m=>typeof m=="string"||typeof m=="boolean"?null:"a string or a boolean",lt=m=>typeof m=="string"||typeof m=="object"&&m!==null&&!Array.isArray(m)?null:"a string or an object",Tt=m=>typeof m=="string"||Array.isArray(m)&&m.every(w=>typeof w=="string")?null:"a string or an array of strings",Et=m=>typeof m=="string"||m instanceof Uint8Array?null:"a string or a Uint8Array",tt=m=>typeof m=="string"||m instanceof URL?null:"a string or a URL";function A(m,w,S,H){let ie=m[S];if(w[S+""]=!0,ie===void 0)return;let ce=H(ie);if(ce!==null)throw new Error(`${_(S)} must be ${ce}`);return ie}function De(m,w,S){for(let H in m)if(!(H in w))throw new Error(`Invalid option ${S}: ${_(H)}`)}function Dn(m){let w=Object.create(null),S=A(m,w,"wasmURL",tt),H=A(m,w,"wasmModule",He),ie=A(m,w,"worker",R);return De(m,w,"in initialize() call"),{wasmURL:S,wasmModule:H,worker:ie}}function tn(m){let w;if(m!==void 0){w=Object.create(null);for(let S in m){let H=m[S];if(typeof H=="string"||H===!1)w[S]=H;else throw new Error(`Expected ${_(S)} in mangle cache to map to either a string or false`)}}return w}function _t(m,w,S,H,ie){let ce=A(w,S,"color",R),te=A(w,S,"logLevel",b),xe=A(w,S,"logLimit",Q);ce!==void 0?m.push(`--color=${ce}`):H&&m.push("--color=true"),m.push(`--log-level=${te||ie}`),m.push(`--log-limit=${xe||0}`)}function Ve(m,w,S){if(typeof m!="string")throw new Error(`Expected value for ${w}${S!==void 0?" "+_(S):""} to be a string, got ${typeof m} instead`);return m}function it(m,w,S){let H=A(w,S,"legalComments",b),ie=A(w,S,"sourceRoot",b),ce=A(w,S,"sourcesContent",R),te=A(w,S,"target",Tt),xe=A(w,S,"format",b),Y=A(w,S,"globalName",b),Fe=A(w,S,"mangleProps",$),Pe=A(w,S,"reserveProps",$),Re=A(w,S,"mangleQuoted",R),Be=A(w,S,"minify",R),Se=A(w,S,"minifySyntax",R),Le=A(w,S,"minifyWhitespace",R),$e=A(w,S,"minifyIdentifiers",R),ve=A(w,S,"lineLimit",Q),Qe=A(w,S,"drop",me),we=A(w,S,"dropLabels",me),ye=A(w,S,"charset",b),ae=A(w,S,"treeShaking",R),K=A(w,S,"ignoreAnnotations",R),D=A(w,S,"jsx",b),G=A(w,S,"jsxFactory",b),J=A(w,S,"jsxFragment",b),he=A(w,S,"jsxImportSource",b),ge=A(w,S,"jsxDev",R),X=A(w,S,"jsxSideEffects",R),ne=A(w,S,"define",be),v=A(w,S,"logOverride",be),L=A(w,S,"supported",be),le=A(w,S,"pure",me),de=A(w,S,"keepNames",R),_e=A(w,S,"platform",b),Oe=A(w,S,"tsconfigRaw",lt),Ke=A(w,S,"absPaths",me);if(H&&m.push(`--legal-comments=${H}`),ie!==void 0&&m.push(`--source-root=${ie}`),ce!==void 0&&m.push(`--sources-content=${ce}`),te&&m.push(`--target=${B(Array.isArray(te)?te:[te],"target")}`),xe&&m.push(`--format=${xe}`),Y&&m.push(`--global-name=${Y}`),_e&&m.push(`--platform=${_e}`),Oe&&m.push(`--tsconfig-raw=${typeof Oe=="string"?Oe:JSON.stringify(Oe)}`),Be&&m.push("--minify"),Se&&m.push("--minify-syntax"),Le&&m.push("--minify-whitespace"),$e&&m.push("--minify-identifiers"),ve&&m.push(`--line-limit=${ve}`),ye&&m.push(`--charset=${ye}`),ae!==void 0&&m.push(`--tree-shaking=${ae}`),K&&m.push("--ignore-annotations"),Qe)for(let pe of Qe)m.push(`--drop:${Ve(pe,"drop")}`);if(we&&m.push(`--drop-labels=${B(we,"drop label")}`),Ke&&m.push(`--abs-paths=${B(Ke,"abs paths")}`),Fe&&m.push(`--mangle-props=${un(Fe)}`),Pe&&m.push(`--reserve-props=${un(Pe)}`),Re!==void 0&&m.push(`--mangle-quoted=${Re}`),D&&m.push(`--jsx=${D}`),G&&m.push(`--jsx-factory=${G}`),J&&m.push(`--jsx-fragment=${J}`),he&&m.push(`--jsx-import-source=${he}`),ge&&m.push("--jsx-dev"),X&&m.push("--jsx-side-effects"),ne)for(let pe in ne){if(pe.indexOf("=")>=0)throw new Error(`Invalid define: ${pe}`);m.push(`--define:${pe}=${Ve(ne[pe],"define",pe)}`)}if(v)for(let pe in v){if(pe.indexOf("=")>=0)throw new Error(`Invalid log override: ${pe}`);m.push(`--log-override:${pe}=${Ve(v[pe],"log override",pe)}`)}if(L)for(let pe in L){if(pe.indexOf("=")>=0)throw new Error(`Invalid supported: ${pe}`);const ke=L[pe];if(typeof ke!="boolean")throw new Error(`Expected value for supported ${_(pe)} to be a boolean, got ${typeof ke} instead`);m.push(`--supported:${pe}=${ke}`)}if(le)for(let pe of le)m.push(`--pure:${Ve(pe,"pure")}`);de&&m.push("--keep-names")}function Mt(m,w,S,H,ie){var ce;let te=[],xe=[],Y=Object.create(null),Fe=null,Pe=null;_t(te,w,Y,S,H),it(te,w,Y);let Re=A(w,Y,"sourcemap",kt),Be=A(w,Y,"bundle",R),Se=A(w,Y,"splitting",R),Le=A(w,Y,"preserveSymlinks",R),$e=A(w,Y,"metafile",R),ve=A(w,Y,"outfile",b),Qe=A(w,Y,"outdir",b),we=A(w,Y,"outbase",b),ye=A(w,Y,"tsconfig",b),ae=A(w,Y,"resolveExtensions",me),K=A(w,Y,"nodePaths",me),D=A(w,Y,"mainFields",me),G=A(w,Y,"conditions",me),J=A(w,Y,"external",me),he=A(w,Y,"packages",b),ge=A(w,Y,"alias",be),X=A(w,Y,"loader",be),ne=A(w,Y,"outExtension",be),v=A(w,Y,"publicPath",b),L=A(w,Y,"entryNames",b),le=A(w,Y,"chunkNames",b),de=A(w,Y,"assetNames",b),_e=A(w,Y,"inject",me),Oe=A(w,Y,"banner",be),Ke=A(w,Y,"footer",be),pe=A(w,Y,"entryPoints",Ie),ke=A(w,Y,"absWorkingDir",b),je=A(w,Y,"stdin",be),Ne=(ce=A(w,Y,"write",R))!=null?ce:ie,dt=A(w,Y,"allowOverwrite",R),nt=A(w,Y,"mangleCache",be);if(Y.plugins=!0,De(w,Y,`in ${m}() call`),Re&&te.push(`--sourcemap${Re===!0?"":`=${Re}`}`),Be&&te.push("--bundle"),dt&&te.push("--allow-overwrite"),Se&&te.push("--splitting"),Le&&te.push("--preserve-symlinks"),$e&&te.push("--metafile"),ve&&te.push(`--outfile=${ve}`),Qe&&te.push(`--outdir=${Qe}`),we&&te.push(`--outbase=${we}`),ye&&te.push(`--tsconfig=${ye}`),he&&te.push(`--packages=${he}`),ae&&te.push(`--resolve-extensions=${B(ae,"resolve extension")}`),v&&te.push(`--public-path=${v}`),L&&te.push(`--entry-names=${L}`),le&&te.push(`--chunk-names=${le}`),de&&te.push(`--asset-names=${de}`),D&&te.push(`--main-fields=${B(D,"main field")}`),G&&te.push(`--conditions=${B(G,"condition")}`),J)for(let Te of J)te.push(`--external:${Ve(Te,"external")}`);if(ge)for(let Te in ge){if(Te.indexOf("=")>=0)throw new Error(`Invalid package name in alias: ${Te}`);te.push(`--alias:${Te}=${Ve(ge[Te],"alias",Te)}`)}if(Oe)for(let Te in Oe){if(Te.indexOf("=")>=0)throw new Error(`Invalid banner file type: ${Te}`);te.push(`--banner:${Te}=${Ve(Oe[Te],"banner",Te)}`)}if(Ke)for(let Te in Ke){if(Te.indexOf("=")>=0)throw new Error(`Invalid footer file type: ${Te}`);te.push(`--footer:${Te}=${Ve(Ke[Te],"footer",Te)}`)}if(_e)for(let Te of _e)te.push(`--inject:${Ve(Te,"inject")}`);if(X)for(let Te in X){if(Te.indexOf("=")>=0)throw new Error(`Invalid loader extension: ${Te}`);te.push(`--loader:${Te}=${Ve(X[Te],"loader",Te)}`)}if(ne)for(let Te in ne){if(Te.indexOf("=")>=0)throw new Error(`Invalid out extension: ${Te}`);te.push(`--out-extension:${Te}=${Ve(ne[Te],"out extension",Te)}`)}if(pe)if(Array.isArray(pe))for(let Te=0,qt=pe.length;Te<qt;Te++){let Rt=pe[Te];if(typeof Rt=="object"&&Rt!==null){let Dt=Object.create(null),Nt=A(Rt,Dt,"in",b),Ct=A(Rt,Dt,"out",b);if(De(Rt,Dt,"in entry point at index "+Te),Nt===void 0)throw new Error('Missing property "in" for entry point at index '+Te);if(Ct===void 0)throw new Error('Missing property "out" for entry point at index '+Te);xe.push([Ct,Nt])}else xe.push(["",Ve(Rt,"entry point at index "+Te)])}else for(let Te in pe)xe.push([Te,Ve(pe[Te],"entry point",Te)]);if(je){let Te=Object.create(null),qt=A(je,Te,"contents",Et),Rt=A(je,Te,"resolveDir",b),Dt=A(je,Te,"sourcefile",b),Nt=A(je,Te,"loader",b);De(je,Te,'in "stdin" object'),Dt&&te.push(`--sourcefile=${Dt}`),Nt&&te.push(`--loader=${Nt}`),Rt&&(Pe=Rt),typeof qt=="string"?Fe=N(qt):qt instanceof Uint8Array&&(Fe=qt)}let Lt=[];if(K)for(let Te of K)Te+="",Lt.push(Te);return{entries:xe,flags:te,write:Ne,stdinContents:Fe,stdinResolveDir:Pe,absWorkingDir:ke,nodePaths:Lt,mangleCache:tn(nt)}}function on(m,w,S,H){let ie=[],ce=Object.create(null);_t(ie,w,ce,S,H),it(ie,w,ce);let te=A(w,ce,"sourcemap",kt),xe=A(w,ce,"sourcefile",b),Y=A(w,ce,"loader",b),Fe=A(w,ce,"banner",b),Pe=A(w,ce,"footer",b),Re=A(w,ce,"mangleCache",be);return De(w,ce,`in ${m}() call`),te&&ie.push(`--sourcemap=${te===!0?"external":te}`),xe&&ie.push(`--sourcefile=${xe}`),Y&&ie.push(`--loader=${Y}`),Fe&&ie.push(`--banner=${Fe}`),Pe&&ie.push(`--footer=${Pe}`),{flags:ie,mangleCache:tn(Re)}}function Ot(m){const w={},S={didClose:!1,reason:""};let H={},ie=0,ce=0,te=new Uint8Array(16*1024),xe=0,Y=ye=>{let ae=xe+ye.length;if(ae>te.length){let D=new Uint8Array(ae*2);D.set(te),te=D}te.set(ye,xe),xe+=ye.length;let K=0;for(;K+4<=xe;){let D=x(te,K);if(K+4+D>xe)break;K+=4,Le(te.subarray(K,K+D)),K+=D}K>0&&(te.copyWithin(0,K,xe),xe-=K)},Fe=ye=>{S.didClose=!0,ye&&(S.reason=": "+(ye.message||ye));const ae="The service was stopped"+S.reason;for(let K in H)H[K](ae,null);H={}},Pe=(ye,ae,K)=>{if(S.didClose)return K("The service is no longer running"+S.reason,null);let D=ie++;H[D]=(G,J)=>{try{K(G,J)}finally{ye&&ye.unref()}},ye&&ye.ref(),m.writeToStdin(E({id:D,isRequest:!0,value:ae}))},Re=(ye,ae)=>{if(S.didClose)throw new Error("The service is no longer running"+S.reason);m.writeToStdin(E({id:ye,isRequest:!1,value:ae}))},Be=(ye,ae)=>f(null,null,function*(){try{if(ae.command==="ping"){Re(ye,{});return}if(typeof ae.key=="number"){const K=w[ae.key];if(!K)return;const D=K[ae.command];if(D){yield D(ye,ae);return}}throw new Error("Invalid command: "+ae.command)}catch(K){const D=[an(K,m,null,void 0,"")];try{Re(ye,{errors:D})}catch{}}}),Se=!0,Le=ye=>{if(Se){Se=!1;let K=String.fromCharCode(...ye);if(K!=="0.25.11")throw new Error(`Cannot start service: Host version "0.25.11" does not match binary version ${_(K)}`);return}let ae=d(ye);if(ae.isRequest)Be(ae.id,ae.value);else{let K=H[ae.id];delete H[ae.id],ae.value.error?K(ae.value.error,{}):K(null,ae.value)}};return{readFromStdout:Y,afterClose:Fe,service:{buildOrContext:({callName:ye,refs:ae,options:K,isTTY:D,defaultWD:G,callback:J})=>{let he=0;const ge=ce++,X={},ne={ref(){++he===1&&ae&&ae.ref()},unref(){--he===0&&(delete w[ge],ae&&ae.unref())}};w[ge]=X,ne.ref(),Ur(ye,ge,Pe,Re,ne,m,X,K,D,G,(v,L)=>{try{J(v,L)}finally{ne.unref()}})},transform:({callName:ye,refs:ae,input:K,options:D,isTTY:G,fs:J,callback:he})=>{const ge=pr();let X=ne=>{try{if(typeof K!="string"&&!(K instanceof Uint8Array))throw new Error('The input to "transform" must be a string or a Uint8Array');let{flags:v,mangleCache:L}=on(ye,D,G,F),le={command:"transform",flags:v,inputFS:ne!==null,input:ne!==null?N(ne):typeof K=="string"?N(K):K};L&&(le.mangleCache=L),Pe(ae,le,(de,_e)=>{if(de)return he(new Error(de),null);let Oe=gt(_e.errors,ge),Ke=gt(_e.warnings,ge),pe=1,ke=()=>{if(--pe===0){let je={warnings:Ke,code:_e.code,map:_e.map,mangleCache:void 0,legalComments:void 0};"legalComments"in _e&&(je.legalComments=_e?.legalComments),_e.mangleCache&&(je.mangleCache=_e?.mangleCache),he(null,je)}};if(Oe.length>0)return he(cn("Transform failed",Oe,Ke),null);_e.codeFS&&(pe++,J.readFile(_e.code,(je,Ne)=>{je!==null?he(je,null):(_e.code=Ne,ke())})),_e.mapFS&&(pe++,J.readFile(_e.map,(je,Ne)=>{je!==null?he(je,null):(_e.map=Ne,ke())})),ke()})}catch(v){let L=[];try{_t(L,D,{},G,F)}catch{}const le=an(v,m,ge,void 0,"");Pe(ae,{command:"error",flags:L,error:le},()=>{le.detail=ge.load(le.detail),he(cn("Transform failed",[le],[]),null)})}};if((typeof K=="string"||K instanceof Uint8Array)&&K.length>1024*1024){let ne=X;X=()=>J.writeFile(K,ne)}X(null)},formatMessages:({callName:ye,refs:ae,messages:K,options:D,callback:G})=>{if(!D)throw new Error(`Missing second argument in ${ye}() call`);let J={},he=A(D,J,"kind",b),ge=A(D,J,"color",R),X=A(D,J,"terminalWidth",Q);if(De(D,J,`in ${ye}() call`),he===void 0)throw new Error(`Missing "kind" in ${ye}() call`);if(he!=="error"&&he!=="warning")throw new Error(`Expected "kind" to be "error" or "warning" in ${ye}() call`);let ne={command:"format-msgs",messages:Xt(K,"messages",null,"",X),isWarning:he==="warning"};ge!==void 0&&(ne.color=ge),X!==void 0&&(ne.terminalWidth=X),Pe(ae,ne,(v,L)=>{if(v)return G(new Error(v),null);G(null,L.messages)})},analyzeMetafile:({callName:ye,refs:ae,metafile:K,options:D,callback:G})=>{D===void 0&&(D={});let J={},he=A(D,J,"color",R),ge=A(D,J,"verbose",R);De(D,J,`in ${ye}() call`);let X={command:"analyze-metafile",metafile:K};he!==void 0&&(X.color=he),ge!==void 0&&(X.verbose=ge),Pe(ae,X,(ne,v)=>{if(ne)return G(new Error(ne),null);G(null,v.result)})}}}}function Ur(m,w,S,H,ie,ce,te,xe,Y,Fe,Pe){const Re=pr(),Be=m==="context",Se=(ve,Qe)=>{const we=[];try{_t(we,xe,{},Y,C)}catch{}const ye=an(ve,ce,Re,void 0,Qe);S(ie,{command:"error",flags:we,error:ye},()=>{ye.detail=Re.load(ye.detail),Pe(cn(Be?"Context failed":"Build failed",[ye],[]),null)})};let Le;if(typeof xe=="object"){const ve=xe.plugins;if(ve!==void 0){if(!Array.isArray(ve))return Se(new Error('"plugins" must be an array'),"");Le=ve}}if(Le&&Le.length>0){if(ce.isSync)return Se(new Error("Cannot use plugins in synchronous API calls"),"");ms(w,S,H,ie,ce,te,xe,Le,Re).then(ve=>{if(!ve.ok)return Se(ve.error,ve.pluginName);try{$e(ve.requestPlugins,ve.runOnEndCallbacks,ve.scheduleOnDisposeCallbacks)}catch(Qe){Se(Qe,"")}},ve=>Se(ve,""));return}try{$e(null,(ve,Qe)=>Qe([],[]),()=>{})}catch(ve){Se(ve,"")}function $e(ve,Qe,we){const ye=ce.hasFS,{entries:ae,flags:K,write:D,stdinContents:G,stdinResolveDir:J,absWorkingDir:he,nodePaths:ge,mangleCache:X}=Mt(m,xe,Y,C,ye);if(D&&!ce.hasFS)throw new Error('The "write" option is unavailable in this environment');const ne={command:"build",key:w,entries:ae,flags:K,write:D,stdinContents:G,stdinResolveDir:J,absWorkingDir:he||Fe,nodePaths:ge,context:Be};ve&&(ne.plugins=ve),X&&(ne.mangleCache=X);const v=(de,_e)=>{const Oe={errors:gt(de.errors,Re),warnings:gt(de.warnings,Re),outputFiles:void 0,metafile:void 0,mangleCache:void 0},Ke=Oe.errors.slice(),pe=Oe.warnings.slice();de.outputFiles&&(Oe.outputFiles=de.outputFiles.map(Ts)),de.metafile&&(Oe.metafile=JSON.parse(de.metafile)),de.mangleCache&&(Oe.mangleCache=de.mangleCache),de.writeToStdout!==void 0&&console.log(V(de.writeToStdout).replace(/\n$/,"")),Qe(Oe,(ke,je)=>{if(Ke.length>0||ke.length>0){const Ne=cn("Build failed",Ke.concat(ke),pe.concat(je));return _e(Ne,null,ke,je)}_e(null,Oe,ke,je)})};let L,le;Be&&(te["on-end"]=(de,_e)=>new Promise(Oe=>{v(_e,(Ke,pe,ke,je)=>{const Ne={errors:ke,warnings:je};le&&le(Ke,pe),L=void 0,le=void 0,H(de,Ne),Oe()})})),S(ie,ne,(de,_e)=>{if(de)return Pe(new Error(de),null);if(!Be)return v(_e,(pe,ke)=>(we(),Pe(pe,ke)));if(_e.errors.length>0)return Pe(cn("Context failed",_e.errors,_e.warnings),null);let Oe=!1;const Ke={rebuild:()=>(L||(L=new Promise((pe,ke)=>{let je;le=(dt,nt)=>{je||(je=()=>dt?ke(dt):pe(nt))};const Ne=()=>{S(ie,{command:"rebuild",key:w},(nt,Lt)=>{nt?ke(new Error(nt)):je?je():Ne()})};Ne()})),L),watch:(pe={})=>new Promise((ke,je)=>{if(!ce.hasFS)throw new Error('Cannot use the "watch" API in this environment');const Ne={},dt=A(pe,Ne,"delay",Q);De(pe,Ne,"in watch() call");const nt={command:"watch",key:w};dt&&(nt.delay=dt),S(ie,nt,Lt=>{Lt?je(new Error(Lt)):ke(void 0)})}),serve:(pe={})=>new Promise((ke,je)=>{if(!ce.hasFS)throw new Error('Cannot use the "serve" API in this environment');const Ne={},dt=A(pe,Ne,"port",ee),nt=A(pe,Ne,"host",b),Lt=A(pe,Ne,"servedir",b),Te=A(pe,Ne,"keyfile",b),qt=A(pe,Ne,"certfile",b),Rt=A(pe,Ne,"fallback",b),Dt=A(pe,Ne,"cors",be),Nt=A(pe,Ne,"onRequest",fe);De(pe,Ne,"in serve() call");const Ct={command:"serve",key:w,onRequest:!!Nt};if(dt!==void 0&&(Ct.port=dt),nt!==void 0&&(Ct.host=nt),Lt!==void 0&&(Ct.servedir=Lt),Te!==void 0&&(Ct.keyfile=Te),qt!==void 0&&(Ct.certfile=qt),Rt!==void 0&&(Ct.fallback=Rt),Dt){const dn={},pn=A(Dt,dn,"origin",Tt);De(Dt,dn,'on "cors" object'),Array.isArray(pn)?Ct.corsOrigin=pn:pn!==void 0&&(Ct.corsOrigin=[pn])}S(ie,Ct,(dn,pn)=>{if(dn)return je(new Error(dn));Nt&&(te["serve-request"]=(Br,bs)=>{Nt(bs.args),H(Br,{})}),ke(pn)})}),cancel:()=>new Promise(pe=>{if(Oe)return pe();S(ie,{command:"cancel",key:w},()=>{pe()})}),dispose:()=>new Promise(pe=>{if(Oe)return pe();Oe=!0,S(ie,{command:"dispose",key:w},()=>{pe(),we(),ie.unref()})})};ie.ref(),Pe(null,Ke)})}}var ms=(m,w,S,H,ie,ce,te,xe,Y)=>f(null,null,function*(){let Fe=[],Pe=[],Re={},Be={},Se=[],Le=0,$e=0,ve=[],Qe=!1;xe=[...xe];for(let ae of xe){let K={};if(typeof ae!="object")throw new Error(`Plugin at index ${$e} must be an object`);const D=A(ae,K,"name",b);if(typeof D!="string"||D==="")throw new Error(`Plugin at index ${$e} is missing a name`);try{let G=A(ae,K,"setup",fe);if(typeof G!="function")throw new Error("Plugin is missing a setup function");De(ae,K,`on plugin ${_(D)}`);let J={name:D,onStart:!1,onEnd:!1,onResolve:[],onLoad:[]};$e++;let ge=G({initialOptions:te,resolve:(X,ne={})=>{if(!Qe)throw new Error('Cannot call "resolve" before plugin setup has completed');if(typeof X!="string")throw new Error("The path to resolve must be a string");let v=Object.create(null),L=A(ne,v,"pluginName",b),le=A(ne,v,"importer",b),de=A(ne,v,"namespace",b),_e=A(ne,v,"resolveDir",b),Oe=A(ne,v,"kind",b),Ke=A(ne,v,"pluginData",p),pe=A(ne,v,"with",be);return De(ne,v,"in resolve() call"),new Promise((ke,je)=>{const Ne={command:"resolve",path:X,key:m,pluginName:D};if(L!=null&&(Ne.pluginName=L),le!=null&&(Ne.importer=le),de!=null&&(Ne.namespace=de),_e!=null&&(Ne.resolveDir=_e),Oe!=null)Ne.kind=Oe;else throw new Error('Must specify "kind" when calling "resolve"');Ke!=null&&(Ne.pluginData=Y.store(Ke)),pe!=null&&(Ne.with=ys(pe,"with")),w(H,Ne,(dt,nt)=>{dt!==null?je(new Error(dt)):ke({errors:gt(nt.errors,Y),warnings:gt(nt.warnings,Y),path:nt.path,external:nt.external,sideEffects:nt.sideEffects,namespace:nt.namespace,suffix:nt.suffix,pluginData:Y.load(nt.pluginData)})})})},onStart(X){let ne='This error came from the "onStart" callback registered here:',v=Qn(new Error(ne),ie,"onStart");Fe.push({name:D,callback:X,note:v}),J.onStart=!0},onEnd(X){let ne='This error came from the "onEnd" callback registered here:',v=Qn(new Error(ne),ie,"onEnd");Pe.push({name:D,callback:X,note:v}),J.onEnd=!0},onResolve(X,ne){let v='This error came from the "onResolve" callback registered here:',L=Qn(new Error(v),ie,"onResolve"),le={},de=A(X,le,"filter",$),_e=A(X,le,"namespace",b);if(De(X,le,`in onResolve() call for plugin ${_(D)}`),de==null)throw new Error("onResolve() call is missing a filter");let Oe=Le++;Re[Oe]={name:D,callback:ne,note:L},J.onResolve.push({id:Oe,filter:un(de),namespace:_e||""})},onLoad(X,ne){let v='This error came from the "onLoad" callback registered here:',L=Qn(new Error(v),ie,"onLoad"),le={},de=A(X,le,"filter",$),_e=A(X,le,"namespace",b);if(De(X,le,`in onLoad() call for plugin ${_(D)}`),de==null)throw new Error("onLoad() call is missing a filter");let Oe=Le++;Be[Oe]={name:D,callback:ne,note:L},J.onLoad.push({id:Oe,filter:un(de),namespace:_e||""})},onDispose(X){Se.push(X)},esbuild:ie.esbuild});ge&&(yield ge),ve.push(J)}catch(G){return{ok:!1,error:G,pluginName:D}}}ce["on-start"]=(ae,K)=>f(null,null,function*(){Y.clear();let D={errors:[],warnings:[]};yield Promise.all(Fe.map(G=>f(null,[G],function*({name:J,callback:he,note:ge}){try{let X=yield he();if(X!=null){if(typeof X!="object")throw new Error(`Expected onStart() callback in plugin ${_(J)} to return an object`);let ne={},v=A(X,ne,"errors",Ee),L=A(X,ne,"warnings",Ee);De(X,ne,`from onStart() callback in plugin ${_(J)}`),v!=null&&D.errors.push(...Xt(v,"errors",Y,J,void 0)),L!=null&&D.warnings.push(...Xt(L,"warnings",Y,J,void 0))}}catch(X){D.errors.push(an(X,ie,Y,ge&&ge(),J))}}))),S(ae,D)}),ce["on-resolve"]=(ae,K)=>f(null,null,function*(){let D={},G="",J,he;for(let ge of K.ids)try{({name:G,callback:J,note:he}=Re[ge]);let X=yield J({path:K.path,importer:K.importer,namespace:K.namespace,resolveDir:K.resolveDir,kind:K.kind,pluginData:Y.load(K.pluginData),with:K.with});if(X!=null){if(typeof X!="object")throw new Error(`Expected onResolve() callback in plugin ${_(G)} to return an object`);let ne={},v=A(X,ne,"pluginName",b),L=A(X,ne,"path",b),le=A(X,ne,"namespace",b),de=A(X,ne,"suffix",b),_e=A(X,ne,"external",R),Oe=A(X,ne,"sideEffects",R),Ke=A(X,ne,"pluginData",p),pe=A(X,ne,"errors",Ee),ke=A(X,ne,"warnings",Ee),je=A(X,ne,"watchFiles",me),Ne=A(X,ne,"watchDirs",me);De(X,ne,`from onResolve() callback in plugin ${_(G)}`),D.id=ge,v!=null&&(D.pluginName=v),L!=null&&(D.path=L),le!=null&&(D.namespace=le),de!=null&&(D.suffix=de),_e!=null&&(D.external=_e),Oe!=null&&(D.sideEffects=Oe),Ke!=null&&(D.pluginData=Y.store(Ke)),pe!=null&&(D.errors=Xt(pe,"errors",Y,G,void 0)),ke!=null&&(D.warnings=Xt(ke,"warnings",Y,G,void 0)),je!=null&&(D.watchFiles=Gn(je,"watchFiles")),Ne!=null&&(D.watchDirs=Gn(Ne,"watchDirs"));break}}catch(X){D={id:ge,errors:[an(X,ie,Y,he&&he(),G)]};break}S(ae,D)}),ce["on-load"]=(ae,K)=>f(null,null,function*(){let D={},G="",J,he;for(let ge of K.ids)try{({name:G,callback:J,note:he}=Be[ge]);let X=yield J({path:K.path,namespace:K.namespace,suffix:K.suffix,pluginData:Y.load(K.pluginData),with:K.with});if(X!=null){if(typeof X!="object")throw new Error(`Expected onLoad() callback in plugin ${_(G)} to return an object`);let ne={},v=A(X,ne,"pluginName",b),L=A(X,ne,"contents",Et),le=A(X,ne,"resolveDir",b),de=A(X,ne,"pluginData",p),_e=A(X,ne,"loader",b),Oe=A(X,ne,"errors",Ee),Ke=A(X,ne,"warnings",Ee),pe=A(X,ne,"watchFiles",me),ke=A(X,ne,"watchDirs",me);De(X,ne,`from onLoad() callback in plugin ${_(G)}`),D.id=ge,v!=null&&(D.pluginName=v),L instanceof Uint8Array?D.contents=L:L!=null&&(D.contents=N(L)),le!=null&&(D.resolveDir=le),de!=null&&(D.pluginData=Y.store(de)),_e!=null&&(D.loader=_e),Oe!=null&&(D.errors=Xt(Oe,"errors",Y,G,void 0)),Ke!=null&&(D.warnings=Xt(Ke,"warnings",Y,G,void 0)),pe!=null&&(D.watchFiles=Gn(pe,"watchFiles")),ke!=null&&(D.watchDirs=Gn(ke,"watchDirs"));break}}catch(X){D={id:ge,errors:[an(X,ie,Y,he&&he(),G)]};break}S(ae,D)});let we=(ae,K)=>K([],[]);Pe.length>0&&(we=(ae,K)=>{f(null,null,function*(){const D=[],G=[];for(const{name:J,callback:he,note:ge}of Pe){let X,ne;try{const v=yield he(ae);if(v!=null){if(typeof v!="object")throw new Error(`Expected onEnd() callback in plugin ${_(J)} to return an object`);let L={},le=A(v,L,"errors",Ee),de=A(v,L,"warnings",Ee);De(v,L,`from onEnd() callback in plugin ${_(J)}`),le!=null&&(X=Xt(le,"errors",Y,J,void 0)),de!=null&&(ne=Xt(de,"warnings",Y,J,void 0))}}catch(v){X=[an(v,ie,Y,ge&&ge(),J)]}if(X){D.push(...X);try{ae.errors.push(...X)}catch{}}if(ne){G.push(...ne);try{ae.warnings.push(...ne)}catch{}}}K(D,G)})});let ye=()=>{for(const ae of Se)setTimeout(()=>ae(),0)};return Qe=!0,{ok:!0,requestPlugins:ve,runOnEndCallbacks:we,scheduleOnDisposeCallbacks:ye}});function pr(){const m=new Map;let w=0;return{clear(){m.clear()},load(S){return m.get(S)},store(S){if(S===void 0)return-1;const H=w++;return m.set(H,S),H}}}function Qn(m,w,S){let H,ie=!1;return()=>{if(ie)return H;ie=!0;try{let ce=(m.stack+"").split(`
`);ce.splice(1,1);let te=kr(w,ce,S);if(te)return H={text:m.message,location:te},H}catch{}}}function an(m,w,S,H,ie){let ce="Internal error",te=null;try{ce=(m&&m.message||m)+""}catch{}try{te=kr(w,(m.stack+"").split(`
`),"")}catch{}return{id:"",pluginName:ie,text:ce,location:te,notes:H?[H]:[],detail:S?S.store(m):-1}}function kr(m,w,S){let H="    at ";if(m.readFileSync&&!w[0].startsWith(H)&&w[1].startsWith(H))for(let ie=1;ie<w.length;ie++){let ce=w[ie];if(ce.startsWith(H))for(ce=ce.slice(H.length);;){let te=/^(?:new |async )?\S+ \((.*)\)$/.exec(ce);if(te){ce=te[1];continue}if(te=/^eval at \S+ \((.*)\)(?:, \S+:\d+:\d+)?$/.exec(ce),te){ce=te[1];continue}if(te=/^(\S+):(\d+):(\d+)$/.exec(ce),te){let xe;try{xe=m.readFileSync(te[1],"utf8")}catch{break}let Y=xe.split(/\r\n|\r|\n|\u2028|\u2029/)[+te[2]-1]||"",Fe=+te[3]-1,Pe=Y.slice(Fe,Fe+S.length)===S?S.length:0;return{file:te[1],namespace:"file",line:+te[2],column:N(Y.slice(0,Fe)).length,length:N(Y.slice(Fe,Fe+Pe)).length,lineText:Y+`
`+w.slice(1).join(`
`),suggestion:""}}break}}return null}function cn(m,w,S){let H=5;m+=w.length<1?"":` with ${w.length} error${w.length<2?"":"s"}:`+w.slice(0,H+1).map((ce,te)=>{if(te===H)return`
...`;if(!ce.location)return`
error: ${ce.text}`;let{file:xe,line:Y,column:Fe}=ce.location,Pe=ce.pluginName?`[plugin: ${ce.pluginName}] `:"";return`
${xe}:${Y}:${Fe}: ERROR: ${Pe}${ce.text}`}).join("");let ie=new Error(m);for(const[ce,te]of[["errors",w],["warnings",S]])Object.defineProperty(ie,ce,{configurable:!0,enumerable:!0,get:()=>te,set:xe=>Object.defineProperty(ie,ce,{configurable:!0,enumerable:!0,value:xe})});return ie}function gt(m,w){for(const S of m)S.detail=w.load(S.detail);return m}function ln(m,w,S){if(m==null)return null;let H={},ie=A(m,H,"file",b),ce=A(m,H,"namespace",b),te=A(m,H,"line",Q),xe=A(m,H,"column",Q),Y=A(m,H,"length",Q),Fe=A(m,H,"lineText",b),Pe=A(m,H,"suggestion",b);if(De(m,H,w),Fe){const Re=Fe.slice(0,(xe&&xe>0?xe:0)+(Y&&Y>0?Y:0)+(S&&S>0?S:80));!/[\x7F-\uFFFF]/.test(Re)&&!/\n/.test(Fe)&&(Fe=Re)}return{file:ie||"",namespace:ce||"",line:te||0,column:xe||0,length:Y||0,lineText:Fe||"",suggestion:Pe||""}}function Xt(m,w,S,H,ie){let ce=[],te=0;for(const xe of m){let Y={},Fe=A(xe,Y,"id",b),Pe=A(xe,Y,"pluginName",b),Re=A(xe,Y,"text",b),Be=A(xe,Y,"location",We),Se=A(xe,Y,"notes",Ee),Le=A(xe,Y,"detail",p),$e=`in element ${te} of "${w}"`;De(xe,Y,$e);let ve=[];if(Se)for(const Qe of Se){let we={},ye=A(Qe,we,"text",b),ae=A(Qe,we,"location",We);De(Qe,we,$e),ve.push({text:ye||"",location:ln(ae,$e,ie)})}ce.push({id:Fe||"",pluginName:Pe||H,text:Re||"",location:ln(Be,$e,ie),notes:ve,detail:S?S.store(Le):-1}),te++}return ce}function Gn(m,w){const S=[];for(const H of m){if(typeof H!="string")throw new Error(`${_(w)} must be an array of strings`);S.push(H)}return S}function ys(m,w){const S=Object.create(null);for(const H in m){const ie=m[H];if(typeof ie!="string")throw new Error(`key ${_(H)} in object ${_(w)} must be a string`);S[H]=ie}return S}function Ts({path:m,contents:w,hash:S}){let H=null;return{path:m,contents:w,hash:S,get text(){const ie=this.contents;return(H===null||ie!==w)&&(w=ie,H=V(ie)),H}}}function un(m){let w=m.source;return m.flags&&(w=`(?${m.flags})${w}`),w}var gr="0.25.11",Hn=m=>Ue().build(m),Fn=m=>Ue().context(m),fn=(m,w)=>Ue().transform(m,w),er=(m,w)=>Ue().formatMessages(m,w),jr=(m,w)=>Ue().analyzeMetafile(m,w),tr=()=>{throw new Error('The "buildSync" API only works in node')},hn=()=>{throw new Error('The "transformSync" API only works in node')},xs=()=>{throw new Error('The "formatMessagesSync" API only works in node')},vs=()=>{throw new Error('The "analyzeMetafileSync" API only works in node')},Es=()=>(ot&&ot(),Promise.resolve()),nn,ot,Kt,Ue=()=>{if(Kt)return Kt;throw nn?new Error('You need to wait for the promise returned from "initialize" to be resolved before calling this'):new Error('You need to call "initialize" before calling this')},ws=m=>{m=Dn(m||{});let w=m.wasmURL,S=m.wasmModule,H=m.worker!==!1;if(!w&&!S)throw new Error('Must provide either the "wasmURL" option or the "wasmModule" option');if(nn)throw new Error('Cannot call "initialize" more than once');return nn=jt(w||"",S,H),nn.catch(()=>{nn=void 0}),nn},jt=(m,w,S)=>f(null,null,function*(){let H,ie;const ce=new Promise(Re=>ie=Re);if(S){let Re=new Blob([`onmessage=((postMessage) => {
      // Copyright 2018 The Go Authors. All rights reserved.
      // Use of this source code is governed by a BSD-style
      // license that can be found in the LICENSE file.
      var __async = (__this, __arguments, generator) => {
        return new Promise((resolve, reject) => {
          var fulfilled = (value) => {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          };
          var rejected = (value) => {
            try {
              step(generator.throw(value));
            } catch (e) {
              reject(e);
            }
          };
          var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
          step((generator = generator.apply(__this, __arguments)).next());
        });
      };
      let onmessage;
      let globalThis = {};
      for (let o = self; o; o = Object.getPrototypeOf(o))
        for (let k of Object.getOwnPropertyNames(o))
          if (!(k in globalThis))
            Object.defineProperty(globalThis, k, { get: () => self[k] });
      "use strict";
      (() => {
        const enosys = () => {
          const err = new Error("not implemented");
          err.code = "ENOSYS";
          return err;
        };
        if (!globalThis.fs) {
          let outputBuf = "";
          globalThis.fs = {
            constants: { O_WRONLY: -1, O_RDWR: -1, O_CREAT: -1, O_TRUNC: -1, O_APPEND: -1, O_EXCL: -1 },
            // unused
            writeSync(fd, buf) {
              outputBuf += decoder.decode(buf);
              const nl = outputBuf.lastIndexOf("\\n");
              if (nl != -1) {
                console.log(outputBuf.substring(0, nl));
                outputBuf = outputBuf.substring(nl + 1);
              }
              return buf.length;
            },
            write(fd, buf, offset, length, position, callback) {
              if (offset !== 0 || length !== buf.length || position !== null) {
                callback(enosys());
                return;
              }
              const n = this.writeSync(fd, buf);
              callback(null, n);
            },
            chmod(path, mode, callback) {
              callback(enosys());
            },
            chown(path, uid, gid, callback) {
              callback(enosys());
            },
            close(fd, callback) {
              callback(enosys());
            },
            fchmod(fd, mode, callback) {
              callback(enosys());
            },
            fchown(fd, uid, gid, callback) {
              callback(enosys());
            },
            fstat(fd, callback) {
              callback(enosys());
            },
            fsync(fd, callback) {
              callback(null);
            },
            ftruncate(fd, length, callback) {
              callback(enosys());
            },
            lchown(path, uid, gid, callback) {
              callback(enosys());
            },
            link(path, link, callback) {
              callback(enosys());
            },
            lstat(path, callback) {
              callback(enosys());
            },
            mkdir(path, perm, callback) {
              callback(enosys());
            },
            open(path, flags, mode, callback) {
              callback(enosys());
            },
            read(fd, buffer, offset, length, position, callback) {
              callback(enosys());
            },
            readdir(path, callback) {
              callback(enosys());
            },
            readlink(path, callback) {
              callback(enosys());
            },
            rename(from, to, callback) {
              callback(enosys());
            },
            rmdir(path, callback) {
              callback(enosys());
            },
            stat(path, callback) {
              callback(enosys());
            },
            symlink(path, link, callback) {
              callback(enosys());
            },
            truncate(path, length, callback) {
              callback(enosys());
            },
            unlink(path, callback) {
              callback(enosys());
            },
            utimes(path, atime, mtime, callback) {
              callback(enosys());
            }
          };
        }
        if (!globalThis.process) {
          globalThis.process = {
            getuid() {
              return -1;
            },
            getgid() {
              return -1;
            },
            geteuid() {
              return -1;
            },
            getegid() {
              return -1;
            },
            getgroups() {
              throw enosys();
            },
            pid: -1,
            ppid: -1,
            umask() {
              throw enosys();
            },
            cwd() {
              throw enosys();
            },
            chdir() {
              throw enosys();
            }
          };
        }
        if (!globalThis.crypto) {
          throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");
        }
        if (!globalThis.performance) {
          throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");
        }
        if (!globalThis.TextEncoder) {
          throw new Error("globalThis.TextEncoder is not available, polyfill required");
        }
        if (!globalThis.TextDecoder) {
          throw new Error("globalThis.TextDecoder is not available, polyfill required");
        }
        const encoder = new TextEncoder("utf-8");
        const decoder = new TextDecoder("utf-8");
        globalThis.Go = class {
          constructor() {
            this.argv = ["js"];
            this.env = {};
            this.exit = (code) => {
              if (code !== 0) {
                console.warn("exit code:", code);
              }
            };
            this._exitPromise = new Promise((resolve) => {
              this._resolveExitPromise = resolve;
            });
            this._pendingEvent = null;
            this._scheduledTimeouts = /* @__PURE__ */ new Map();
            this._nextCallbackTimeoutID = 1;
            const setInt64 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
              this.mem.setUint32(addr + 4, Math.floor(v / 4294967296), true);
            };
            const setInt32 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
            };
            const getInt64 = (addr) => {
              const low = this.mem.getUint32(addr + 0, true);
              const high = this.mem.getInt32(addr + 4, true);
              return low + high * 4294967296;
            };
            const loadValue = (addr) => {
              const f = this.mem.getFloat64(addr, true);
              if (f === 0) {
                return void 0;
              }
              if (!isNaN(f)) {
                return f;
              }
              const id = this.mem.getUint32(addr, true);
              return this._values[id];
            };
            const storeValue = (addr, v) => {
              const nanHead = 2146959360;
              if (typeof v === "number" && v !== 0) {
                if (isNaN(v)) {
                  this.mem.setUint32(addr + 4, nanHead, true);
                  this.mem.setUint32(addr, 0, true);
                  return;
                }
                this.mem.setFloat64(addr, v, true);
                return;
              }
              if (v === void 0) {
                this.mem.setFloat64(addr, 0, true);
                return;
              }
              let id = this._ids.get(v);
              if (id === void 0) {
                id = this._idPool.pop();
                if (id === void 0) {
                  id = this._values.length;
                }
                this._values[id] = v;
                this._goRefCounts[id] = 0;
                this._ids.set(v, id);
              }
              this._goRefCounts[id]++;
              let typeFlag = 0;
              switch (typeof v) {
                case "object":
                  if (v !== null) {
                    typeFlag = 1;
                  }
                  break;
                case "string":
                  typeFlag = 2;
                  break;
                case "symbol":
                  typeFlag = 3;
                  break;
                case "function":
                  typeFlag = 4;
                  break;
              }
              this.mem.setUint32(addr + 4, nanHead | typeFlag, true);
              this.mem.setUint32(addr, id, true);
            };
            const loadSlice = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return new Uint8Array(this._inst.exports.mem.buffer, array, len);
            };
            const loadSliceOfValues = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              const a = new Array(len);
              for (let i = 0; i < len; i++) {
                a[i] = loadValue(array + i * 8);
              }
              return a;
            };
            const loadString = (addr) => {
              const saddr = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return decoder.decode(new DataView(this._inst.exports.mem.buffer, saddr, len));
            };
            const timeOrigin = Date.now() - performance.now();
            this.importObject = {
              _gotest: {
                add: (a, b) => a + b
              },
              gojs: {
                // Go's SP does not change as long as no Go code is running. Some operations (e.g. calls, getters and setters)
                // may synchronously trigger a Go event handler. This makes Go code get executed in the middle of the imported
                // function. A goroutine can switch to a new stack if the current stack is too small (see morestack function).
                // This changes the SP, thus we have to update the SP used by the imported function.
                // func wasmExit(code int32)
                "runtime.wasmExit": (sp) => {
                  sp >>>= 0;
                  const code = this.mem.getInt32(sp + 8, true);
                  this.exited = true;
                  delete this._inst;
                  delete this._values;
                  delete this._goRefCounts;
                  delete this._ids;
                  delete this._idPool;
                  this.exit(code);
                },
                // func wasmWrite(fd uintptr, p unsafe.Pointer, n int32)
                "runtime.wasmWrite": (sp) => {
                  sp >>>= 0;
                  const fd = getInt64(sp + 8);
                  const p = getInt64(sp + 16);
                  const n = this.mem.getInt32(sp + 24, true);
                  globalThis.fs.writeSync(fd, new Uint8Array(this._inst.exports.mem.buffer, p, n));
                },
                // func resetMemoryDataView()
                "runtime.resetMemoryDataView": (sp) => {
                  sp >>>= 0;
                  this.mem = new DataView(this._inst.exports.mem.buffer);
                },
                // func nanotime1() int64
                "runtime.nanotime1": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 8, (timeOrigin + performance.now()) * 1e6);
                },
                // func walltime() (sec int64, nsec int32)
                "runtime.walltime": (sp) => {
                  sp >>>= 0;
                  const msec = (/* @__PURE__ */ new Date()).getTime();
                  setInt64(sp + 8, msec / 1e3);
                  this.mem.setInt32(sp + 16, msec % 1e3 * 1e6, true);
                },
                // func scheduleTimeoutEvent(delay int64) int32
                "runtime.scheduleTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this._nextCallbackTimeoutID;
                  this._nextCallbackTimeoutID++;
                  this._scheduledTimeouts.set(id, setTimeout(
                    () => {
                      this._resume();
                      while (this._scheduledTimeouts.has(id)) {
                        console.warn("scheduleTimeoutEvent: missed timeout event");
                        this._resume();
                      }
                    },
                    getInt64(sp + 8)
                  ));
                  this.mem.setInt32(sp + 16, id, true);
                },
                // func clearTimeoutEvent(id int32)
                "runtime.clearTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getInt32(sp + 8, true);
                  clearTimeout(this._scheduledTimeouts.get(id));
                  this._scheduledTimeouts.delete(id);
                },
                // func getRandomData(r []byte)
                "runtime.getRandomData": (sp) => {
                  sp >>>= 0;
                  crypto.getRandomValues(loadSlice(sp + 8));
                },
                // func finalizeRef(v ref)
                "syscall/js.finalizeRef": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getUint32(sp + 8, true);
                  this._goRefCounts[id]--;
                  if (this._goRefCounts[id] === 0) {
                    const v = this._values[id];
                    this._values[id] = null;
                    this._ids.delete(v);
                    this._idPool.push(id);
                  }
                },
                // func stringVal(value string) ref
                "syscall/js.stringVal": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, loadString(sp + 8));
                },
                // func valueGet(v ref, p string) ref
                "syscall/js.valueGet": (sp) => {
                  sp >>>= 0;
                  const result = Reflect.get(loadValue(sp + 8), loadString(sp + 16));
                  sp = this._inst.exports.getsp() >>> 0;
                  storeValue(sp + 32, result);
                },
                // func valueSet(v ref, p string, x ref)
                "syscall/js.valueSet": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), loadString(sp + 16), loadValue(sp + 32));
                },
                // func valueDelete(v ref, p string)
                "syscall/js.valueDelete": (sp) => {
                  sp >>>= 0;
                  Reflect.deleteProperty(loadValue(sp + 8), loadString(sp + 16));
                },
                // func valueIndex(v ref, i int) ref
                "syscall/js.valueIndex": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, Reflect.get(loadValue(sp + 8), getInt64(sp + 16)));
                },
                // valueSetIndex(v ref, i int, x ref)
                "syscall/js.valueSetIndex": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), getInt64(sp + 16), loadValue(sp + 24));
                },
                // func valueCall(v ref, m string, args []ref) (ref, bool)
                "syscall/js.valueCall": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const m = Reflect.get(v, loadString(sp + 16));
                    const args = loadSliceOfValues(sp + 32);
                    const result = Reflect.apply(m, v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, result);
                    this.mem.setUint8(sp + 64, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, err);
                    this.mem.setUint8(sp + 64, 0);
                  }
                },
                // func valueInvoke(v ref, args []ref) (ref, bool)
                "syscall/js.valueInvoke": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.apply(v, void 0, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueNew(v ref, args []ref) (ref, bool)
                "syscall/js.valueNew": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.construct(v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueLength(v ref) int
                "syscall/js.valueLength": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 16, parseInt(loadValue(sp + 8).length));
                },
                // valuePrepareString(v ref) (ref, int)
                "syscall/js.valuePrepareString": (sp) => {
                  sp >>>= 0;
                  const str = encoder.encode(String(loadValue(sp + 8)));
                  storeValue(sp + 16, str);
                  setInt64(sp + 24, str.length);
                },
                // valueLoadString(v ref, b []byte)
                "syscall/js.valueLoadString": (sp) => {
                  sp >>>= 0;
                  const str = loadValue(sp + 8);
                  loadSlice(sp + 16).set(str);
                },
                // func valueInstanceOf(v ref, t ref) bool
                "syscall/js.valueInstanceOf": (sp) => {
                  sp >>>= 0;
                  this.mem.setUint8(sp + 24, loadValue(sp + 8) instanceof loadValue(sp + 16) ? 1 : 0);
                },
                // func copyBytesToGo(dst []byte, src ref) (int, bool)
                "syscall/js.copyBytesToGo": (sp) => {
                  sp >>>= 0;
                  const dst = loadSlice(sp + 8);
                  const src = loadValue(sp + 32);
                  if (!(src instanceof Uint8Array || src instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                // func copyBytesToJS(dst ref, src []byte) (int, bool)
                "syscall/js.copyBytesToJS": (sp) => {
                  sp >>>= 0;
                  const dst = loadValue(sp + 8);
                  const src = loadSlice(sp + 16);
                  if (!(dst instanceof Uint8Array || dst instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                "debug": (value) => {
                  console.log(value);
                }
              }
            };
          }
          run(instance) {
            return __async(this, null, function* () {
              if (!(instance instanceof WebAssembly.Instance)) {
                throw new Error("Go.run: WebAssembly.Instance expected");
              }
              this._inst = instance;
              this.mem = new DataView(this._inst.exports.mem.buffer);
              this._values = [
                // JS values that Go currently has references to, indexed by reference id
                NaN,
                0,
                null,
                true,
                false,
                globalThis,
                this
              ];
              this._goRefCounts = new Array(this._values.length).fill(Infinity);
              this._ids = /* @__PURE__ */ new Map([
                // mapping from JS values to reference ids
                [0, 1],
                [null, 2],
                [true, 3],
                [false, 4],
                [globalThis, 5],
                [this, 6]
              ]);
              this._idPool = [];
              this.exited = false;
              let offset = 4096;
              const strPtr = (str) => {
                const ptr = offset;
                const bytes = encoder.encode(str + "\\0");
                new Uint8Array(this.mem.buffer, offset, bytes.length).set(bytes);
                offset += bytes.length;
                if (offset % 8 !== 0) {
                  offset += 8 - offset % 8;
                }
                return ptr;
              };
              const argc = this.argv.length;
              const argvPtrs = [];
              this.argv.forEach((arg) => {
                argvPtrs.push(strPtr(arg));
              });
              argvPtrs.push(0);
              const keys = Object.keys(this.env).sort();
              keys.forEach((key) => {
                argvPtrs.push(strPtr(\`\${key}=\${this.env[key]}\`));
              });
              argvPtrs.push(0);
              const argv = offset;
              argvPtrs.forEach((ptr) => {
                this.mem.setUint32(offset, ptr, true);
                this.mem.setUint32(offset + 4, 0, true);
                offset += 8;
              });
              const wasmMinDataAddr = 4096 + 8192;
              if (offset >= wasmMinDataAddr) {
                throw new Error("total length of command line and environment variables exceeds limit");
              }
              this._inst.exports.run(argc, argv);
              if (this.exited) {
                this._resolveExitPromise();
              }
              yield this._exitPromise;
            });
          }
          _resume() {
            if (this.exited) {
              throw new Error("Go program has already exited");
            }
            this._inst.exports.resume();
            if (this.exited) {
              this._resolveExitPromise();
            }
          }
          _makeFuncWrapper(id) {
            const go = this;
            return function() {
              const event = { id, this: this, args: arguments };
              go._pendingEvent = event;
              go._resume();
              return event.result;
            };
          }
        };
      })();
      onmessage = ({ data: wasm }) => {
        let decoder = new TextDecoder();
        let fs = globalThis.fs;
        let stderr = "";
        fs.writeSync = (fd, buffer) => {
          if (fd === 1) {
            postMessage(buffer);
          } else if (fd === 2) {
            stderr += decoder.decode(buffer);
            let parts = stderr.split("\\n");
            if (parts.length > 1) console.log(parts.slice(0, -1).join("\\n"));
            stderr = parts[parts.length - 1];
          } else {
            throw new Error("Bad write");
          }
          return buffer.length;
        };
        let stdin = [];
        let resumeStdin;
        let stdinPos = 0;
        onmessage = ({ data }) => {
          if (data.length > 0) {
            stdin.push(data);
            if (resumeStdin) resumeStdin();
          }
          return go;
        };
        fs.read = (fd, buffer, offset, length, position, callback) => {
          if (fd !== 0 || offset !== 0 || length !== buffer.length || position !== null) {
            throw new Error("Bad read");
          }
          if (stdin.length === 0) {
            resumeStdin = () => fs.read(fd, buffer, offset, length, position, callback);
            return;
          }
          let first = stdin[0];
          let count = Math.max(0, Math.min(length, first.length - stdinPos));
          buffer.set(first.subarray(stdinPos, stdinPos + count), offset);
          stdinPos += count;
          if (stdinPos === first.length) {
            stdin.shift();
            stdinPos = 0;
          }
          callback(null, count);
        };
        let go = new globalThis.Go();
        go.argv = ["", \`--service=\${"0.25.11"}\`];
        tryToInstantiateModule(wasm, go).then(
          (instance) => {
            postMessage(null);
            go.run(instance);
          },
          (error) => {
            postMessage(error);
          }
        );
        return go;
      };
      function tryToInstantiateModule(wasm, go) {
        return __async(this, null, function* () {
          if (wasm instanceof WebAssembly.Module) {
            return WebAssembly.instantiate(wasm, go.importObject);
          }
          const res = yield fetch(wasm);
          if (!res.ok) throw new Error(\`Failed to download \${JSON.stringify(wasm)}\`);
          if ("instantiateStreaming" in WebAssembly && /^application\\/wasm($|;)/i.test(res.headers.get("Content-Type") || "")) {
            const result2 = yield WebAssembly.instantiateStreaming(res, go.importObject);
            return result2.instance;
          }
          const bytes = yield res.arrayBuffer();
          const result = yield WebAssembly.instantiate(bytes, go.importObject);
          return result.instance;
        });
      }
      return (m) => onmessage(m);
    })(postMessage)`],{type:"text/javascript"});H=new Worker(URL.createObjectURL(Re))}else{let Re=(Se=>{var Le=(we,ye,ae)=>new Promise((K,D)=>{var G=ge=>{try{he(ae.next(ge))}catch(X){D(X)}},J=ge=>{try{he(ae.throw(ge))}catch(X){D(X)}},he=ge=>ge.done?K(ge.value):Promise.resolve(ge.value).then(G,J);he((ae=ae.apply(we,ye)).next())});let $e,ve={};for(let we=self;we;we=Object.getPrototypeOf(we))for(let ye of Object.getOwnPropertyNames(we))ye in ve||Object.defineProperty(ve,ye,{get:()=>self[ye]});(()=>{const we=()=>{const K=new Error("not implemented");return K.code="ENOSYS",K};if(!ve.fs){let K="";ve.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(D,G){K+=ae.decode(G);const J=K.lastIndexOf(`
`);return J!=-1&&(console.log(K.substring(0,J)),K=K.substring(J+1)),G.length},write(D,G,J,he,ge,X){if(J!==0||he!==G.length||ge!==null){X(we());return}const ne=this.writeSync(D,G);X(null,ne)},chmod(D,G,J){J(we())},chown(D,G,J,he){he(we())},close(D,G){G(we())},fchmod(D,G,J){J(we())},fchown(D,G,J,he){he(we())},fstat(D,G){G(we())},fsync(D,G){G(null)},ftruncate(D,G,J){J(we())},lchown(D,G,J,he){he(we())},link(D,G,J){J(we())},lstat(D,G){G(we())},mkdir(D,G,J){J(we())},open(D,G,J,he){he(we())},read(D,G,J,he,ge,X){X(we())},readdir(D,G){G(we())},readlink(D,G){G(we())},rename(D,G,J){J(we())},rmdir(D,G){G(we())},stat(D,G){G(we())},symlink(D,G,J){J(we())},truncate(D,G,J){J(we())},unlink(D,G){G(we())},utimes(D,G,J,he){he(we())}}}if(ve.process||(ve.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw we()},pid:-1,ppid:-1,umask(){throw we()},cwd(){throw we()},chdir(){throw we()}}),!ve.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!ve.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!ve.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!ve.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const ye=new TextEncoder("utf-8"),ae=new TextDecoder("utf-8");ve.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=v=>{v!==0&&console.warn("exit code:",v)},this._exitPromise=new Promise(v=>{this._resolveExitPromise=v}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const K=(v,L)=>{this.mem.setUint32(v+0,L,!0),this.mem.setUint32(v+4,Math.floor(L/4294967296),!0)},D=v=>{const L=this.mem.getUint32(v+0,!0),le=this.mem.getInt32(v+4,!0);return L+le*4294967296},G=v=>{const L=this.mem.getFloat64(v,!0);if(L===0)return;if(!isNaN(L))return L;const le=this.mem.getUint32(v,!0);return this._values[le]},J=(v,L)=>{if(typeof L=="number"&&L!==0){if(isNaN(L)){this.mem.setUint32(v+4,2146959360,!0),this.mem.setUint32(v,0,!0);return}this.mem.setFloat64(v,L,!0);return}if(L===void 0){this.mem.setFloat64(v,0,!0);return}let de=this._ids.get(L);de===void 0&&(de=this._idPool.pop(),de===void 0&&(de=this._values.length),this._values[de]=L,this._goRefCounts[de]=0,this._ids.set(L,de)),this._goRefCounts[de]++;let _e=0;switch(typeof L){case"object":L!==null&&(_e=1);break;case"string":_e=2;break;case"symbol":_e=3;break;case"function":_e=4;break}this.mem.setUint32(v+4,2146959360|_e,!0),this.mem.setUint32(v,de,!0)},he=v=>{const L=D(v+0),le=D(v+8);return new Uint8Array(this._inst.exports.mem.buffer,L,le)},ge=v=>{const L=D(v+0),le=D(v+8),de=new Array(le);for(let _e=0;_e<le;_e++)de[_e]=G(L+_e*8);return de},X=v=>{const L=D(v+0),le=D(v+8);return ae.decode(new DataView(this._inst.exports.mem.buffer,L,le))},ne=Date.now()-performance.now();this.importObject={_gotest:{add:(v,L)=>v+L},gojs:{"runtime.wasmExit":v=>{v>>>=0;const L=this.mem.getInt32(v+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(L)},"runtime.wasmWrite":v=>{v>>>=0;const L=D(v+8),le=D(v+16),de=this.mem.getInt32(v+24,!0);ve.fs.writeSync(L,new Uint8Array(this._inst.exports.mem.buffer,le,de))},"runtime.resetMemoryDataView":v=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":v=>{v>>>=0,K(v+8,(ne+performance.now())*1e6)},"runtime.walltime":v=>{v>>>=0;const L=new Date().getTime();K(v+8,L/1e3),this.mem.setInt32(v+16,L%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":v=>{v>>>=0;const L=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(L,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(L);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},D(v+8))),this.mem.setInt32(v+16,L,!0)},"runtime.clearTimeoutEvent":v=>{v>>>=0;const L=this.mem.getInt32(v+8,!0);clearTimeout(this._scheduledTimeouts.get(L)),this._scheduledTimeouts.delete(L)},"runtime.getRandomData":v=>{v>>>=0,crypto.getRandomValues(he(v+8))},"syscall/js.finalizeRef":v=>{v>>>=0;const L=this.mem.getUint32(v+8,!0);if(this._goRefCounts[L]--,this._goRefCounts[L]===0){const le=this._values[L];this._values[L]=null,this._ids.delete(le),this._idPool.push(L)}},"syscall/js.stringVal":v=>{v>>>=0,J(v+24,X(v+8))},"syscall/js.valueGet":v=>{v>>>=0;const L=Reflect.get(G(v+8),X(v+16));v=this._inst.exports.getsp()>>>0,J(v+32,L)},"syscall/js.valueSet":v=>{v>>>=0,Reflect.set(G(v+8),X(v+16),G(v+32))},"syscall/js.valueDelete":v=>{v>>>=0,Reflect.deleteProperty(G(v+8),X(v+16))},"syscall/js.valueIndex":v=>{v>>>=0,J(v+24,Reflect.get(G(v+8),D(v+16)))},"syscall/js.valueSetIndex":v=>{v>>>=0,Reflect.set(G(v+8),D(v+16),G(v+24))},"syscall/js.valueCall":v=>{v>>>=0;try{const L=G(v+8),le=Reflect.get(L,X(v+16)),de=ge(v+32),_e=Reflect.apply(le,L,de);v=this._inst.exports.getsp()>>>0,J(v+56,_e),this.mem.setUint8(v+64,1)}catch(L){v=this._inst.exports.getsp()>>>0,J(v+56,L),this.mem.setUint8(v+64,0)}},"syscall/js.valueInvoke":v=>{v>>>=0;try{const L=G(v+8),le=ge(v+16),de=Reflect.apply(L,void 0,le);v=this._inst.exports.getsp()>>>0,J(v+40,de),this.mem.setUint8(v+48,1)}catch(L){v=this._inst.exports.getsp()>>>0,J(v+40,L),this.mem.setUint8(v+48,0)}},"syscall/js.valueNew":v=>{v>>>=0;try{const L=G(v+8),le=ge(v+16),de=Reflect.construct(L,le);v=this._inst.exports.getsp()>>>0,J(v+40,de),this.mem.setUint8(v+48,1)}catch(L){v=this._inst.exports.getsp()>>>0,J(v+40,L),this.mem.setUint8(v+48,0)}},"syscall/js.valueLength":v=>{v>>>=0,K(v+16,parseInt(G(v+8).length))},"syscall/js.valuePrepareString":v=>{v>>>=0;const L=ye.encode(String(G(v+8)));J(v+16,L),K(v+24,L.length)},"syscall/js.valueLoadString":v=>{v>>>=0;const L=G(v+8);he(v+16).set(L)},"syscall/js.valueInstanceOf":v=>{v>>>=0,this.mem.setUint8(v+24,G(v+8)instanceof G(v+16)?1:0)},"syscall/js.copyBytesToGo":v=>{v>>>=0;const L=he(v+8),le=G(v+32);if(!(le instanceof Uint8Array||le instanceof Uint8ClampedArray)){this.mem.setUint8(v+48,0);return}const de=le.subarray(0,L.length);L.set(de),K(v+40,de.length),this.mem.setUint8(v+48,1)},"syscall/js.copyBytesToJS":v=>{v>>>=0;const L=G(v+8),le=he(v+16);if(!(L instanceof Uint8Array||L instanceof Uint8ClampedArray)){this.mem.setUint8(v+48,0);return}const de=le.subarray(0,L.length);L.set(de),K(v+40,de.length),this.mem.setUint8(v+48,1)},debug:v=>{console.log(v)}}}}run(K){return Le(this,null,function*(){if(!(K instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=K,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,ve,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[ve,5],[this,6]]),this._idPool=[],this.exited=!1;let D=4096;const G=v=>{const L=D,le=ye.encode(v+"\0");return new Uint8Array(this.mem.buffer,D,le.length).set(le),D+=le.length,D%8!==0&&(D+=8-D%8),L},J=this.argv.length,he=[];this.argv.forEach(v=>{he.push(G(v))}),he.push(0),Object.keys(this.env).sort().forEach(v=>{he.push(G(`${v}=${this.env[v]}`))}),he.push(0);const X=D;if(he.forEach(v=>{this.mem.setUint32(D,v,!0),this.mem.setUint32(D+4,0,!0),D+=8}),D>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(J,X),this.exited&&this._resolveExitPromise(),yield this._exitPromise})}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(K){const D=this;return function(){const G={id:K,this:this,args:arguments};return D._pendingEvent=G,D._resume(),G.result}}}})(),$e=({data:we})=>{let ye=new TextDecoder,ae=ve.fs,K="";ae.writeSync=(ge,X)=>{if(ge===1)Se(X);else if(ge===2){K+=ye.decode(X);let ne=K.split(`
`);ne.length>1&&console.log(ne.slice(0,-1).join(`
`)),K=ne[ne.length-1]}else throw new Error("Bad write");return X.length};let D=[],G,J=0;$e=({data:ge})=>(ge.length>0&&(D.push(ge),G&&G()),he),ae.read=(ge,X,ne,v,L,le)=>{if(ge!==0||ne!==0||v!==X.length||L!==null)throw new Error("Bad read");if(D.length===0){G=()=>ae.read(ge,X,ne,v,L,le);return}let de=D[0],_e=Math.max(0,Math.min(v,de.length-J));X.set(de.subarray(J,J+_e),ne),J+=_e,J===de.length&&(D.shift(),J=0),le(null,_e)};let he=new ve.Go;return he.argv=["","--service=0.25.11"],Qe(we,he).then(ge=>{Se(null),he.run(ge)},ge=>{Se(ge)}),he};function Qe(we,ye){return Le(this,null,function*(){if(we instanceof WebAssembly.Module)return WebAssembly.instantiate(we,ye.importObject);const ae=yield fetch(we);if(!ae.ok)throw new Error(`Failed to download ${JSON.stringify(we)}`);if("instantiateStreaming"in WebAssembly&&/^application\/wasm($|;)/i.test(ae.headers.get("Content-Type")||""))return(yield WebAssembly.instantiateStreaming(ae,ye.importObject)).instance;const K=yield ae.arrayBuffer();return(yield WebAssembly.instantiate(K,ye.importObject)).instance})}return we=>$e(we)})(Se=>H.onmessage({data:Se})),Be;H={onmessage:null,postMessage:Se=>setTimeout(()=>{try{Be=Re({data:Se})}catch(Le){ie(Le)}}),terminate(){if(Be)for(let Se of Be._scheduledTimeouts.values())clearTimeout(Se)}}}let te,xe;const Y=new Promise((Re,Be)=>{te=Re,xe=Be});H.onmessage=({data:Re})=>{H.onmessage=({data:Be})=>Fe(Be),Re?xe(Re):te()},H.postMessage(w||new URL(m,location.href).toString());let{readFromStdout:Fe,service:Pe}=Ot({writeToStdin(Re){H.postMessage(Re)},isSync:!1,hasFS:!1,esbuild:y});yield Y,ot=()=>{H.terminate(),nn=void 0,ot=void 0,Kt=void 0},Kt={build:Re=>new Promise((Be,Se)=>{ce.then(Se),Pe.buildOrContext({callName:"build",refs:null,options:Re,isTTY:!1,defaultWD:"/",callback:(Le,$e)=>Le?Se(Le):Be($e)})}),context:Re=>new Promise((Be,Se)=>{ce.then(Se),Pe.buildOrContext({callName:"context",refs:null,options:Re,isTTY:!1,defaultWD:"/",callback:(Le,$e)=>Le?Se(Le):Be($e)})}),transform:(Re,Be)=>new Promise((Se,Le)=>{ce.then(Le),Pe.transform({callName:"transform",refs:null,input:Re,options:Be||{},isTTY:!1,fs:{readFile($e,ve){ve(new Error("Internal error"),null)},writeFile($e,ve){ve(null)}},callback:($e,ve)=>$e?Le($e):Se(ve)})}),formatMessages:(Re,Be)=>new Promise((Se,Le)=>{ce.then(Le),Pe.formatMessages({callName:"formatMessages",refs:null,messages:Re,options:Be,callback:($e,ve)=>$e?Le($e):Se(ve)})}),analyzeMetafile:(Re,Be)=>new Promise((Se,Le)=>{ce.then(Le),Pe.analyzeMetafile({callName:"analyzeMetafile",refs:null,metafile:typeof Re=="string"?Re:JSON.stringify(Re),options:Be,callback:($e,ve)=>$e?Le($e):Se(ve)})})}}),Bt=y})(r)})(Os)),Os.exports}var mo=Xc();class yo extends Error{location;error;constructor(e,t){super(void 0,t),this.cause=e,this.error=e.errors[0]}get name(){return"BundlerError"}get message(){return this.error.text}get stack(){if(!this.error.location)return;const{file:e,line:t,column:n}=this.error.location;return`${this.toString()}
    at ${e}:${t}:${n}`}}class Kr extends Error{manifoldStack;cause;constructor(e,t,n){super(t??e.message,n),this.cause=e}get name(){return this.cause.name}get message(){return this.cause.message}get stack(){return this.manifoldStack}}var Kc=44,Mi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qc=new Uint8Array(64),To=new Uint8Array(128);for(let r=0;r<Mi.length;r++){const e=Mi.charCodeAt(r);qc[r]=e,To[e]=r}function Tr(r,e){let t=0,n=0,s=0;do{const o=r.next();s=To[o],t|=(s&31)<<n,n+=5}while(s&32);const i=t&1;return t>>>=1,i&&(t=-2147483648|-t),e+t}function Ni(r,e){return r.pos>=e?!1:r.peek()!==Kc}var Yc=class{constructor(r){this.pos=0,this.buffer=r}next(){return this.buffer.charCodeAt(this.pos++)}peek(){return this.buffer.charCodeAt(this.pos)}indexOf(r){const{buffer:e,pos:t}=this,n=e.indexOf(r,t);return n===-1?e.length:n}};function Jc(r){const{length:e}=r,t=new Yc(r),n=[];let s=0,i=0,o=0,a=0,u=0;do{const f=t.indexOf(";"),y=[];let E=!0,d=0;for(s=0;t.pos<f;){let T;s=Tr(t,s),s<d&&(E=!1),d=s,Ni(t,f)?(i=Tr(t,i),o=Tr(t,o),a=Tr(t,a),Ni(t,f)?(u=Tr(t,u),T=[s,i,o,a,u]):T=[s,i,o,a]):T=[s],y.push(T),t.pos++}E||Zc(y),n.push(y),t.pos=f+1}while(t.pos<=e);return n}function Zc(r){r.sort(Qc)}function Qc(r,e){return r[0]-e[0]}var qr={exports:{}},el=qr.exports,Ci;function tl(){return Ci||(Ci=1,(function(r,e){(function(t,n){r.exports=n()})(el,(function(){const t=/^[\w+.-]+:\/\//,n=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,s=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function i(U){return t.test(U)}function o(U){return U.startsWith("//")}function a(U){return U.startsWith("/")}function u(U){return U.startsWith("file:")}function f(U){return/^[.?#]/.test(U)}function y(U){const _=n.exec(U);return d(_[1],_[2]||"",_[3],_[4]||"",_[5]||"/",_[6]||"",_[7]||"")}function E(U){const _=s.exec(U),C=_[2];return d("file:","",_[1]||"","",a(C)?C:"/"+C,_[3]||"",_[4]||"")}function d(U,_,C,F,B,p,R){return{scheme:U,user:_,host:C,port:F,path:B,query:p,hash:R,type:7}}function T(U){if(o(U)){const C=y("http:"+U);return C.scheme="",C.type=6,C}if(a(U)){const C=y("http://foo.com"+U);return C.scheme="",C.host="",C.type=5,C}if(u(U))return E(U);if(i(U))return y(U);const _=y("http://foo.com/"+U);return _.scheme="",_.host="",_.type=U?U.startsWith("?")?3:U.startsWith("#")?2:4:1,_}function N(U){if(U.endsWith("/.."))return U;const _=U.lastIndexOf("/");return U.slice(0,_+1)}function V(U,_){W(_,_.type),U.path==="/"?U.path=_.path:U.path=N(_.path)+U.path}function W(U,_){const C=_<=4,F=U.path.split("/");let B=1,p=0,R=!1;for(let $=1;$<F.length;$++){const Q=F[$];if(!Q){R=!0;continue}if(R=!1,Q!=="."){if(Q===".."){p?(R=!0,p--,B--):C&&(F[B++]=Q);continue}F[B++]=Q,p++}}let b="";for(let $=1;$<B;$++)b+="/"+F[$];(!b||R&&!b.endsWith("/.."))&&(b+="/"),U.path=b}function x(U,_){if(!U&&!_)return"";const C=T(U);let F=C.type;if(_&&F!==7){const p=T(_),R=p.type;switch(F){case 1:C.hash=p.hash;case 2:C.query=p.query;case 3:case 4:V(C,p);case 5:C.user=p.user,C.host=p.host,C.port=p.port;case 6:C.scheme=p.scheme}R>F&&(F=R)}W(C,F);const B=C.query+C.hash;switch(F){case 2:case 3:return B;case 4:{const p=C.path.slice(1);return p?f(_||U)&&!f(p)?"./"+p+B:p+B:B||"."}case 5:return C.path+B;default:return C.scheme+"//"+C.user+C.host+C.port+C.path+B}}return x}))})(qr)),qr.exports}var nl=tl(),rl=go(nl);function sl(r){if(!r)return"";const e=r.lastIndexOf("/");return r.slice(0,e+1)}function il(r,e){const t=sl(r),n=e?e+"/":"";return s=>rl(n+(s||""),t)}var Ln=0,ol=1,al=2,cl=3,ll=4;function ul(r,e){const t=Oi(r,0);if(t===r.length)return r;e||(r=r.slice());for(let n=t;n<r.length;n=Oi(r,n+1))r[n]=hl(r[n],e);return r}function Oi(r,e){for(let t=e;t<r.length;t++)if(!fl(r[t]))return t;return r.length}function fl(r){for(let e=1;e<r.length;e++)if(r[e][Ln]<r[e-1][Ln])return!1;return!0}function hl(r,e){return e||(r=r.slice()),r.sort(dl)}function dl(r,e){return r[Ln]-e[Ln]}var ts=!1;function pl(r,e,t,n){for(;t<=n;){const s=t+(n-t>>1),i=r[s][Ln]-e;if(i===0)return ts=!0,s;i<0?t=s+1:n=s-1}return ts=!1,t-1}function gl(r,e,t){for(let n=t+1;n<r.length&&r[n][Ln]===e;t=n++);return t}function ml(r,e,t){for(let n=t-1;n>=0&&r[n][Ln]===e;t=n--);return t}function yl(){return{lastKey:-1,lastNeedle:-1,lastIndex:-1}}function Tl(r,e,t,n){const{lastKey:s,lastNeedle:i,lastIndex:o}=t;let a=0,u=r.length-1;if(n===s){if(e===i)return ts=o!==-1&&r[o][Ln]===e,o;e>=i?a=o===-1?0:o:u=o}return t.lastKey=n,t.lastNeedle=e,t.lastIndex=pl(r,e,a,u)}function xl(r){return typeof r=="string"?JSON.parse(r):r}var vl="`line` must be greater than 0 (lines start at line 1)",El="`column` must be greater than or equal to 0 (columns start at column 0)",Di=-1,wl=1,bl=class{constructor(r,e){const t=typeof r=="string";if(!t&&r._decodedMemo)return r;const n=xl(r),{version:s,file:i,names:o,sourceRoot:a,sources:u,sourcesContent:f}=n;this.version=s,this.file=i,this.names=o||[],this.sourceRoot=a,this.sources=u,this.sourcesContent=f,this.ignoreList=n.ignoreList||n.x_google_ignoreList||void 0;const y=il(e,a);this.resolvedSources=u.map(y);const{mappings:E}=n;if(typeof E=="string")this._encoded=E,this._decoded=void 0;else if(Array.isArray(E))this._encoded=void 0,this._decoded=ul(E,t);else throw n.sections?new Error("TraceMap passed sectioned source map, please use FlattenMap export instead"):new Error(`invalid source map: ${JSON.stringify(n)}`);this._decodedMemo=yl(),this._bySources=void 0,this._bySourceMemos=void 0}};function _l(r){var e;return(e=r)._decoded||(e._decoded=Jc(r._encoded))}function Rl(r,e){let{line:t,column:n,bias:s}=e;if(t--,t<0)throw new Error(vl);if(n<0)throw new Error(El);const i=_l(r);if(t>=i.length)return Vr(null,null,null,null);const o=i[t],a=Il(o,r._decodedMemo,t,n,s||wl);if(a===-1)return Vr(null,null,null,null);const u=o[a];if(u.length===1)return Vr(null,null,null,null);const{names:f,resolvedSources:y}=r;return Vr(y[u[ol]],u[al]+1,u[cl],u.length===5?f[u[ll]]:null)}function Vr(r,e,t,n){return{source:r,line:e,column:t,name:n}}function Il(r,e,t,n,s){let i=Tl(r,n,e,t);return ts?i=(s===Di?gl:ml)(r,n,i):s===Di&&i++,i===-1||i===r.length?-1:i}var Ds={},Fi;function Sl(){return Fi||(Fi=1,(function(r){Object.defineProperty(r,"commentRegex",{get:function(){return/^\s*?\/[\/\*][@#]\s+?sourceMappingURL=data:(((?:application|text)\/json)(?:;charset=([^;,]+?)?)?)?(?:;(base64))?,(.*?)$/mg}}),Object.defineProperty(r,"mapFileCommentRegex",{get:function(){return/(?:\/\/[@#][ \t]+?sourceMappingURL=([^\s'"`]+?)[ \t]*?$)|(?:\/\*[@#][ \t]+sourceMappingURL=([^*]+?)[ \t]*?(?:\*\/){1}[ \t]*?$)/mg}});var e;typeof Buffer<"u"?typeof Buffer.from=="function"?e=t:e=n:e=s;function t(d){return Buffer.from(d,"base64").toString()}function n(d){if(typeof value=="number")throw new TypeError("The value to decode must not be of type number.");return new Buffer(d,"base64").toString()}function s(d){return decodeURIComponent(escape(atob(d)))}function i(d){return d.split(",").pop()}function o(d,T){var N=r.mapFileCommentRegex.exec(d),V=N[1]||N[2];try{var d=T(V);return d!=null&&typeof d.catch=="function"?d.catch(W):d}catch(x){W(x)}function W(x){throw new Error("An error occurred while trying to read the map file at "+V+`
`+x.stack)}}function a(d,T){T=T||{},T.hasComment&&(d=i(d)),T.encoding==="base64"?d=e(d):T.encoding==="uri"&&(d=decodeURIComponent(d)),(T.isJSON||T.encoding)&&(d=JSON.parse(d)),this.sourcemap=d}a.prototype.toJSON=function(d){return JSON.stringify(this.sourcemap,null,d)},typeof Buffer<"u"?typeof Buffer.from=="function"?a.prototype.toBase64=u:a.prototype.toBase64=f:a.prototype.toBase64=y;function u(){var d=this.toJSON();return Buffer.from(d,"utf8").toString("base64")}function f(){var d=this.toJSON();if(typeof d=="number")throw new TypeError("The json to encode must not be of type number.");return new Buffer(d,"utf8").toString("base64")}function y(){var d=this.toJSON();return btoa(unescape(encodeURIComponent(d)))}a.prototype.toURI=function(){var d=this.toJSON();return encodeURIComponent(d)},a.prototype.toComment=function(d){var T,N,V;return d!=null&&d.encoding==="uri"?(T="",N=this.toURI()):(T=";base64",N=this.toBase64()),V="sourceMappingURL=data:application/json;charset=utf-8"+T+","+N,d!=null&&d.multiline?"/*# "+V+" */":"//# "+V},a.prototype.toObject=function(){return JSON.parse(this.toJSON())},a.prototype.addProperty=function(d,T){if(this.sourcemap.hasOwnProperty(d))throw new Error('property "'+d+'" already exists on the sourcemap, use set property instead');return this.setProperty(d,T)},a.prototype.setProperty=function(d,T){return this.sourcemap[d]=T,this},a.prototype.getProperty=function(d){return this.sourcemap[d]},r.fromObject=function(d){return new a(d)},r.fromJSON=function(d){return new a(d,{isJSON:!0})},r.fromURI=function(d){return new a(d,{encoding:"uri"})},r.fromBase64=function(d){return new a(d,{encoding:"base64"})},r.fromComment=function(d){var T,N;return d=d.replace(/^\/\*/g,"//").replace(/\*\/$/g,""),T=r.commentRegex.exec(d),N=T&&T[4]||"uri",new a(d,{encoding:N,hasComment:!0})};function E(d){return new a(d,{isJSON:!0})}r.fromMapFileComment=function(d,T){if(typeof T=="string")throw new Error("String directory paths are no longer supported with `fromMapFileComment`\nPlease review the Upgrading documentation at https://github.com/thlorenz/convert-source-map#upgrading");var N=o(d,T);return N!=null&&typeof N.then=="function"?N.then(E):E(N)},r.fromSource=function(d){var T=d.match(r.commentRegex);return T?r.fromComment(T.pop()):null},r.fromMapFileSource=function(d,T){if(typeof T=="string")throw new Error("String directory paths are no longer supported with `fromMapFileSource`\nPlease review the Upgrading documentation at https://github.com/thlorenz/convert-source-map#upgrading");var N=d.match(r.mapFileCommentRegex);return N?r.fromMapFileComment(N.pop(),T):null},r.removeComments=function(d){return d.replace(r.commentRegex,"")},r.removeMapFileComments=function(d){return d.replace(r.mapFileCommentRegex,"")},r.generateMapFileComment=function(d,T){var N="sourceMappingURL="+d;return T&&T.multiline?"/*# "+N+" */":"//# "+N}})(Ds)),Ds}var Al=Sl(),Ml=go(Al),Pr="<unknown>";function Nl(r){var e=r.split(`
`);return e.reduce(function(t,n){var s=Dl(n)||Pl(n)||jl(n)||Vl(n)||Ll(n);return s&&t.push(s),t},[])}var Cl=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|rsc|<anonymous>|\/|[a-z]:\\|\\\\).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Ol=/\((\S*)(?::(\d+))(?::(\d+))\)/;function Dl(r){var e=Cl.exec(r);if(!e)return null;var t=e[2]&&e[2].indexOf("native")===0,n=e[2]&&e[2].indexOf("eval")===0,s=Ol.exec(e[2]);return n&&s!=null&&(e[2]=s[1],e[3]=s[2],e[4]=s[3]),{file:t?null:e[2],methodName:e[1]||Pr,arguments:t?[e[2]]:[],lineNumber:e[3]?+e[3]:null,column:e[4]?+e[4]:null}}var Fl=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|rsc|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i;function Pl(r){var e=Fl.exec(r);return e?{file:e[2],methodName:e[1]||Pr,arguments:[],lineNumber:+e[3],column:e[4]?+e[4]:null}:null}var Ul=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|rsc|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,kl=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function jl(r){var e=Ul.exec(r);if(!e)return null;var t=e[3]&&e[3].indexOf(" > eval")>-1,n=kl.exec(e[3]);return t&&n!=null&&(e[3]=n[1],e[4]=n[2],e[5]=null),{file:e[3],methodName:e[1]||Pr,arguments:e[2]?e[2].split(","):[],lineNumber:e[4]?+e[4]:null,column:e[5]?+e[5]:null}}var Bl=/^\s*(?:([^@]*)(?:\((.*?)\))?@)?(\S.*?):(\d+)(?::(\d+))?\s*$/i;function Ll(r){var e=Bl.exec(r);return e?{file:e[3],methodName:e[1]||Pr,arguments:[],lineNumber:+e[4],column:e[5]?+e[5]:null}:null}var $l=/^\s*at (?:((?:\[object object\])?[^\\/]+(?: \[as \S+\])?) )?\(?(.*?):(\d+)(?::(\d+))?\)?\s*$/i;function Vl(r){var e=$l.exec(r);return e?{file:e[2],methodName:e[1]||Pr,arguments:[],lineNumber:+e[3],column:e[4]?+e[4]:null}:null}const Gl=()=>typeof self<"u"&&typeof self.document>"u",us=()=>typeof process<"u"&&!!process?.versions?.node,Hl=(r,e,t=0)=>{const n=Ml.fromSource(r);if(!n||!e.stack)return e.stack;const s=new bl(n.toObject());let i=Nl(e.stack);return i=i.slice(0,i.findIndex(o=>o.methodName=="evaluate")),i=i.map(o=>{if(o.lineNumber+t<1)return o;const{line:a,column:u,source:f}=Rl(s,{line:o.lineNumber+t,column:o.column}),y=o.methodName!="anonymous"?o.methodName:"";return{...o,lineNumber:a,column:u,file:f,methodName:y}}),[e.toString(),...i.map(o=>{const a=`${o.file}:${o.lineNumber}:${o.column}`;return o.methodName?`    at ${o.methodName} (${a})`:`    at ${a}`})].reduce((o,a)=>`${o}
${a}`)};let Yr=null,xo=!1;const zl=r=>{Yr=r},Wl=r=>{xo=r},Xl={"esm.sh":r=>`https://esm.sh/${r}`,jsDelivr:r=>`https://cdn.jsdelivr.net/npm/${r}/+esm`,skypack:r=>`https://cdn.skypack.dev/${r}`},Pi=(r,e)=>{if(!e)return r;const t=Xl[e];return t?t(r):`${e}${r}`};function Kl(...r){typeof self<"u"&&self.console&&self.console.log(...r)}const ql=(r={})=>({name:"esbuild-manifold-plugin",async setup(e){let t=null;const n="manifold-3d/manifoldCAD",s=/^manifold-3d\/manifoldCAD(.ts|.js)?$/,i=["Mesh","Manifold","CrossSection","setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","resetToCircularDefaults","triangulate","show","only","setMaterial","setMorphStart","setMorphEnd","GLTFNode","getGLTFNodes","resetGLTFNodes","isManifoldCAD"];us()&&(async()=>{const{resolve:a,dirname:u}=await Promise.resolve().then(function(){return ls}),{fileURLToPath:f}=await Promise.resolve().then(function(){return ls}),y=__dirname??import.meta?.dirname??u(f(import.meta.url));t=a(y,"./manifoldCAD.ts")})();const o={};e.onResolve({filter:/.*/},async a=>{if(a.pluginData===o||a.namespace==="http-url"||a.path.match(/^https?:\/\//))return null;const u={toplevel:a.importer===r.filename||a.importer==="<stdin>"};if(a.path.match(s))return{namespace:"manifold-cad-globals",path:a.path,pluginData:u};if(r.files&&Object.keys(r.files).includes(a.path))return{namespace:"virtual-file",path:a.path};const f=await e.resolve(a.path,{resolveDir:a.resolveDir,kind:"import-statement",pluginData:o});return f.errors.length===0?t&&t===f.path?{namespace:"manifold-cad-globals",path:a.path,pluginData:u}:f:r.fetchRemotePackages!==!1&&r.jsCDN?{path:Pi(a.path,r.jsCDN),namespace:"http-url"}:null}),e.onLoad({filter:/.*/,namespace:"manifold-cad-globals"},a=>{const u=a.pluginData?.toplevel?"_manifold_cad_top_level":"_manifold_cad_library";return{contents:`export const {${i}} = ${u};`}}),e.onLoad({filter:/.*/,namespace:"virtual-file"},a=>({contents:r.files[a.path]})),r.fetchRemotePackages!==!1&&(e.onResolve({filter:/^https?:\/\//},a=>({path:a.path,namespace:"http-url"})),e.onResolve({filter:/.*/,namespace:"http-url"},a=>{const u=new URL(a.path,a.importer).toString();return u===Pi(n,r.jsCDN)?{path:u,namespace:"manifold-cad-globals",pluginData:{toplevel:!1}}:{path:u,namespace:"http-url"}}),e.onLoad({filter:/.*/,namespace:"http-url"},async a=>{const u=await fetch(a.path);return u.ok?(Kl(`Fetching ${a.path}.`),{contents:await u.text()}):{errors:[{text:await u.text()}]}}))}});let Ui=!1;const Yl=async(r={})=>{if(!Ui){const e={};if(!us()){if(!Yr||typeof Yr!="string")throw new Error("No URL given for 'esbuild.wasm'.");e.wasmURL=Yr,e.worker=xo===!0}await mo.initialize(e),Ui=!0}return{bundle:!0,write:!1,platform:"neutral",treeShaking:!1,sourcemap:"inline",sourcesContent:!1,format:"cjs",logLevel:"silent",plugins:[ql(r)],logOverride:{"empty-import-meta":"info"}}},Jl=async(r,e={})=>{try{let t;if(us()&&e.filename){const{dirname:s}=await Promise.resolve().then(function(){return ls});t=s(e.filename)}return(await mo.build({...await Yl(e),stdin:{contents:r,sourcefile:e.filename,resolveDir:t,loader:"ts"}})).outputFiles[0].text}catch(t){throw t.errors?.length?new yo(t):t}},vo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Eo=r=>{let e="";for(let t=0;t<16;t++)t%4!=3&&(t>0&&(e+=" "),e+=r[t]||0);return e},Zl=(r=1,e=vo)=>`    <item objectid="${r}" transform="${Eo(e)}" />
`,ki=r=>r?r.toISOString().substring(0,10):"";function Ql(r,{unit:e="millimeter",title:t="jscad model",author:n="",description:s="",application:i="jscad",creationDate:o=new Date,license:a="",modificationDate:u}={}){r.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${t}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||t}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${a}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${ki(o)}</metadata>
  <metadata name="ModificationDate">${ki(u||o)}</metadata>
  <metadata name="Application">${i}</metadata>
   `)}function eu(r,e,t,n){r.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),r.push(` <components>
`),t.forEach(({objectID:s,transform:i})=>{tu(r,s,i)}),r.push(` </components>
`),r.push(`</object>
`)}const tu=(r,e=1,t=vo)=>{r.push(`    <component objectid="${e}" transform="${Eo(t)}" />
`)};function nu(r,e,t,n,s,i){r.push(`  <object id="${e}" type="model"${i?' name="'+i+'"':""}>
   <mesh>
    <vertices>
`);for(let o=0;o<t.length;o+=3)r.push(`     <vertex x="${t[o].toPrecision(s)}" y="${t[o+1].toPrecision(s)}" z="${t[o+2].toPrecision(s)}" />
`);r.push(`    </vertices>
    <triangles>
`);for(let o=0;o<n.length;o+=3)r.push(`     <triangle v1="${n[o]}" v2="${n[o+1]}" v3="${n[o+2]}" />
`);return r.push(`    </triangles>
   </mesh>
  </object>
`),r}const ji={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function ru({meshes:r=[],components:e=[],items:t=[],precision:n=17,header:s}){const i=[];return Ql(i,s),i.push(`  <resources>
`),t.length==0&&console.error("3MF empty build! Include items or simple."),r.forEach(({id:o,vertices:a,indices:u,name:f})=>nu(i,o,a,u,n,f)),e.forEach(({id:o,children:a,name:u})=>{eu(i,o,a,u)}),i.push(`  </resources>
`),i.push(`<build>
`),t.forEach(({objectID:o,transform:a})=>{i.push(Zl(o,a))}),i.push(`</build>
`),i.push(`</model>
`),i.join("")}class su{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,t){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${t}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var bt=Uint8Array,Pt=Uint16Array,ri=Int32Array,si=new bt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ii=new bt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bi=new bt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wo=function(r,e){for(var t=new Pt(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var s=new ri(t[30]),n=1;n<30;++n)for(var i=t[n];i<t[n+1];++i)s[i]=i-t[n]<<5|n;return{b:t,r:s}},bo=wo(si,2),iu=bo.b,Vs=bo.r;iu[28]=258,Vs[258]=28;var ou=wo(ii,0),Li=ou.r,Gs=new Pt(32768);for(var et=0;et<32768;++et){var Pn=(et&43690)>>1|(et&21845)<<1;Pn=(Pn&52428)>>2|(Pn&13107)<<2,Pn=(Pn&61680)>>4|(Pn&3855)<<4,Gs[et]=((Pn&65280)>>8|(Pn&255)<<8)>>1}var Sr=(function(r,e,t){for(var n=r.length,s=0,i=new Pt(e);s<n;++s)r[s]&&++i[r[s]-1];var o=new Pt(e);for(s=1;s<e;++s)o[s]=o[s-1]+i[s-1]<<1;var a;if(t){a=new Pt(1<<e);var u=15-e;for(s=0;s<n;++s)if(r[s])for(var f=s<<4|r[s],y=e-r[s],E=o[r[s]-1]++<<y,d=E|(1<<y)-1;E<=d;++E)a[Gs[E]>>u]=f}else for(a=new Pt(n),s=0;s<n;++s)r[s]&&(a[s]=Gs[o[r[s]-1]++]>>15-r[s]);return a}),Kn=new bt(288);for(var et=0;et<144;++et)Kn[et]=8;for(var et=144;et<256;++et)Kn[et]=9;for(var et=256;et<280;++et)Kn[et]=7;for(var et=280;et<288;++et)Kn[et]=8;var ns=new bt(32);for(var et=0;et<32;++et)ns[et]=5;var au=Sr(Kn,9,0),cu=Sr(ns,5,0),_o=function(r){return(r+7)/8|0},Ro=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new bt(r.subarray(e,t))},lu=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],fs=function(r,e,t){var n=new Error(e||lu[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,fs),!t)throw n;return n},yn=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8},xr=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8,r[n+2]|=t>>16},Fs=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var s=t.length,i=t.slice();if(!s)return{t:So,l:0};if(s==1){var o=new bt(t[0].s+1);return o[t[0].s]=1,{t:o,l:1}}t.sort(function(F,B){return F.f-B.f}),t.push({s:-1,f:25001});var a=t[0],u=t[1],f=0,y=1,E=2;for(t[0]={s:-1,f:a.f+u.f,l:a,r:u};y!=s-1;)a=t[t[f].f<t[E].f?f++:E++],u=t[f!=y&&t[f].f<t[E].f?f++:E++],t[y++]={s:-1,f:a.f+u.f,l:a,r:u};for(var d=i[0].s,n=1;n<s;++n)i[n].s>d&&(d=i[n].s);var T=new Pt(d+1),N=Hs(t[y-1],T,0);if(N>e){var n=0,V=0,W=N-e,x=1<<W;for(i.sort(function(B,p){return T[p.s]-T[B.s]||B.f-p.f});n<s;++n){var U=i[n].s;if(T[U]>e)V+=x-(1<<N-T[U]),T[U]=e;else break}for(V>>=W;V>0;){var _=i[n].s;T[_]<e?V-=1<<e-T[_]++-1:++n}for(;n>=0&&V;--n){var C=i[n].s;T[C]==e&&(--T[C],++V)}N=e}return{t:new bt(T),l:N}},Hs=function(r,e,t){return r.s==-1?Math.max(Hs(r.l,e,t+1),Hs(r.r,e,t+1)):e[r.s]=t},$i=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Pt(++e),n=0,s=r[0],i=1,o=function(u){t[n++]=u},a=1;a<=e;++a)if(r[a]==s&&a!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(s),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(s);i=1,s=r[a]}return{c:t.subarray(0,n),n:e}},vr=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},Io=function(r,e,t){var n=t.length,s=_o(e+2);r[s]=n&255,r[s+1]=n>>8,r[s+2]=r[s]^255,r[s+3]=r[s+1]^255;for(var i=0;i<n;++i)r[s+i+4]=t[i];return(s+4+n)*8},Vi=function(r,e,t,n,s,i,o,a,u,f,y){yn(e,y++,t),++s[256];for(var E=Fs(s,15),d=E.t,T=E.l,N=Fs(i,15),V=N.t,W=N.l,x=$i(d),U=x.c,_=x.n,C=$i(V),F=C.c,B=C.n,p=new Pt(19),R=0;R<U.length;++R)++p[U[R]&31];for(var R=0;R<F.length;++R)++p[F[R]&31];for(var b=Fs(p,7),$=b.t,Q=b.l,ee=19;ee>4&&!$[Bi[ee-1]];--ee);var fe=f+5<<3,Ee=vr(s,Kn)+vr(i,ns)+o,me=vr(s,d)+vr(i,V)+o+14+3*ee+vr(p,$)+2*p[16]+3*p[17]+7*p[18];if(u>=0&&fe<=Ee&&fe<=me)return Io(e,y,r.subarray(u,u+f));var be,Ie,He,We;if(yn(e,y,1+(me<Ee)),y+=2,me<Ee){be=Sr(d,T,0),Ie=d,He=Sr(V,W,0),We=V;var kt=Sr($,Q,0);yn(e,y,_-257),yn(e,y+5,B-1),yn(e,y+10,ee-4),y+=14;for(var R=0;R<ee;++R)yn(e,y+3*R,$[Bi[R]]);y+=3*ee;for(var lt=[U,F],Tt=0;Tt<2;++Tt)for(var Et=lt[Tt],R=0;R<Et.length;++R){var tt=Et[R]&31;yn(e,y,kt[tt]),y+=$[tt],tt>15&&(yn(e,y,Et[R]>>5&127),y+=Et[R]>>12)}}else be=au,Ie=Kn,He=cu,We=ns;for(var R=0;R<a;++R){var A=n[R];if(A>255){var tt=A>>18&31;xr(e,y,be[tt+257]),y+=Ie[tt+257],tt>7&&(yn(e,y,A>>23&31),y+=si[tt]);var De=A&31;xr(e,y,He[De]),y+=We[De],De>3&&(xr(e,y,A>>5&8191),y+=ii[De])}else xr(e,y,be[A]),y+=Ie[A]}return xr(e,y,be[256]),y+Ie[256]},uu=new ri([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),So=new bt(0),fu=function(r,e,t,n,s,i){var o=i.z||r.length,a=new bt(n+o+5*(1+Math.ceil(o/7e3))+s),u=a.subarray(n,a.length-s),f=i.l,y=(i.r||0)&7;if(e){y&&(u[0]=i.r>>3);for(var E=uu[e-1],d=E>>13,T=E&8191,N=(1<<t)-1,V=i.p||new Pt(32768),W=i.h||new Pt(N+1),x=Math.ceil(t/3),U=2*x,_=function(Ot){return(r[Ot]^r[Ot+1]<<x^r[Ot+2]<<U)&N},C=new ri(25e3),F=new Pt(288),B=new Pt(32),p=0,R=0,b=i.i||0,$=0,Q=i.w||0,ee=0;b+2<o;++b){var fe=_(b),Ee=b&32767,me=W[fe];if(V[Ee]=me,W[fe]=Ee,Q<=b){var be=o-b;if((p>7e3||$>24576)&&(be>423||!f)){y=Vi(r,u,0,C,F,B,R,$,ee,b-ee,y),$=p=R=0,ee=b;for(var Ie=0;Ie<286;++Ie)F[Ie]=0;for(var Ie=0;Ie<30;++Ie)B[Ie]=0}var He=2,We=0,kt=T,lt=Ee-me&32767;if(be>2&&fe==_(b-lt))for(var Tt=Math.min(d,be)-1,Et=Math.min(32767,b),tt=Math.min(258,be);lt<=Et&&--kt&&Ee!=me;){if(r[b+He]==r[b+He-lt]){for(var A=0;A<tt&&r[b+A]==r[b+A-lt];++A);if(A>He){if(He=A,We=lt,A>Tt)break;for(var De=Math.min(lt,A-2),Dn=0,Ie=0;Ie<De;++Ie){var tn=b-lt+Ie&32767,_t=V[tn],Ve=tn-_t&32767;Ve>Dn&&(Dn=Ve,me=tn)}}}Ee=me,me=V[Ee],lt+=Ee-me&32767}if(We){C[$++]=268435456|Vs[He]<<18|Li[We];var it=Vs[He]&31,Mt=Li[We]&31;R+=si[it]+ii[Mt],++F[257+it],++B[Mt],Q=b+He,++p}else C[$++]=r[b],++F[r[b]]}}for(b=Math.max(b,Q);b<o;++b)C[$++]=r[b],++F[r[b]];y=Vi(r,u,f,C,F,B,R,$,ee,b-ee,y),f||(i.r=y&7|u[y/8|0]<<3,y-=7,i.h=W,i.p=V,i.i=b,i.w=Q)}else{for(var b=i.w||0;b<o+f;b+=65535){var on=b+65535;on>=o&&(u[y/8|0]=f,on=o),y=Io(u,y+1,r.subarray(b,on))}i.i=o}return Ro(a,0,n+_o(y)+s)},hu=(function(){for(var r=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&-306674912)^t>>>1;r[e]=t}return r})(),du=function(){var r=-1;return{p:function(e){for(var t=r,n=0;n<e.length;++n)t=hu[t&255^e[n]]^t>>>8;r=t},d:function(){return~r}}},pu=function(r,e,t,n,s){if(!s&&(s={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new bt(i.length+r.length);o.set(i),o.set(r,i.length),r=o,s.w=i.length}return fu(r,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,n,s)},Ao=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},vt=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8};function gu(r,e){return pu(r,e||{},0,0)}var Mo=function(r,e,t,n){for(var s in r){var i=r[s],o=e+s,a=n;Array.isArray(i)&&(a=Ao(n,i[1]),i=i[0]),i instanceof bt?t[o]=[i,a]:(t[o+="/"]=[new bt(0),a],Mo(i,o,t,n))}},Gi=typeof TextEncoder<"u"&&new TextEncoder,mu=typeof TextDecoder<"u"&&new TextDecoder,yu=0;try{mu.decode(So,{stream:!0}),yu=1}catch{}function Ar(r,e){var t;if(Gi)return Gi.encode(r);for(var n=r.length,s=new bt(r.length+(r.length>>1)),i=0,o=function(f){s[i++]=f},t=0;t<n;++t){if(i+5>s.length){var a=new bt(i+8+(n-t<<1));a.set(s),s=a}var u=r.charCodeAt(t);u<128||e?o(u):u<2048?(o(192|u>>6),o(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|r.charCodeAt(++t)&1023,o(240|u>>18),o(128|u>>12&63),o(128|u>>6&63),o(128|u&63)):(o(224|u>>12),o(128|u>>6&63),o(128|u&63))}return Ro(s,0,i)}var zs=function(r){var e=0;if(r)for(var t in r){var n=r[t].length;n>65535&&fs(9),e+=n+4}return e},Hi=function(r,e,t,n,s,i,o,a){var u=n.length,f=t.extra,y=a&&a.length,E=zs(f);vt(r,e,o!=null?33639248:67324752),e+=4,o!=null&&(r[e++]=20,r[e++]=t.os),r[e]=20,e+=2,r[e++]=t.flag<<1|(i<0&&8),r[e++]=s&&8,r[e++]=t.compression&255,r[e++]=t.compression>>8;var d=new Date(t.mtime==null?Date.now():t.mtime),T=d.getFullYear()-1980;if((T<0||T>119)&&fs(10),vt(r,e,T<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>1),e+=4,i!=-1&&(vt(r,e,t.crc),vt(r,e+4,i<0?-i-2:i),vt(r,e+8,t.size)),vt(r,e+12,u),vt(r,e+14,E),e+=16,o!=null&&(vt(r,e,y),vt(r,e+6,t.attrs),vt(r,e+10,o),e+=14),r.set(n,e),e+=u,E)for(var N in f){var V=f[N],W=V.length;vt(r,e,+N),vt(r,e+2,W),r.set(V,e+4),e+=4+W}return y&&(r.set(a,e),e+=y),e},Tu=function(r,e,t,n,s){vt(r,e,101010256),vt(r,e+8,t),vt(r,e+10,t),vt(r,e+12,n),vt(r,e+16,s)};function xu(r,e){e||(e={});var t={},n=[];Mo(r,"",t,e);var s=0,i=0;for(var o in t){var a=t[o],u=a[0],f=a[1],y=f.level==0?0:8,E=Ar(o),d=E.length,T=f.comment,N=T&&Ar(T),V=N&&N.length,W=zs(f.extra);d>65535&&fs(11);var x=y?gu(u,f):u,U=x.length,_=du();_.p(u),n.push(Ao(f,{size:u.length,crc:_.d(),c:x,f:E,m:N,u:d!=o.length||N&&T.length!=V,o:s,compression:y})),s+=30+d+W+U,i+=76+2*(d+W)+(V||0)+U}for(var C=new bt(i+22),F=s,B=i-s,p=0;p<n.length;++p){var E=n[p];Hi(C,E.o,E,E.f,E.u,E.c.length);var R=30+E.f.length+zs(E.extra);C.set(E.c,E.o+R),Hi(C,s,E,E.f,E.u,E.c.length,E.o,E.m),s+=16+R+(E.m?E.m.length:0)}return Tu(C,s,n.length,B,F),C}class vu{extensions=["3mf"];unit="millimeter";title="ManifoldCAD.org model";author;description="ManifoldCAD.org model";application="ManifoldCAD.org";creationDate;license;modificationDate;async asBlob(e){const t={meshes:[],components:[],items:[],precision:7,header:{unit:this.unit,title:this.title,description:this.description,application:this.application,creationDate:this.creationDate,license:this.license,modificationDate:this.modificationDate}};let n=1;const s=new Map,i=T=>`${s.get(T)}`,o=T=>{const{clonedFrom:N}=T.getExtras();return N?s.get(N):s.get(T)},a=T=>{const N=`${n++}`;return s.set(T,N),N};for(const T of e.getRoot().listMeshes()){const N=T.getExtension("EXT_mesh_manifold");if(N){const W=N.getIndices(),x=T.listPrimitives()[0].getAttribute("POSITION"),U=a(T);t.meshes.push({vertices:x.getArray(),indices:W.getArray(),id:U})}const{clonedFrom:V}=T.getExtras();!N&&V||!N&&!V&&console.log("skipping non-ManifoldCAD mesh")}const u=e.getRoot().listNodes().reverse();for(const T of u){const N=T.getMesh()&&o(T.getMesh());t.components.push({id:a(T),name:T.getName(),children:N?[{objectID:N}]:[],transform:T.getMatrix().map(V=>V.toFixed(t.precision))})}for(const T of e.getRoot().listNodes()){const N=i(T);if(!N){console.log(`Could not find object ID for ${T.getName()}`);continue}const V={objectID:N,transform:T.getMatrix().map(x=>x.toFixed(t?.precision))},W=T.getParentNode();if(W){const x=i(W);t.components.find(_=>_.id==x).children.push(V)}else t.items.push({objectID:N})}const f=new su;f.add3dModel("3D/3dmodel.model");const y=ru(t),E={};E["3D/3dmodel.model"]=Ar(y),E[ji.name]=Ar(ji.content),E[f.name]=Ar(f.content);const d=xu(E);return new Blob([d],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"})}}class No{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}return this}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let i=0,o=s.length;i<o;i++)s[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class ir{constructor(e,t,n,s={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=s,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Eu extends No{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const t=new Set;for(const n of this.listParentEdges(e))t.add(n.getParent());return Array.from(t)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const t=new Set;for(const n of this.listChildEdges(e))t.add(n.getChild());return Array.from(t)}disconnectParents(e,t){for(const n of this.listParentEdges(e))(!t||t(n.getParent()))&&n.dispose();return this}_createEdge(e,t,n,s){const i=new ir(e,t,n,s);this._edges.add(i);const o=i.getParent();this._parentEdges.has(o)||this._parentEdges.set(o,new Set),this._parentEdges.get(o).add(i);const a=i.getChild();return this._childEdges.has(a)||this._childEdges.set(a,new Set),this._childEdges.get(a).add(i),i}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Mr(){return Mr=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Mr.apply(this,arguments)}class kn{constructor(e){if(this.list=[],e)for(const t of e)this.list.push(t)}add(e){this.list.push(e)}remove(e){const t=this.list.indexOf(e);t>=0&&this.list.splice(t,1)}removeChild(e){const t=[];for(const n of this.list)n.getChild()===e&&t.push(n);for(const n of t)this.remove(n);return t}listRefsByChild(e){const t=[];for(const n of this.list)n.getChild()===e&&t.push(n);return t}values(){return this.list}}class Je{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const t of e)this.add(t)}add(e){const t=e.getChild();this.removeChild(t),this.set.add(e),this.map.set(t,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const t=this.map.get(e)||null;return t&&this.remove(t),t}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class Qt{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,t){this.map[e]=t}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const ze=Symbol("attributes"),Wn=Symbol("immutableKeys");class oi extends No{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[ze]=void 0,this[Wn]=void 0,this.graph=e,this[Wn]=new Set,this[ze]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const s=e[n];if(s instanceof oi){const i=this.graph._createEdge(n,this,s);this[Wn].add(n),t[n]=i}else t[n]=s}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[ze]){const s=this[ze][n];if(s instanceof ir){const i=s;i.getChild()===e&&this.setRef(n,t,i.getAttributes())}else if(s instanceof kn)for(const i of s.listRefsByChild(e)){const o=i.getAttributes();this.removeRef(n,e),this.addRef(n,t,o)}else if(s instanceof Je){const i=s.getRefByChild(e);if(i){const o=i.getAttributes();this.removeRef(n,e),this.addRef(n,t,o)}}else if(s instanceof Qt)for(const i of s.keys()){const o=s.get(i);o.getChild()===e&&this.setRefMap(n,i,t,o.getAttributes())}}return this}get(e){return this[ze][e]}set(e,t){return this[ze][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[ze][e];return t?t.getChild():null}setRef(e,t,n){if(this[Wn].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[ze][e];if(s&&s.dispose(),!t)return this;const i=this.graph._createEdge(e,this,t,n);return this[ze][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(n=>n.getChild())}addRef(e,t,n){const s=this.graph._createEdge(e,this,t,n);return this.assertRefList(e).add(s),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){const n=this.assertRefList(e);if(n instanceof kn)for(const s of n.listRefsByChild(t))s.dispose();else{const s=n.getRefByChild(t);s&&s.dispose()}return this}assertRefList(e){const t=this[ze][e];if(t instanceof kn||t instanceof Je)return t;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(t=>t.getChild())}getRefMap(e,t){const s=this.assertRefMap(e).get(t);return s?s.getChild():null}setRefMap(e,t,n,s){const i=this.assertRefMap(e),o=i.get(t);if(o&&o.dispose(),!n)return this;s=Object.assign(s||{},{key:t});const a=this.graph._createEdge(e,this,n,Mr({},s,{key:t}));return i.set(t,a),this.dispatchEvent({type:"change",attribute:e,key:t})}assertRefMap(e){const t=this[ze][e];if(t instanceof Qt)return t;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(Mr({},e,{target:this})),this.graph.dispatchEvent(Mr({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const t=e.getName();if(this[ze][t]===e)this[ze][t]=null,this[Wn].has(t)&&e.getChild().dispose();else if(this[ze][t]instanceof kn)this[ze][t].remove(e);else if(this[ze][t]instanceof Je)this[ze][t].remove(e);else if(this[ze][t]instanceof Qt){const n=this[ze][t];for(const s of n.keys())n.get(s)===e&&n.delete(s)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:t})}}const Co="v4.2.1",ar="@glb.bin";var k;(function(r){r.ACCESSOR="Accessor",r.ANIMATION="Animation",r.ANIMATION_CHANNEL="AnimationChannel",r.ANIMATION_SAMPLER="AnimationSampler",r.BUFFER="Buffer",r.CAMERA="Camera",r.MATERIAL="Material",r.MESH="Mesh",r.PRIMITIVE="Primitive",r.PRIMITIVE_TARGET="PrimitiveTarget",r.NODE="Node",r.ROOT="Root",r.SCENE="Scene",r.SKIN="Skin",r.TEXTURE="Texture",r.TEXTURE_INFO="TextureInfo"})(k||(k={}));var rs;(function(r){r.INTERLEAVED="interleaved",r.SEPARATE="separate"})(rs||(rs={}));var Ut;(function(r){r.ARRAY_BUFFER="ARRAY_BUFFER",r.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",r.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",r.OTHER="OTHER",r.SPARSE="SPARSE"})(Ut||(Ut={}));var Wt;(function(r){r[r.R=4096]="R",r[r.G=256]="G",r[r.B=16]="B",r[r.A=1]="A"})(Wt||(Wt={}));var jn;(function(r){r.GLTF="GLTF",r.GLB="GLB"})(jn||(jn={}));const hs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class Ce{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}else{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let t=0;for(const i of e)t+=i.byteLength;const n=new Uint8Array(t);let s=0;for(const i of e)n.set(i,s),s+=i.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),t!==0)for(let i=e.byteLength;i<n;i++)s[i]=t;return s}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class wu{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let t=new DataView(e.buffer,e.byteOffset+4),n,s;for(;t.byteLength;){if(n=t.getUint16(0,!1),bu(t,n),s=t.getUint8(n+1),s===192||s===193||s===194)return[t.getUint16(n+7,!1),t.getUint16(n+5,!1)];t=new DataView(e.buffer,t.byteOffset+n+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class ds{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Ce.decodeText(e.slice(12,16))===ds.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}ds.PNG_FRIED_CHUNK_NAME="CgBI";class sn{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const s=4,i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)n+=i[0]*i[1]*s,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return n+=1*s,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}sn.impls={"image/jpeg":new wu,"image/png":new ds};function bu(r,e){if(e>r.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(r.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return r}class cr{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return sn.mimeTypeToExtension(t)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var Ws=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function _u(){var r=new Ws(3);return Ws!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ps(r){var e=r[0],t=r[1],n=r[2];return Math.hypot(e,t,n)}function Ru(r,e,t){var n=e[0],s=e[1],i=e[2],o=t[3]*n+t[7]*s+t[11]*i+t[15];return o=o||1,r[0]=(t[0]*n+t[4]*s+t[8]*i+t[12])/o,r[1]=(t[1]*n+t[5]*s+t[9]*i+t[13])/o,r[2]=(t[2]*n+t[6]*s+t[10]*i+t[14])/o,r}(function(){var r=_u();return function(e,t,n,s,i,o){var a,u;for(t||(t=3),n||(n=0),s?u=Math.min(s*t+n,e.length):u=e.length,a=n;a<u;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],i(r,r,o),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e}})();function Iu(r){const e=Oo(),t=r.propertyType===k.NODE?[r]:r.listChildren();for(const n of t)n.traverse(s=>{const i=s.getMesh();if(!i)return;const o=Su(i,s.getWorldMatrix());o.min.every(isFinite)&&o.max.every(isFinite)&&(Xs(o.min,e),Xs(o.max,e))});return e}function Su(r,e){const t=Oo();for(const n of r.listPrimitives()){const s=n.getAttribute("POSITION"),i=n.getIndices();if(!s)continue;let o=[0,0,0],a=[0,0,0];for(let u=0,f=i?i.getCount():s.getCount();u<f;u++){const y=i?i.getScalar(u):u;o=s.getElement(y,o),a=Ru(a,o,e),Xs(a,t)}}return t}function Xs(r,e){for(let t=0;t<3;t++)e.min[t]=Math.min(r[t],e.min[t]),e.max[t]=Math.max(r[t],e.max[t])}function Oo(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}const zi="https://null.example";class Nr{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return cr.basename(new URL(e,zi).pathname)}static extension(e){return cr.extension(new URL(e,zi).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),s=t.split("/");n.pop();for(let i=0;i<s.length;i++)s[i]!=="."&&(s[i]===".."?n.pop():n.push(s[i]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Nr.DEFAULT_INIT={};Nr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function Wi(r){return Object.prototype.toString.call(r)==="[object Object]"}function Xn(r){if(Wi(r)===!1)return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(Wi(t)===!1||Object.hasOwn(t,"isPrototypeOf")===!1)}var Ks,qs;(function(r){r[r.SILENT=4]="SILENT",r[r.ERROR=3]="ERROR",r[r.WARN=2]="WARN",r[r.INFO=1]="INFO",r[r.DEBUG=0]="DEBUG"})(qs||(qs={}));class zt{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=zt.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=zt.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=zt.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=zt.Verbosity.ERROR&&console.error(e)}}Ks=zt;zt.Verbosity=qs;zt.DEFAULT_INSTANCE=new Ks(Ks.Verbosity.INFO);function Au(r){var e=r[0],t=r[1],n=r[2],s=r[3],i=r[4],o=r[5],a=r[6],u=r[7],f=r[8],y=r[9],E=r[10],d=r[11],T=r[12],N=r[13],V=r[14],W=r[15],x=e*o-t*i,U=e*a-n*i,_=e*u-s*i,C=t*a-n*o,F=t*u-s*o,B=n*u-s*a,p=f*N-y*T,R=f*V-E*T,b=f*W-d*T,$=y*V-E*N,Q=y*W-d*N,ee=E*W-d*V;return x*ee-U*Q+_*$+C*b-F*R+B*p}function Mu(r,e,t){var n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],u=e[5],f=e[6],y=e[7],E=e[8],d=e[9],T=e[10],N=e[11],V=e[12],W=e[13],x=e[14],U=e[15],_=t[0],C=t[1],F=t[2],B=t[3];return r[0]=_*n+C*a+F*E+B*V,r[1]=_*s+C*u+F*d+B*W,r[2]=_*i+C*f+F*T+B*x,r[3]=_*o+C*y+F*N+B*U,_=t[4],C=t[5],F=t[6],B=t[7],r[4]=_*n+C*a+F*E+B*V,r[5]=_*s+C*u+F*d+B*W,r[6]=_*i+C*f+F*T+B*x,r[7]=_*o+C*y+F*N+B*U,_=t[8],C=t[9],F=t[10],B=t[11],r[8]=_*n+C*a+F*E+B*V,r[9]=_*s+C*u+F*d+B*W,r[10]=_*i+C*f+F*T+B*x,r[11]=_*o+C*y+F*N+B*U,_=t[12],C=t[13],F=t[14],B=t[15],r[12]=_*n+C*a+F*E+B*V,r[13]=_*s+C*u+F*d+B*W,r[14]=_*i+C*f+F*T+B*x,r[15]=_*o+C*y+F*N+B*U,r}function Nu(r,e){var t=e[0],n=e[1],s=e[2],i=e[4],o=e[5],a=e[6],u=e[8],f=e[9],y=e[10];return r[0]=Math.hypot(t,n,s),r[1]=Math.hypot(i,o,a),r[2]=Math.hypot(u,f,y),r}function Cu(r,e){var t=new Ws(3);Nu(t,e);var n=1/t[0],s=1/t[1],i=1/t[2],o=e[0]*n,a=e[1]*s,u=e[2]*i,f=e[4]*n,y=e[5]*s,E=e[6]*i,d=e[8]*n,T=e[9]*s,N=e[10]*i,V=o+y+N,W=0;return V>0?(W=Math.sqrt(V+1)*2,r[3]=.25*W,r[0]=(E-T)/W,r[1]=(d-u)/W,r[2]=(a-f)/W):o>y&&o>N?(W=Math.sqrt(1+o-y-N)*2,r[3]=(E-T)/W,r[0]=.25*W,r[1]=(a+f)/W,r[2]=(d+u)/W):y>N?(W=Math.sqrt(1+y-o-N)*2,r[3]=(d-u)/W,r[0]=(a+f)/W,r[1]=.25*W,r[2]=(E+T)/W):(W=Math.sqrt(1+N-o-y)*2,r[3]=(a-f)/W,r[0]=(d+u)/W,r[1]=(E+T)/W,r[2]=.25*W),r}class Xe{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-t[s])>n)return!1;return!0}static clamp(e,t,n){return e<t?t:e>n?n:e}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(Xe.clamp(e,0,1)*65535);case 5121:return Math.round(Xe.clamp(e,0,1)*255);case 5122:return Math.round(Xe.clamp(e,-1,1)*32767);case 5120:return Math.round(Xe.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,t,n,s){let i=Ps([e[0],e[1],e[2]]);const o=Ps([e[4],e[5],e[6]]),a=Ps([e[8],e[9],e[10]]);Au(e)<0&&(i=-i),t[0]=e[12],t[1]=e[13],t[2]=e[14];const f=e.slice(),y=1/i,E=1/o,d=1/a;f[0]*=y,f[1]*=y,f[2]*=y,f[4]*=E,f[5]*=E,f[6]*=E,f[8]*=d,f[9]*=d,f[10]*=d,Cu(n,f),s[0]=i,s[1]=o,s[2]=a}static compose(e,t,n,s){const i=s,o=t[0],a=t[1],u=t[2],f=t[3],y=o+o,E=a+a,d=u+u,T=o*y,N=o*E,V=o*d,W=a*E,x=a*d,U=u*d,_=f*y,C=f*E,F=f*d,B=n[0],p=n[1],R=n[2];return i[0]=(1-(W+U))*B,i[1]=(N+F)*B,i[2]=(V-C)*B,i[3]=0,i[4]=(N-F)*p,i[5]=(1-(T+U))*p,i[6]=(x+_)*p,i[7]=0,i[8]=(V+C)*R,i[9]=(x-_)*R,i[10]=(1-(T+W))*R,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function Ou(r,e){if(!!r!=!!e)return!1;const t=r.getChild(),n=e.getChild();return t===n||t.equals(n)}function Du(r,e){if(!!r!=!!e)return!1;const t=r.values(),n=e.values();if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++){const i=t[s],o=n[s];if(i.getChild()!==o.getChild()&&!i.getChild().equals(o.getChild()))return!1}return!0}function Fu(r,e){if(!!r!=!!e)return!1;const t=r.keys(),n=e.keys();if(t.length!==n.length)return!1;for(const s of t){const i=r.get(s),o=e.get(s);if(!!i!=!!o)return!1;const a=i.getChild(),u=o.getChild();if(a!==u&&!a.equals(u))return!1}return!0}function Do(r,e){if(r===e)return!0;if(!!r!=!!e||!r||!e||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Fo(r,e){if(r===e)return!0;if(!!r!=!!e)return!1;if(!Xn(r)||!Xn(e))return r===e;const t=r,n=e;let s=0,i=0,o;for(o in t)s++;for(o in n)i++;if(s!==i)return!1;for(o in t){const a=t[o],u=n[o];if(ss(a)&&ss(u)){if(!Do(a,u))return!1}else if(Xn(a)&&Xn(u)){if(!Fo(a,u))return!1}else if(a!==u)return!1}return!0}function ss(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const Xi="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",Pu=999,Uu=6,Ki=new Set,ku=function(){let e="";for(let t=0;t<Uu;t++)e+=Xi.charAt(Math.floor(Math.random()*Xi.length));return e},ju=function(){for(let e=0;e<Pu;e++){const t=ku();if(!Ki.has(t))return Ki.add(t),t}return""},$n=r=>r,Bu=new Set;class ai extends oi{constructor(e,t=""){super(e),this[ze].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,$n)}copy(e,t=$n){for(const n in this[ze]){const s=this[ze][n];if(s instanceof ir)this[Wn].has(n)||s.dispose();else if(s instanceof kn||s instanceof Je)for(const i of s.values())i.dispose();else if(s instanceof Qt)for(const i of s.values())i.dispose()}for(const n in e[ze]){const s=this[ze][n],i=e[ze][n];if(i instanceof ir)this[Wn].has(n)?s.getChild().copy(t(i.getChild()),t):this.setRef(n,t(i.getChild()),i.getAttributes());else if(i instanceof Je||i instanceof kn)for(const o of i.values())this.addRef(n,t(o.getChild()),o.getAttributes());else if(i instanceof Qt)for(const o of i.keys()){const a=i.get(o);this.setRefMap(n,o,t(a.getChild()),a.getAttributes())}else Xn(i)?this[ze][n]=JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?this[ze][n]=i.slice():this[ze][n]=i}return this}equals(e,t=Bu){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[ze]){if(t.has(n))continue;const s=this[ze][n],i=e[ze][n];if(s instanceof ir||i instanceof ir){if(!Ou(s,i))return!1}else if(s instanceof Je||i instanceof Je||s instanceof kn||i instanceof kn){if(!Du(s,i))return!1}else if(s instanceof Qt||i instanceof Qt){if(!Fu(s,i))return!1}else if(Xn(s)||Xn(i)){if(!Fo(s,i))return!1}else if(ss(s)||ss(i)){if(!Do(s,i))return!1}else if(s!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class At extends ai{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new Qt})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t._validateParent(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class oe extends At{init(){this.propertyType=k.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:oe.Type.SCALAR,componentType:oe.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case oe.Type.SCALAR:return 1;case oe.Type.VEC2:return 2;case oe.Type.VEC3:return 3;case oe.Type.VEC4:return 4;case oe.Type.MAT2:return 4;case oe.Type.MAT3:return 9;case oe.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case oe.ComponentType.BYTE:return 1;case oe.ComponentType.UNSIGNED_BYTE:return 1;case oe.ComponentType.SHORT:return 2;case oe.ComponentType.UNSIGNED_SHORT:return 2;case oe.ComponentType.UNSIGNED_INT:return 4;case oe.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType();if(this.getMin(e),t)for(let i=0;i<n;i++)e[i]=Xe.decodeNormalizedInt(e[i],s);return e}getMin(e){const t=this.getArray(),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=1/0;for(let i=0;i<n*s;i+=s)for(let o=0;o<s;o++){const a=t[i+o];Number.isFinite(a)&&(e[o]=Math.min(e[o],a))}return e}getMaxNormalized(e){const t=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType();if(this.getMax(e),t)for(let i=0;i<n;i++)e[i]=Xe.decodeNormalizedInt(e[i],s);return e}getMax(e){const t=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=-1/0;for(let i=0;i<n*s;i+=s)for(let o=0;o<s;o++){const a=t[i+o];Number.isFinite(a)&&(e[o]=Math.max(e[o],a))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return oe.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const t=this.getElementSize(),n=this.getComponentType(),s=this.getArray();return this.getNormalized()?Xe.decodeNormalizedInt(s[e*t],n):s[e*t]}setScalar(e,t){const n=this.getElementSize(),s=this.getComponentType(),i=this.getArray();return this.getNormalized()?i[e*n]=Xe.encodeNormalizedInt(t,s):i[e*n]=t,this}getElement(e,t){const n=this.getNormalized(),s=this.getElementSize(),i=this.getComponentType(),o=this.getArray();for(let a=0;a<s;a++)n?t[a]=Xe.decodeNormalizedInt(o[e*s+a],i):t[a]=o[e*s+a];return t}setElement(e,t){const n=this.getNormalized(),s=this.getElementSize(),i=this.getComponentType(),o=this.getArray();for(let a=0;a<s;a++)n?o[e*s+a]=Xe.encodeNormalizedInt(t[a],i):o[e*s+a]=t[a];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?Lu(e):oe.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}oe.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};oe.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function Lu(r){switch(r.constructor){case Float32Array:return oe.ComponentType.FLOAT;case Uint32Array:return oe.ComponentType.UNSIGNED_INT;case Uint16Array:return oe.ComponentType.UNSIGNED_SHORT;case Uint8Array:return oe.ComponentType.UNSIGNED_BYTE;case Int16Array:return oe.ComponentType.SHORT;case Int8Array:return oe.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class Po extends At{init(){this.propertyType=k.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new Je,samplers:new Je})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class ci extends At{init(){this.propertyType=k.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}ci.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class dr extends At{init(){this.propertyType=k.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:dr.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Ut.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Ut.OTHER})}}dr.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Uo extends At{init(){this.propertyType=k.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Zn extends At{init(){this.propertyType=k.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Zn.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Zn.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class st extends ai{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}st.EXTENSION_NAME=void 0;class Ye extends At{init(){this.propertyType=k.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ye.WrapMode.REPEAT,wrapT:Ye.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ye.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Ye.MagFilter={NEAREST:9728,LINEAR:9729};Ye.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Gr,G:Hr,B:zr,A:$u}=Wt;class Vn extends At{init(){this.propertyType=k.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Vn.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ye(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ye(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ye(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ye(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ye(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Gr|Hr|zr|$u,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Gr|Hr|zr,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Gr|Hr|zr})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Gr})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Hr|zr})}}Vn.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class ko extends At{init(){this.propertyType=k.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new Je})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class jo extends At{init(){this.propertyType=k.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new Je})}copy(e,t=$n){if(t===$n)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Xe.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return Xe.decompose(e,t,n,s),this.set("translation",t).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return Xe.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Xe.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Xe.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.getParentNode())e.push(s);let t;const n=e.pop().getMatrix();for(;t=e.pop();)Mu(n,n,t.getMatrix());return n}addChild(e){const t=e.getParentNode();t&&t.removeChild(e);for(const n of e.listParents())n.propertyType===k.SCENE&&n.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===k.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class qn extends At{init(){this.propertyType=k.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:qn.Mode.TRIANGLES,material:null,indices:null,attributes:new Qt,targets:new Je})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Ut.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ut.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}qn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Vu extends ai{init(){this.propertyType=k.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new Qt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ut.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function St(){return St=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},St.apply(null,arguments)}class Bo extends At{init(){this.propertyType=k.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new Je})}copy(e,t=$n){if(t===$n)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){const t=e.getParentNode();return t&&t.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class Lo extends At{init(){this.propertyType=k.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new Je})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Ut.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class $o extends At{init(){this.propertyType=k.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||sn.extensionToMimeType(cr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=sn.extensionToMimeType(cr.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Ce.assertView(e))}getSize(){const e=this.get("image");return e?sn.getSize(e,this.getMimeType()):null}}class Vo extends At{init(){this.propertyType=k.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Co}`,version:"2.0"},defaultScene:null,accessors:new Je,animations:new Je,buffers:new Je,cameras:new Je,materials:new Je,meshes:new Je,nodes:new Je,scenes:new Je,skins:new Je,textures:new Je})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",t=>{this._addChildOfRoot(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=$n){if(t===$n)throw new Error("Root cannot be copied.");this.set("asset",St({},e.get("asset"))),this.setName(e.getName()),this.setExtras(St({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,t(s))}return this}_addChildOfRoot(e){return e instanceof Bo?this.addRef("scenes",e):e instanceof jo?this.addRef("nodes",e):e instanceof Zn?this.addRef("cameras",e):e instanceof Lo?this.addRef("skins",e):e instanceof ko?this.addRef("meshes",e):e instanceof Vn?this.addRef("materials",e):e instanceof $o?this.addRef("textures",e):e instanceof Po?this.addRef("animations",e):e instanceof oe?this.addRef("accessors",e):e instanceof Uo&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class lr{static fromGraph(e){return lr._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Eu,this._root=new Vo(this._graph),this._logger=zt.DEFAULT_INSTANCE,lr._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===t)||new e(this)}createScene(e=""){return new Bo(this._graph,e)}createNode(e=""){return new jo(this._graph,e)}createCamera(e=""){return new Zn(this._graph,e)}createSkin(e=""){return new Lo(this._graph,e)}createMesh(e=""){return new ko(this._graph,e)}createPrimitive(){return new qn(this._graph)}createPrimitiveTarget(e=""){return new Vu(this._graph,e)}createMaterial(e=""){return new Vn(this._graph,e)}createTexture(e=""){return new $o(this._graph,e)}createAnimation(e=""){return new Po(this._graph,e)}createAnimationChannel(e=""){return new ci(this._graph,e)}createAnimationSampler(e=""){return new dr(this._graph,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new oe(this._graph,e).setBuffer(t)}createBuffer(e=""){return new Uo(this._graph,e)}}lr._GRAPH_DOCUMENTS=new WeakMap;class Ze{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=e,e.getRoot()._enableExtension(this),this._listener=n=>{const s=n,i=s.target;i instanceof st&&i.extensionName===this.extensionName&&(s.type==="node:create"&&this._addExtensionProperty(i),s.type==="node:dispose"&&this._removeExtensionProperty(i))};const t=e.getGraph();t.addEventListener("node:create",this._listener),t.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const e=this.document.getGraph();e.removeEventListener("node:create",this._listener),e.removeEventListener("node:dispose",this._listener);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(e){return this.properties.add(e),this}_removeExtensionProperty(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Ze.EXTENSION_NAME=void 0;class Gu{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}}const qi={logger:zt.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Hu=new Set([k.BUFFER,k.TEXTURE,k.MATERIAL,k.MESH,k.PRIMITIVE,k.NODE,k.SCENE]);class zu{static read(e,t=qi){const n=St({},qi,t),{json:s}=e,i=new lr().setLogger(n.logger);this.validate(e,n);const o=new Gu(e),a=s.asset,u=i.getRoot().getAsset();a.copyright&&(u.copyright=a.copyright),a.extras&&(u.extras=a.extras),s.extras!==void 0&&i.getRoot().setExtras(St({},s.extras));const f=s.extensionsUsed||[],y=s.extensionsRequired||[];n.extensions.sort((p,R)=>p.EXTENSION_NAME>R.EXTENSION_NAME?1:-1);for(const p of n.extensions)if(f.includes(p.EXTENSION_NAME)){const R=i.createExtension(p).setRequired(y.includes(p.EXTENSION_NAME)),b=R.prereadTypes.filter($=>!Hu.has($));b.length&&n.logger.warn(`Preread hooks for some types (${b.join()}), requested by extension ${R.extensionName}, are unsupported. Please file an issue or a PR.`);for(const $ of R.readDependencies)R.install($,n.dependencies[$])}const E=s.buffers||[];i.getRoot().listExtensionsUsed().filter(p=>p.prereadTypes.includes(k.BUFFER)).forEach(p=>p.preread(o,k.BUFFER)),o.buffers=E.map(p=>{const R=i.createBuffer(p.name);return p.extras&&R.setExtras(p.extras),p.uri&&p.uri.indexOf("__")!==0&&R.setURI(p.uri),R});const d=s.bufferViews||[];o.bufferViewBuffers=d.map((p,R)=>{if(!o.bufferViews[R]){const b=e.json.buffers[p.buffer],$=b.uri?e.resources[b.uri]:e.resources[ar],Q=p.byteOffset||0;o.bufferViews[R]=Ce.toView($,Q,p.byteLength)}return o.buffers[p.buffer]});const T=s.accessors||[];o.accessors=T.map(p=>{const R=o.bufferViewBuffers[p.bufferView],b=i.createAccessor(p.name,R).setType(p.type);return p.extras&&b.setExtras(p.extras),p.normalized!==void 0&&b.setNormalized(p.normalized),p.bufferView===void 0||b.setArray(Jr(p,o)),b});const N=s.images||[],V=s.textures||[];i.getRoot().listExtensionsUsed().filter(p=>p.prereadTypes.includes(k.TEXTURE)).forEach(p=>p.preread(o,k.TEXTURE)),o.textures=N.map(p=>{const R=i.createTexture(p.name);if(p.extras&&R.setExtras(p.extras),p.bufferView!==void 0){const b=s.bufferViews[p.bufferView],$=e.json.buffers[b.buffer],Q=$.uri?e.resources[$.uri]:e.resources[ar],ee=b.byteOffset||0,fe=b.byteLength,Ee=Q.slice(ee,ee+fe);R.setImage(Ee)}else p.uri!==void 0&&(R.setImage(e.resources[p.uri]),p.uri.indexOf("__")!==0&&R.setURI(p.uri));if(p.mimeType!==void 0)R.setMimeType(p.mimeType);else if(p.uri){const b=cr.extension(p.uri);R.setMimeType(sn.extensionToMimeType(b))}return R}),i.getRoot().listExtensionsUsed().filter(p=>p.prereadTypes.includes(k.MATERIAL)).forEach(p=>p.preread(o,k.MATERIAL));const W=s.materials||[];o.materials=W.map(p=>{const R=i.createMaterial(p.name);p.extras&&R.setExtras(p.extras),p.alphaMode!==void 0&&R.setAlphaMode(p.alphaMode),p.alphaCutoff!==void 0&&R.setAlphaCutoff(p.alphaCutoff),p.doubleSided!==void 0&&R.setDoubleSided(p.doubleSided);const b=p.pbrMetallicRoughness||{};if(b.baseColorFactor!==void 0&&R.setBaseColorFactor(b.baseColorFactor),p.emissiveFactor!==void 0&&R.setEmissiveFactor(p.emissiveFactor),b.metallicFactor!==void 0&&R.setMetallicFactor(b.metallicFactor),b.roughnessFactor!==void 0&&R.setRoughnessFactor(b.roughnessFactor),b.baseColorTexture!==void 0){const $=b.baseColorTexture,Q=o.textures[V[$.index].source];R.setBaseColorTexture(Q),o.setTextureInfo(R.getBaseColorTextureInfo(),$)}if(p.emissiveTexture!==void 0){const $=p.emissiveTexture,Q=o.textures[V[$.index].source];R.setEmissiveTexture(Q),o.setTextureInfo(R.getEmissiveTextureInfo(),$)}if(p.normalTexture!==void 0){const $=p.normalTexture,Q=o.textures[V[$.index].source];R.setNormalTexture(Q),o.setTextureInfo(R.getNormalTextureInfo(),$),p.normalTexture.scale!==void 0&&R.setNormalScale(p.normalTexture.scale)}if(p.occlusionTexture!==void 0){const $=p.occlusionTexture,Q=o.textures[V[$.index].source];R.setOcclusionTexture(Q),o.setTextureInfo(R.getOcclusionTextureInfo(),$),p.occlusionTexture.strength!==void 0&&R.setOcclusionStrength(p.occlusionTexture.strength)}if(b.metallicRoughnessTexture!==void 0){const $=b.metallicRoughnessTexture,Q=o.textures[V[$.index].source];R.setMetallicRoughnessTexture(Q),o.setTextureInfo(R.getMetallicRoughnessTextureInfo(),$)}return R}),i.getRoot().listExtensionsUsed().filter(p=>p.prereadTypes.includes(k.MESH)).forEach(p=>p.preread(o,k.MESH));const x=s.meshes||[];i.getRoot().listExtensionsUsed().filter(p=>p.prereadTypes.includes(k.PRIMITIVE)).forEach(p=>p.preread(o,k.PRIMITIVE)),o.meshes=x.map(p=>{const R=i.createMesh(p.name);return p.extras&&R.setExtras(p.extras),p.weights!==void 0&&R.setWeights(p.weights),(p.primitives||[]).forEach($=>{const Q=i.createPrimitive();$.extras&&Q.setExtras($.extras),$.material!==void 0&&Q.setMaterial(o.materials[$.material]),$.mode!==void 0&&Q.setMode($.mode);for(const[Ee,me]of Object.entries($.attributes||{}))Q.setAttribute(Ee,o.accessors[me]);$.indices!==void 0&&Q.setIndices(o.accessors[$.indices]);const ee=p.extras&&p.extras.targetNames||[];($.targets||[]).forEach((Ee,me)=>{const be=ee[me]||me.toString(),Ie=i.createPrimitiveTarget(be);for(const[He,We]of Object.entries(Ee))Ie.setAttribute(He,o.accessors[We]);Q.addTarget(Ie)}),R.addPrimitive(Q)}),R});const U=s.cameras||[];o.cameras=U.map(p=>{const R=i.createCamera(p.name).setType(p.type);if(p.extras&&R.setExtras(p.extras),p.type===Zn.Type.PERSPECTIVE){const b=p.perspective;R.setYFov(b.yfov),R.setZNear(b.znear),b.zfar!==void 0&&R.setZFar(b.zfar),b.aspectRatio!==void 0&&R.setAspectRatio(b.aspectRatio)}else{const b=p.orthographic;R.setZNear(b.znear).setZFar(b.zfar).setXMag(b.xmag).setYMag(b.ymag)}return R});const _=s.nodes||[];i.getRoot().listExtensionsUsed().filter(p=>p.prereadTypes.includes(k.NODE)).forEach(p=>p.preread(o,k.NODE)),o.nodes=_.map(p=>{const R=i.createNode(p.name);if(p.extras&&R.setExtras(p.extras),p.translation!==void 0&&R.setTranslation(p.translation),p.rotation!==void 0&&R.setRotation(p.rotation),p.scale!==void 0&&R.setScale(p.scale),p.matrix!==void 0){const b=[0,0,0],$=[0,0,0,1],Q=[1,1,1];Xe.decompose(p.matrix,b,$,Q),R.setTranslation(b),R.setRotation($),R.setScale(Q)}return p.weights!==void 0&&R.setWeights(p.weights),R});const C=s.skins||[];o.skins=C.map(p=>{const R=i.createSkin(p.name);p.extras&&R.setExtras(p.extras),p.inverseBindMatrices!==void 0&&R.setInverseBindMatrices(o.accessors[p.inverseBindMatrices]),p.skeleton!==void 0&&R.setSkeleton(o.nodes[p.skeleton]);for(const b of p.joints)R.addJoint(o.nodes[b]);return R}),_.map((p,R)=>{const b=o.nodes[R];(p.children||[]).forEach(Q=>b.addChild(o.nodes[Q])),p.mesh!==void 0&&b.setMesh(o.meshes[p.mesh]),p.camera!==void 0&&b.setCamera(o.cameras[p.camera]),p.skin!==void 0&&b.setSkin(o.skins[p.skin])});const F=s.animations||[];o.animations=F.map(p=>{const R=i.createAnimation(p.name);p.extras&&R.setExtras(p.extras);const $=(p.samplers||[]).map(ee=>{const fe=i.createAnimationSampler().setInput(o.accessors[ee.input]).setOutput(o.accessors[ee.output]).setInterpolation(ee.interpolation||dr.Interpolation.LINEAR);return ee.extras&&fe.setExtras(ee.extras),R.addSampler(fe),fe});return(p.channels||[]).forEach(ee=>{const fe=i.createAnimationChannel().setSampler($[ee.sampler]).setTargetPath(ee.target.path);ee.target.node!==void 0&&fe.setTargetNode(o.nodes[ee.target.node]),ee.extras&&fe.setExtras(ee.extras),R.addChannel(fe)}),R});const B=s.scenes||[];return i.getRoot().listExtensionsUsed().filter(p=>p.prereadTypes.includes(k.SCENE)).forEach(p=>p.preread(o,k.SCENE)),o.scenes=B.map(p=>{const R=i.createScene(p.name);return p.extras&&R.setExtras(p.extras),(p.nodes||[]).map($=>o.nodes[$]).forEach($=>R.addChild($)),R}),s.scene!==void 0&&i.getRoot().setDefaultScene(o.scenes[s.scene]),i.getRoot().listExtensionsUsed().forEach(p=>p.read(o)),T.forEach((p,R)=>{const b=o.accessors[R],$=!!p.sparse,Q=!p.bufferView&&!b.getArray();($||Q)&&b.setSparse(!0).setArray(Xu(p,o))}),i}static validate(e,t){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!t.extensions.find(i=>i.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)t.extensions.find(i=>i.EXTENSION_NAME===s)||t.logger.warn(`Missing optional extension, "${s}".`)}}function Wu(r,e){const t=e.jsonDoc,n=e.bufferViews[r.bufferView],s=t.json.bufferViews[r.bufferView],i=hs[r.componentType],o=oe.getElementSize(r.type),a=i.BYTES_PER_ELEMENT,u=r.byteOffset||0,f=new i(r.count*o),y=new DataView(n.buffer,n.byteOffset,n.byteLength),E=s.byteStride;for(let d=0;d<r.count;d++)for(let T=0;T<o;T++){const N=u+d*E+T*a;let V;switch(r.componentType){case oe.ComponentType.FLOAT:V=y.getFloat32(N,!0);break;case oe.ComponentType.UNSIGNED_INT:V=y.getUint32(N,!0);break;case oe.ComponentType.UNSIGNED_SHORT:V=y.getUint16(N,!0);break;case oe.ComponentType.UNSIGNED_BYTE:V=y.getUint8(N);break;case oe.ComponentType.SHORT:V=y.getInt16(N,!0);break;case oe.ComponentType.BYTE:V=y.getInt8(N);break;default:throw new Error(`Unexpected componentType "${r.componentType}".`)}f[d*o+T]=V}return f}function Jr(r,e){const t=e.jsonDoc,n=e.bufferViews[r.bufferView],s=t.json.bufferViews[r.bufferView],i=hs[r.componentType],o=oe.getElementSize(r.type),a=i.BYTES_PER_ELEMENT,u=o*a;if(s.byteStride!==void 0&&s.byteStride!==u)return Wu(r,e);const f=n.byteOffset+(r.byteOffset||0),y=r.count*o*a;return new i(n.buffer.slice(f,f+y))}function Xu(r,e){const t=hs[r.componentType],n=oe.getElementSize(r.type);let s;r.bufferView!==void 0?s=Jr(r,e):s=new t(r.count*n);const i=r.sparse;if(!i)return s;const o=i.count,a=St({},r,i.indices,{count:o,type:"SCALAR"}),u=St({},r,i.values,{count:o}),f=Jr(a,e),y=Jr(u,e);for(let E=0;E<a.count;E++)for(let d=0;d<n;d++)s[f[E]*n+d]=y[E*n+d];return s}var Cr;(function(r){r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Cr||(Cr={}));class en{constructor(e,t,n){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=t,this.options=n;const s=e.getRoot(),i=s.listBuffers().length,o=s.listTextures().length;this.bufferURIGenerator=new Yi(i>1,()=>n.basename||"buffer"),this.imageURIGenerator=new Yi(o>1,a=>Ku(e,a)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},o=JSON.stringify(i);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const a={index:this.textureDefIndexMap.get(o)};return t.getTexCoord()!==0&&(a.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(a.extras=t.getExtras()),this.textureInfoDefMap.set(t,a),a}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===jn.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const s=sn.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.assignResourceURI(e.uri,t,!1)}}assignResourceURI(e,t,n){const s=this.jsonDoc.resources;if(!(e in s)){s[e]=t;return}if(t===s[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const i=`Resource URI "${e}" already assigned to different data.`;if(!n){this.logger.warn(i);return}throw new Error(i)}getAccessorUsage(e){const t=this._accessorUsageMap.get(e);if(t)return t;if(e.getSparse())return Ut.SPARSE;for(const n of this._doc.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==k.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Ut.OTHER}addAccessorToUsageGroup(e,t){const n=this._accessorUsageMap.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this._accessorUsageMap.set(e,t),this}}en.BufferViewTarget=Cr;en.BufferViewUsage=Ut;en.USAGE_TO_TARGET={[Ut.ARRAY_BUFFER]:Cr.ARRAY_BUFFER,[Ut.ELEMENT_ARRAY_BUFFER]:Cr.ELEMENT_ARRAY_BUFFER};class Yi{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}else return`${this.basename(e)}.${t}`}}function Ku(r,e){const t=r.getGraph().listParentEdges(e).find(n=>n.getParent()!==r.getRoot());return t?t.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Wr}=en,{UNSIGNED_INT:qu,UNSIGNED_SHORT:Yu,UNSIGNED_BYTE:Ju}=oe.ComponentType,Zu=new Set([k.ACCESSOR,k.BUFFER,k.MATERIAL,k.MESH]);class Qu{static write(e,t){const n=e.getGraph(),s=e.getRoot(),i={asset:St({generator:`glTF-Transform ${Co}`},s.getAsset()),extras:St({},s.getExtras())},o={json:i,resources:{}},a=new en(e,o,t),u=t.logger||zt.DEFAULT_INSTANCE,f=new Set(t.extensions.map(x=>x.EXTENSION_NAME)),y=e.getRoot().listExtensionsUsed().filter(x=>f.has(x.extensionName)).sort((x,U)=>x.extensionName>U.extensionName?1:-1),E=e.getRoot().listExtensionsRequired().filter(x=>f.has(x.extensionName)).sort((x,U)=>x.extensionName>U.extensionName?1:-1);y.length<e.getRoot().listExtensionsUsed().length&&u.warn("Some extensions were not registered for I/O, and will not be written.");for(const x of y){const U=x.prewriteTypes.filter(_=>!Zu.has(_));U.length&&u.warn(`Prewrite hooks for some types (${U.join()}), requested by extension ${x.extensionName}, are unsupported. Please file an issue or a PR.`);for(const _ of x.writeDependencies)x.install(_,t.dependencies[_])}function d(x,U,_,C){const F=[];let B=0;for(const b of x){const $=a.createAccessorDef(b);$.bufferView=i.bufferViews.length;const Q=b.getArray(),ee=Ce.pad(Ce.toView(Q));$.byteOffset=B,B+=ee.byteLength,F.push(ee),a.accessorIndexMap.set(b,i.accessors.length),i.accessors.push($)}const p=Ce.concat(F),R={buffer:U,byteOffset:_,byteLength:p.byteLength};return C&&(R.target=C),i.bufferViews.push(R),{buffers:F,byteLength:B}}function T(x,U,_){const C=x[0].getCount();let F=0;for(const $ of x){const Q=a.createAccessorDef($);Q.bufferView=i.bufferViews.length,Q.byteOffset=F;const ee=$.getElementSize(),fe=$.getComponentSize();F+=Ce.padNumber(ee*fe),a.accessorIndexMap.set($,i.accessors.length),i.accessors.push(Q)}const B=C*F,p=new ArrayBuffer(B),R=new DataView(p);for(let $=0;$<C;$++){let Q=0;for(const ee of x){const fe=ee.getElementSize(),Ee=ee.getComponentSize(),me=ee.getComponentType(),be=ee.getArray();for(let Ie=0;Ie<fe;Ie++){const He=$*F+Q+Ie*Ee,We=be[$*fe+Ie];switch(me){case oe.ComponentType.FLOAT:R.setFloat32(He,We,!0);break;case oe.ComponentType.BYTE:R.setInt8(He,We);break;case oe.ComponentType.SHORT:R.setInt16(He,We,!0);break;case oe.ComponentType.UNSIGNED_BYTE:R.setUint8(He,We);break;case oe.ComponentType.UNSIGNED_SHORT:R.setUint16(He,We,!0);break;case oe.ComponentType.UNSIGNED_INT:R.setUint32(He,We,!0);break;default:throw new Error("Unexpected component type: "+me)}}Q+=Ce.padNumber(fe*Ee)}}const b={buffer:U,byteOffset:_,byteLength:B,byteStride:F,target:en.BufferViewTarget.ARRAY_BUFFER};return i.bufferViews.push(b),{byteLength:B,buffers:[new Uint8Array(p)]}}function N(x,U,_){const C=[];let F=0;const B=new Map;let p=-1/0,R=!1;for(const me of x){const be=a.createAccessorDef(me);i.accessors.push(be),a.accessorIndexMap.set(me,i.accessors.length-1);const Ie=[],He=[],We=[],kt=new Array(me.getElementSize()).fill(0);for(let tt=0,A=me.getCount();tt<A;tt++)if(me.getElement(tt,We),!Xe.eq(We,kt,0)){p=Math.max(tt,p),Ie.push(tt);for(let De=0;De<We.length;De++)He.push(We[De])}const lt=Ie.length,Tt={accessorDef:be,count:lt};if(B.set(me,Tt),lt===0)continue;lt>me.getCount()/2&&(R=!0);const Et=hs[me.getComponentType()];Tt.indices=Ie,Tt.values=new Et(He)}if(!Number.isFinite(p))return{buffers:C,byteLength:F};R&&u.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const b=p<255?Uint8Array:p<65535?Uint16Array:Uint32Array,$=p<255?Ju:p<65535?Yu:qu,Q={buffer:U,byteOffset:_+F,byteLength:0};for(const me of x){const be=B.get(me);if(be.count===0)continue;be.indicesByteOffset=Q.byteLength;const Ie=Ce.pad(Ce.toView(new b(be.indices)));C.push(Ie),F+=Ie.byteLength,Q.byteLength+=Ie.byteLength}i.bufferViews.push(Q);const ee=i.bufferViews.length-1,fe={buffer:U,byteOffset:_+F,byteLength:0};for(const me of x){const be=B.get(me);if(be.count===0)continue;be.valuesByteOffset=fe.byteLength;const Ie=Ce.pad(Ce.toView(be.values));C.push(Ie),F+=Ie.byteLength,fe.byteLength+=Ie.byteLength}i.bufferViews.push(fe);const Ee=i.bufferViews.length-1;for(const me of x){const be=B.get(me);be.count!==0&&(be.accessorDef.sparse={count:be.count,indices:{bufferView:ee,byteOffset:be.indicesByteOffset,componentType:$},values:{bufferView:Ee,byteOffset:be.valuesByteOffset}})}return{buffers:C,byteLength:F}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=s.listTextures().map((x,U)=>{const _=a.createPropertyDef(x);x.getMimeType()&&(_.mimeType=x.getMimeType());const C=x.getImage();return C&&a.createImageData(_,C,x),a.imageIndexMap.set(x,U),_}),y.filter(x=>x.prewriteTypes.includes(k.ACCESSOR)).forEach(x=>x.prewrite(a,k.ACCESSOR)),s.listAccessors().forEach(x=>{const U=a.accessorUsageGroupedByParent,_=a.accessorParents;if(a.accessorIndexMap.has(x))return;const C=a.getAccessorUsage(x);if(a.addAccessorToUsageGroup(x,C),U.has(C)){const F=n.listParents(x).find(B=>B.propertyType!==k.ROOT);_.set(x,F)}}),y.filter(x=>x.prewriteTypes.includes(k.BUFFER)).forEach(x=>x.prewrite(a,k.BUFFER)),(s.listAccessors().length>0||a.otherBufferViews.size>0||s.listTextures().length>0&&t.format===jn.GLB)&&s.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],s.listBuffers().forEach((x,U)=>{const _=a.createPropertyDef(x),C=a.accessorUsageGroupedByParent,F=x.listParents().filter(fe=>fe instanceof oe),B=new Set(F.map(fe=>a.accessorParents.get(fe))),p=new Map(Array.from(B).map((fe,Ee)=>[fe,Ee])),R={};for(const fe of F){var b;if(a.accessorIndexMap.has(fe))continue;const Ee=a.getAccessorUsage(fe);let me=Ee;if(C.has(Ee)){const be=a.accessorParents.get(fe);me+=`:${p.get(be)}`}R[b=me]||(R[b]={usage:Ee,accessors:[]}),R[me].accessors.push(fe)}const $=[],Q=i.buffers.length;let ee=0;for(const{usage:fe,accessors:Ee}of Object.values(R))if(fe===Wr.ARRAY_BUFFER&&t.vertexLayout===rs.INTERLEAVED){const me=T(Ee,Q,ee);ee+=me.byteLength;for(const be of me.buffers)$.push(be)}else if(fe===Wr.ARRAY_BUFFER)for(const me of Ee){const be=T([me],Q,ee);ee+=be.byteLength;for(const Ie of be.buffers)$.push(Ie)}else if(fe===Wr.SPARSE){const me=N(Ee,Q,ee);ee+=me.byteLength;for(const be of me.buffers)$.push(be)}else if(fe===Wr.ELEMENT_ARRAY_BUFFER){const me=en.BufferViewTarget.ELEMENT_ARRAY_BUFFER,be=d(Ee,Q,ee,me);ee+=be.byteLength;for(const Ie of be.buffers)$.push(Ie)}else{const me=d(Ee,Q,ee);ee+=me.byteLength;for(const be of me.buffers)$.push(be)}if(a.imageBufferViews.length&&U===0){for(let fe=0;fe<a.imageBufferViews.length;fe++)if(i.bufferViews[i.images[fe].bufferView].byteOffset=ee,ee+=a.imageBufferViews[fe].byteLength,$.push(a.imageBufferViews[fe]),ee%8){const Ee=8-ee%8;ee+=Ee,$.push(new Uint8Array(Ee))}}if(a.otherBufferViews.has(x))for(const fe of a.otherBufferViews.get(x))i.bufferViews.push({buffer:Q,byteOffset:ee,byteLength:fe.byteLength}),a.otherBufferViewsIndexMap.set(fe,i.bufferViews.length-1),ee+=fe.byteLength,$.push(fe);if(ee){let fe;t.format===jn.GLB?fe=ar:(fe=a.bufferURIGenerator.createURI(x,"bin"),_.uri=fe),_.byteLength=ee,a.assignResourceURI(fe,Ce.concat($),!0)}i.buffers.push(_),a.bufferIndexMap.set(x,U)}),s.listAccessors().find(x=>!x.getBuffer())&&u.warn("Skipped writing one or more Accessors: no Buffer assigned."),y.filter(x=>x.prewriteTypes.includes(k.MATERIAL)).forEach(x=>x.prewrite(a,k.MATERIAL)),i.materials=s.listMaterials().map((x,U)=>{const _=a.createPropertyDef(x);if(x.getAlphaMode()!==Vn.AlphaMode.OPAQUE&&(_.alphaMode=x.getAlphaMode()),x.getAlphaMode()===Vn.AlphaMode.MASK&&(_.alphaCutoff=x.getAlphaCutoff()),x.getDoubleSided()&&(_.doubleSided=!0),_.pbrMetallicRoughness={},Xe.eq(x.getBaseColorFactor(),[1,1,1,1])||(_.pbrMetallicRoughness.baseColorFactor=x.getBaseColorFactor()),Xe.eq(x.getEmissiveFactor(),[0,0,0])||(_.emissiveFactor=x.getEmissiveFactor()),x.getRoughnessFactor()!==1&&(_.pbrMetallicRoughness.roughnessFactor=x.getRoughnessFactor()),x.getMetallicFactor()!==1&&(_.pbrMetallicRoughness.metallicFactor=x.getMetallicFactor()),x.getBaseColorTexture()){const C=x.getBaseColorTexture(),F=x.getBaseColorTextureInfo();_.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(C,F)}if(x.getEmissiveTexture()){const C=x.getEmissiveTexture(),F=x.getEmissiveTextureInfo();_.emissiveTexture=a.createTextureInfoDef(C,F)}if(x.getNormalTexture()){const C=x.getNormalTexture(),F=x.getNormalTextureInfo(),B=a.createTextureInfoDef(C,F);x.getNormalScale()!==1&&(B.scale=x.getNormalScale()),_.normalTexture=B}if(x.getOcclusionTexture()){const C=x.getOcclusionTexture(),F=x.getOcclusionTextureInfo(),B=a.createTextureInfoDef(C,F);x.getOcclusionStrength()!==1&&(B.strength=x.getOcclusionStrength()),_.occlusionTexture=B}if(x.getMetallicRoughnessTexture()){const C=x.getMetallicRoughnessTexture(),F=x.getMetallicRoughnessTextureInfo();_.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(C,F)}return a.materialIndexMap.set(x,U),_}),y.filter(x=>x.prewriteTypes.includes(k.MESH)).forEach(x=>x.prewrite(a,k.MESH)),i.meshes=s.listMeshes().map((x,U)=>{const _=a.createPropertyDef(x);let C=null;return _.primitives=x.listPrimitives().map(F=>{const B={attributes:{}};B.mode=F.getMode();const p=F.getMaterial();p&&(B.material=a.materialIndexMap.get(p)),Object.keys(F.getExtras()).length&&(B.extras=F.getExtras());const R=F.getIndices();R&&(B.indices=a.accessorIndexMap.get(R));for(const b of F.listSemantics())B.attributes[b]=a.accessorIndexMap.get(F.getAttribute(b));for(const b of F.listTargets()){const $={};for(const Q of b.listSemantics())$[Q]=a.accessorIndexMap.get(b.getAttribute(Q));B.targets=B.targets||[],B.targets.push($)}return F.listTargets().length&&!C&&(C=F.listTargets().map(b=>b.getName())),B}),x.getWeights().length&&(_.weights=x.getWeights()),C&&(_.extras=_.extras||{},_.extras.targetNames=C),a.meshIndexMap.set(x,U),_}),i.cameras=s.listCameras().map((x,U)=>{const _=a.createPropertyDef(x);if(_.type=x.getType(),_.type===Zn.Type.PERSPECTIVE){_.perspective={znear:x.getZNear(),zfar:x.getZFar(),yfov:x.getYFov()};const C=x.getAspectRatio();C!==null&&(_.perspective.aspectRatio=C)}else _.orthographic={znear:x.getZNear(),zfar:x.getZFar(),xmag:x.getXMag(),ymag:x.getYMag()};return a.cameraIndexMap.set(x,U),_}),i.nodes=s.listNodes().map((x,U)=>{const _=a.createPropertyDef(x);return Xe.eq(x.getTranslation(),[0,0,0])||(_.translation=x.getTranslation()),Xe.eq(x.getRotation(),[0,0,0,1])||(_.rotation=x.getRotation()),Xe.eq(x.getScale(),[1,1,1])||(_.scale=x.getScale()),x.getWeights().length&&(_.weights=x.getWeights()),a.nodeIndexMap.set(x,U),_}),i.skins=s.listSkins().map((x,U)=>{const _=a.createPropertyDef(x),C=x.getInverseBindMatrices();C&&(_.inverseBindMatrices=a.accessorIndexMap.get(C));const F=x.getSkeleton();return F&&(_.skeleton=a.nodeIndexMap.get(F)),_.joints=x.listJoints().map(B=>a.nodeIndexMap.get(B)),a.skinIndexMap.set(x,U),_}),s.listNodes().forEach((x,U)=>{const _=i.nodes[U],C=x.getMesh();C&&(_.mesh=a.meshIndexMap.get(C));const F=x.getCamera();F&&(_.camera=a.cameraIndexMap.get(F));const B=x.getSkin();B&&(_.skin=a.skinIndexMap.get(B)),x.listChildren().length>0&&(_.children=x.listChildren().map(p=>a.nodeIndexMap.get(p)))}),i.animations=s.listAnimations().map((x,U)=>{const _=a.createPropertyDef(x),C=new Map;return _.samplers=x.listSamplers().map((F,B)=>{const p=a.createPropertyDef(F);return p.input=a.accessorIndexMap.get(F.getInput()),p.output=a.accessorIndexMap.get(F.getOutput()),p.interpolation=F.getInterpolation(),C.set(F,B),p}),_.channels=x.listChannels().map(F=>{const B=a.createPropertyDef(F);return B.sampler=C.get(F.getSampler()),B.target={node:a.nodeIndexMap.get(F.getTargetNode()),path:F.getTargetPath()},B}),a.animationIndexMap.set(x,U),_}),i.scenes=s.listScenes().map((x,U)=>{const _=a.createPropertyDef(x);return _.nodes=x.listChildren().map(C=>a.nodeIndexMap.get(C)),a.sceneIndexMap.set(x,U),_});const W=s.getDefaultScene();return W&&(i.scene=s.listScenes().indexOf(W)),i.extensionsUsed=y.map(x=>x.extensionName),i.extensionsRequired=E.map(x=>x.extensionName),y.forEach(x=>x.write(a)),ef(i),o}}function ef(r){const e=[];for(const t in r){const n=r[t];(Array.isArray(n)&&n.length===0||n===null||n===""||n&&typeof n=="object"&&Object.keys(n).length===0)&&e.push(t)}for(const t of e)delete r[t]}var is;(function(r){r[r.JSON=1313821514]="JSON",r[r.BIN=5130562]="BIN"})(is||(is={}));class tf{constructor(){this._logger=zt.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=rs.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const t of e)this._extensions.add(t),t.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=Ji(t)?this._binaryToJSON(t):{json:JSON.parse(Ce.decodeText(t)),resources:{}};return await this._readResourcesExternal(n,this.dirname(e)),this._readResourcesInternal(n),n}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),zu.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const t=this._binaryToJSON(Ce.assertView(e));this._readResourcesInternal(t);const n=t.json;if(n.buffers&&n.buffers.some(s=>nf(t,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>rf(t,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Ce.assertView(e)))}async writeJSON(e,t={}){if(t.format===jn.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return Qu.write(e,{format:t.format||jn.GLTF,basename:t.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:St({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:jn.GLB}),s=new Uint32Array([1179937895,2,12]),i=JSON.stringify(t),o=Ce.pad(Ce.encodeText(i),32),a=Ce.toView(new Uint32Array([o.byteLength,1313821514])),u=Ce.concat([a,o]);s[s.length-1]+=u.byteLength;const f=Object.values(n)[0];if(!f||!f.byteLength)return Ce.concat([Ce.toView(s),u]);const y=Ce.pad(f,0),E=Ce.toView(new Uint32Array([y.byteLength,5130562])),d=Ce.concat([E,y]);return s[s.length-1]+=d.byteLength,Ce.concat([Ce.toView(s),u,d])}async _readResourcesExternal(e,t){var n=this;const s=e.json.images||[],i=e.json.buffers||[],o=[...s,...i].map(async function(a){const u=a.uri;if(!u||u.match(/data:/))return Promise.resolve();e.resources[u]=await n.readURI(n.resolve(t,u),"view"),n.lastReadBytes+=e.resources[u].byteLength});await Promise.all(o)}_readResourcesInternal(e){function t(i){if(i.uri){if(i.uri in e.resources){Ce.assertView(e.resources[i.uri]);return}if(i.uri.match(/data:/)){const o=`__${ju()}.${cr.extension(i.uri)}`;e.resources[o]=Ce.createBufferFromDataURI(i.uri),i.uri=o}}}(e.json.images||[]).forEach(i=>{if(i.bufferView===void 0&&i.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(i)}),(e.json.buffers||[]).forEach(t)}_copyJSON(e){const{images:t,buffers:n}=e.json;return e={json:St({},e.json),resources:St({},e.resources)},t&&(e.json.images=t.map(s=>St({},s))),n&&(e.json.buffers=n.map(s=>St({},s))),e}_binaryToJSON(e){if(!Ji(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==is.JSON)throw new Error("Missing required GLB JSON chunk.");const n=20,s=t[0],i=Ce.decodeText(Ce.toView(e,n,s)),o=JSON.parse(i),a=n+s;if(e.byteLength<=a)return{json:o,resources:{}};const u=new Uint32Array(e.buffer,e.byteOffset+a,2);if(u[1]!==is.BIN)return{json:o,resources:{}};const f=u[0],y=Ce.toView(e,a+8,f);return{json:o,resources:{[ar]:y}}}}function nf(r,e){return e.uri!==void 0&&!(e.uri in r.resources)}function rf(r,e){return e.uri!==void 0&&!(e.uri in r.resources)&&e.bufferView===void 0}function Ji(r){if(r.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(r.buffer,r.byteOffset,3);return e[0]===1179937895&&e[1]===2}class sf extends tf{constructor(e=Nr.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,t){const n=await fetch(e,this._fetchConfig);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return Nr.resolve(e,t)}dirname(e){return Nr.dirname(e)}}const of=0,af=0,cf=0,lf=2,uf=0,ff=163,hf=166,df=0,pf=2,gf=1,mf=64,yf=0;function Tf(){return{vkFormat:yf,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,levelCount:0,supercompressionScheme:of,levels:[],dataFormatDescriptor:[{vendorId:cf,descriptorType:af,versionNumber:lf,colorModel:uf,colorPrimaries:gf,transferFunction:pf,flags:df,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null}}class Er{constructor(e,t,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const It=[171,75,84,88,32,50,48,187,13,10,26,10];function Zi(r){return new TextDecoder().decode(r)}function Us(r){const e=new Uint8Array(r.buffer,r.byteOffset,It.length);if(e[0]!==It[0]||e[1]!==It[1]||e[2]!==It[2]||e[3]!==It[3]||e[4]!==It[4]||e[5]!==It[5]||e[6]!==It[6]||e[7]!==It[7]||e[8]!==It[8]||e[9]!==It[9]||e[10]!==It[10]||e[11]!==It[11])throw new Error("Missing KTX 2.0 identifier.");const t=Tf(),n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Er(r,It.length,n,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32(),t.levelCount=s._nextUint32(),t.supercompressionScheme=s._nextUint32();const i=s._nextUint32(),o=s._nextUint32(),a=s._nextUint32(),u=s._nextUint32(),f=s._nextUint64(),y=s._nextUint64(),E=Math.max(t.levelCount,1)*3*8,d=new Er(r,It.length+n,E,!0);for(let Ve=0,it=Math.max(t.levelCount,1);Ve<it;Ve++)t.levels.push({levelData:new Uint8Array(r.buffer,r.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const T=new Er(r,i,o,!0);T._skip(4);const N=T._nextUint16(),V=T._nextUint16(),W=T._nextUint16(),x=T._nextUint16(),U=T._nextUint8(),_=T._nextUint8(),C=T._nextUint8(),F=T._nextUint8(),B=[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],p=[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],b={vendorId:N,descriptorType:V,versionNumber:W,colorModel:U,colorPrimaries:_,transferFunction:C,flags:F,texelBlockDimension:B,bytesPlane:p,samples:[]},ee=(x/4-6)/4;for(let Ve=0;Ve<ee;Ve++){const it={bitOffset:T._nextUint16(),bitLength:T._nextUint8(),channelType:T._nextUint8(),samplePosition:[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};it.channelType&mf?(it.sampleLower=T._nextInt32(),it.sampleUpper=T._nextInt32()):(it.sampleLower=T._nextUint32(),it.sampleUpper=T._nextUint32()),b.samples[Ve]=it}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(b);const fe=new Er(r,a,u,!0);for(;fe._offset<u;){const Ve=fe._nextUint32(),it=fe._scan(Ve),Mt=Zi(it);if(t.keyValue[Mt]=fe._nextUint8Array(Ve-it.byteLength-1),Mt.match(/^ktx/i)){const Ot=Zi(t.keyValue[Mt]);t.keyValue[Mt]=Ot.substring(0,Ot.lastIndexOf("\0"))}const on=Ve%4?4-Ve%4:0;fe._skip(on)}if(y<=0)return t;const Ee=new Er(r,f,y,!0),me=Ee._nextUint16(),be=Ee._nextUint16(),Ie=Ee._nextUint32(),He=Ee._nextUint32(),We=Ee._nextUint32(),kt=Ee._nextUint32(),lt=[];for(let Ve=0,it=Math.max(t.levelCount,1);Ve<it;Ve++)lt.push({imageFlags:Ee._nextUint32(),rgbSliceByteOffset:Ee._nextUint32(),rgbSliceByteLength:Ee._nextUint32(),alphaSliceByteOffset:Ee._nextUint32(),alphaSliceByteLength:Ee._nextUint32()});const Tt=f+Ee._offset,Et=Tt+Ie,tt=Et+He,A=tt+We,De=new Uint8Array(r.buffer,r.byteOffset+Tt,Ie),Dn=new Uint8Array(r.buffer,r.byteOffset+Et,He),tn=new Uint8Array(r.buffer,r.byteOffset+tt,We),_t=new Uint8Array(r.buffer,r.byteOffset+A,kt);return t.globalData={endpointCount:me,selectorCount:be,imageDescs:lt,endpointsData:De,selectorsData:Dn,tablesData:tn,extendedData:_t},t}const Tn="EXT_mesh_gpu_instancing",xt="EXT_meshopt_compression",br="EXT_texture_webp",_r="EXT_texture_avif",rt="KHR_draco_mesh_compression",Vt="KHR_lights_punctual",xn="KHR_materials_anisotropy",vn="KHR_materials_clearcoat",En="KHR_materials_diffuse_transmission",wn="KHR_materials_dispersion",bn="KHR_materials_emissive_strength",_n="KHR_materials_ior",Rn="KHR_materials_iridescence",In="KHR_materials_pbrSpecularGlossiness",Sn="KHR_materials_sheen",An="KHR_materials_specular",Mn="KHR_materials_transmission",Un="KHR_materials_unlit",Nn="KHR_materials_volume",wt="KHR_materials_variants",Go="KHR_mesh_quantization",Rr="KHR_texture_basisu",Cn="KHR_texture_transform",Gt="KHR_xmp_json_ld",Ys="INSTANCE_ATTRIBUTE";class Ho extends st{init(){this.extensionName=Tn,this.propertyType="InstancedMesh",this.parentTypes=[k.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new Qt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ys})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Ho.EXTENSION_NAME=Tn;class zo extends Ze{constructor(...e){super(...e),this.extensionName=Tn,this.provideTypes=[k.NODE],this.prewriteTypes=[k.ACCESSOR]}createInstancedMesh(){return new Ho(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[Tn])return;const o=s.extensions[Tn],a=this.createInstancedMesh();for(const u in o.attributes)a.setAttribute(u,e.accessors[o.attributes[u]]);e.nodes[i].setExtension(Tn,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Ys);for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,Ys);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(Tn);if(s){const i=e.nodeIndexMap.get(n),o=t.json.nodes[i],a={attributes:{}};s.listSemantics().forEach(u=>{const f=s.getAttribute(u);a.attributes[u]=e.accessorIndexMap.get(f)}),o.extensions=o.extensions||{},o.extensions[Tn]=a}}),this}}zo.EXTENSION_NAME=Tn;function On(){return On=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},On.apply(null,arguments)}var Or;(function(r){r.QUANTIZE="quantize",r.FILTER="filter"})(Or||(Or={}));var or;(function(r){r.ATTRIBUTES="ATTRIBUTES",r.TRIANGLES="TRIANGLES",r.INDICES="INDICES"})(or||(or={}));var ct;(function(r){r.NONE="NONE",r.OCTAHEDRAL="OCTAHEDRAL",r.QUATERNION="QUATERNION",r.EXPONENTIAL="EXPONENTIAL"})(ct||(ct={}));function xf(r){return!r.extensions||!r.extensions[xt]?!1:!!r.extensions[xt].fallback}const{BYTE:vf,SHORT:Qi,FLOAT:Ef}=oe.ComponentType,{encodeNormalizedInt:eo,decodeNormalizedInt:Js}=Xe;function wf(r,e,t,n){const{filter:s,bits:i}=n,o={array:r.getArray(),byteStride:r.getElementSize()*r.getComponentSize(),componentType:r.getComponentType(),normalized:r.getNormalized()};if(t!==or.ATTRIBUTES)return o;if(s!==ct.NONE){let a=r.getNormalized()?bf(r):new Float32Array(o.array);switch(s){case ct.EXPONENTIAL:o.byteStride=r.getElementSize()*4,o.componentType=Ef,o.normalized=!1,o.array=e.encodeFilterExp(a,r.getCount(),o.byteStride,i);break;case ct.OCTAHEDRAL:o.byteStride=i>8?8:4,o.componentType=i>8?Qi:vf,o.normalized=!0,a=r.getElementSize()===3?Rf(a):a,o.array=e.encodeFilterOct(a,r.getCount(),o.byteStride,i);break;case ct.QUATERNION:o.byteStride=8,o.componentType=Qi,o.normalized=!0,o.array=e.encodeFilterQuat(a,r.getCount(),o.byteStride,i);break;default:throw new Error("Invalid filter.")}o.min=r.getMin([]),o.max=r.getMax([]),r.getNormalized()&&(o.min=o.min.map(u=>Js(u,r.getComponentType())),o.max=o.max.map(u=>Js(u,r.getComponentType()))),o.normalized&&(o.min=o.min.map(u=>eo(u,o.componentType)),o.max=o.max.map(u=>eo(u,o.componentType)))}else o.byteStride%4&&(o.array=_f(o.array,r.getElementSize()),o.byteStride=o.array.byteLength/r.getCount());return o}function bf(r){const e=r.getComponentType(),t=r.getArray(),n=new Float32Array(t.length);for(let s=0;s<t.length;s++)n[s]=Js(t[s],e);return n}function _f(r,e){const n=Ce.padNumber(r.BYTES_PER_ELEMENT*e)/r.BYTES_PER_ELEMENT,s=r.length/e,i=new r.constructor(s*n);for(let o=0;o*e<r.length;o++)for(let a=0;a<e;a++)i[o*n+a]=r[o*e+a];return i}function Rf(r){const e=new Float32Array(r.length*4/3);for(let t=0,n=r.length/3;t<n;t++)e[t*4]=r[t*3],e[t*4+1]=r[t*3+1],e[t*4+2]=r[t*3+2];return e}function If(r,e){return e===en.BufferViewUsage.ELEMENT_ARRAY_BUFFER?r.listParents().some(n=>n instanceof qn&&n.getMode()===qn.Mode.TRIANGLES)?or.TRIANGLES:or.INDICES:or.ATTRIBUTES}function Sf(r,e){const t=e.getGraph().listParentEdges(r).filter(n=>!(n.getParent()instanceof Vo));for(const n of t){const s=n.getName(),i=n.getAttributes().key||"",o=n.getParent().propertyType===k.PRIMITIVE_TARGET;if(s==="indices")return{filter:ct.NONE};if(s==="attributes"){if(i==="POSITION")return{filter:ct.NONE};if(i==="TEXCOORD_0")return{filter:ct.NONE};if(i.startsWith("JOINTS_"))return{filter:ct.NONE};if(i.startsWith("WEIGHTS_"))return{filter:ct.NONE};if(i==="NORMAL"||i==="TANGENT")return o?{filter:ct.NONE}:{filter:ct.OCTAHEDRAL,bits:8}}if(s==="output"){const a=Wo(r);return a==="rotation"?{filter:ct.QUATERNION,bits:16}:a==="translation"?{filter:ct.EXPONENTIAL,bits:12}:a==="scale"?{filter:ct.EXPONENTIAL,bits:12}:{filter:ct.NONE}}if(s==="input")return{filter:ct.NONE};if(s==="inverseBindMatrices")return{filter:ct.NONE}}return{filter:ct.NONE}}function Wo(r){for(const e of r.listParents())if(e instanceof dr){for(const t of e.listParents())if(t instanceof ci)return t.getTargetPath()}return null}const to={method:Or.QUANTIZE};class li extends Ze{constructor(...e){super(...e),this.extensionName=xt,this.prereadTypes=[k.BUFFER,k.PRIMITIVE],this.prewriteTypes=[k.BUFFER,k.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=to,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=On({},to,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${xt}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${xt}]: Missing WASM support.`)}return t===k.BUFFER?this._prereadBuffers(e):t===k.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[xt])return;const o=s.extensions[xt],a=o.byteOffset||0,u=o.byteLength||0,f=o.count,y=o.byteStride,E=new Uint8Array(f*y),d=t.json.buffers[o.buffer],T=d.uri?t.resources[d.uri]:t.resources[ar],N=Ce.toView(T,a,u);this._decoder.decodeGltfBuffer(E,f,y,N,o.mode,o.filter),e.bufferViews[i]=E})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(s=>{if(!s.extensions||!s.extensions[xt])return;const i=s.extensions[xt],o=e.buffers[i.buffer],a=e.buffers[s.buffer],u=t.json.buffers[s.buffer];xf(u)&&this._decoderFallbackBufferMap.set(a,o)})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const s of t.listParents())s instanceof oe&&s.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===k.ACCESSOR?this._prewriteAccessors(e):t===k.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,i=this.document.getGraph(),o=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(o);let u=1;const f=new Map,y=E=>{for(const d of i.listParents(E)){if(d.propertyType===k.ROOT)continue;let T=f.get(E);return T===void 0&&f.set(E,T=u++),T}return-1};this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const E of this.document.getRoot().listAccessors()){if(Wo(E)==="weights"||E.getSparse())continue;const d=e.getAccessorUsage(E),T=e.accessorUsageGroupedByParent.has(d)?y(E):null,N=If(E,d),V=s.method===Or.FILTER?Sf(E,this.document):{filter:ct.NONE},W=wf(E,n,N,V),{array:x,byteStride:U}=W,_=E.getBuffer();if(!_)throw new Error(`${xt}: Missing buffer for accessor.`);const C=this.document.getRoot().listBuffers().indexOf(_),F=[d,T,N,V.filter,U,C].join(":");let B=this._encoderBufferViews[F],p=this._encoderBufferViewData[F],R=this._encoderBufferViewAccessors[F];(!B||!p)&&(R=this._encoderBufferViewAccessors[F]=[],p=this._encoderBufferViewData[F]=[],B=this._encoderBufferViews[F]={buffer:a,target:en.USAGE_TO_TARGET[d],byteOffset:0,byteLength:0,byteStride:d===en.BufferViewUsage.ARRAY_BUFFER?U:void 0,extensions:{[xt]:{buffer:C,byteOffset:0,byteLength:0,mode:N,filter:V.filter!==ct.NONE?V.filter:void 0,byteStride:U,count:0}}});const b=e.createAccessorDef(E);b.componentType=W.componentType,b.normalized=W.normalized,b.byteOffset=B.byteLength,b.min&&W.min&&(b.min=W.min),b.max&&W.max&&(b.max=W.max),e.accessorIndexMap.set(E,t.accessors.length),t.accessors.push(b),R.push(b),p.push(new Uint8Array(x.buffer,x.byteOffset,x.byteLength)),B.byteLength+=x.byteLength,B.extensions.EXT_meshopt_compression.count+=E.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],i=this._encoderBufferViewData[n],o=this.document.getRoot().listBuffers()[s.extensions[xt].buffer],a=e.otherBufferViews.get(o)||[],{count:u,byteStride:f,mode:y}=s.extensions[xt],E=Ce.concat(i),d=t.encodeGltfBuffer(E,u,f,y),T=Ce.pad(d);s.extensions[xt].byteLength=d.byteLength,i.length=0,i.push(T),a.push(T),e.otherBufferViews.set(o,a)}}write(e){let t=0;for(const o in this._encoderBufferViews){const a=this._encoderBufferViews[o],u=this._encoderBufferViewData[o][0],f=e.otherBufferViewsIndexMap.get(u),y=this._encoderBufferViewAccessors[o];for(const N of y)N.bufferView=f;const E=e.jsonDoc.json.bufferViews[f],d=E.byteOffset||0;Object.assign(E,a),E.byteOffset=t;const T=E.extensions[xt];T.byteOffset=d,t+=Ce.padNumber(a.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),i=e.jsonDoc.json.buffers[s];return i.byteLength=t,i.extensions={[xt]:{fallback:!0}},n.dispose(),this}}li.EXTENSION_NAME=xt;li.EncoderMethod=Or;class Af{match(e){return e.length>=12&&Ce.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=no(t,0);if(!n)return null;let s=n.end;for(;n=no(t,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class Xo extends Ze{constructor(...e){super(...e),this.extensionName=_r,this.prereadTypes=[k.TEXTURE]}static register(){sn.registerFormat("image/avif",new Af)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[_r]&&(n.source=n.extensions[_r].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===s&&(o.extensions=o.extensions||{},o.extensions[_r]={source:o.source},delete o.source)})}}),this}}Xo.EXTENSION_NAME=_r;function no(r,e){if(r.byteLength<4+e)return null;const t=r.getUint32(e);return r.byteLength<t+e||t<8?null:{type:Ce.decodeText(new Uint8Array(r.buffer,r.byteOffset+e+4,4)),start:e+8,end:e+t}}class Mf{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Ce.decodeText(e.slice(0,4)),n=Ce.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<s.byteLength;){const o=Ce.decodeText(new Uint8Array([s.getUint8(i),s.getUint8(i+1),s.getUint8(i+2),s.getUint8(i+3)])),a=s.getUint32(i+4,!0);if(o==="VP8 "){const u=s.getInt16(i+14,!0)&16383,f=s.getInt16(i+16,!0)&16383;return[u,f]}else if(o==="VP8L"){const u=s.getUint8(i+9),f=s.getUint8(i+10),y=s.getUint8(i+11),E=s.getUint8(i+12),d=1+((f&63)<<8|u),T=1+((E&15)<<10|y<<2|(f&192)>>6);return[d,T]}i+=8+a+a%2}return null}getChannels(e){return 4}}class Ko extends Ze{constructor(...e){super(...e),this.extensionName=br,this.prereadTypes=[k.TEXTURE]}static register(){sn.registerFormat("image/webp",new Mf)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[br]&&(n.source=n.extensions[br].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===s&&(o.extensions=o.extensions||{},o.extensions[br]={source:o.source},delete o.source)})}}),this}}Ko.EXTENSION_NAME=br;let pt,qo,Yo;function Nf(r,e){const t=new pt.DecoderBuffer;try{if(t.Init(e,e.length),r.GetEncodedGeometryType(t)!==pt.TRIANGULAR_MESH)throw new Error(`[${rt}] Unknown geometry type.`);const s=new pt.Mesh;if(!r.DecodeBufferToMesh(t,s).ok()||s.ptr===0)throw new Error(`[${rt}] Decoding failure.`);return s}finally{pt.destroy(t)}}function Cf(r,e){const n=e.num_faces()*3;let s,i;if(e.num_points()<=65534){const o=n*Uint16Array.BYTES_PER_ELEMENT;s=pt._malloc(o),r.GetTrianglesUInt16Array(e,o,s),i=new Uint16Array(pt.HEAPU16.buffer,s,n).slice()}else{const o=n*Uint32Array.BYTES_PER_ELEMENT;s=pt._malloc(o),r.GetTrianglesUInt32Array(e,o,s),i=new Uint32Array(pt.HEAPU32.buffer,s,n).slice()}return pt._free(s),i}function Of(r,e,t,n){const s=Yo[n.componentType],i=qo[n.componentType],o=t.num_components(),u=e.num_points()*o,f=u*i.BYTES_PER_ELEMENT,y=pt._malloc(f);r.GetAttributeDataArrayForAllPoints(e,t,s,f,y);const E=new i(pt.HEAPF32.buffer,y,u).slice();return pt._free(y),E}function Df(r){pt=r,qo={[oe.ComponentType.FLOAT]:Float32Array,[oe.ComponentType.UNSIGNED_INT]:Uint32Array,[oe.ComponentType.UNSIGNED_SHORT]:Uint16Array,[oe.ComponentType.UNSIGNED_BYTE]:Uint8Array,[oe.ComponentType.SHORT]:Int16Array,[oe.ComponentType.BYTE]:Int8Array},Yo={[oe.ComponentType.FLOAT]:pt.DT_FLOAT32,[oe.ComponentType.UNSIGNED_INT]:pt.DT_UINT32,[oe.ComponentType.UNSIGNED_SHORT]:pt.DT_UINT16,[oe.ComponentType.UNSIGNED_BYTE]:pt.DT_UINT8,[oe.ComponentType.SHORT]:pt.DT_INT16,[oe.ComponentType.BYTE]:pt.DT_INT8}}let $t;var Dr;(function(r){r[r.EDGEBREAKER=1]="EDGEBREAKER",r[r.SEQUENTIAL=0]="SEQUENTIAL"})(Dr||(Dr={}));var Ht;(function(r){r.POSITION="POSITION",r.NORMAL="NORMAL",r.COLOR="COLOR",r.TEX_COORD="TEX_COORD",r.GENERIC="GENERIC"})(Ht||(Ht={}));const Jo={[Ht.POSITION]:14,[Ht.NORMAL]:10,[Ht.COLOR]:8,[Ht.TEX_COORD]:12,[Ht.GENERIC]:12},ro={decodeSpeed:5,encodeSpeed:5,method:Dr.EDGEBREAKER,quantizationBits:Jo,quantizationVolume:"mesh"};function Ff(r){$t=r}function Pf(r,e=ro){const t=On({},ro,e);t.quantizationBits=On({},Jo,e.quantizationBits);const n=new $t.MeshBuilder,s=new $t.Mesh,i=new $t.ExpertEncoder(s),o={},a=new $t.DracoInt8Array,u=r.listTargets().length>0;let f=!1;for(const V of r.listSemantics()){const W=r.getAttribute(V);if(W.getSparse()){f=!0;continue}const x=Uf(V),U=kf(n,W.getComponentType(),s,$t[x],W.getCount(),W.getElementSize(),W.getArray());if(U===-1)throw new Error(`Error compressing "${V}" attribute.`);if(o[V]=U,t.quantizationVolume==="mesh"||V!=="POSITION")i.SetAttributeQuantization(U,t.quantizationBits[x]);else if(typeof t.quantizationVolume=="object"){const{quantizationVolume:_}=t,C=Math.max(_.max[0]-_.min[0],_.max[1]-_.min[1],_.max[2]-_.min[2]);i.SetAttributeExplicitQuantization(U,t.quantizationBits[x],W.getElementSize(),_.min,C)}else throw new Error("Invalid quantization volume state.")}const y=r.getIndices();if(!y)throw new Zs("Primitive must have indices.");n.AddFacesToMesh(s,y.getCount()/3,y.getArray()),i.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),i.SetTrackEncodedProperties(!0),t.method===Dr.SEQUENTIAL||u||f?i.SetEncodingMethod($t.MESH_SEQUENTIAL_ENCODING):i.SetEncodingMethod($t.MESH_EDGEBREAKER_ENCODING);const E=i.EncodeToDracoBuffer(!(u||f),a);if(E<=0)throw new Zs("Error applying Draco compression.");const d=new Uint8Array(E);for(let V=0;V<E;++V)d[V]=a.GetValue(V);const T=i.GetNumberOfEncodedPoints(),N=i.GetNumberOfEncodedFaces()*3;return $t.destroy(a),$t.destroy(s),$t.destroy(n),$t.destroy(i),{numVertices:T,numIndices:N,data:d,attributeIDs:o}}function Uf(r){return r==="POSITION"?Ht.POSITION:r==="NORMAL"?Ht.NORMAL:r.startsWith("COLOR_")?Ht.COLOR:r.startsWith("TEXCOORD_")?Ht.TEX_COORD:Ht.GENERIC}function kf(r,e,t,n,s,i,o){switch(e){case oe.ComponentType.UNSIGNED_BYTE:return r.AddUInt8Attribute(t,n,s,i,o);case oe.ComponentType.BYTE:return r.AddInt8Attribute(t,n,s,i,o);case oe.ComponentType.UNSIGNED_SHORT:return r.AddUInt16Attribute(t,n,s,i,o);case oe.ComponentType.SHORT:return r.AddInt16Attribute(t,n,s,i,o);case oe.ComponentType.UNSIGNED_INT:return r.AddUInt32Attribute(t,n,s,i,o);case oe.ComponentType.FLOAT:return r.AddFloatAttribute(t,n,s,i,o);default:throw new Error(`Unexpected component type, "${e}".`)}}class Zs extends Error{}class ui extends Ze{constructor(...e){super(...e),this.extensionName=rt,this.prereadTypes=[k.PRIMITIVE],this.prewriteTypes=[k.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,Df(this._decoderModule)),e==="draco3d.encoder"&&(this._encoderModule=t,Ff(this._encoderModule)),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${rt}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const i=n.json.meshes||[];for(const o of i)for(const a of o.primitives){if(!a.extensions||!a.extensions[rt])continue;const u=a.extensions[rt];let[f,y]=s.get(u.bufferView)||[];if(!y||!f){const E=n.json.bufferViews[u.bufferView],d=n.json.buffers[E.buffer],T=d.uri?n.resources[d.uri]:n.resources[ar],N=E.byteOffset||0,V=E.byteLength,W=Ce.toView(T,N,V);f=new this._decoderModule.Decoder,y=Nf(f,W),s.set(u.bufferView,[f,y]),t.debug(`[${rt}] Decompressed ${W.byteLength} bytes.`)}for(const E in u.attributes){const d=e.jsonDoc.json.accessors[a.attributes[E]],T=f.GetAttributeByUniqueId(y,u.attributes[E]),N=Of(f,y,T,d);e.accessors[a.attributes[E]].setArray(N)}a.indices!==void 0&&e.accessors[a.indices].setArray(Cf(f,y))}}finally{for(const[i,o]of Array.from(s.values()))this._decoderModule.destroy(i),this._decoderModule.destroy(o)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${rt}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${rt}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=jf(this.document),i=new Map;let o="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${rt}]: quantizationVolume=scene requires exactly 1 scene.`):o=Iu(this.document.getRoot().listScenes().pop()));for(const a of Array.from(s.keys())){const u=s.get(a);if(!u)throw new Error("Unexpected primitive.");if(i.has(u)){i.set(u,i.get(u));continue}const f=a.getIndices(),y=e.jsonDoc.json.accessors;let E;try{E=Pf(a,On({},this._encoderOptions,{quantizationVolume:o}))}catch(N){if(N instanceof Zs){n.warn(`[${rt}]: ${N.message} Skipping primitive compression.`);continue}throw N}i.set(u,E);const d=e.createAccessorDef(f);d.count=E.numIndices,e.accessorIndexMap.set(f,y.length),y.push(d),E.numVertices>65534&&oe.getComponentSize(d.componentType)<=2?d.componentType=oe.ComponentType.UNSIGNED_INT:E.numVertices>254&&oe.getComponentSize(d.componentType)<=1&&(d.componentType=oe.ComponentType.UNSIGNED_SHORT);for(const N of a.listSemantics()){const V=a.getAttribute(N);if(E.attributeIDs[N]===void 0)continue;const W=e.createAccessorDef(V);W.count=E.numVertices,e.accessorIndexMap.set(V,y.length),y.push(W)}const T=a.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(T)||e.otherBufferViews.set(T,[]),e.otherBufferViews.get(T).push(E.data)}return n.debug(`[${rt}] Compressed ${s.size} primitives.`),e.extensionData[rt]={primitiveHashMap:s,primitiveEncodingMap:i},this}write(e){const t=e.extensionData[rt];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let i=0;i<n.listPrimitives().length;i++){const o=n.listPrimitives()[i],a=s.primitives[i],u=t.primitiveHashMap.get(o);if(!u)continue;const f=t.primitiveEncodingMap.get(u);f&&(a.extensions=a.extensions||{},a.extensions[rt]={bufferView:e.otherBufferViewsIndexMap.get(f.data),attributes:f.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==rt),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==rt)}return this}}ui.EXTENSION_NAME=rt;ui.EncoderMethod=Dr;function jf(r){const e=r.getLogger(),t=new Set,n=new Set;let s=0,i=0;for(const E of r.getRoot().listMeshes())for(const d of E.listPrimitives())d.getIndices()?d.getMode()!==qn.Mode.TRIANGLES?(n.add(d),i++):t.add(d):(n.add(d),s++);s>0&&e.warn(`[${rt}] Skipping Draco compression of ${s} non-indexed primitives.`),i>0&&e.warn(`[${rt}] Skipping Draco compression of ${i} non-TRIANGLES primitives.`);const o=r.getRoot().listAccessors(),a=new Map;for(let E=0;E<o.length;E++)a.set(o[E],E);const u=new Map,f=new Set,y=new Map;for(const E of Array.from(t)){let d=so(E,a);if(f.has(d)){y.set(E,d);continue}if(u.has(E.getIndices())){const T=E.getIndices(),N=T.clone();a.set(N,r.getRoot().listAccessors().length-1),E.swap(T,N)}for(const T of E.listAttributes())if(u.has(T)){const N=T.clone();a.set(N,r.getRoot().listAccessors().length-1),E.swap(T,N)}d=so(E,a),f.add(d),y.set(E,d),u.set(E.getIndices(),d);for(const T of E.listAttributes())u.set(T,d)}for(const E of Array.from(u.keys())){const d=new Set(E.listParents().map(T=>T.propertyType));if(d.size!==2||!d.has(k.PRIMITIVE)||!d.has(k.ROOT))throw new Error(`[${rt}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const E of Array.from(t)){const d=y.get(E),T=E.getIndices();if(u.get(T)!==d||E.listAttributes().some(N=>u.get(N)!==d))throw new Error(`[${rt}] Draco primitives must share all, or no, accessors.`)}for(const E of Array.from(n)){const d=E.getIndices();if(u.has(d)||E.listAttributes().some(T=>u.has(T)))throw new Error(`[${rt}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return y}function so(r,e){const t=[],n=r.getIndices();t.push(e.get(n));for(const s of r.listAttributes())t.push(e.get(s));return t.sort().join("|")}class ur extends st{init(){this.extensionName=Vt,this.propertyType="Light",this.parentTypes=[k.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ur.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ur.EXTENSION_NAME=Vt;ur.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};class Zo extends Ze{constructor(...e){super(...e),this.extensionName=Vt}createLight(e=""){return new ur(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Vt])return this;const i=(t.json.extensions[Vt].lights||[]).map(o=>{var a,u;const f=this.createLight().setName(o.name||"").setType(o.type);return o.color!==void 0&&f.setColor(o.color),o.intensity!==void 0&&f.setIntensity(o.intensity),o.range!==void 0&&f.setRange(o.range),((a=o.spot)==null?void 0:a.innerConeAngle)!==void 0&&f.setInnerConeAngle(o.spot.innerConeAngle),((u=o.spot)==null?void 0:u.outerConeAngle)!==void 0&&f.setOuterConeAngle(o.spot.outerConeAngle),f});return t.json.nodes.forEach((o,a)=>{if(!o.extensions||!o.extensions[Vt])return;const u=o.extensions[Vt];e.nodes[a].setExtension(Vt,i[u.light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const i of this.properties){const o=i,a={type:o.getType()};Xe.eq(o.getColor(),[1,1,1])||(a.color=o.getColor()),o.getIntensity()!==1&&(a.intensity=o.getIntensity()),o.getRange()!=null&&(a.range=o.getRange()),o.getName()&&(a.name=o.getName()),o.getType()===ur.Type.SPOT&&(a.spot={innerConeAngle:o.getInnerConeAngle(),outerConeAngle:o.getOuterConeAngle()}),n.push(a),s.set(o,n.length-1)}return this.document.getRoot().listNodes().forEach(i=>{const o=i.getExtension(Vt);if(o){const a=e.nodeIndexMap.get(i),u=t.json.nodes[a];u.extensions=u.extensions||{},u.extensions[Vt]={light:s.get(o)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[Vt]={lights:n},this}}Zo.EXTENSION_NAME=Vt;const{R:Bf,G:Lf,B:$f}=Wt;class Qo extends st{init(){this.extensionName=xn,this.propertyType="Anisotropy",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Ye(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Bf|Lf|$f})}}Qo.EXTENSION_NAME=xn;class ea extends Ze{constructor(...e){super(...e),this.extensionName=xn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createAnisotropy(){return new Qo(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[xn]){const a=this.createAnisotropy();e.materials[o].setExtension(xn,a);const u=i.extensions[xn];if(u.anisotropyStrength!==void 0&&a.setAnisotropyStrength(u.anisotropyStrength),u.anisotropyRotation!==void 0&&a.setAnisotropyRotation(u.anisotropyRotation),u.anisotropyTexture!==void 0){const f=u.anisotropyTexture,y=e.textures[s[f.index].source];a.setAnisotropyTexture(y),e.setTextureInfo(a.getAnisotropyTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(xn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[xn]={};if(s.getAnisotropyStrength()>0&&(a.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(a.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const u=s.getAnisotropyTexture(),f=s.getAnisotropyTextureInfo();a.anisotropyTexture=e.createTextureInfoDef(u,f)}}}),this}}ea.EXTENSION_NAME=xn;const{R:io,G:oo,B:Vf}=Wt;class ta extends st{init(){this.extensionName=vn,this.propertyType="Clearcoat",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Ye(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Ye(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Ye(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:io})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:oo})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:io|oo|Vf})}}ta.EXTENSION_NAME=vn;class na extends Ze{constructor(...e){super(...e),this.extensionName=vn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createClearcoat(){return new ta(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[vn]){const a=this.createClearcoat();e.materials[o].setExtension(vn,a);const u=i.extensions[vn];if(u.clearcoatFactor!==void 0&&a.setClearcoatFactor(u.clearcoatFactor),u.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(u.clearcoatRoughnessFactor),u.clearcoatTexture!==void 0){const f=u.clearcoatTexture,y=e.textures[s[f.index].source];a.setClearcoatTexture(y),e.setTextureInfo(a.getClearcoatTextureInfo(),f)}if(u.clearcoatRoughnessTexture!==void 0){const f=u.clearcoatRoughnessTexture,y=e.textures[s[f.index].source];a.setClearcoatRoughnessTexture(y),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),f)}if(u.clearcoatNormalTexture!==void 0){const f=u.clearcoatNormalTexture,y=e.textures[s[f.index].source];a.setClearcoatNormalTexture(y),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),f),f.scale!==void 0&&a.setClearcoatNormalScale(f.scale)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(vn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[vn]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const u=s.getClearcoatTexture(),f=s.getClearcoatTextureInfo();a.clearcoatTexture=e.createTextureInfoDef(u,f)}if(s.getClearcoatRoughnessTexture()){const u=s.getClearcoatRoughnessTexture(),f=s.getClearcoatRoughnessTextureInfo();a.clearcoatRoughnessTexture=e.createTextureInfoDef(u,f)}if(s.getClearcoatNormalTexture()){const u=s.getClearcoatNormalTexture(),f=s.getClearcoatNormalTextureInfo();a.clearcoatNormalTexture=e.createTextureInfoDef(u,f),s.getClearcoatNormalScale()!==1&&(a.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}na.EXTENSION_NAME=vn;const{R:Gf,G:Hf,B:zf,A:Wf}=Wt;class ra extends st{init(){this.extensionName=En,this.propertyType="DiffuseTransmission",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new Ye(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new Ye(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:Wf})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:Gf|Hf|zf})}}ra.EXTENSION_NAME=En;class sa extends Ze{constructor(...e){super(...e),this.extensionName=En}createDiffuseTransmission(){return new ra(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[En]){const a=this.createDiffuseTransmission();e.materials[o].setExtension(En,a);const u=i.extensions[En];if(u.diffuseTransmissionFactor!==void 0&&a.setDiffuseTransmissionFactor(u.diffuseTransmissionFactor),u.diffuseTransmissionColorFactor!==void 0&&a.setDiffuseTransmissionColorFactor(u.diffuseTransmissionColorFactor),u.diffuseTransmissionTexture!==void 0){const f=u.diffuseTransmissionTexture,y=e.textures[s[f.index].source];a.setDiffuseTransmissionTexture(y),e.setTextureInfo(a.getDiffuseTransmissionTextureInfo(),f)}if(u.diffuseTransmissionColorTexture!==void 0){const f=u.diffuseTransmissionColorTexture,y=e.textures[s[f.index].source];a.setDiffuseTransmissionColorTexture(y),e.setTextureInfo(a.getDiffuseTransmissionColorTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;for(const n of this.document.getRoot().listMaterials()){const s=n.getExtension(En);if(!s)continue;const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[En]={diffuseTransmissionFactor:s.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:s.getDiffuseTransmissionColorFactor()};if(s.getDiffuseTransmissionTexture()){const u=s.getDiffuseTransmissionTexture(),f=s.getDiffuseTransmissionTextureInfo();a.diffuseTransmissionTexture=e.createTextureInfoDef(u,f)}if(s.getDiffuseTransmissionColorTexture()){const u=s.getDiffuseTransmissionColorTexture(),f=s.getDiffuseTransmissionColorTextureInfo();a.diffuseTransmissionColorTexture=e.createTextureInfoDef(u,f)}}return this}}sa.EXTENSION_NAME=En;class ia extends st{init(){this.extensionName=wn,this.propertyType="Dispersion",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}ia.EXTENSION_NAME=wn;class oa extends Ze{constructor(...e){super(...e),this.extensionName=wn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createDispersion(){return new ia(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[wn]){const o=this.createDispersion();e.materials[i].setExtension(wn,o);const a=s.extensions[wn];a.dispersion!==void 0&&o.setDispersion(a.dispersion)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(wn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[wn]={dispersion:s.getDispersion()}}}),this}}oa.EXTENSION_NAME=wn;class aa extends st{init(){this.extensionName=bn,this.propertyType="EmissiveStrength",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}aa.EXTENSION_NAME=bn;class ca extends Ze{constructor(...e){super(...e),this.extensionName=bn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createEmissiveStrength(){return new aa(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[bn]){const o=this.createEmissiveStrength();e.materials[i].setExtension(bn,o);const a=s.extensions[bn];a.emissiveStrength!==void 0&&o.setEmissiveStrength(a.emissiveStrength)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(bn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[bn]={emissiveStrength:s.getEmissiveStrength()}}}),this}}ca.EXTENSION_NAME=bn;class la extends st{init(){this.extensionName=_n,this.propertyType="IOR",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}la.EXTENSION_NAME=_n;class ua extends Ze{constructor(...e){super(...e),this.extensionName=_n,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createIOR(){return new la(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[_n]){const o=this.createIOR();e.materials[i].setExtension(_n,o);const a=s.extensions[_n];a.ior!==void 0&&o.setIOR(a.ior)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(_n);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[_n]={ior:s.getIOR()}}}),this}}ua.EXTENSION_NAME=_n;const{R:Xf,G:Kf}=Wt;class fa extends st{init(){this.extensionName=Rn,this.propertyType="Iridescence",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Ye(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Ye(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Xf})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Kf})}}fa.EXTENSION_NAME=Rn;class ha extends Ze{constructor(...e){super(...e),this.extensionName=Rn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createIridescence(){return new fa(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Rn]){const a=this.createIridescence();e.materials[o].setExtension(Rn,a);const u=i.extensions[Rn];if(u.iridescenceFactor!==void 0&&a.setIridescenceFactor(u.iridescenceFactor),u.iridescenceIor!==void 0&&a.setIridescenceIOR(u.iridescenceIor),u.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(u.iridescenceThicknessMaximum),u.iridescenceTexture!==void 0){const f=u.iridescenceTexture,y=e.textures[s[f.index].source];a.setIridescenceTexture(y),e.setTextureInfo(a.getIridescenceTextureInfo(),f)}if(u.iridescenceThicknessTexture!==void 0){const f=u.iridescenceThicknessTexture,y=e.textures[s[f.index].source];a.setIridescenceThicknessTexture(y),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Rn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Rn]={};if(s.getIridescenceFactor()>0&&(a.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(a.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(a.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(a.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const u=s.getIridescenceTexture(),f=s.getIridescenceTextureInfo();a.iridescenceTexture=e.createTextureInfoDef(u,f)}if(s.getIridescenceThicknessTexture()){const u=s.getIridescenceThicknessTexture(),f=s.getIridescenceThicknessTextureInfo();a.iridescenceThicknessTexture=e.createTextureInfoDef(u,f)}}}),this}}ha.EXTENSION_NAME=Rn;const{R:ao,G:co,B:lo,A:uo}=Wt;class da extends st{init(){this.extensionName=In,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Ye(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Ye(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:ao|co|lo|uo,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:ao|co|lo|uo})}}da.EXTENSION_NAME=In;class pa extends Ze{constructor(...e){super(...e),this.extensionName=In,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createPBRSpecularGlossiness(){return new da(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[In]){const a=this.createPBRSpecularGlossiness();e.materials[o].setExtension(In,a);const u=i.extensions[In];if(u.diffuseFactor!==void 0&&a.setDiffuseFactor(u.diffuseFactor),u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.glossinessFactor!==void 0&&a.setGlossinessFactor(u.glossinessFactor),u.diffuseTexture!==void 0){const f=u.diffuseTexture,y=e.textures[s[f.index].source];a.setDiffuseTexture(y),e.setTextureInfo(a.getDiffuseTextureInfo(),f)}if(u.specularGlossinessTexture!==void 0){const f=u.specularGlossinessTexture,y=e.textures[s[f.index].source];a.setSpecularGlossinessTexture(y),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(In);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[In]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const u=s.getDiffuseTexture(),f=s.getDiffuseTextureInfo();a.diffuseTexture=e.createTextureInfoDef(u,f)}if(s.getSpecularGlossinessTexture()){const u=s.getSpecularGlossinessTexture(),f=s.getSpecularGlossinessTextureInfo();a.specularGlossinessTexture=e.createTextureInfoDef(u,f)}}}),this}}pa.EXTENSION_NAME=In;const{R:qf,G:Yf,B:Jf,A:Zf}=Wt;class ga extends st{init(){this.extensionName=Sn,this.propertyType="Sheen",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Ye(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Ye(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:qf|Yf|Jf,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Zf})}}ga.EXTENSION_NAME=Sn;class ma extends Ze{constructor(...e){super(...e),this.extensionName=Sn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createSheen(){return new ga(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Sn]){const a=this.createSheen();e.materials[o].setExtension(Sn,a);const u=i.extensions[Sn];if(u.sheenColorFactor!==void 0&&a.setSheenColorFactor(u.sheenColorFactor),u.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(u.sheenRoughnessFactor),u.sheenColorTexture!==void 0){const f=u.sheenColorTexture,y=e.textures[s[f.index].source];a.setSheenColorTexture(y),e.setTextureInfo(a.getSheenColorTextureInfo(),f)}if(u.sheenRoughnessTexture!==void 0){const f=u.sheenRoughnessTexture,y=e.textures[s[f.index].source];a.setSheenRoughnessTexture(y),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Sn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Sn]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const u=s.getSheenColorTexture(),f=s.getSheenColorTextureInfo();a.sheenColorTexture=e.createTextureInfoDef(u,f)}if(s.getSheenRoughnessTexture()){const u=s.getSheenRoughnessTexture(),f=s.getSheenRoughnessTextureInfo();a.sheenRoughnessTexture=e.createTextureInfoDef(u,f)}}}),this}}ma.EXTENSION_NAME=Sn;const{R:Qf,G:eh,B:th,A:nh}=Wt;class ya extends st{init(){this.extensionName=An,this.propertyType="Specular",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Ye(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Ye(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:nh})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Qf|eh|th,isColor:!0})}}ya.EXTENSION_NAME=An;class Ta extends Ze{constructor(...e){super(...e),this.extensionName=An,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createSpecular(){return new ya(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[An]){const a=this.createSpecular();e.materials[o].setExtension(An,a);const u=i.extensions[An];if(u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.specularColorFactor!==void 0&&a.setSpecularColorFactor(u.specularColorFactor),u.specularTexture!==void 0){const f=u.specularTexture,y=e.textures[s[f.index].source];a.setSpecularTexture(y),e.setTextureInfo(a.getSpecularTextureInfo(),f)}if(u.specularColorTexture!==void 0){const f=u.specularColorTexture,y=e.textures[s[f.index].source];a.setSpecularColorTexture(y),e.setTextureInfo(a.getSpecularColorTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(An);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[An]={};if(s.getSpecularFactor()!==1&&(a.specularFactor=s.getSpecularFactor()),Xe.eq(s.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const u=s.getSpecularTexture(),f=s.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(u,f)}if(s.getSpecularColorTexture()){const u=s.getSpecularColorTexture(),f=s.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(u,f)}}}),this}}Ta.EXTENSION_NAME=An;const{R:rh}=Wt;class xa extends st{init(){this.extensionName=Mn,this.propertyType="Transmission",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Ye(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:rh})}}xa.EXTENSION_NAME=Mn;class va extends Ze{constructor(...e){super(...e),this.extensionName=Mn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createTransmission(){return new xa(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Mn]){const a=this.createTransmission();e.materials[o].setExtension(Mn,a);const u=i.extensions[Mn];if(u.transmissionFactor!==void 0&&a.setTransmissionFactor(u.transmissionFactor),u.transmissionTexture!==void 0){const f=u.transmissionTexture,y=e.textures[s[f.index].source];a.setTransmissionTexture(y),e.setTextureInfo(a.getTransmissionTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Mn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Mn]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const u=s.getTransmissionTexture(),f=s.getTransmissionTextureInfo();a.transmissionTexture=e.createTextureInfoDef(u,f)}}}),this}}va.EXTENSION_NAME=Mn;class Ea extends st{init(){this.extensionName=Un,this.propertyType="Unlit",this.parentTypes=[k.MATERIAL]}}Ea.EXTENSION_NAME=Un;class fi extends Ze{constructor(...e){super(...e),this.extensionName=Un,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createUnlit(){return new Ea(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((n,s)=>{n.extensions&&n.extensions[Un]&&e.materials[s].setExtension(Un,this.createUnlit())}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(Un)){const s=e.materialIndexMap.get(n),i=t.json.materials[s];i.extensions=i.extensions||{},i.extensions[Un]={}}}),this}}fi.EXTENSION_NAME=Un;class wa extends st{init(){this.extensionName=wt,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new Je})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}wa.EXTENSION_NAME=wt;class ba extends st{init(){this.extensionName=wt,this.propertyType="MappingList",this.parentTypes=[k.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new Je})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}ba.EXTENSION_NAME=wt;class Qs extends st{init(){this.extensionName=wt,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Qs.EXTENSION_NAME=wt;class _a extends Ze{constructor(...e){super(...e),this.extensionName=wt}createMappingList(){return new ba(this.document.getGraph())}createVariant(e=""){return new Qs(this.document.getGraph(),e)}createMapping(){return new wa(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Qs)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[wt])return this;const i=(t.json.extensions[wt].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(t.json.meshes||[]).forEach((a,u)=>{const f=e.meshes[u];(a.primitives||[]).forEach((E,d)=>{if(!E.extensions||!E.extensions[wt])return;const T=this.createMappingList(),N=E.extensions[wt];for(const V of N.mappings){const W=this.createMapping();V.material!==void 0&&W.setMaterial(e.materials[V.material]);for(const x of V.variants||[])W.addVariant(i[x]);T.addMapping(W)}f.listPrimitives()[d].setExtension(wt,T)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],i=new Map;for(const o of n)i.set(o,s.length),s.push(e.createPropertyDef(o));for(const o of this.document.getRoot().listMeshes()){const a=e.meshIndexMap.get(o);o.listPrimitives().forEach((u,f)=>{const y=u.getExtension(wt);if(!y)return;const E=e.jsonDoc.json.meshes[a].primitives[f],d=y.listMappings().map(T=>{const N=e.createPropertyDef(T),V=T.getMaterial();return V&&(N.material=e.materialIndexMap.get(V)),N.variants=T.listVariants().map(W=>i.get(W)),N});E.extensions=E.extensions||{},E.extensions[wt]={mappings:d}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[wt]={variants:s},this}}_a.EXTENSION_NAME=wt;const{G:sh}=Wt;class Ra extends st{init(){this.extensionName=Nn,this.propertyType="Volume",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Ye(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:sh})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}Ra.EXTENSION_NAME=Nn;class Ia extends Ze{constructor(...e){super(...e),this.extensionName=Nn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createVolume(){return new Ra(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Nn]){const a=this.createVolume();e.materials[o].setExtension(Nn,a);const u=i.extensions[Nn];if(u.thicknessFactor!==void 0&&a.setThicknessFactor(u.thicknessFactor),u.attenuationDistance!==void 0&&a.setAttenuationDistance(u.attenuationDistance),u.attenuationColor!==void 0&&a.setAttenuationColor(u.attenuationColor),u.thicknessTexture!==void 0){const f=u.thicknessTexture,y=e.textures[s[f.index].source];a.setThicknessTexture(y),e.setTextureInfo(a.getThicknessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Nn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Nn]={};if(s.getThicknessFactor()>0&&(a.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(a.attenuationDistance=s.getAttenuationDistance()),Xe.eq(s.getAttenuationColor(),[1,1,1])||(a.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const u=s.getThicknessTexture(),f=s.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(u,f)}}}),this}}Ia.EXTENSION_NAME=Nn;class Sa extends Ze{constructor(...e){super(...e),this.extensionName=Go}read(e){return this}write(e){return this}}Sa.EXTENSION_NAME=Go;class ih{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=Us(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const n=Us(e).dataFormatDescriptor[0];if(n.colorModel===ff)return n.samples.length===2&&(n.samples[1].channelType&15)===15?4:3;if(n.colorModel===hf)return(n.samples[0].channelType&15)===3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${n.colorModel}".`)}getVRAMByteLength(e){const t=Us(e),n=this.getChannels(e)>3;let s=0;for(let i=0;i<t.levels.length;i++){const o=t.levels[i];if(o.uncompressedByteLength)s+=o.uncompressedByteLength;else{const a=Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,i))),u=Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,i))),f=n?16:8;s+=a/4*(u/4)*f}}return s}}class Aa extends Ze{constructor(...e){super(...e),this.extensionName=Rr,this.prereadTypes=[k.TEXTURE]}static register(){sn.registerFormat("image/ktx2",new ih)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{if(t.extensions&&t.extensions[Rr]){const n=t.extensions[Rr];t.source=n.source}}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);t.json.textures.forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Rr]={source:i.source},delete i.source)})}}),this}}Aa.EXTENSION_NAME=Rr;class Ma extends st{init(){this.extensionName=Cn,this.propertyType="Transform",this.parentTypes=[k.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Ma.EXTENSION_NAME=Cn;class Na extends Ze{constructor(...e){super(...e),this.extensionName=Cn}createTransform(){return new Ma(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Cn])continue;const s=this.createTransform(),i=n.extensions[Cn];i.offset!==void 0&&s.setOffset(i.offset),i.rotation!==void 0&&s.setRotation(i.rotation),i.scale!==void 0&&s.setScale(i.scale),i.texCoord!==void 0&&s.setTexCoord(i.texCoord),t.setExtension(Cn,s)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of t){const i=n.getExtension(Cn);if(!i)continue;s.extensions=s.extensions||{};const o={},a=Xe.eq;a(i.getOffset(),[0,0])||(o.offset=i.getOffset()),i.getRotation()!==0&&(o.rotation=i.getRotation()),a(i.getScale(),[1,1])||(o.scale=i.getScale()),i.getTexCoord()!=null&&(o.texCoord=i.getTexCoord()),s.extensions[Cn]=o}return this}}Na.EXTENSION_NAME=Cn;const oh=[k.ROOT,k.SCENE,k.NODE,k.MESH,k.MATERIAL,k.TEXTURE,k.ANIMATION];class Ca extends st{init(){this.extensionName=Gt,this.propertyType="Packet",this.parentTypes=oh}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",On({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=On({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){const e=ks(this.get("context")),t=ks(this.get("properties"));return On({"@context":e},t)}fromJSONLD(e){e=ks(e);const t=e["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${Gt}: Missing context for term, "${e}".`)}}Ca.EXTENSION_NAME=Gt;function ks(r){return JSON.parse(JSON.stringify(r))}class Oa extends Ze{constructor(...e){super(...e),this.extensionName=Gt}createPacket(){return new Ca(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[Gt];if(!n||!n.packets)return this;const s=e.jsonDoc.json,i=this.document.getRoot(),o=n.packets.map(f=>this.createPacket().fromJSONLD(f)),a=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],u=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let f=0;f<a.length;f++){const y=a[f]||[];for(let E=0;E<y.length;E++){const d=y[E];if(d.extensions&&d.extensions[Gt]){const T=d.extensions[Gt];u[f][E].setExtension(Gt,o[T.packet])}}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const i of s.listParents()){let o;switch(i.propertyType){case k.ROOT:o=t.asset;break;case k.SCENE:o=t.scenes[e.sceneIndexMap.get(i)];break;case k.NODE:o=t.nodes[e.nodeIndexMap.get(i)];break;case k.MESH:o=t.meshes[e.meshIndexMap.get(i)];break;case k.MATERIAL:o=t.materials[e.materialIndexMap.get(i)];break;case k.TEXTURE:o=t.images[e.imageIndexMap.get(i)];break;case k.ANIMATION:o=t.animations[e.animationIndexMap.get(i)];break;default:o=null,this.document.getLogger().warn(`[${Gt}]: Unsupported parent property, "${i.propertyType}"`);break}o&&(o.extensions=o.extensions||{},o.extensions[Gt]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[Gt]={packets:n}),this}}Oa.EXTENSION_NAME=Gt;const Da=[ui,Zo,ea,na,sa,oa,ca,ua,ha,pa,Ta,ma,va,fi,_a,Ia,Sa,Aa,Na,Oa];[...Da];const rn="EXT_mesh_manifold",fo="MERGE";class hi extends st{static EXTENSION_NAME=rn;init(){hi.EXTENSION_NAME=rn,this.propertyType="ManifoldPrimitive",this.parentTypes=[k.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,t){if(e.getCount()!==t.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",t)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class Fa extends Ze{extensionName=rn;prewriteTypes=[k.ACCESSOR];static EXTENSION_NAME=rn;createManifoldPrimitive(){return new hi(this.document.getGraph())}read(e){const{json:t}=e.jsonDoc;return(t.meshes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[rn])return;const o=e.meshes[i],a=this.createManifoldPrimitive();o.setExtension(rn,a);const u=s.extensions[rn];if(u.manifoldPrimitive){let f=0;const y=Array();y.push(f);for(const E of o.listPrimitives()){const d=E.getIndices();if(!d){console.log("Skipping non-indexed primitive ",E.getName());continue}f+=d.getCount(),y.push(f)}a.setRunIndex(y),a.setIndices(e.accessors[u.manifoldPrimitive.indices])}u.mergeIndices!=null&&u.mergeValues!=null&&a.setMerge(e.accessors[u.mergeIndices],e.accessors[u.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(t=>{const n=t.getExtension(rn);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,en.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const i=n.getMergeIndices(),o=n.getMergeValues();!i||!o||(e.addAccessorToUsageGroup(i,fo),e.addAccessorToUsageGroup(o,fo))}),this}write(e){const{json:t}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(rn);if(!s)return;const i=e.meshIndexMap.get(n),o=t.meshes[i],a=s.getRunIndex(),u=a.length-1;if(u!==o.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const f=e.accessorIndexMap.get(s.getMergeIndices()),y=e.accessorIndexMap.get(s.getMergeValues()),E=t.accessors[f],d=t.accessors[y],T=o.primitives[0],N={indices:e.accessorIndexMap.get(s.getIndices()),mode:T.mode,attributes:{POSITION:T.attributes.POSITION}},V=t.accessors[N.indices];if(V){E&&d&&(V.sparse={count:E.count,indices:{bufferView:E.bufferView,byteOffset:E.byteOffset,componentType:E.componentType},values:{bufferView:d.bufferView,byteOffset:d.byteOffset}});for(let W=0;W<u;++W){const x=t.accessors[o.primitives[W].indices];x.bufferView=V.bufferView,x.byteOffset=V.byteOffset+4*a[W],x.count=a[W+1]-a[W]}o.extensions=o.extensions||{},o.extensions[rn]={manifoldPrimitive:N,mergeIndices:f,mergeValues:y}}}),this}}const wr={POSITION:{type:oe.Type.VEC3,components:3},NORMAL:{type:oe.Type.VEC3,components:3},TANGENT:{type:oe.Type.VEC4,components:4},TEXCOORD_0:{type:oe.Type.VEC2,components:2},TEXCOORD_1:{type:oe.Type.VEC2,components:2},COLOR_0:{type:oe.Type.VEC3,components:3},JOINTS_0:{type:oe.Type.VEC4,components:4},WEIGHTS_0:{type:oe.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function ah(r){return r.registerExtensions([Fa])}function Pa(r,e,t){r.getRoot().listBuffers().length===0&&r.createBuffer();const n=r.getRoot().listBuffers()[0],s=r.createExtension(Fa),i=r.createMesh(),o=Array(),a=Array(),u=new Map,f=e.runIndex.length-1;let y=-1;for(let _=0;_<f;++_){const C=e.runOriginalID[_];if(C==y)continue;y=C,o.push(e.runIndex[_]);const F=r.createAccessor("primitive indices of ID "+C).setBuffer(n).setType(oe.Type.SCALAR).setArray(new Uint32Array(1)),B=r.createPrimitive().setIndices(F),p=t.get(C);if(p){const{material:R,attributes:b}=p;if(b.length<1||b[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');B.setMaterial(R),u.set(B,b),p.attributes.forEach(($,Q)=>{if(Q>=a.length)a.push($);else{const ee=wr[$].components,fe=wr[a[Q]].components;if(ee!=fe)throw new Error("Attribute sizes do not correspond: "+$+" and "+a[Q]);wr[a[Q]].type==null&&(a[Q]=$)}})}else u.set(B,["POSITION"]);i.addPrimitive(B)}o.push(e.runIndex[f]);const E=e.numVert,d=e.numProp;let T=0;a.forEach((_,C)=>{const F=wr[_];if(F==null)throw new Error(_+" is not a recognized attribute.");if(F.type==null){++T;return}const B=F.components;if(T+B>d)throw new Error("Too many attribute channels.");const p=new Float32Array(B*E);for(let b=0;b<E;++b)for(let $=0;$<B;++$){let Q=e.vertProperties[d*b+T+$];_=="COLOR_0"&&(Q=Math.max(0,Math.min(1,Q))),p[B*b+$]=Q}const R=r.createAccessor(_).setBuffer(n).setType(F.type).setArray(p);for(const b of i.listPrimitives()){const $=u.get(b);$.length>C&&wr[$[C]].type!=null&&b.setAttribute(_,R)}T+=B});const N=s.createManifoldPrimitive();i.setExtension("EXT_mesh_manifold",N);const V=r.createAccessor("manifold indices").setBuffer(n).setType(oe.Type.SCALAR).setArray(e.triVerts);N.setIndices(V),N.setRunIndex(o);const W=[...Array(e.numVert).keys()],x=Array(),U=Array();if(e.mergeFromVert&&e.mergeToVert){for(const[_,C]of e.mergeFromVert.entries())W[C]=e.mergeToVert[_];for(const[_,C]of e.triVerts.entries()){const F=W[C];C!==F&&(x.push(_),U.push(F))}}if(x.length>0){const _=r.createAccessor("merge from").setBuffer(n).setType(oe.Type.SCALAR).setArray(new Uint32Array(x)),C=r.createAccessor("merge to").setBuffer(n).setType(oe.Type.SCALAR).setArray(new Uint32Array(U));N.setMerge(_,C)}return i}class ch{extensions=["glb","gltf"];async asBlob(e){const t=ah(new sf);t.registerExtensions(Da);const n=await t.writeBinary(e);return new Blob([n],{type:"application/octet-stream"})}}const ei=Array(),lh=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],uh=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","calculateCurvature","calculateNormals","smoothByNormals","smoothOut","refine","refineToLength","refineToTolerance","setProperties","setTolerance","simplify","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull"],fh=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],hh=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],dh=()=>{for(const r of ei)if(r instanceof Array)for(const e of r)e.delete();else r.delete();ei.length=0},ph=r=>(...e)=>{const t=r(...e);return ei.push(t),t},Xr=(r,e)=>{for(const t of e){const n=r[t];r[t]=ph(n)}},ed=r=>(Xr(r.Manifold,lh),Xr(r.Manifold.prototype,uh),Xr(r.CrossSection,fh),Xr(r.CrossSection.prototype,hh),r),{cos:js,sin:Bs,PI:gh}=Math,sr=gh*2;function Ua(r){const e=js(r[2]*.5*sr/360),t=Bs(r[2]*.5*sr/360),n=js(r[1]*.5*sr/360),s=Bs(r[1]*.5*sr/360),i=js(r[0]*.5*sr/360),o=Bs(r[0]*.5*sr/360),a=[0,0,0,0];return a[3]=e*n*i+t*s*o,a[2]=t*n*i-e*s*o,a[1]=e*s*i+t*n*o,a[0]=e*n*o-t*s*i,a}const mh=30,Yn=new Map;let fr,Fr,ti,os,ps;function yh(){Yn.clear()}function Ls(r,e,t,n){const s=t[e];if(s==null)return null;if(typeof s!="function")return s;const i=Fr.getCount(),o=e=="rotation"?4:3,a=new Float32Array(o*i);for(let E=0;E<i;++E){const d=E/(i-1),T=s(Bn.animationMode!=="ping-pong"?d:(1-Math.cos(d*2*Math.PI))/2);a.set(o===4?Ua(T):T,o*E)}const u=r.createAccessor(t.name+" "+e+" frames").setBuffer(r.getRoot().listBuffers()[0]).setArray(a).setType(o===4?oe.Type.VEC4:oe.Type.VEC3),f=r.createAnimationSampler().setInput(Fr).setOutput(u).setInterpolation("LINEAR"),y=r.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(f);return fr.addSampler(f),fr.addChannel(y),ps=!0,s(0)}function Th(r,e,t){if(Yn.has(t)){const n=r.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(os);fr.addChannel(n),ps=!0}}const xh=r=>Yn.get(r);function vh(r,e){const t=[];if(e==null)return t;for(let n=0;n<r.numVert;++n)for(let s=0;s<3;++s)t[n*3+s]=r.vertProperties[n*r.numProp+s];if(e.start)for(let n=0;n<r.numVert;++n){const s=r.vertProperties,i=n*r.numProp,o=t.slice(i,i+3);e.start(o);for(let a=0;a<3;++a)s[i+a]=o[a]}return t}function Eh(r,e,t,n,s){s!=null&&(t.setWeights([0]),t.listPrimitives().forEach((i,o)=>{if(s.end)for(let d=0;d<e.numVert;++d){const T=n.slice(3*d,3*(d+1));s.end(T),n.splice(3*d,3,...T)}const a=i.getAttribute("POSITION").getArray(),u=new Float32Array(a.length),f=e.runIndex[o];for(let d=0;d<u.length;++d)u[d]=n[f+d]-a[d];const y=r.createAccessor(t.getName()+" morph target").setBuffer(r.getRoot().listBuffers()[0]).setArray(u).setType(oe.Type.VEC3),E=r.createPrimitiveTarget().setAttribute("POSITION",y);i.addTarget(E)}))}const wh=(r,e)=>{const t=Yn.get(r);t!=null?t.start=e:Yn.set(r,{start:e})},bh=(r,e)=>{const t=Yn.get(r);t!=null?t.end=e:Yn.set(r,{end:e})};function _h(r){fr=r.createAnimation(""),ps=!1;const e=Math.round(Bn.animationLength*mh)+1,t=new Float32Array(e),n=new Float32Array(e);for(let s=0;s<e;++s){const i=s/(e-1);t[s]=i*Bn.animationLength,n[s]=Bn.animationMode!=="ping-pong"?i:(1-Math.cos(i*2*Math.PI))/2}Fr=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(t).setType(oe.Type.SCALAR),ti=r.createAccessor("animation weights").setBuffer(r.getRoot().listBuffers()[0]).setArray(n).setType(oe.Type.SCALAR),os=r.createAnimationSampler().setInput(Fr).setOutput(ti).setInterpolation("LINEAR"),fr.addSampler(os)}function Rh(){ps||(Fr.dispose(),ti.dispose(),os.dispose(),fr.dispose())}const di=new Map,Zr=new Map;function Ih(){di.clear(),Zr.clear()}const Sh=(r,e)=>{const t=r.asOriginal();return di.set(t.originalID(),e),t},ka=r=>di.get(r);function ja(r){return r==null?{}:(r.material==null&&(r.material=ja(r.parent)),r.material)}function Ah(r,e={}){const t={...Bn};Object.assign(t,e);const{roughness:n,metallic:s,baseColorFactor:i,alpha:o,unlit:a}=t,u=r.createMaterial(e.name??"");if(a){const f=r.createExtension(fi).createUnlit();u.setExtension("KHR_materials_unlit",f)}return o<1&&u.setAlphaMode(Vn.AlphaMode.BLEND).setDoubleSided(!0),u.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...i,o])}function as(r,e){return Zr.has(e)||Zr.set(e,Ah(r,e)),Zr.get(e)}let pi=!1;const hr=new Map,gs=new Map,Mh={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},Nh={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0};function Ch(){pi=!1,hr.clear(),gs.clear()}const Oh=r=>hr.has(r)?hr.get(r):gs.get(r),Dh=r=>{const e=hr.has(r),t=e?hr.get(r):gs.get(r);return e&&t?Mh:ka(r)},Fh=r=>pi?Nh:ka(r),Ba=(r,e)=>{let t=r.asOriginal();return e.set(t.originalID(),t.getMesh()),t},Ph=r=>Ba(r,hr),Uh=r=>(pi=!0,Ba(r,gs)),kh=(r,e,t,n={})=>{const s=[];for(const[i,o]of e.runOriginalID.entries()){const a=Oh(o);if(!a)continue;const u=Dh(o)||n;t.get(o).material=as(r,u);const f=r.createNode("debug").setMesh(Pa(r,a,t)).setMatrix(e.transform(i));s.push(f)}return s},La={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},Bn={...La};function $a(){yh(),Ch(),Ih(),mi()}class Jn{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e}clone(e){const t=new Jn(e??this.parent);return Object.assign(t,this),t}get parent(){return this._parent}}const gi=new Array;class Va extends Jn{constructor(e){super(e),gi.push(this)}}const ni=()=>gi,mi=()=>{gi.length=0};function Ir(...r){typeof self<"u"&&self.console&&self.console.log(...r)}function jh(r,e){const t=r.createNode(e.name),n=Ls(r,"translation",e,t);n!=null&&t.setTranslation(n);const s=Ls(r,"rotation",e,t);s!=null&&t.setRotation(Ua(s));const i=Ls(r,"scale",e,t);return i!=null&&t.setScale(i),t}function Bh(r,e,t,n={}){const s=t.numTri();if(s==0){Ir("Empty manifold, skipping.");return}Ir(`Triangles: ${s.toLocaleString()}`);const i=t.boundingBox(),o=[0,0,0];for(let N=0;N<3;N++)o[N]=Math.round((i.max[N]-i.min[N])*10)/10;Ir(`Bounding Box: X = ${o[0].toLocaleString()} mm, Y = ${o[1].toLocaleString()} mm, Z = ${o[2].toLocaleString()} mm`);const a=Math.round(t.volume()/10);Ir(`Genus: ${t.genus().toLocaleString()}, Volume: ${(a/100).toLocaleString()} cm^3`);const u=t.getMesh(),f=new Map;for(const N of u.runOriginalID){const V=Fh(N)||n;f.set(N,{material:as(r,V),attributes:["POSITION",...V.attributes??[]]})}const y=xh(t),E=vh(u,y),d=Pa(r,u,f);e.setMesh(d),Eh(r,u,d,E,y);const T=kh(r,u,f,n);for(const N of T)e.addChild(N)}function Ga(r,e){r.setMesh(e.getMesh()),e.listChildren().forEach(t=>{const n=t.clone();r.addChild(n)})}function Lh(r,e,t,n,s){Ga(e,t);const i=t.getMesh(),o=r.createMesh();e.setMesh(o),i.listPrimitives().forEach(a=>{const u=a.clone();a.getMaterial()===s&&u.setMaterial(n),o.addPrimitive(u)}),o.setExtras({clonedFrom:i})}function $h(r,e,t){const n=jh(r,e),{manifold:s}=e;if(s){Th(r,n,s);const i=ja(e),o=t.get(s);if(o==null){Bh(r,n,s,i);const a=new Map;a.set(i,n),t.set(s,a)}else{const a=o.get(i);if(a==null){const[u,f]=o.entries().next().value;Lh(r,n,f,as(r,i),as(r,u)),o.set(i,n)}else Ga(n,a)}}return n}function Vh(r){Object.assign(Bn,La),Object.assign(Bn,r)}function Gh(r){const e=Math.sqrt(2)/2,t=1/1e3,n=r.createNode("wrapper").setRotation([-e,0,0,e]).setScale([t,t,t]);return r.createScene().addChild(n),n}function Hh(r,e){const t=new Jn;return t.manifold=r,yi([t],e)}function yi(r,e){if(Vh(e),r.length==0)throw new TypeError("nodes[] must contain at least one GLTFNode.");const t=new lr,n=Gh(t);_h(t);const s=new Map,i=new Map;let o=0;for(const a of r)s.set(a,$h(t,a,i)),a.manifold&&++o;for(const a of r){const u=s.get(a),{parent:f}=a;f?s.get(f).addChild(u):n.addChild(u)}return Ir("Total glTF nodes: ",r.length,", Total mesh references: ",o),Rh(),t}async function cs(r){const e=await import("./manifoldCAD-q5OqbiZz.js");if(Array.isArray(r))return await r.map(cs).reduce(async(t,n)=>[...await t,...await n],new Promise(t=>t([])));if(r instanceof e.GLTFNode||r instanceof Jn){const t=r;return t.parent?[await cs(t.parent),t].flat():[t]}else if(r instanceof e.Manifold){const t=new Jn;return t.manifold=r,[t]}throw new Error("Cannot convert model to GLTFNode!")}var td=Object.freeze({__proto__:null,GLTFNode:Jn,GLTFNodeTracked:Va,GLTFNodesToGLTFDoc:yi,anyToGLTFNodeList:cs,cleanup:$a,getGLTFNodes:ni,globalDefaults:Bn,manifoldToGLTFDoc:Hh,only:Uh,resetGLTFNodes:mi,setMaterial:Sh,setMorphEnd:bh,setMorphStart:wh,show:Ph}),ho=(()=>{var r=import.meta.url;return(async function(e={}){var t,n=e,s,i,o=new Promise((c,l)=>{s=c,i=l}),a=typeof window=="object",u=typeof importScripts=="function",f=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(f){const{createRequire:c}=await Promise.resolve().then(function(){return ls});var y=c(import.meta.url)}var E=!1;n.setup=function(){if(E)return;E=!0,n.initTBB();function c(I,O,z=(se=>se)){if(O)for(let se of O)I.push_back(z(se));return I}function l(I,O=(z=>z)){const z=[],se=I.size();for(let Me=0;Me<se;Me++)z.push(O(I.get(Me)));return z}function h(I,O=(z=>z)){const z=[],se=I.size();for(let Me=0;Me<se;Me++){const qe=I.get(Me),ut=qe.size(),Ft=[];for(let yt=0;yt<ut;yt++)Ft.push(O(qe.get(yt)));z.push(Ft)}return z}function g(I){return I[0].length<3&&(I=[I]),c(new n.Vector2_vec2,I,O=>c(new n.Vector_vec2,O,z=>z instanceof Array?{x:z[0],y:z[1]}:z))}function M(I){for(let O=0;O<I.size();O++)I.get(O).delete();I.delete()}function P(I){return I[0]instanceof Array?{x:I[0][0],y:I[0][1]}:typeof I[0]=="number"?{x:I[0]||0,y:I[1]||0}:I[0]}function q(I){return I[0]instanceof Array?{x:I[0][0],y:I[0][1],z:I[0][2]}:typeof I[0]=="number"?{x:I[0]||0,y:I[1]||0,z:I[2]||0}:I[0]}function j(I){return I=="EvenOdd"?0:I=="NonZero"?1:I=="Negative"?3:2}function Z(I){return I=="Round"?1:I=="Miter"?2:0}const re=n.CrossSection;function ue(I,O="Positive"){if(I instanceof re)return I;{const z=g(I),se=new re(z,j(O));return M(z),se}}n.CrossSection.prototype.translate=function(...I){return this._Translate(P(I))},n.CrossSection.prototype.scale=function(I){return typeof I=="number"?this._Scale({x:I,y:I}):this._Scale(P([I]))},n.CrossSection.prototype.mirror=function(I){return this._Mirror(P([I]))},n.CrossSection.prototype.warp=function(I){const O=mr(function(se){const Me=gt(se,"double"),qe=gt(se+8,"double"),ut=[Me,qe];I(ut),ln(se,ut[0],"double"),ln(se+8,ut[1],"double")},"vi"),z=this._Warp(O);return yr(O),z},n.CrossSection.prototype.decompose=function(){const I=this._Decompose(),O=l(I);return I.delete(),O},n.CrossSection.prototype.bounds=function(){const I=this._Bounds();return{min:["x","y"].map(O=>I.min[O]),max:["x","y"].map(O=>I.max[O])}},n.CrossSection.prototype.offset=function(I,O="Round",z=2,se=0){return this._Offset(I,Z(O),z,se)},n.CrossSection.prototype.simplify=function(I=1e-6){return this._Simplify(I)},n.CrossSection.prototype.extrude=function(I,O=0,z=0,se=[1,1],Me=!1){se=P([se]);const qe=n._Extrude(this._ToPolygons(),I,O,z,se);return Me?qe.translate([0,0,-I/2]):qe},n.CrossSection.prototype.revolve=function(I=0,O=360){return n._Revolve(this._ToPolygons(),I,O)},n.CrossSection.prototype.add=function(I){return this._add(ue(I))},n.CrossSection.prototype.subtract=function(I){return this._subtract(ue(I))},n.CrossSection.prototype.intersect=function(I){return this._intersect(ue(I))},n.CrossSection.prototype.toPolygons=function(){const I=this._ToPolygons(),O=h(I,z=>[z.x,z.y]);return I.delete(),O},n.Manifold.prototype.smoothOut=function(I=60,O=0){return this._SmoothOut(I,O)},n.Manifold.prototype.warp=function(I){const O=mr(function(Me){const qe=gt(Me,"double"),ut=gt(Me+8,"double"),Ft=gt(Me+16,"double"),yt=[qe,ut,Ft];I(yt),ln(Me,yt[0],"double"),ln(Me+8,yt[1],"double"),ln(Me+16,yt[2],"double")},"vi"),z=this._Warp(O);yr(O);const se=z.status();if(se!=="NoError")throw new n.ManifoldError(se);return z},n.Manifold.prototype.calculateNormals=function(I,O=60){return this._CalculateNormals(I,O)},n.Manifold.prototype.setProperties=function(I,O){const z=this.numProp(),se=mr(function(qe,ut,Ft){const yt=[];for(let ft=0;ft<I;++ft)yt[ft]=gt(qe+8*ft,"double");const nr=[];for(let ft=0;ft<3;++ft)nr[ft]=gt(ut+8*ft,"double");const rr=[];for(let ft=0;ft<z;++ft)rr[ft]=gt(Ft+8*ft,"double");O(yt,nr,rr);for(let ft=0;ft<I;++ft)ln(qe+8*ft,yt[ft],"double")},"viii"),Me=this._SetProperties(I,se);return yr(se),Me},n.Manifold.prototype.translate=function(...I){return this._Translate(q(I))},n.Manifold.prototype.rotate=function(I,O,z){return Array.isArray(I)?this._Rotate(...I):this._Rotate(I,O||0,z||0)},n.Manifold.prototype.scale=function(I){return typeof I=="number"?this._Scale({x:I,y:I,z:I}):this._Scale(q([I]))},n.Manifold.prototype.mirror=function(I){return this._Mirror(q([I]))},n.Manifold.prototype.trimByPlane=function(I,O=0){return this._TrimByPlane(q([I]),O)},n.Manifold.prototype.slice=function(I=0){const O=this._Slice(I),z=new re(O,j("Positive"));return M(O),z},n.Manifold.prototype.project=function(){const I=this._Project(),O=new re(I,j("Positive"));return M(I),O},n.Manifold.prototype.split=function(I){const O=this._Split(I),z=l(O);return O.delete(),z},n.Manifold.prototype.splitByPlane=function(I,O=0){const z=this._SplitByPlane(q([I]),O),se=l(z);return z.delete(),se},n.Manifold.prototype.decompose=function(){const I=this._Decompose(),O=l(I);return I.delete(),O},n.Manifold.prototype.boundingBox=function(){const I=this._boundingBox();return{min:["x","y","z"].map(O=>I.min[O]),max:["x","y","z"].map(O=>I.max[O])}};class Ae{constructor({numProp:O=3,triVerts:z=new Uint32Array,vertProperties:se=new Float32Array,mergeFromVert:Me,mergeToVert:qe,runIndex:ut,runOriginalID:Ft,faceID:yt,halfedgeTangent:nr,runTransform:rr}={}){this.numProp=O,this.triVerts=z,this.vertProperties=se,this.mergeFromVert=Me,this.mergeToVert=qe,this.runIndex=ut,this.runOriginalID=Ft,this.faceID=yt,this.halfedgeTangent=nr,this.runTransform=rr}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:O,mesh:z}=n._Merge(this);return Object.assign(this,{...z}),O}verts(O){return this.triVerts.subarray(3*O,3*(O+1))}position(O){return this.vertProperties.subarray(this.numProp*O,this.numProp*O+3)}extras(O){return this.vertProperties.subarray(this.numProp*O+3,this.numProp*(O+1))}tangent(O){return this.halfedgeTangent.subarray(4*O,4*(O+1))}transform(O){const z=new Array(16);for(const se of[0,1,2,3])for(const Me of[0,1,2])z[4*se+Me]=this.runTransform[12*O+3*se+Me];return z[15]=1,z}}n.Mesh=Ae,n.Manifold.prototype.getMesh=function(I=-1){return new Ae(this._GetMeshJS(I))},n.ManifoldError=function(O,...z){let se="Unknown error";switch(O){case"NonFiniteVertex":se="Non-finite vertex";break;case"NotManifold":se="Not manifold";break;case"VertexOutOfBounds":se="Vertex index out of bounds";break;case"PropertiesWrongLength":se="Properties have wrong length";break;case"MissingPositionProperties":se="Less than three properties";break;case"MergeVectorsDifferentLengths":se="Merge vectors have different lengths";break;case"MergeIndexOutOfBounds":se="Merge index out of bounds";break;case"TransformWrongLength":se="Transform vector has wrong length";break;case"RunIndexWrongLength":se="Run index vector has wrong length";break;case"FaceIDWrongLength":se="Face ID vector has wrong length";case"InvalidConstruction":se="Manifold constructed with invalid parameters"}const Me=Error.apply(this,[se,...z]);Me.name=this.name="ManifoldError",this.message=Me.message,this.stack=Me.stack,this.code=O},n.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:n.ManifoldError,writable:!0,configurable:!0}}),n.CrossSection=function(I,O="Positive"){const z=g(I),se=new re(z,j(O));return M(z),se},n.CrossSection.ofPolygons=function(I,O="Positive"){return new n.CrossSection(I,O)},n.CrossSection.square=function(...I){let O;I.length==0?O={x:1,y:1}:typeof I[0]=="number"?O={x:I[0],y:I[0]}:O=P(I);const z=I[1]||!1;return n._Square(O,z)},n.CrossSection.circle=function(I,O=0){return n._Circle(I,O)};function Ge(I){return function(...O){O.length==1&&(O=O[0]);const z=new n.Vector_crossSection;for(const Me of O)z.push_back(ue(Me));const se=n["_crossSection"+I](z);return z.delete(),se}}n.CrossSection.compose=Ge("Compose"),n.CrossSection.union=Ge("UnionN"),n.CrossSection.difference=Ge("DifferenceN"),n.CrossSection.intersection=Ge("IntersectionN");function ht(I,O){c(I,O,z=>z instanceof Array?{x:z[0],y:z[1]}:z)}n.CrossSection.hull=function(...I){I.length==1&&(I=I[0]);let O=new n.Vector_vec2;for(const se of I)if(se instanceof re)n._crossSectionCollectVertices(O,se);else if(se instanceof Array&&se.length==2&&typeof se[0]=="number")O.push_back({x:se[0],y:se[1]});else if(se.x)O.push_back(se);else{const qe=se[0].length==2&&typeof se[0][0]=="number"||se[0].x?[se]:se;for(const ut of qe)ht(O,ut)}const z=n._crossSectionHullPoints(O);return O.delete(),z},n.CrossSection.prototype=Object.create(re.prototype),Object.defineProperty(n.CrossSection,Symbol.hasInstance,{get:()=>I=>I instanceof re});const at=n.Manifold;n.Manifold=function(I){const O=new at(I),z=O.status();if(z!=="NoError")throw new n.ManifoldError(z);return O},n.Manifold.ofMesh=function(I){return new n.Manifold(I)},n.Manifold.tetrahedron=function(){return n._Tetrahedron()},n.Manifold.cube=function(...I){let O;I.length==0?O={x:1,y:1,z:1}:typeof I[0]=="number"?O={x:I[0],y:I[0],z:I[0]}:O=q(I);const z=I[1]||!1;return n._Cube(O,z)},n.Manifold.cylinder=function(I,O,z=-1,se=0,Me=!1){return n._Cylinder(I,O,z,se,Me)},n.Manifold.sphere=function(I,O=0){return n._Sphere(I,O)},n.Manifold.smooth=function(I,O=[]){const z=new n.Vector_smoothness;c(z,O);const se=n._Smooth(I,z);return z.delete(),se},n.Manifold.extrude=function(I,O,z=0,se=0,Me=[1,1],qe=!1){return(I instanceof re?I:n.CrossSection(I,"Positive")).extrude(O,z,se,Me,qe)},n.Manifold.revolve=function(I,O=0,z=360){return(I instanceof re?I:n.CrossSection(I,"Positive")).revolve(O,z)},n.Manifold.reserveIDs=function(I){return n._ReserveIDs(I)},n.Manifold.compose=function(I){const O=new n.Vector_manifold;c(O,I);const z=n._manifoldCompose(O);return O.delete(),z};function Jt(I){return function(...O){O.length==1&&(O=O[0]);const z=new n.Vector_manifold;for(const Me of O)z.push_back(Me);const se=n["_manifold"+I+"N"](z);return z.delete(),se}}n.Manifold.union=Jt("Union"),n.Manifold.difference=Jt("Difference"),n.Manifold.intersection=Jt("Intersection"),n.Manifold.levelSet=function(I,O,z,se=0,Me=-1){const qe={min:{x:O.min[0],y:O.min[1],z:O.min[2]},max:{x:O.max[0],y:O.max[1],z:O.max[2]}},ut=mr(function(yt){const nr=gt(yt,"double"),rr=gt(yt+8,"double"),ft=gt(yt+16,"double");return I([nr,rr,ft])},"di"),Ft=n._LevelSet(ut,qe,z,se,Me);return yr(ut),Ft};function Zt(I,O){c(I,O,z=>z instanceof Array?{x:z[0],y:z[1],z:z[2]}:z)}n.Manifold.hull=function(...I){I.length==1&&(I=I[0]);let O=new n.Vector_vec3;for(const se of I)se instanceof at?n._manifoldCollectVertices(O,se):se instanceof Array&&se.length==3&&typeof se[0]=="number"?O.push_back({x:se[0],y:se[1],z:se[2]}):se.x?O.push_back(se):Zt(O,se);const z=n._manifoldHullPoints(O);return O.delete(),z},n.Manifold.prototype=Object.create(at.prototype),Object.defineProperty(n.Manifold,Symbol.hasInstance,{get:()=>I=>I instanceof at}),n.triangulate=function(I,O=-1,z=!0){const se=g(I),Me=l(n._Triangulate(se,O,z),qe=>[qe[0],qe[1],qe[2]]);return M(se),Me}};var d=Object.assign({},n),T="";function N(c){return n.locateFile?n.locateFile(c,T):T+c}var V,W;if(f){var x=y("fs"),U=y("path");T=y("url").fileURLToPath(new URL("/assets/manifold-B8h_vZ5O.js",import.meta.url)),W=c=>{c=Mt(c)?new URL(c):U.normalize(c);var l=x.readFileSync(c);return l},V=(c,l=!0)=>(c=Mt(c)?new URL(c):U.normalize(c),new Promise((h,g)=>{x.readFile(c,l?void 0:"utf8",(M,P)=>{M?g(M):h(l?P.buffer:P)})})),!n.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2)}else(a||u)&&(u?T=self.location.href:typeof document<"u"&&document.currentScript&&(T=document.currentScript.src),r&&(T=r),T.startsWith("blob:")?T="":T=T.substr(0,T.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(W=c=>{var l=new XMLHttpRequest;return l.open("GET",c,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}),V=c=>Mt(c)?new Promise((l,h)=>{var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=()=>{(g.status==200||g.status==0&&g.response)&&h(g.response),l(g.status)},g.onerror=l,g.send(null)}):fetch(c,{credentials:"same-origin"}).then(l=>l.ok?l.arrayBuffer():Promise.reject(new Error(l.status+" : "+l.url))));n.print||console.log.bind(console);var _=n.printErr||console.error.bind(console);Object.assign(n,d),d=null,n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.quit&&n.quit;var C;n.wasmBinary&&(C=n.wasmBinary);var F,B=!1,p,R,b,$,Q,ee,fe,Ee;function me(){var c=F.buffer;n.HEAP8=p=new Int8Array(c),n.HEAP16=b=new Int16Array(c),n.HEAPU8=R=new Uint8Array(c),n.HEAPU16=$=new Uint16Array(c),n.HEAP32=Q=new Int32Array(c),n.HEAPU32=ee=new Uint32Array(c),n.HEAPF32=fe=new Float32Array(c),n.HEAPF64=Ee=new Float64Array(c)}var be=[],Ie=[],He=[];function We(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Tt(n.preRun.shift());cn(be)}function kt(){cn(Ie)}function lt(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)tt(n.postRun.shift());cn(He)}function Tt(c){be.unshift(c)}function Et(c){Ie.unshift(c)}function tt(c){He.unshift(c)}var A=0,De=null;function Dn(c){A++,n.monitorRunDependencies?.(A)}function tn(c){if(A--,n.monitorRunDependencies?.(A),A==0&&De){var l=De;De=null,l()}}function _t(c){n.onAbort?.(c),c="Aborted("+c+")",_(c),B=!0,c+=". Build with -sASSERTIONS for more info.";var l=new WebAssembly.RuntimeError(c);throw i(l),l}var Ve="data:application/octet-stream;base64,",it=c=>c.startsWith(Ve),Mt=c=>c.startsWith("file://");function on(){if(n.locateFile){var c="manifold.wasm";return it(c)?c:N(c)}return new URL("/assets/manifold-D9yvTBHx.wasm",import.meta.url).href}var Ot;function Ur(c){if(c==Ot&&C)return new Uint8Array(C);if(W)return W(c);throw"both async and sync fetching of the wasm failed"}function ms(c){return C?Promise.resolve().then(()=>Ur(c)):V(c).then(l=>new Uint8Array(l),()=>Ur(c))}function pr(c,l,h){return ms(c).then(g=>WebAssembly.instantiate(g,l)).then(h,g=>{_(`failed to asynchronously prepare wasm: ${g}`),_t(g)})}function Qn(c,l,h,g){return!c&&typeof WebAssembly.instantiateStreaming=="function"&&!it(l)&&!Mt(l)&&!f&&typeof fetch=="function"?fetch(l,{credentials:"same-origin"}).then(M=>{var P=WebAssembly.instantiateStreaming(M,h);return P.then(g,function(q){return _(`wasm streaming compile failed: ${q}`),_("falling back to ArrayBuffer instantiation"),pr(l,h,g)})}):pr(l,h,g)}function an(){return{a:zc}}function kr(){var c=an();function l(g,M){return Yt=g.exports,Yt=Wc(Yt),F=Yt.J,me(),Ne=Yt.M,Et(Yt.K),tn(),Yt}Dn();function h(g){l(g.instance)}if(n.instantiateWasm)try{return n.instantiateWasm(c,l)}catch(g){_(`Module.instantiateWasm callback failed with error: ${g}`),i(g)}return Ot||(Ot=on()),Qn(C,Ot,c,h).catch(i),{}}var cn=c=>{for(;c.length>0;)c.shift()(n)};function gt(c,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":return p[c>>>0];case"i8":return p[c>>>0];case"i16":return b[c>>>1>>>0];case"i32":return Q[c>>>2>>>0];case"i64":_t("to do getValue(i64) use WASM_BIGINT");case"float":return fe[c>>>2>>>0];case"double":return Ee[c>>>3>>>0];case"*":return ee[c>>>2>>>0];default:_t(`invalid type for getValue: ${l}`)}}n.noExitRuntime;function ln(c,l,h="i8"){switch(h.endsWith("*")&&(h="*"),h){case"i1":p[c>>>0]=l;break;case"i8":p[c>>>0]=l;break;case"i16":b[c>>>1>>>0]=l;break;case"i32":Q[c>>>2>>>0]=l;break;case"i64":_t("to do setValue(i64) use WASM_BIGINT");case"float":fe[c>>>2>>>0]=l;break;case"double":Ee[c>>>3>>>0]=l;break;case"*":ee[c>>>2>>>0]=l;break;default:_t(`invalid type for setValue: ${h}`)}}class Xt{constructor(l){this.excPtr=l,this.ptr=l-24}set_type(l){ee[this.ptr+4>>>2>>>0]=l}get_type(){return ee[this.ptr+4>>>2>>>0]}set_destructor(l){ee[this.ptr+8>>>2>>>0]=l}get_destructor(){return ee[this.ptr+8>>>2>>>0]}set_caught(l){l=l?1:0,p[this.ptr+12>>>0]=l}get_caught(){return p[this.ptr+12>>>0]!=0}set_rethrown(l){l=l?1:0,p[this.ptr+13>>>0]=l}get_rethrown(){return p[this.ptr+13>>>0]!=0}init(l,h){this.set_adjusted_ptr(0),this.set_type(l),this.set_destructor(h)}set_adjusted_ptr(l){ee[this.ptr+16>>>2>>>0]=l}get_adjusted_ptr(){return ee[this.ptr+16>>>2>>>0]}get_exception_ptr(){var l=Ii(this.get_type());if(l)return ee[this.excPtr>>>2>>>0];var h=this.get_adjusted_ptr();return h!==0?h:this.excPtr}}var Gn=0;function ys(c,l,h){c>>>=0,l>>>=0,h>>>=0;var g=new Xt(c);throw g.init(l,h),Gn=c,Gn}var Ts=()=>{_t("")},un={},gr=c=>{for(;c.length;){var l=c.pop(),h=c.pop();h(l)}};function Hn(c){return this.fromWireType(ee[c>>>2>>>0])}var Fn={},fn={},er={},jr,tr=c=>{throw new jr(c)},hn=(c,l,h)=>{c.forEach(function(j){er[j]=l});function g(j){var Z=h(j);Z.length!==c.length&&tr("Mismatched type converter count");for(var re=0;re<c.length;++re)jt(c[re],Z[re])}var M=new Array(l.length),P=[],q=0;l.forEach((j,Z)=>{fn.hasOwnProperty(j)?M[Z]=fn[j]:(P.push(j),Fn.hasOwnProperty(j)||(Fn[j]=[]),Fn[j].push(()=>{M[Z]=fn[j],++q,q===P.length&&g(M)}))}),P.length===0&&g(M)},xs=function(c){c>>>=0;var l=un[c];delete un[c];var h=l.rawConstructor,g=l.rawDestructor,M=l.fields,P=M.map(q=>q.getterReturnType).concat(M.map(q=>q.setterArgumentType));hn([c],P,q=>{var j={};return M.forEach((Z,re)=>{var ue=Z.fieldName,Ae=q[re],Ge=Z.getter,ht=Z.getterContext,at=q[re+M.length],Jt=Z.setter,Zt=Z.setterContext;j[ue]={read:I=>Ae.fromWireType(Ge(ht,I)),write:(I,O)=>{var z=[];Jt(Zt,I,at.toWireType(z,O)),gr(z)}}}),[{name:l.name,fromWireType:Z=>{var re={};for(var ue in j)re[ue]=j[ue].read(Z);return g(Z),re},toWireType:(Z,re)=>{for(var ue in j)if(!(ue in re))throw new TypeError(`Missing field: "${ue}"`);var Ae=h();for(ue in j)j[ue].write(Ae,re[ue]);return Z!==null&&Z.push(g,Ae),Ae},argPackAdvance:Bt,readValueFromPointer:Hn,destructorFunction:g}]})};function vs(c,l,h,g,M){}var Es=()=>{for(var c=new Array(256),l=0;l<256;++l)c[l]=String.fromCharCode(l);nn=c},nn,ot=c=>{for(var l="",h=c;R[h>>>0];)l+=nn[R[h++>>>0]];return l},Kt,Ue=c=>{throw new Kt(c)};function ws(c,l,h={}){var g=l.name;if(c||Ue(`type "${g}" must have a positive integer typeid pointer`),fn.hasOwnProperty(c)){if(h.ignoreDuplicateRegistrations)return;Ue(`Cannot register type '${g}' twice`)}if(fn[c]=l,delete er[c],Fn.hasOwnProperty(c)){var M=Fn[c];delete Fn[c],M.forEach(P=>P())}}function jt(c,l,h={}){if(!("argPackAdvance"in l))throw new TypeError("registerType registeredInstance requires argPackAdvance");return ws(c,l,h)}var Bt=8;function m(c,l,h,g){c>>>=0,l>>>=0,l=ot(l),jt(c,{name:l,fromWireType:function(M){return!!M},toWireType:function(M,P){return P?h:g},argPackAdvance:Bt,readValueFromPointer:function(M){return this.fromWireType(R[M>>>0])},destructorFunction:null})}var w=c=>({count:c.count,deleteScheduled:c.deleteScheduled,preservePointerOnDelete:c.preservePointerOnDelete,ptr:c.ptr,ptrType:c.ptrType,smartPtr:c.smartPtr,smartPtrType:c.smartPtrType}),S=c=>{function l(h){return h.$$.ptrType.registeredClass.name}Ue(l(c)+" instance already deleted")},H=!1,ie=c=>{},ce=c=>{c.smartPtr?c.smartPtrType.rawDestructor(c.smartPtr):c.ptrType.registeredClass.rawDestructor(c.ptr)},te=c=>{c.count.value-=1;var l=c.count.value===0;l&&ce(c)},xe=(c,l,h)=>{if(l===h)return c;if(h.baseClass===void 0)return null;var g=xe(c,l,h.baseClass);return g===null?null:h.downcast(g)},Y={},Fe=()=>Object.keys(ve).length,Pe=()=>{var c=[];for(var l in ve)ve.hasOwnProperty(l)&&c.push(ve[l]);return c},Re=[],Be=()=>{for(;Re.length;){var c=Re.pop();c.$$.deleteScheduled=!1,c.delete()}},Se,Le=c=>{Se=c,Re.length&&Se&&Se(Be)},$e=()=>{n.getInheritedInstanceCount=Fe,n.getLiveInheritedInstances=Pe,n.flushPendingDeletes=Be,n.setDelayFunction=Le},ve={},Qe=(c,l)=>{for(l===void 0&&Ue("ptr should not be undefined");c.baseClass;)l=c.upcast(l),c=c.baseClass;return l},we=(c,l)=>(l=Qe(c,l),ve[l]),ye=(c,l)=>{(!l.ptrType||!l.ptr)&&tr("makeClassHandle requires ptr and ptrType");var h=!!l.smartPtrType,g=!!l.smartPtr;return h!==g&&tr("Both smartPtrType and smartPtr must be specified"),l.count={value:1},K(Object.create(c,{$$:{value:l,writable:!0}}))};function ae(c){var l=this.getPointee(c);if(!l)return this.destructor(c),null;var h=we(this.registeredClass,l);if(h!==void 0){if(h.$$.count.value===0)return h.$$.ptr=l,h.$$.smartPtr=c,h.clone();var g=h.clone();return this.destructor(c),g}function M(){return this.isSmartPointer?ye(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:l,smartPtrType:this,smartPtr:c}):ye(this.registeredClass.instancePrototype,{ptrType:this,ptr:c})}var P=this.registeredClass.getActualType(l),q=Y[P];if(!q)return M.call(this);var j;this.isConst?j=q.constPointerType:j=q.pointerType;var Z=xe(l,this.registeredClass,j.registeredClass);return Z===null?M.call(this):this.isSmartPointer?ye(j.registeredClass.instancePrototype,{ptrType:j,ptr:Z,smartPtrType:this,smartPtr:c}):ye(j.registeredClass.instancePrototype,{ptrType:j,ptr:Z})}var K=c=>typeof FinalizationRegistry>"u"?(K=l=>l,c):(H=new FinalizationRegistry(l=>{te(l.$$)}),K=l=>{var h=l.$$,g=!!h.smartPtr;if(g){var M={$$:h};H.register(l,M,l)}return l},ie=l=>H.unregister(l),K(c)),D=()=>{Object.assign(G.prototype,{isAliasOf(c){if(!(this instanceof G)||!(c instanceof G))return!1;var l=this.$$.ptrType.registeredClass,h=this.$$.ptr;c.$$=c.$$;for(var g=c.$$.ptrType.registeredClass,M=c.$$.ptr;l.baseClass;)h=l.upcast(h),l=l.baseClass;for(;g.baseClass;)M=g.upcast(M),g=g.baseClass;return l===g&&h===M},clone(){if(this.$$.ptr||S(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var c=K(Object.create(Object.getPrototypeOf(this),{$$:{value:w(this.$$)}}));return c.$$.count.value+=1,c.$$.deleteScheduled=!1,c},delete(){this.$$.ptr||S(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ue("Object already scheduled for deletion"),ie(this),te(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||S(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ue("Object already scheduled for deletion"),Re.push(this),Re.length===1&&Se&&Se(Be),this.$$.deleteScheduled=!0,this}})};function G(){}var J=(c,l)=>Object.defineProperty(l,"name",{value:c}),he=(c,l,h)=>{if(c[l].overloadTable===void 0){var g=c[l];c[l]=function(...M){return c[l].overloadTable.hasOwnProperty(M.length)||Ue(`Function '${h}' called with an invalid number of arguments (${M.length}) - expects one of (${c[l].overloadTable})!`),c[l].overloadTable[M.length].apply(this,M)},c[l].overloadTable=[],c[l].overloadTable[g.argCount]=g}},ge=(c,l,h)=>{n.hasOwnProperty(c)?((h===void 0||n[c].overloadTable!==void 0&&n[c].overloadTable[h]!==void 0)&&Ue(`Cannot register public name '${c}' twice`),he(n,c,c),n.hasOwnProperty(h)&&Ue(`Cannot register multiple overloads of a function with the same number of arguments (${h})!`),n[c].overloadTable[h]=l):(n[c]=l,h!==void 0&&(n[c].numArguments=h))},X=48,ne=57,v=c=>{if(c===void 0)return"_unknown";c=c.replace(/[^a-zA-Z0-9_]/g,"$");var l=c.charCodeAt(0);return l>=X&&l<=ne?`_${c}`:c};function L(c,l,h,g,M,P,q,j){this.name=c,this.constructor=l,this.instancePrototype=h,this.rawDestructor=g,this.baseClass=M,this.getActualType=P,this.upcast=q,this.downcast=j,this.pureVirtualFunctions=[]}var le=(c,l,h)=>{for(;l!==h;)l.upcast||Ue(`Expected null or instance of ${h.name}, got an instance of ${l.name}`),c=l.upcast(c),l=l.baseClass;return c};function de(c,l){if(l===null)return this.isReference&&Ue(`null is not a valid ${this.name}`),0;l.$$||Ue(`Cannot pass "${Ss(l)}" as a ${this.name}`),l.$$.ptr||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`);var h=l.$$.ptrType.registeredClass,g=le(l.$$.ptr,h,this.registeredClass);return g}function _e(c,l){var h;if(l===null)return this.isReference&&Ue(`null is not a valid ${this.name}`),this.isSmartPointer?(h=this.rawConstructor(),c!==null&&c.push(this.rawDestructor,h),h):0;(!l||!l.$$)&&Ue(`Cannot pass "${Ss(l)}" as a ${this.name}`),l.$$.ptr||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&l.$$.ptrType.isConst&&Ue(`Cannot convert argument of type ${l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name} to parameter type ${this.name}`);var g=l.$$.ptrType.registeredClass;if(h=le(l.$$.ptr,g,this.registeredClass),this.isSmartPointer)switch(l.$$.smartPtr===void 0&&Ue("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:l.$$.smartPtrType===this?h=l.$$.smartPtr:Ue(`Cannot convert argument of type ${l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:h=l.$$.smartPtr;break;case 2:if(l.$$.smartPtrType===this)h=l.$$.smartPtr;else{var M=l.clone();h=this.rawShare(h,mt.toHandle(()=>M.delete())),c!==null&&c.push(this.rawDestructor,h)}break;default:Ue("Unsupporting sharing policy")}return h}function Oe(c,l){if(l===null)return this.isReference&&Ue(`null is not a valid ${this.name}`),0;l.$$||Ue(`Cannot pass "${Ss(l)}" as a ${this.name}`),l.$$.ptr||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`),l.$$.ptrType.isConst&&Ue(`Cannot convert argument of type ${l.$$.ptrType.name} to parameter type ${this.name}`);var h=l.$$.ptrType.registeredClass,g=le(l.$$.ptr,h,this.registeredClass);return g}var Ke=()=>{Object.assign(pe.prototype,{getPointee(c){return this.rawGetPointee&&(c=this.rawGetPointee(c)),c},destructor(c){this.rawDestructor?.(c)},argPackAdvance:Bt,readValueFromPointer:Hn,fromWireType:ae})};function pe(c,l,h,g,M,P,q,j,Z,re,ue){this.name=c,this.registeredClass=l,this.isReference=h,this.isConst=g,this.isSmartPointer=M,this.pointeeType=P,this.sharingPolicy=q,this.rawGetPointee=j,this.rawConstructor=Z,this.rawShare=re,this.rawDestructor=ue,!M&&l.baseClass===void 0?g?(this.toWireType=de,this.destructorFunction=null):(this.toWireType=Oe,this.destructorFunction=null):this.toWireType=_e}var ke=(c,l,h)=>{n.hasOwnProperty(c)||tr("Replacing nonexistent public symbol"),n[c].overloadTable!==void 0&&h!==void 0?n[c].overloadTable[h]=l:(n[c]=l,n[c].argCount=h)},je=(c,l,h)=>{c=c.replace(/p/g,"i");var g=n["dynCall_"+c];return g(l,...h)},Ne,dt=c=>Ne.get(c),nt=(c,l,h=[])=>{if(c.includes("j"))return je(c,l,h);var g=dt(l)(...h);return c[0]=="p"?g>>>0:g},Lt=(c,l)=>(...h)=>nt(c,l,h),Te=(c,l)=>{c=ot(c);function h(){return c.includes("j")||c.includes("p")?Lt(c,l):dt(l)}var g=h();return typeof g!="function"&&Ue(`unknown function pointer with signature ${c}: ${l}`),g},qt=(c,l)=>{var h=J(l,function(g){this.name=l,this.message=g;var M=new Error(g).stack;M!==void 0&&(this.stack=this.toString()+`
`+M.replace(/^Error(:[^\n]*)?\n/,""))});return h.prototype=Object.create(c.prototype),h.prototype.constructor=h,h.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},h},Rt,Dt=c=>{var l=Ri(c),h=ot(l);return mn(l),h},Nt=(c,l)=>{var h=[],g={};function M(P){if(!g[P]&&!fn[P]){if(er[P]){er[P].forEach(M);return}h.push(P),g[P]=!0}}throw l.forEach(M),new Rt(`${c}: `+h.map(Dt).join([", "]))};function Ct(c,l,h,g,M,P,q,j,Z,re,ue,Ae,Ge){c>>>=0,l>>>=0,h>>>=0,g>>>=0,M>>>=0,P>>>=0,q>>>=0,j>>>=0,Z>>>=0,re>>>=0,ue>>>=0,Ae>>>=0,Ge>>>=0,ue=ot(ue),P=Te(M,P),j&&=Te(q,j),re&&=Te(Z,re),Ge=Te(Ae,Ge);var ht=v(ue);ge(ht,function(){Nt(`Cannot construct ${ue} due to unbound types`,[g])}),hn([c,l,h],g?[g]:[],at=>{at=at[0];var Jt,Zt;g?(Jt=at.registeredClass,Zt=Jt.instancePrototype):Zt=G.prototype;var I=J(ue,function(...ut){if(Object.getPrototypeOf(this)!==O)throw new Kt("Use 'new' to construct "+ue);if(z.constructor_body===void 0)throw new Kt(ue+" has no accessible constructor");var Ft=z.constructor_body[ut.length];if(Ft===void 0)throw new Kt(`Tried to invoke ctor of ${ue} with invalid number of parameters (${ut.length}) - expected (${Object.keys(z.constructor_body).toString()}) parameters instead!`);return Ft.apply(this,ut)}),O=Object.create(Zt,{constructor:{value:I}});I.prototype=O;var z=new L(ue,I,O,Ge,Jt,P,j,re);z.baseClass&&(z.baseClass.__derivedClasses??=[],z.baseClass.__derivedClasses.push(z));var se=new pe(ue,z,!0,!1,!1),Me=new pe(ue+"*",z,!1,!1,!1),qe=new pe(ue+" const*",z,!1,!0,!1);return Y[c]={pointerType:Me,constPointerType:qe},ke(ht,I),[se,Me,qe]})}var dn=(c,l)=>{for(var h=[],g=0;g<c;g++)h.push(ee[l+g*4>>>2>>>0]);return h};function pn(c){for(var l=1;l<c.length;++l)if(c[l]!==null&&c[l].destructorFunction===void 0)return!0;return!1}function Br(c,l){if(!(c instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof c} which is not a function`);var h=J(c.name||"unknownFunctionName",function(){});h.prototype=c.prototype;var g=new h,M=c.apply(g,l);return M instanceof Object?M:g}function bs(c,l,h,g){for(var M=pn(c),P=c.length,q="",j="",Z=0;Z<P-2;++Z)q+=(Z!==0?", ":"")+"arg"+Z,j+=(Z!==0?", ":"")+"arg"+Z+"Wired";var re=`
        return function (${q}) {
        if (arguments.length !== ${P-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${P-2}');
        }`;M&&(re+=`var destructors = [];
`);var ue=M?"destructors":"null",Ae=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];l&&(re+="var thisWired = classParam['toWireType']("+ue+`, this);
`);for(var Z=0;Z<P-2;++Z)re+="var arg"+Z+"Wired = argType"+Z+"['toWireType']("+ue+", arg"+Z+`);
`,Ae.push("argType"+Z);if(l&&(j="thisWired"+(j.length>0?", ":"")+j),re+=(h||g?"var rv = ":"")+"invoker(fn"+(j.length>0?", ":"")+j+`);
`,M)re+=`runDestructors(destructors);
`;else for(var Z=l?1:2;Z<c.length;++Z){var Ge=Z===1?"thisWired":"arg"+(Z-2)+"Wired";c[Z].destructorFunction!==null&&(re+=`${Ge}_dtor(${Ge});
`,Ae.push(`${Ge}_dtor`))}return h&&(re+=`var ret = retType['fromWireType'](rv);
return ret;
`),re+=`}
`,[Ae,re]}function _s(c,l,h,g,M,P){var q=l.length;q<2&&Ue("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var j=l[1]!==null&&h!==null,Z=pn(l),re=l[0].name!=="void",ue=[c,Ue,g,M,gr,l[0],l[1]],Ae=0;Ae<q-2;++Ae)ue.push(l[Ae+2]);if(!Z)for(var Ae=j?1:2;Ae<l.length;++Ae)l[Ae].destructorFunction!==null&&ue.push(l[Ae].destructorFunction);let[Ge,ht]=bs(l,j,re,P);Ge.push(ht);var at=Br(Function,Ge)(...ue);return J(c,at)}var Ha=function(c,l,h,g,M,P){c>>>=0,h>>>=0,g>>>=0,M>>>=0,P>>>=0;var q=dn(l,h);M=Te(g,M),hn([],[c],j=>{j=j[0];var Z=`constructor ${j.name}`;if(j.registeredClass.constructor_body===void 0&&(j.registeredClass.constructor_body=[]),j.registeredClass.constructor_body[l-1]!==void 0)throw new Kt(`Cannot register multiple constructors with identical number of parameters (${l-1}) for class '${j.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return j.registeredClass.constructor_body[l-1]=()=>{Nt(`Cannot construct ${j.name} due to unbound types`,q)},hn([],q,re=>(re.splice(1,0,null),j.registeredClass.constructor_body[l-1]=_s(Z,re,null,M,P),[])),[]})},Ti=c=>{c=c.trim();const l=c.indexOf("(");return l!==-1?c.substr(0,l):c},za=function(c,l,h,g,M,P,q,j,Z){c>>>=0,l>>>=0,g>>>=0,M>>>=0,P>>>=0,q>>>=0;var re=dn(h,g);l=ot(l),l=Ti(l),P=Te(M,P),hn([],[c],ue=>{ue=ue[0];var Ae=`${ue.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]),j&&ue.registeredClass.pureVirtualFunctions.push(l);function Ge(){Nt(`Cannot call ${Ae} due to unbound types`,re)}var ht=ue.registeredClass.instancePrototype,at=ht[l];return at===void 0||at.overloadTable===void 0&&at.className!==ue.name&&at.argCount===h-2?(Ge.argCount=h-2,Ge.className=ue.name,ht[l]=Ge):(he(ht,l,Ae),ht[l].overloadTable[h-2]=Ge),hn([],re,Jt=>{var Zt=_s(Ae,Jt,ue,P,q,Z);return ht[l].overloadTable===void 0?(Zt.argCount=h-2,ht[l]=Zt):ht[l].overloadTable[h-2]=Zt,[]}),[]})},Rs=[],gn=[];function Is(c){c>>>=0,c>9&&--gn[c+1]===0&&(gn[c]=void 0,Rs.push(c))}var Wa=()=>gn.length/2-5-Rs.length,Xa=()=>{gn.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=Wa},mt={toValue:c=>(c||Ue("Cannot use deleted val. handle = "+c),gn[c]),toHandle:c=>{switch(c){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const l=Rs.pop()||gn.length;return gn[l]=c,gn[l+1]=1,l}}}},Ka={name:"emscripten::val",fromWireType:c=>{var l=mt.toValue(c);return Is(c),l},toWireType:(c,l)=>mt.toHandle(l),argPackAdvance:Bt,readValueFromPointer:Hn,destructorFunction:null};function xi(c){return c>>>=0,jt(c,Ka)}var qa=(c,l,h)=>{switch(l){case 1:return h?function(g){return this.fromWireType(p[g>>>0])}:function(g){return this.fromWireType(R[g>>>0])};case 2:return h?function(g){return this.fromWireType(b[g>>>1>>>0])}:function(g){return this.fromWireType($[g>>>1>>>0])};case 4:return h?function(g){return this.fromWireType(Q[g>>>2>>>0])}:function(g){return this.fromWireType(ee[g>>>2>>>0])};default:throw new TypeError(`invalid integer width (${l}): ${c}`)}};function Ya(c,l,h,g){c>>>=0,l>>>=0,h>>>=0,l=ot(l);function M(){}M.values={},jt(c,{name:l,constructor:M,fromWireType:function(P){return this.constructor.values[P]},toWireType:(P,q)=>q.value,argPackAdvance:Bt,readValueFromPointer:qa(l,h,g),destructorFunction:null}),ge(l,M)}var Lr=(c,l)=>{var h=fn[c];return h===void 0&&Ue(`${l} has unknown type ${Dt(c)}`),h};function Ja(c,l,h){c>>>=0,l>>>=0;var g=Lr(c,"enum");l=ot(l);var M=g.constructor,P=Object.create(g.constructor.prototype,{value:{value:h},constructor:{value:J(`${g.name}_${l}`,function(){})}});M.values[h]=P,M[l]=P}var Ss=c=>{if(c===null)return"null";var l=typeof c;return l==="object"||l==="array"||l==="function"?c.toString():""+c},Za=(c,l)=>{switch(l){case 4:return function(h){return this.fromWireType(fe[h>>>2>>>0])};case 8:return function(h){return this.fromWireType(Ee[h>>>3>>>0])};default:throw new TypeError(`invalid float width (${l}): ${c}`)}},Qa=function(c,l,h){c>>>=0,l>>>=0,h>>>=0,l=ot(l),jt(c,{name:l,fromWireType:g=>g,toWireType:(g,M)=>M,argPackAdvance:Bt,readValueFromPointer:Za(l,h),destructorFunction:null})};function ec(c,l,h,g,M,P,q){c>>>=0,h>>>=0,g>>>=0,M>>>=0,P>>>=0;var j=dn(l,h);c=ot(c),c=Ti(c),M=Te(g,M),ge(c,function(){Nt(`Cannot call ${c} due to unbound types`,j)},l-1),hn([],j,Z=>{var re=[Z[0],null].concat(Z.slice(1));return ke(c,_s(c,re,null,M,P,q),l-1),[]})}var tc=(c,l,h)=>{switch(l){case 1:return h?g=>p[g>>>0]:g=>R[g>>>0];case 2:return h?g=>b[g>>>1>>>0]:g=>$[g>>>1>>>0];case 4:return h?g=>Q[g>>>2>>>0]:g=>ee[g>>>2>>>0];default:throw new TypeError(`invalid integer width (${l}): ${c}`)}};function nc(c,l,h,g,M){c>>>=0,l>>>=0,h>>>=0,l=ot(l);var P=ue=>ue;if(g===0){var q=32-8*h;P=ue=>ue<<q>>>q}var j=l.includes("unsigned"),Z=(ue,Ae)=>{},re;j?re=function(ue,Ae){return Z(Ae,this.name),Ae>>>0}:re=function(ue,Ae){return Z(Ae,this.name),Ae},jt(c,{name:l,fromWireType:P,toWireType:re,argPackAdvance:Bt,readValueFromPointer:tc(l,h,g!==0),destructorFunction:null})}function rc(c,l,h){c>>>=0,h>>>=0;var g=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],M=g[l];function P(q){var j=ee[q>>>2>>>0],Z=ee[q+4>>>2>>>0];return new M(p.buffer,Z,j)}h=ot(h),jt(c,{name:h,fromWireType:P,argPackAdvance:Bt,readValueFromPointer:P},{ignoreDuplicateRegistrations:!0})}function sc(c,l){c>>>=0,xi(c)}var ic=(c,l,h,g)=>{if(h>>>=0,!(g>0))return 0;for(var M=h,P=h+g-1,q=0;q<c.length;++q){var j=c.charCodeAt(q);if(j>=55296&&j<=57343){var Z=c.charCodeAt(++q);j=65536+((j&1023)<<10)|Z&1023}if(j<=127){if(h>=P)break;l[h++>>>0]=j}else if(j<=2047){if(h+1>=P)break;l[h++>>>0]=192|j>>6,l[h++>>>0]=128|j&63}else if(j<=65535){if(h+2>=P)break;l[h++>>>0]=224|j>>12,l[h++>>>0]=128|j>>6&63,l[h++>>>0]=128|j&63}else{if(h+3>=P)break;l[h++>>>0]=240|j>>18,l[h++>>>0]=128|j>>12&63,l[h++>>>0]=128|j>>6&63,l[h++>>>0]=128|j&63}}return l[h>>>0]=0,h-M},oc=(c,l,h)=>ic(c,R,l,h),ac=c=>{for(var l=0,h=0;h<c.length;++h){var g=c.charCodeAt(h);g<=127?l++:g<=2047?l+=2:g>=55296&&g<=57343?(l+=4,++h):l+=3}return l},vi=typeof TextDecoder<"u"?new TextDecoder:void 0,cc=(c,l,h)=>{l>>>=0;for(var g=l+h,M=l;c[M]&&!(M>=g);)++M;if(M-l>16&&c.buffer&&vi)return vi.decode(c.subarray(l,M));for(var P="";l<M;){var q=c[l++];if(!(q&128)){P+=String.fromCharCode(q);continue}var j=c[l++]&63;if((q&224)==192){P+=String.fromCharCode((q&31)<<6|j);continue}var Z=c[l++]&63;if((q&240)==224?q=(q&15)<<12|j<<6|Z:q=(q&7)<<18|j<<12|Z<<6|c[l++]&63,q<65536)P+=String.fromCharCode(q);else{var re=q-65536;P+=String.fromCharCode(55296|re>>10,56320|re&1023)}}return P},lc=(c,l)=>(c>>>=0,c?cc(R,c,l):"");function uc(c,l){c>>>=0,l>>>=0,l=ot(l);var h=l==="std::string";jt(c,{name:l,fromWireType(g){var M=ee[g>>>2>>>0],P=g+4,q;if(h)for(var j=P,Z=0;Z<=M;++Z){var re=P+Z;if(Z==M||R[re>>>0]==0){var ue=re-j,Ae=lc(j,ue);q===void 0?q=Ae:(q+="\0",q+=Ae),j=re+1}}else{for(var Ge=new Array(M),Z=0;Z<M;++Z)Ge[Z]=String.fromCharCode(R[P+Z>>>0]);q=Ge.join("")}return mn(g),q},toWireType(g,M){M instanceof ArrayBuffer&&(M=new Uint8Array(M));var P,q=typeof M=="string";q||M instanceof Uint8Array||M instanceof Uint8ClampedArray||M instanceof Int8Array||Ue("Cannot pass non-string to std::string"),h&&q?P=ac(M):P=M.length;var j=Cs(4+P+1),Z=j+4;if(ee[j>>>2>>>0]=P,h&&q)oc(M,Z,P+1);else if(q)for(var re=0;re<P;++re){var ue=M.charCodeAt(re);ue>255&&(mn(Z),Ue("String has UTF-16 code units that do not fit in 8 bits")),R[Z+re>>>0]=ue}else for(var re=0;re<P;++re)R[Z+re>>>0]=M[re];return g!==null&&g.push(mn,j),j},argPackAdvance:Bt,readValueFromPointer:Hn,destructorFunction(g){mn(g)}})}var Ei=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,fc=(c,l)=>{for(var h=c,g=h>>1,M=g+l/2;!(g>=M)&&$[g>>>0];)++g;if(h=g<<1,h-c>32&&Ei)return Ei.decode(R.subarray(c>>>0,h>>>0));for(var P="",q=0;!(q>=l/2);++q){var j=b[c+q*2>>>1>>>0];if(j==0)break;P+=String.fromCharCode(j)}return P},hc=(c,l,h)=>{if(h??=2147483647,h<2)return 0;h-=2;for(var g=l,M=h<c.length*2?h/2:c.length,P=0;P<M;++P){var q=c.charCodeAt(P);b[l>>>1>>>0]=q,l+=2}return b[l>>>1>>>0]=0,l-g},dc=c=>c.length*2,pc=(c,l)=>{for(var h=0,g="";!(h>=l/4);){var M=Q[c+h*4>>>2>>>0];if(M==0)break;if(++h,M>=65536){var P=M-65536;g+=String.fromCharCode(55296|P>>10,56320|P&1023)}else g+=String.fromCharCode(M)}return g},gc=(c,l,h)=>{if(l>>>=0,h??=2147483647,h<4)return 0;for(var g=l,M=g+h-4,P=0;P<c.length;++P){var q=c.charCodeAt(P);if(q>=55296&&q<=57343){var j=c.charCodeAt(++P);q=65536+((q&1023)<<10)|j&1023}if(Q[l>>>2>>>0]=q,l+=4,l+4>M)break}return Q[l>>>2>>>0]=0,l-g},mc=c=>{for(var l=0,h=0;h<c.length;++h){var g=c.charCodeAt(h);g>=55296&&g<=57343&&++h,l+=4}return l},yc=function(c,l,h){c>>>=0,l>>>=0,h>>>=0,h=ot(h);var g,M,P,q;l===2?(g=fc,M=hc,q=dc,P=j=>$[j>>>1>>>0]):l===4&&(g=pc,M=gc,q=mc,P=j=>ee[j>>>2>>>0]),jt(c,{name:h,fromWireType:j=>{for(var Z=ee[j>>>2>>>0],re,ue=j+4,Ae=0;Ae<=Z;++Ae){var Ge=j+4+Ae*l;if(Ae==Z||P(Ge)==0){var ht=Ge-ue,at=g(ue,ht);re===void 0?re=at:(re+="\0",re+=at),ue=Ge+l}}return mn(j),re},toWireType:(j,Z)=>{typeof Z!="string"&&Ue(`Cannot pass non-string to C++ string type ${h}`);var re=q(Z),ue=Cs(4+re+l);return ee[ue>>>2>>>0]=re/l,M(Z,ue+4,re+l),j!==null&&j.push(mn,ue),ue},argPackAdvance:Bt,readValueFromPointer:Hn,destructorFunction(j){mn(j)}})};function Tc(c,l,h,g,M,P){c>>>=0,l>>>=0,h>>>=0,g>>>=0,M>>>=0,P>>>=0,un[c]={name:ot(l),rawConstructor:Te(h,g),rawDestructor:Te(M,P),fields:[]}}function xc(c,l,h,g,M,P,q,j,Z,re){c>>>=0,l>>>=0,h>>>=0,g>>>=0,M>>>=0,P>>>=0,q>>>=0,j>>>=0,Z>>>=0,re>>>=0,un[c].fields.push({fieldName:ot(l),getterReturnType:h,getter:Te(g,M),getterContext:P,setterArgumentType:q,setter:Te(j,Z),setterContext:re})}var vc=function(c,l){c>>>=0,l>>>=0,l=ot(l),jt(c,{isVoid:!0,name:l,argPackAdvance:0,fromWireType:()=>{},toWireType:(h,g)=>{}})};function Ec(c,l,h){return c>>>=0,l>>>=0,h>>>=0,R.copyWithin(c>>>0,l>>>0,l+h>>>0)}var wi=(c,l,h)=>{var g=[],M=c.toWireType(g,h);return g.length&&(ee[l>>>2>>>0]=mt.toHandle(g)),M};function wc(c,l,h){return c>>>=0,l>>>=0,h>>>=0,c=mt.toValue(c),l=Lr(l,"emval::as"),wi(l,h,c)}var bc={},bi=c=>{var l=bc[c];return l===void 0?ot(c):l},As=[];function _c(c,l,h,g,M){return c>>>=0,l>>>=0,h>>>=0,g>>>=0,M>>>=0,c=As[c],l=mt.toValue(l),h=bi(h),c(l,l[h],g,M)}function Rc(c,l){return c>>>=0,l>>>=0,c=mt.toValue(c),l=mt.toValue(l),c==l}var Ic=c=>{var l=As.length;return As.push(c),l},Sc=(c,l)=>{for(var h=new Array(c),g=0;g<c;++g)h[g]=Lr(ee[l+g*4>>>2>>>0],"parameter "+g);return h};function Ac(c,l,h){l>>>=0;var g=Sc(c,l),M=g.shift();c--;var P=`return function (obj, func, destructorsRef, args) {
`,q=0,j=[];h===0&&j.push("obj");for(var Z=["retType"],re=[M],ue=0;ue<c;++ue)j.push("arg"+ue),Z.push("argType"+ue),re.push(g[ue]),P+=`  var arg${ue} = argType${ue}.readValueFromPointer(args${q?"+"+q:""});
`,q+=g[ue].argPackAdvance;var Ae=h===1?"new func":"func.call";P+=`  var rv = ${Ae}(${j.join(", ")});
`,M.isVoid||(Z.push("emval_returnValue"),re.push(wi),P+=`  return emval_returnValue(retType, destructorsRef, rv);
`),P+=`};
`,Z.push(P);var Ge=Br(Function,Z)(...re),ht=`methodCaller<(${g.map(at=>at.name).join(", ")}) => ${M.name}>`;return Ic(J(ht,Ge))}function Mc(c,l){return c>>>=0,l>>>=0,c=mt.toValue(c),l=mt.toValue(l),mt.toHandle(c[l])}function Nc(c){c>>>=0,c>9&&(gn[c+1]+=1)}function Cc(c){return c>>>=0,mt.toHandle(bi(c))}function Oc(){return mt.toHandle({})}function Dc(c){c>>>=0;var l=mt.toValue(c);gr(l),Is(c)}function Fc(c,l,h){c>>>=0,l>>>=0,h>>>=0,c=mt.toValue(c),l=mt.toValue(l),h=mt.toValue(h),c[l]=h}function Pc(c,l){c>>>=0,l>>>=0,c=Lr(c,"_emval_take_value");var h=c.readValueFromPointer(l);return mt.toHandle(h)}var Uc=()=>4294901760,kc=c=>{var l=F.buffer,h=(c-l.byteLength+65535)/65536;try{return F.grow(h),me(),1}catch{}};function jc(c){c>>>=0;var l=R.length,h=Uc();if(c>h)return!1;for(var g=(Z,re)=>Z+(re-Z%re)%re,M=1;M<=4;M*=2){var P=l*(1+.2/M);P=Math.min(P,c+100663296);var q=Math.min(h,g(Math.max(c,P),65536)),j=kc(q);if(j)return!0}return!1}var _i=(c,l)=>{c<128?l.push(c):l.push(c%128|128,c>>7)},Bc=c=>{for(var l={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},h={parameters:[],results:c[0]=="v"?[]:[l[c[0]]]},g=1;g<c.length;++g)h.parameters.push(l[c[g]]);return h},Lc=(c,l)=>{var h=c.slice(0,1),g=c.slice(1),M={i:127,p:127,j:126,f:125,d:124,e:111};l.push(96),_i(g.length,l);for(var P=0;P<g.length;++P)l.push(M[g[P]]);h=="v"?l.push(0):l.push(1,M[h])},$c=(c,l)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(Bc(l),c);var h=[1];Lc(l,h);var g=[0,97,115,109,1,0,0,0,1];_i(h.length,g),g.push(...h),g.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var M=new WebAssembly.Module(new Uint8Array(g)),P=new WebAssembly.Instance(M,{e:{f:c}}),q=P.exports.f;return q},Vc=(c,l)=>{if(zn)for(var h=c;h<c+l;h++){var g=dt(h);g&&zn.set(g,h)}},zn,Gc=c=>(zn||(zn=new WeakMap,Vc(0,Ne.length)),zn.get(c)||0),Ms=[],Hc=()=>{if(Ms.length)return Ms.pop();try{Ne.grow(1)}catch(c){throw c instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":c}return Ne.length-1},Ns=(c,l)=>Ne.set(c,l),mr=(c,l)=>{var h=Gc(c);if(h)return h;var g=Hc();try{Ns(g,c)}catch(P){if(!(P instanceof TypeError))throw P;var M=$c(c,l);Ns(g,M)}return zn.set(c,g),g},yr=c=>{zn.delete(dt(c)),Ns(c,null),Ms.push(c)};jr=n.InternalError=class extends Error{constructor(l){super(l),this.name="InternalError"}},Es(),Kt=n.BindingError=class extends Error{constructor(l){super(l),this.name="BindingError"}},D(),$e(),Ke(),Rt=n.UnboundTypeError=qt(Error,"UnboundTypeError"),Xa();var zc={i:ys,D:Ts,n:xs,C:vs,H:m,h:Ct,g:Ha,a:za,G:xi,t:Ya,e:Ja,x:Qa,c:ec,j:nc,f:rc,k:sc,w:uc,s:yc,o:Tc,l:xc,I:vc,F:Ec,v:wc,z:_c,b:Is,m:Rc,y:Ac,B:Mc,u:Nc,q:Cc,A:Oc,p:Dc,r:Fc,d:Pc,E:jc},Yt=kr(),Ri=c=>(Ri=Yt.L)(c),Cs=c=>(Cs=Yt.N)(c),mn=c=>(mn=Yt.O)(c),Ii=c=>(Ii=Yt.P)(c);function Wc(c){c=Object.assign({},c);var l=g=>M=>g(M)>>>0,h=g=>()=>g()>>>0;return c.L=l(c.L),c.N=l(c.N),c._emscripten_stack_alloc=l(c._emscripten_stack_alloc),c.emscripten_stack_get_current=h(c.emscripten_stack_get_current),c}n.addFunction=mr,n.removeFunction=yr;var $r;De=function c(){$r||Si(),$r||(De=c)};function Si(){if(A>0||(We(),A>0))return;function c(){$r||($r=!0,n.calledRun=!0,!B&&(kt(),s(n),n.onRuntimeInitialized?.(),lt()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),c()},1)):c()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Si(),t=o,t})})();let $s=null,Qr=null;function zh(r){Qr=r}async function Wh(){let r=null;if(us())r=await ho();else{if(typeof Qr!="string"||!Qr)throw new Error("No URL given for 'manifold.wasm'.");r=await ho({locateFile:()=>Qr})}return r.setup(),r}async function Xh(){return $s||($s=await Wh()),$s}let po;const Kh=Object.getPrototypeOf(async function(){}).constructor;function es(...r){typeof self<"u"&&self.console&&self.console.log(...r)}function qh(){dh(),$a()}async function Yh(r,e={}){const t=performance.now(),{doNotBundle:n,...s}=e,i=n===!0?r:await Jl(r,s),o=performance.now();n!==!0&&es(`Bundling code took ${((o-t)/1e3).toFixed(2)} seconds`);const a=await import("./manifoldCAD-q5OqbiZz.js");a.resetToCircularDefaults(),qh();const u={...a,isManifoldCAD:()=>!0},f={...u,GLTFNode:Va,getGLTFNodes:ni,resetGLTFNodes:mi},y={},E={globalDefaults:y,_manifold_cad_top_level:f,_manifold_cad_library:u,exports:{},module:{exports:{default:null}}};let d=null;try{await new Kh(...Object.keys(E),i)(...Object.values(E)),d=E.module?.exports?.default,typeof d=="function"&&(d=await d())}catch(x){const U=Hl(i,x,-2);let _=null;const C=Object.keys(f).find(F=>x.message.match(F));throw x.name==="ReferenceError"&&C?_=new Kr(x,x.message+`.  Import it by adding \`import {${C}} from 'manifold-3d/manifoldCAD';\` to the top of your model.`):x.name==="ReferenceError"&&x.message.match(/glMatrix/)?_=new Kr(x,"ManifoldCAD no longer includes gl-matrix directly.  Import it by adding `import * as glMatrix from 'gl-matrix';` to the top of your model."):_=new Kr(x),_.manifoldStack=U,_}const T=performance.now();if(es(`Manifold took ${((T-o)/1e3).toFixed(2)} seconds`),!d||Array.isArray(d)&&!d.length)throw ni().length?new Error("GLTF Nodes were created, but not exported.  Add `const nodes = getGLTFNodes();` and `export default nodes;` to the end of your model."):new Error("No output as no model was exported.  Add a default export (e.g.: `export default result;`) to the bottom of your model.  The default export must be a `Manifold` or `GLTFNode` object, an array of `Manifold` or `GLTFNode` objects, or a function that returns any of the above.");const N=await cs(d),V=yi(N,y),W=performance.now();return es(`Creating GLTF Document took ${((W-T)/1e3).toFixed(2)} seconds`),V}const Jh=async(r,e)=>{const t=performance.now();po=[new vu,new ch];const n=await po.find(o=>o.extensions.includes(e)).asBlob(r),s=URL.createObjectURL(n),i=performance.now();return es(`Exporting ${e.toUpperCase()} took ${(Math.round((i-t)/10)/100).toLocaleString()} seconds`),s},Zh=()=>{const r=()=>{if(console.debug("Intercepting console.log() in manifoldCAD worker."),self.console){const o=self.console.log;self.console.log=function(...a){let u="";for(const f of a)f==null?u+="undefined":typeof f=="object"?u+=JSON.stringify(f,null,4):u+=f.toString();self.postMessage({type:"log",message:u}),o(...a)}}},e=o=>{o.stack&&(o instanceof yo||o instanceof Kr)?console.error(o.stack):console.error(o),self.postMessage({type:"error",name:o.name,message:o.message,stack:o.stack})},t=async o=>{try{console.debug("Initializing ManifoldCAD worker."),o.manifoldWasmUrl&&zh(o.manifoldWasmUrl),o.esbuildWasmUrl&&zl(o.esbuildWasmUrl),Wl(o.esbuildHasOwnWorker===!0),await Xh(),r(),self.postMessage({type:"ready"}),console.debug("Successfully initialized ManifoldCAD worker!")}catch(a){e(a)}};let n=null;const s=async o=>{try{const{code:a,...u}=o;n=await Yh(o.code,u),self.postMessage({type:"done"})}catch(a){e(a)}},i=async o=>{try{self.postMessage({type:"blob",extension:o.extension,blobURL:await Jh(n,o.extension)})}catch(a){e(a)}};self.onmessage=async o=>{const a=o.data;a.type==="initialize"?t(a):a.type==="evaluate"?s(a):a.type==="export"&&i(a)}};Gl()&&Zh();var ls=Object.freeze({__proto__:null});export{ph as a,Xh as b,Sh as c,Ph as d,ed as g,Uh as o,td as s};
