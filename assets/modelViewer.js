import"./preload-helper.js";import{s as I,i as D,D as L,k as O,l as U,r as k,m as v,j as B,w as E,p as S}from"./gltf-io.js";import{M as j}from"./manifold.js";import"./_commonjsHelpers.js";const w=I(new D),e=new L,M=await j();M.setup();const{Manifold:i,Mesh:A}=M,f=new Map;async function b(o){const r=Array(),c=await w.read(o);await c.transform(O());const d=c.getRoot().listNodes(),h=Array();for(const t of d){U(t);const a=t.getMesh();if(a==null)continue;const s=k(a);if(s==null)continue;const m=s.runProperties.length,u=i.reserveIDs(m);s.mesh.runOriginalID=new Uint32Array(m);for(let n=0;n<m;++n)s.mesh.runOriginalID[n]=u+n,h.push(u+n),f.set(u+n,s.runProperties[n]);r.push(new i(new A(s.mesh)))}const y=e.getRoot().listMaterials().length;v(e,c),e.getRoot().listScenes().forEach(t=>t.dispose()),e.getRoot().listBuffers().forEach(t=>t.dispose()),e.getRoot().listAccessors().forEach(t=>t.dispose());for(const[t,a]of h.entries()){const s=e.getRoot().listMaterials()[y+t];f.get(a).material=s}return i.union(r)}const q=await b("/models/space.glb"),N=await b("/models/moon.glb"),p=e.createNode();e.createScene().addChild(p);function R(o){C(i[o](q,N))}R("difference");const g=document.querySelector("select");g.onchange=function(){R(g.value)};let l="";const P=document.querySelector("#download");P.onclick=function(){const o=document.createElement("a");o.download="manifold.glb",o.href=l,o.click()};const x=document.querySelector("model-viewer");async function C(o){B(p.getMesh());const r=E(e,o.getMesh(),f);p.setMesh(r),await e.transform(S());const c=await w.writeBinary(e),d=new Blob([c],{type:"application/octet-stream"});URL.revokeObjectURL(l),l=URL.createObjectURL(d),x.src=l}
