// Copyright 2023 The Manifold Authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// Note that this file is shared between the standard polygon test and fuzzer
// seed.

/**
 * These polygons are all valid geometry. Some are clearly valid, while many are
 * marginal, but all should produce correct topology and geometry, within
 * tolerance.
 */
TEST(Polygon, SimpleHole) {
  Polygons polys;
  polys.push_back({
      {0, -2},  //
      {2, 2},   //
      {0, 4},   //
      {-3, 3},  //
  });
  polys.push_back({
      {0, -1},  //
      {-1, 1},  //
      {1, 1},   //
  });
  TestPoly(polys, 7);
}

TEST(Polygon, SimpleHole2) {
  Polygons polys;
  polys.push_back({
      {0, 1.63299},           //
      {-1.41421, -0.816496},  //
      {1.41421, -0.816496},   //
  });
  polys.push_back({
      {0, 1.02062},           //
      {0.883883, -0.51031},   //
      {-0.883883, -0.51031},  //
  });
  TestPoly(polys, 6);
}

TEST(Polygon, MultiMerge) {
  Polygons polys;
  polys.push_back({
      {-7, 0},   //
      {-6, 3},   //
      {-5, 1},   //
      {-4, 6},   //
      {-3, 2},   //
      {-2, 5},   //
      {-1, 4},   //
      {0, 12},   //
      {-6, 10},  //
      {-8, 11},  //
  });
  polys.push_back({
      {-5, 7},  //
      {-6, 8},  //
      {-5, 9},  //
  });
  TestPoly(polys, 13);
}

TEST(Polygon, SimpleHoles) {
  Polygons polys;
  polys.push_back({
      {-0.277777791, 0.376543224},  //
      {0.5, -0.233333275},          //
      {0.285185158, 0.214814827},   //
  });
  polys.push_back({
      {0.325617313, -0.055555556},  //
      {0.277777791, 0.092592679},   //
      {0.328042328, 0.0608465709},  //
  });
  polys.push_back({
      {0.212963, 0.092592597},     //
      {0.203703716, 0.141975299},  //
      {0.212962985, 0.138888896},  //
  });
  TestPoly(polys, 11);
}

TEST(Polygon, SimpleHoles2) {
  Polygons polys;
  polys.push_back({
      {-0.0185185187, 0.5},         //
      {-0.5, 0.49253732},           //
      {0.166666672, 0.0370370671},  //
      {0.0617283992, 0.438271612},  //
  });
  polys.push_back({
      {-0.179012358, 0.448559672},  //
      {-0.179012358, 0.438271612},  //
      {-0.188271582, 0.438271612},  //
  });
  polys.push_back({
      {-0.413580239, 0.45679009},   //
      {-0.401234567, 0.448559672},  //
      {-0.401234567, 0.438271612},  //
  });
  polys.push_back({
      {0.0308641978, 0.450617284},  //
      {0.0432098769, 0.450617284},  //
      {0.0493827164, 0.438271612},  //
  });
  TestPoly(polys, 17);
}

TEST(Polygon, Looping1) {
  Polygons polys;
  polys.push_back({
      {0.f, -2.f},  //
      {2.f, 2.f},   //
      {0.f, 4.f},   //
      {-3.f, 3.f},  //
  });
  polys.push_back({
      {1.40282347e+38f, 1.40282347e+38f},  //
      {-0.f, 0.f},                         //
      {0.f, 1.f},                          //
      {1.f, 0.f},                          //
  });
  polys.push_back({
      {0.f, -1.f},  //
      {-1.f, 1.f},  //
      {1.f, 1.f},   //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Looping2) {
  Polygons polys;
  polys.push_back({
      {-0.277777791f, 0.376543224f},  //
      {0.5f, -0.233333275f},          //
      {0.285185158f, 0.214814827f},   //
  });
  polys.push_back({
      {0.325617313f, -0.055555556f},  //
      {0.277777791f, 0.092592679f},   //
      {0.328042328f, 0.0608465709f},  //
  });
  polys.push_back({
      {3.40282347e+38f, 0.283553332f},  //
      {0.212963f, 0.092592597f},        //
      {0.203703716f, 0.141975299f},     //
      {0.212962985f, 0.138888896f},     //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, AlignedHoles) {
  Polygons polys;
  polys.push_back({
      {-0.391621143, 0.5},         //
      {0.5, -0.305555522},         //
      {0.5, -0.0629629567},        //
      {0.214285731, 0.285714298},  //
  });
  polys.push_back({
      {-0.174897119, 0.403292179},  //
      {-0.179012358, 0.395061731},  //
      {-0.19135803, 0.407407403},   //
  });
  polys.push_back({
      {0.325617313, -0.055555556},  //
      {0.277777791, -0.055555556},  //
      {0.314176232, 0.0747126788},  //
  });
  polys.push_back({
      {0.339506179, -0.0740740374},  //
      {0.339506179, -0.0833333284},  //
      {0.327160507, -0.0802469105},  //
  });
  polys.push_back({
      {0.364197522, -0.129629627},   //
      {0.314814836, -0.0802469477},  //
      {0.351851851, -0.092592597},   //
  });
  polys.push_back({
      {0.302469134, -0.0679012388},  //
      {0.30864194, -0.0802469105},   //
      {0.302469134, -0.0833332911},  //
  });
  TestPoly(polys, 27);
}

TEST(Polygon, Outers) {
  Polygons polys;
  polys.push_back({
      {-4.95815706, 4.55738497},  //
      {-4.85924578, 4.65629625},  //
      {-4.85924578, 4.65629625},  //
      {-4.91438103, 4.64493704},  //
      {-4.91438103, 4.64493704},  //
      {-4.95815706, 4.65629625},  //
      {-4.95815706, 4.65629625},  //
      {-4.95815706, 4.65629625},  //
  });
  polys.push_back({
      {-4.95815706, 4.95815706},  //
      {-4.95815706, 4.85725117},  //
      {-4.95815706, 4.85725117},  //
      {-4.95815706, 4.85725117},  //
      {-4.95815706, 4.95815706},  //
      {-4.90248775, 4.9224453},   //
      {-4.87105799, 4.95158386},  //
      {-4.87105799, 4.95158386},  //
      {-4.85925102, 4.95815706},  //
  });
  polys.push_back({
      {-4.55738497, 4.95815706},  //
      {-4.65629101, 4.95815706},  //
      {-4.65105772, 4.95158339},  //
      {-4.64647388, 4.89330769},  //
      {-4.64647388, 4.89330769},  //
      {-4.65829086, 4.85725117},  //
      {-4.65829086, 4.85725117},  //
  });
  TestPoly(polys, 18);
}

TEST(Polygon, Holes) {
  Polygons polys;
  polys.push_back({
      {0.462962955, -0.5},          //
      {0.462962955, 0.129629627},   //
      {0.432784647, -0.314814836},  //
      {0.462962955, -0.316186577},  //
      {0.461591214, -0.351851851},  //
      {0.431412905, -0.351851851},  //
      {0.428669423, -0.42592594},   //
      {0.462962955, -0.427297682},  //
      {0.42592594, -0.5},           //
  });
  polys.push_back({
      {0.438271612, -0.413122982},  //
      {0.438728869, -0.401234567},  //
      {0.450617284, -0.401691824},  //
  });
  polys.push_back({
      {0.438271612, -0.302011877},  //
      {0.438728869, -0.290123463},  //
      {0.450617284, -0.29058072},   //
  });
  TestPoly(polys, 17);
}

TEST(Polygon, Holes2) {
  Polygons polys;
  polys.push_back({
      {31.5, -40.5},        //
      {31.5, 24.5602417},   //
      {29.4397583, 22.5},   //
      {28.5, 7.5},          //
      {24.5602417, -22.5},  //
      {31.5, -31.5},        //
      {23.5843372, -31.5},  //
  });
  polys.push_back({
      {30.5, -6.27108431},  //
      {29.5, -5.72891569},  //
      {30.2710838, -5.5},   //
  });
  polys.push_back({
      {30.5, 18.5},  //
      {29.5, 17.5},  //
      {29.5, 18.5},  //
  });
  polys.push_back({
      {30.5, 20.7289162},  //
      {29.5, 21.2710838},  //
      {30.2710838, 21.5},  //
  });
  TestPoly(polys, 20);
};

TEST(Polygon, Holes3) {
  Polygons polys;
  polys.push_back({
      {0.154320985, 0.438271612},   //
      {0.0802469105, 0.216049403},  //
      {0.0555555634, 0.166666672},  //
      {-0.166666672, -0.5},         //
      {0.166666672, -0.5},          //
  });
  polys.push_back({
      {0.141975313, -0.187242806},  //
      {0.146090537, -0.179012358},  //
      {0.154320985, -0.183127582},  //
  });
  polys.push_back({
      {-0.00617283955, -0.187242806},  //
      {-0.00205761334, -0.179012358},  //
      {0.00617283955, -0.183127582},   //
  });
  polys.push_back({
      {0.0679012388, 0.19135803},   //
      {0.0802469105, 0.19135803},   //
      {0.0802469105, 0.179012358},  //
  });
  polys.push_back({
      {0.104938269, 0.257201672},  //
      {0.104938269, 0.265432119},  //
      {0.117283955, 0.265432119},  //
  });
  TestPoly(polys, 23);
};

TEST(Polygon, Holes4) {
  Polygons polys;
  polys.push_back({
      {0.166666672, 0.5},           //
      {0.129629627, 0.314814836},   //
      {0.0802469105, 0.216049403},  //
      {0.0555555634, 0.166666672},  //
      {0.166666672, 0.0555555634},  //
      {-0.166666672, -0.5},         //
      {0.166666672, -0.5},          //
  });
  polys.push_back({
      {0.1090535, 0.19135803},     //
      {0.117283955, 0.187242806},  //
      {0.113168724, 0.179012358},  //
  });
  polys.push_back({
      {0.0679012388, 0.183127582},  //
      {0.0679012388, 0.19135803},   //
      {0.0802469105, 0.179012358},  //
  });
  polys.push_back({
      {0.104938269, 0.257201672},  //
      {0.104938269, 0.265432119},  //
      {0.117283955, 0.265432119},  //
  });
  TestPoly(polys, 20);
};

TEST(Polygon, SmallHole) {
  Polygons polys;
  polys.push_back({
      {8.93379593, -41.2573624},  //
      {10.5178413, -41.2440758},  //
      {8.99354267, -41.1997375},  //
  });
  polys.push_back({
      {9.08317471, -41.2453728},  //
      {9.08610725, -41.242527},   //
      {9.0890007, -41.2397537},   //
      {9.08943081, -41.2436409},  //
      {9.08946514, -41.2439499},  //
      {9.08924961, -41.2441826},  //
      {9.0890007, -41.2444496},   //
  });
  TestPoly(polys, 10);
};

TEST(Polygon, Precision4) {
  Polygons polys;
  polys.push_back({
      {-7.57671118, -12.7964983},  //
      {-7.57698059, -12.796319},   //
      {-7.57698631, -12.7967968},  //
      {-7.63940859, -12.9102335},  //
      {-7.58357, -12.7919359},     //
      {-7.58663845, -12.7898951},  //
      {-7.63940859, -12.9102335},  //
  });
  TestPoly(polys, 5, 0.0004);
};

TEST(Polygon, CoincidentHole) {
  Polygons polys;
  polys.push_back({
      {9.82835007, -0.939956188},  //
      {10.1291866, -1.12029469},   //
      {10.1291866, -0.759618163},  //
  });
  polys.push_back({
      {9.82835007, -0.939956307},  //
      {10.053978, -0.80470264},    //
      {9.97876835, -1.0301255},    //
  });
  TestPoly(polys, 6);
};

TEST(Polygon, Holes5) {
  Polygons polys;
  polys.push_back({
      {-0.166666672, -0.166666672},  //
      {-0.462962955, 0.42592594},    //
      {-0.5, -0.5},                  //
  });
  polys.push_back({
      {-0.240740761, -0.129629627},  //
      {-0.203703716, -0.092592597},  //
      {-0.203703716, -0.092592597},  //
      {-0.203703716, -0.129629627},  //
  });
  polys.push_back({
      {-0.388888896, -0.055555556},  //
      {-0.277777791, 0.055555556},   //
      {-0.277777791, -0.055555556},  //
  });
  TestPoly(polys, 12);
};

TEST(Polygon, Holes6) {
  Polygons polys;
  polys.push_back({
      {0.388888896, 0.277777791},  //
      {0.277777791, 0.388888896},  //
      {0.388888896, 0.388888896},  //
  });
  polys.push_back({
      {0.055555556, 0.388888896},   //
      {-0.055555556, 0.277777791},  //
      {-0.055555556, 0.388888896},  //
  });
  polys.push_back({
      {-0.277777791, 0.388888896},  //
      {-0.388888896, 0.277777791},  //
      {-0.388888896, 0.388888896},  //
  });
  polys.push_back({
      {-0.5, -0.5},  //
      {0.5, -0.5},   //
      {0.5, 0.5},    //
      {-0.5, 0.5},   //
  });
  TestPoly(polys, 17);
};

TEST(Polygon, Holes7) {
  Polygons polys;
  polys.push_back({
      {0.203703731, -0.203703716},  //
      {-0.388888896, 0.277777791},  //
      {-0.5, -0.5},                 //
  });
  polys.push_back({
      {-0.129629627, -0.203703716},  //
      {-0.092592597, -0.203703716},  //
      {-0.092592597, -0.240740761},  //
  });
  polys.push_back({
      {-0.351851851, -0.203703716},  //
      {-0.314814836, -0.203703716},  //
      {-0.314814836, -0.240740761},  //
  });
  TestPoly(polys, 11);
};

TEST(Polygon, Holes8) {
  Polygons polys;
  polys.push_back({
      {-0.166666672, 0.166666672},  //
      {-0.42592594, 0.42592594},    //
      {-0.5, -0.5},                 //
  });
  polys.push_back({
      {-0.277777791, -0.055555556},  //
      {-0.388888896, 0.055555556},   //
      {-0.277777791, 0.055555556},   //
      {-0.277777791, -0.055555556},  //
  });
  polys.push_back({
      {-0.462962955, -0.129629627},  //
      {-0.42592594, -0.092592597},   //
      {-0.42592594, -0.129629627},   //
  });
  TestPoly(polys, 12);
};

TEST(Polygon, Holes9) {
  Polygons polys;
  polys.push_back({
      {-0.166666672, -0.166666672},  //
      {-0.166666672, 0.166666672},   //
      {-0.166666657, 0.166666672},   //
      {-0.462962955, 0.42592594},    //
      {-0.5, -0.5},                  //
  });
  polys.push_back({
      {-0.277777791, -0.055555556},  //
      {-0.277777791, -0.055555556},  //
      {-0.388888896, 0.055555556},   //
      {-0.277777791, 0.055555556},   //
  });
  polys.push_back({
      {-0.462962955, -0.129629627},  //
      {-0.42592594, -0.092592597},   //
      {-0.42592594, -0.092592597},   //
      {-0.42592594, -0.129629627},   //
  });
  TestPoly(polys, 15);
};

TEST(Polygon, Eberly) {
  Polygons polys;
  polys.push_back({
      {0, 0},    //
      {9, 0},    //
      {7, -1},   //
      {8, -1},   //
      {10, -5},  //
      {10, 3},   //
      {0, 3},    //
  });
  polys.push_back({
      {1, 1},  //
      {1, 2},  //
      {2, 1},  //
  });
  TestPoly(polys, 10);
};

TEST(Polygon, Ugly) {
  Polygons polys;
  polys.push_back({
      {2379.21118, 13009.6982},  //
      {2292.45776, 13566.7129},  //
      {2048.95142, 13894.6953},  //
      {2054.84497, 13878.9023},  //
      {2055.11914, 13878.9707},  //
      {2186.24487, 13527.4189},  //
      {2186.24487, 13527.4189},  //
      {2186.24487, 13527.4189},  //
      {2189.47729, 13552.7422},  //
      {2208.28711, 13577.457},   //
      {2208.28711, 13577.457},   //
      {2236.93433, 13589.4551},  //
      {2236.93433, 13589.4551},  //
      {2236.93433, 13589.4551},  //
      {2208.28711, 13577.457},   //
      {2292.45703, 13566.7129},  //
      {2208.28711, 13577.457},   //
      {2208.28711, 13577.457},   //
      {2189.47729, 13552.7422},  //
      {2189.47729, 13552.7422},  //
      {2189.47729, 13552.7422},  //
      {2222.25732, 13474.4775},  //
      {2222.25732, 13474.4775},  //
      {2222.25732, 13474.4775},  //
      {2222.25732, 13474.4775},  //
      {2222.25732, 13474.4775},  //
      {2189.47729, 13552.7422},  //
      {2186.24487, 13527.4189},  //
      {2186.61182, 13525.8066},  //
      {2222.38232, 13429.9521},  //
      {2222.38232, 13429.9521},  //
      {2222.38232, 13429.9521},  //
  });
  polys.push_back({
      {2379.03198, 13010.5518},  //
      {2378.89648, 13010.541},   //
      {2289.28784, 13251.1582},  //
      {2379.03027, 13010.5566},  //
  });
  TestPoly(polys, 36);
};

TEST(Polygon, Sponge4a) {
  Polygons polys;
  polys.push_back({
      {0.166666672, -0.0555555671},  //
      {0.216049403, -0.0720164701},  //
      {0.216049403, -0.0679012388},  //
      {0.220164627, -0.0679012388},  //
      {0.228395075, -0.0679012388},  //
      {0.228395075, -0.0720164627},  //
      {0.228395075, -0.076131694},   //
      {0.314814836, -0.104938284},   //
      {0.314814836, -0.092592597},   //
      {0.327160507, -0.092592597},   //
      {0.351851851, -0.092592597},   //
      {0.351851851, -0.104938276},   //
      {0.351851851, -0.117283955},   //
      {0.438271612, -0.146090537},   //
      {0.438271612, -0.141975313},   //
      {0.442386836, -0.141975313},   //
      {0.450617284, -0.141975313},   //
      {0.376543224, -0.104938284},   //
      {0.376543224, -0.1090535},     //
      {0.376543224, -0.117283955},   //
      {0.372428, -0.117283955},      //
      {0.364197552, -0.117283955},   //
      {0.364197552, -0.113168724},   //
      {0.364197552, -0.104938269},   //
      {0.368312776, -0.104938269},   //
      {0.376543194, -0.104938269},   //
      {0.302469134, -0.0679012388},  //
      {0.302469134, -0.0720164627},  //
      {0.302469134, -0.0802469105},  //
      {0.29835391, -0.0802469105},   //
      {0.290123463, -0.0802469105},  //
      {0.290123463, -0.0761316866},  //
      {0.290123463, -0.0679012388},  //
      {0.294238687, -0.0679012388},  //
      {0.302469134, -0.0679012388},  //
      {0.166666672, 0},              //
  });
  polys.push_back({
      {0.179012358, -0.0432098769},  //
      {0.179012358, -0.0390946493},  //
      {0.179012358, -0.0308641978},  //
      {0.183127582, -0.0308641978},  //
      {0.19135803, -0.0308641978},   //
      {0.19135803, -0.0349794254},   //
      {0.19135803, -0.0432098769},   //
      {0.187242806, -0.0432098769},  //
  });
  polys.push_back({
      {0.216049403, -0.0432098769},  //
      {0.216049403, -0.0390946493},  //
      {0.216049403, -0.0308641978},  //
      {0.220164627, -0.0308641978},  //
      {0.228395075, -0.0308641978},  //
      {0.228395075, -0.0349794254},  //
      {0.228395075, -0.0432098769},  //
      {0.224279851, -0.0432098769},  //
  });
  polys.push_back({
      {0.253086448, -0.0802469105},  //
      {0.253086448, -0.0761316866},  //
      {0.253086448, -0.0679012388},  //
      {0.257201672, -0.0679012388},  //
      {0.265432119, -0.0679012388},  //
      {0.265432119, -0.0720164627},  //
      {0.265432119, -0.0802469105},  //
      {0.261316895, -0.0802469105},  //
  });
  TestPoly(polys, 64);
};

TEST(Polygon, CoincidentHole2) {
  Polygons polys;
  polys.push_back({
      {-6.53556156, 12.4571409},  //
      {-6.72912979, 12.5610456},  //
      {-6.7918272, 12.5019674},   //
  });
  polys.push_back({
      {-6.72903824, 12.5008945},  //
      {-6.72912979, 12.5008078},  //
      {-6.72931194, 12.5008106},  //
      {-6.7918272, 12.5019674},   //
      {-6.72912979, 12.5610456},  //
      {-6.72894907, 12.501153},   //
      {-6.72894812, 12.5009804},  //
  });
  TestPoly(polys, 10, 0.0005);
};

TEST(Polygon, CoincidentHole3) {
  Polygons polys;
  polys.push_back({
      {9.76247501, -8.75089836},  //
      {9.78284931, -8.75129509},  //
      {9.78242302, -8.75128555},  //
      {9.76939392, -8.74437904},  //
      {9.76939392, -8.74437904},  //
  });
  polys.push_back({
      {9.76247501, -8.75089836},  //
      {9.76939392, -8.74437904},  //
      {9.77548981, -8.75115108},  //
      {9.77501488, -8.7511425},   //
  });
  TestPoly(polys, 9, 0.0002);
};

TEST(Polygon, CoincidentHole4) {
  Polygons polys;
  polys.push_back({
      {1.44564819, 9.71884632},  //
      {1.48651409, 9.71884632},  //
      {1.44735146, 9.76247501},  //
  });
  polys.push_back({
      {1.4456495, 9.71884632},   //
      {1.44564915, 9.71884632},  //
      {1.44564879, 9.71884632},  //
      {1.44564819, 9.71884632},  //
      {1.44586205, 9.72430038},  //
      {1.44992185, 9.72319221},  //
      {1.44936395, 9.71884632},  //
  });
  TestPoly(polys, 10, 0.0002);
};

TEST(Polygon, Colinear) {
  Polygons polys;
  polys.push_back({
      {-5.48368, -3.73905},   //
      {-4.9881, -4.51552},    //
      {-4.78988, -4.13186},   //
      {-4.82012, -4.13999},   //
      {-4.84314, -4.14617},   //
      {-4.85738, -4.13581},   //
      {-4.86772, -4.12831},   //
      {-4.87337, -4.12422},   //
      {-4.88097, -4.1187},    //
      {-4.89799, -4.10634},   //
      {-4.90219, -4.103290},  //
      {-4.90826, -4.098871},  //
      {-4.90846, -4.098732},  //
      {-4.91227, -4.095973},  //
      {-4.92199, -4.08894},   //
      {-5.0245, -4.014435},   //
      {-5.02494, -4.014126},  //
      {-5.02536, -4.013817},  //
      {-5.0316, -4.009278},   //
      {-5.03211, -4.008919},  //
      {-5.05197, -3.994480},  //
      {-5.14757, -3.925041},  //
      {-5.21287, -3.87762},   //
      {-5.29419, -3.818533},  //
      {-5.29907, -3.814994},  //
      {-5.36732, -3.765415},  //
  });
  TestPoly(polys, 24);
}

TEST(Polygon, Colinear4) {
  Polygons polys;
  polys.push_back({
      {-22.7753239, 8.03145695},  //
      {-22.8791199, 8.04628658},  //
      {-22.8791199, 8.0424366},   //
      {-22.8792648, 8.04237938},  //
      {-22.8794041, 8.04239368},  //
      {-22.9786491, 8.05282307},  //
      {-22.9923439, 8.06109047},  //
      {-22.995327, 8.06289101},   //
      {-23.0484314, 8.07047844},  //
      {-23.056942, 8.06713009},   //
      {-23.0641346, 8.06429958},  //
      {-23.0679455, 8.06355},     //
      {-23.0689487, 8.06335258},  //
      {-23.0691357, 8.06331635},  //
      {-23.0723953, 8.06429958},  //
      {-23.1114883, 8.0794878},   //
      {-24.4342442, 8.26848221},  //
      {-24.4342442, 8.2057848},   //
  });
  TestPoly(polys, 16, 0.0004);
}

TEST(Polygon, Merges) {
  Polygons polys;
  polys.push_back({
      {-3.22039, 10.2769},   //
      {-3.12437, 10.4147},   //
      {-3.99093, 10.1781},   //
      {-3.8154, 10.0716},    //
      {-3.78982, 10.0893},   //
      {-3.55033, 10.2558},   //
      {-3.50073, 10.2549},   //
      {-3.47018, 10.2572},   //
      {-3.42633, 10.2605},   //
      {-3.34311, 10.2604},   //
      {-3.32096, 10.26330},  //
  });
  TestPoly(polys, 9);
}

TEST(Polygon, ExtraTriangle) {
  Polygons polys;
  polys.push_back({
      {1.23141634, -0.493547261},  //
      {1.23142254, -0.493540883},  //
      {1.23088336, -0.457464248},  //
  });
  polys.push_back({
      {1.23146737, -0.493494928},   //
      {1.47253549, -0.24623163},    //
      {1.47253144, -0.246230021},   //
      {1.47166216, -0.246238187},   //
      {1.46963537, -0.24623026},    //
      {1.46811843, -0.246224999},   //
      {1.46594918, -0.246223733},   //
      {1.46594965, -0.2462321670},  //
      {1.46594965, -0.2462322411},  //
      {1.46594083, -0.2462237332},  //
      {1.46591508, -0.2462237183},  //
      {1.46594179, -0.2462314374},  //
      {1.46585774, -0.2462236885},  //
      {1.46577716, -0.2462236296},  //
      {1.46590662, -0.2462312137},  //
      {1.46550393, -0.2462234658},  //
      {1.46081161, -0.2462207389},  //
      {1.46407437, -0.2462289040},  //
      {1.45568836, -0.2462277561},  //
      {1.42199826, -0.2602537572},  //
      {1.40801644, -0.2462047343},  //
      {1.40688479, -0.246203084},   //
      {1.38571239, -0.2461840815},  //
      {1.30817795, -0.2461582426},  //
      {1.28997684, -0.3280568727},  //
      {1.30974603, -0.3150095348},  //
      {1.31756043, -0.3649175179},  //
  });
  TestPoly(polys, 26);
}

TEST(Polygon, SpongeThin) {
  Polygons polys;
  polys.push_back({
      {-0.5, -0.4753086571},          //
      {-0.487654328, -0.4754610662},  //
      {-0.487654328, -0.4753086573},  //
      {-0.487654328, -0.4753086574},  //
      {-0.487654328, -0.4753086575},  //
      {-0.475308657, -0.4753086576},  //
      {-0.475308657, -0.4756134757},  //
      {-0.462962985, -0.4757659148},  //
      {-0.462962985, -0.4753086579},  //
  });
  polys.push_back({
      {0.42592591, -0.4753086570},   //
      {0.351851851, -0.4753086571},  //
      {0.351851851, -0.4753086572},  //
      {0.351851851, -0.485825333},   //
      {0.364197552, -0.4859777694},  //
      {0.364197552, -0.4753086575},  //
      {0.364197552, -0.4753086576},  //
      {0.364197552, -0.4753086577},  //
      {0.376543224, -0.4753086578},  //
      {0.376543224, -0.4861301789},  //
      {0.401234567, -0.4864349960},  //
      {0.401234567, -0.4753086571},  //
      {0.401234567, -0.4753086572},  //
      {0.401234567, -0.4753086573},  //
      {0.413580239, -0.4753086574},  //
      {0.413580239, -0.4865874055},  //
      {0.42592591, -0.4867398446},   //
  });
  polys.push_back({
      {0.314814806, -0.4753086577},  //
      {0.240740761, -0.4753086578},  //
      {0.240740761, -0.4753086579},  //
      {0.240740761, -0.4844535890},  //
      {0.253086448, -0.4846060281},  //
      {0.253086448, -0.4753086572},  //
      {0.253086448, -0.4753086573},  //
      {0.253086448, -0.4753086574},  //
      {0.265432119, -0.4753086575},  //
      {0.265432119, -0.4847584376},  //
      {0.290123463, -0.4850632557},  //
      {0.290123463, -0.4753086578},  //
      {0.290123463, -0.4753086579},  //
      {0.290123463, -0.4753086570},  //
      {0.302469134, -0.4753086571},  //
      {0.302469134, -0.4852156642},  //
      {0.314814806, -0.4853681033},  //
      {0.314814806, -0.4753086574},  //
  });
  TestPoly(polys, 38);
}

TEST(Polygon, ColinearY) {
  Polygons polys;
  polys.push_back({
      {0, 0},   //
      {1, 1},   //
      {2, 1},   //
      {3, 1},   //
      {4, 1},   //
      {4, 2},   //
      {3, 2},   //
      {2, 2},   //
      {1, 2},   //
      {0, 3},   //
      {-1, 2},  //
      {-2, 2},  //
      {-3, 2},  //
      {-4, 2},  //
      {-4, 1},  //
      {-3, 1},  //
      {-2, 1},  //
      {-1, 1},  //
  });
  TestPoly(polys, 16);
}

TEST(Polygon, NearlyColinearY) {
  Polygons polys;
  polys.push_back({
      {3.5, 0},       //
      {3.0, 0.5},     //
      {3.0, 0.0144},  //
      {2.0, 0.4},     //
      {1.8, 0.1},     //
      {1.6, 0.0155},  //
      {1.5, 0.0147},  //
      {1.4, 0.0144},  //
      {1.0, 0.1},     //
      {0, 0},         //
  });
  TestPoly(polys, 8, 0.001);
}

TEST(Polygon, Concave) {
  Polygons polys;
  polys.push_back({
      {-0.707107008, -0.707107008},    //
      {1, 0},                          //
      {0.683013022, 0},                //
      {0.379409999, -0.232962996},     //
      {0.379409999, -0.232962996},     //
      {1.49012003e-08, -0.183013007},  //
      {1.49012003e-08, -0.183013007},  //
      {-0.140431002, 0},               //
      {-1, 0},                         //
  });
  TestPoly(polys, 7);
}

TEST(Polygon, Concave2) {
  Polygons polys;
  polys.push_back({
      {4, 0},   //
      {3, 2},   //
      {3, 3},   //
      {6, 5},   //
      {6, 14},  //
      {0, 13},  //
      {0, 12},  //
      {3, 11},  //
      {4, 10},  //
      {5, 8},   //
      {1, 7},   //
      {2, 1},   //
  });
  TestPoly(polys, 10);
}

TEST(Polygon, Sliver) {
  Polygons polys;
  polys.push_back({
      {2.82002997, 0},             //
      {2.82002997, 0},             //
      {2.06105995, 0},             //
      {2.05792999, 0.0680378973},  //
      {2.06410003, 0.206908002},   //
      {2.28446007, 1.04696},       //
      {2.35005999, 1.24989998},    //
      {-2.82002997, 15},           //
      {-2.82002997, 0},            //
  });
  TestPoly(polys, 7);
}

TEST(Polygon, Duplicate) {
  Polygons polys;
  polys.push_back({
      {-32.0774002, -10.4309998},   //
      {-31.7346992, -6.10348988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.61858988},   //
      {-31.8645992, -5.618589880},  //
      {-31.8645992, -5.618589881},  //
      {-31.8645992, -5.618589882},  //
      {-31.8645992, -5.618589883},  //
      {-31.8645992, -5.618589884},  //
      {-31.8645992, -5.618589885},  //
      {-31.8645992, -5.618589886},  //
      {-31.8645992, -5.618589887},  //
      {-31.8645992, -5.618589888},  //
      {-31.8645992, -5.618589889},  //
      {-31.8645992, -5.618589880},  //
      {-32.0774002, -3.18654991},   //
  });
  TestPoly(polys, 20);
}

TEST(Polygon, Duplicate2) {
  Polygons polys;
  polys.push_back({
      {0, 0},   //
      {0, -1},  //
      {1, 1},   //
      {-1, 0},  //
      {0, 0},   //

  });
  TestPoly(polys, 3);
}

TEST(Polygon, Folded) {
  Polygons polys;
  polys.push_back({
      {2.82002997, 0},              //
      {1.23706996, 4.20994997},     //
      {1.14140999, 4.09090996},     //
      {1.05895996, 3.94496012},     //
      {0.00757742021, 2.72726989},  //
      {-0.468091995, 1.94363999},   //
      {-1.06106997, 1.36363995},    //
      {-1.79214001, 0.346489996},   //
      {-2.27416992, 0},             //
      {-2.82002997, 0},             //
      {-2.82002997, 0},             //
  });
  TestPoly(polys, 9);
}

TEST(Polygon, NearlyLinear) {
  Polygons polys;
  polys.push_back({
      {2.82002997, -8.22814036e-05},    //
      {2.82002997, -8.22814036e-05},    //
      {2.31802011, -8.22814036e-05},    //
      {-0.164566994, -8.22813017e-05},  //
      {-0.85738802, -8.22814036e-05},   //
      {-1.01091003, -8.22814036e-05},   //
      {-1.01091003, -8.22814036e-05},   //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Sliver2) {
  Polygons polys;
  polys.push_back({
      {27.4996014, 8.68737034},    //
      {28.27701, 9.528873446},     //
      {27.6687469, 10.881158804},  //
      {27.5080414, 8.7968292242},  //
      {27.5594807, 8.7521896407},  //
      {27.4996014, 8.687370368},   //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Sliver3) {
  Polygons polys;
  polys.push_back({
      {0, -2.6516838169},               //
      {0, -0.792692184889},             //
      {0, -0.792692184330},             //
      {0, -1.04356134430},              //
      {-0.953957975, -0.768045247331},  //
      {-1.36363637, -0.757460594892},   //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Sliver4) {
  Polygons polys;
  polys.push_back({
      {-0.375669807, 8.90489388474},  //
      {0, 8.39722729459},             //
      {0, 8.9723053468},              //
      {0, 8.9723053469},              //
      {0, 8.96719646467},             //
      {0, 8.89326191466},             //
      {0, 8.78047276465},             //
      {-0.330551624, 8.8897438473},   //
  });
  TestPoly(polys, 6);
}

TEST(Polygon, Sliver5) {
  Polygons polys;
  polys.push_back({
      {-60, 0},               //
      {-50, 0},               //
      {-50, 0},               //
      {-60, 4.37113897e-07},  //
      {-60, 4.37113897e-07},  //
  });
  polys.push_back({
      {-60, 100},             //
      {-60, 4.37113897e-07},  //
      {-60, 4.37113897e-07},  //
      {-50, 0},               //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Sliver6) {
  Polygons polys;
  polys.push_back({
      {10, 0},               //
      {0, 10},               //
      {-10, 0},              //
      {-10, 0},              //
      {4.37113897e-07, 10},  //
      {10, 0},               //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Sliver7) {
  Polygons polys;
  polys.push_back({
      {50, -10},             //
      {60, 0},               //
      {50, 0},               //
      {60, 4.37113897e-07},  //
      {60, 4.37113897e-07},  //
      {60, 4.37113897e-07},  //
      {60, 4.37113897e-07},  //
      {50, 0},               //
  });
  TestPoly(polys, 6);
}

TEST(Polygon, Sliver8) {
  Polygons polys;
  polys.push_back({
      {27.9279995, 4.9749999},    //
      {31.0610008, 2.32299995},   //
      {31.0610008, 2.322999958},  //
      {27.9279995, 4.97499996},   //
      {27.9279995, 4.97499995},   //
      {31.0610008, 2.322999958},  //
      {30.4400005, 5.341000087},  //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Sliver9) {
  Polygons polys;
  polys.push_back({
      {1.49183154, -0.4795963766194},  //
      {1.71669781, -0.2464189836195},  //
      {1.70233643, -0.2464101176196},  //
      {1.47253978, -0.2462775866197},  //
      {1.47254002, -0.2462870037997},  //
      {1.4869014, -0.2462958697996},   //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Sliver10) {
  Polygons polys;
  polys.push_back({
      {-1.20783484, 9.82835007},  //
      {-1.12029445, 10.1291866},  //
      {-1.39725339, 10.0962286},  //
      {-1.20783472, 9.82835007},  //
      {-1.39725339, 10.0962286},  //
  });
  TestPoly(polys, 3, 0.000230642);
}

TEST(Polygon, Colinear2) {
  Polygons polys;
  polys.push_back({
      {11.7864399, -7.4572401176},    //
      {11.6818037, -7.309823044873},  //
      {11.6777582, -7.306262028498},  //
      {11.6789398, -7.305788044872},  //
      {11.3459997, -6.83671999889},   //
      {11.25597, -6.9267602888},      //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Colinear3) {
  Polygons polys;
  polys.push_back({
      {1, -0.600000024},    //
      {1, 0.600000024},     //
      {0, 0.600000024},     //
      {0.5, 0},             //
      {0.5, 0.5},           //
      {0.5, 0.5},           //
      {1, 0.5},             //
      {1, -0.5},            //
      {1, -0.5},            //
      {1, -0.5},            //
      {0.916666627, -0.5},  //
  });
  TestPoly(polys, 9);
}

TEST(Polygon, Envelope) {
  Polygons polys;
  polys.push_back({
      {-36.324749, 0.477457494},  //
      {-36.324749, 0.477457494},  //
      {-36.8497353, 1.03053689},  //
      {-32.5569077, 5},           //
      {-36.8497353, 1.03053689},  //
  });
  polys.push_back({
      {-32.5569077, 5},           //
      {-36.324749, 0.477457494},  //
      {-32.5569077, 5},           //
      {-32.5569077, 5},           //
      {-36.8497353, 1.03053689},  //
  });
  TestPoly(polys, 6);
}

TEST(Polygon, Split) {
  Polygons polys;
  polys.push_back({
      {-0.707106769, -0.707106769},     //
      {1, 0},                           //
      {0.683012664, 0},                 //
      {0.379409522, -0.2329629063},     //
      {0.379409522, -0.2329629062},     //
      {1.49011612e-08, -0.1830126641},  //
      {1.49011612e-08, -0.1830126640},  //
      {-0.14043057, 0},                 //
      {-1, 0},                          //
  });
  TestPoly(polys, 7);
}

TEST(Polygon, Duplicates) {
  Polygons polys;
  polys.push_back({
      {-15, -8.10255623648},         //
      {-15, -9.02439785650},         //
      {-13.636364, -9.4640789678},   //
      {-14.996314, -8.10623646916},  //
      {-15, -8.10639845},            //
      {-15, -8.10255623922},         //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Simple1) {
  Polygons polys;
  polys.push_back({
      {4.04059982, -4.01843977872},   //
      {3.95867562, -4.252639774604},  //
      {4.23459578, -4.301384938274},  //
      {4.235569, -4.301272878273},    //
      {4.23782539, -4.301418784602},  //
  });
  TestPoly(polys, 3);
}

TEST(Polygon, Simple2) {
  Polygons polys;
  polys.push_back({
      {-1, -1},      //
      {-0.5, -0.5},  //
      {-1, 0},       //
      {0, 1},        //
      {0.5, 0.50},   //
      {1, 1},        //
      {-1, 1},       //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Simple3) {
  Polygons polys;
  polys.push_back({
      {19.7193489, 6.154459959798},  //
      {20.2308197, 5.642990591187},  //
      {20.3464642, 5.654597767273},  //
      {20.3733711, 5.654040817274},  //
      {20.373394, 5.654040341188},   //
      {20.8738098, 6.154459959801},  //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Simple4) {
  Polygons polys;
  polys.push_back({
      {15, -12.713556387},          //
      {15, -10.684373988},          //
      {15, -10.684373992},          //
      {15, -11.004141813},          //
      {15, -11.455074309},          //
      {15, -11.455074311},          //
      {14.9958763, -11.454532608},  //
      {14.4307623, -11.380221412},  //
      {13.9298496, -11.276861280},  //
  });
  TestPoly(polys, 7);
}

TEST(Polygon, Simple5) {
  Polygons polys;
  polys.push_back({
      {-27.3845081, 0.37566974864},  //
      {-27.6389656, 0},              //
      {-27.1156006, 0},              //
      {-27.1156006, 0},              //
      {-27.1202412, 0},              //
      {-27.1875362, 0},              //
      {-27.290184, 0},               //
      {-27.3733444, 0.33045187663},  //
  });
  TestPoly(polys, 6);
}

TEST(Polygon, Simple6) {
  Polygons polys;
  polys.push_back({
      {-7.99813318, 12.88888265009},  //
      {-7.85714436, 12.91251955006},  //
      {-7.85714436, 12.98071965005},  //
      {-7.88929749, 12.95930395007},  //
      {-7.99812126, 12.88889125008},  //
  });
  TestPoly(polys, 3);
}

TEST(Polygon, TouchingHole) {
  Polygons polys;
  polys.push_back({
      {-2, -1},  //
      {2, -1},   //
      {2, 1},    //
      {-2, 1},   //
  });
  polys.push_back({
      {-1, -1},  //
      {-1, 1},   //
      {1, 1},    //
      {1, -1},   //
  });
  TestPoly(polys, 8);
}

TEST(Polygon, TouchingHole2) {
  Polygons polys;
  polys.push_back({
      {-0.314814836, -0.462962955},  //
      {-0.240740761, -0.462962955},  //
      {-0.314814836, -0.42592594},   //
  });
  polys.push_back({
      {-0.302469134, -0.450617284},  //
      {-0.302469134, -0.439186096},  //
      {-0.302469134, -0.438271612},  //
      {-0.291037947, -0.438271612},  //
      {-0.290123463, -0.438271612},  //
      {-0.290123463, -0.449702799},  //
      {-0.290123463, -0.450617284},  //
      {-0.30155465, -0.450617284},   //
  });
  TestPoly(polys, 11);
}

TEST(Polygon, Degenerate) {
  Polygons polys;
  polys.push_back({
      {1, -1},   //
      {1, 1},    //
      {1, 1},    //
      {1, -1},   //
      {1, -1},   //
      {-1, -1},  //
      {-1, -1},  //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Degenerate2) {
  Polygons polys;
  polys.push_back({
      {0.0740740597, -0.314814836829},  //
      {0.0925925896, -0.314814806828},  //
      {0.0925925896, -0.314814806826},  //
      {0.0740740597, -0.314814836830},  //
  });
  TestPoly(polys, 2);
}

TEST(Polygon, Degenerate3) {
  Polygons polys;
  polys.push_back({
      {-0.413580239, -0.2160494039696},  //
      {-0.42592591, -0.2160494039690},   //
      {-0.413580239, -0.2160494039694},  //
      {-0.401234567, -0.2160494039713},  //
      {-0.401234567, -0.2160494039715},  //
      {-0.401234567, -0.2160494039716},  //
      {-0.413580239, -0.2160494039697},  //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Degenerate4) {
  Polygons polys;
  polys.push_back({
      {0, 10},                        //
      {-0.0696326792, 9.9939079360},  //
      {4.37113897e-07, 10},           //
      {0.636729717, 9.9442930240},    //
  });
  TestPoly(polys, 2);
}

TEST(Polygon, Degenerate5) {
  Polygons polys;
  polys.push_back({
      {1, 0},  //
      {1, 1},  //
      {1, 1},  //
      {1, 1},  //
      {1, 1},  //
      {0, 1},  //
      {0, 1},  //
      {0, 1},  //
  });
  TestPoly(polys, 6);
}

TEST(Polygon, Degenerate6) {
  Polygons polys;
  polys.push_back({
      {4.37113897e-07, -4.37113897e-07},  //
      {4.37113897e-07, 0},                //
      {0, 0},                             //
      {-1.19421679e-06, 0},               //
      {-8.66025352, 0},                   //
      {-8.66025352, 1.3397469},           //
      {-10, -4.37113897e-07},             //
  });
  TestPoly(polys, 5);
}

TEST(Polygon, Tricky) {
  Polygons polys;
  polys.push_back({
      {1, 0},  //
      {2, 1},  //
      {3, 0},  //
      {3, 5},  //
      {2, 5},  //
      {3, 4},  //
      {3, 2},  //
      {3, 3},  //
      {0, 6},  //
  });
  TestPoly(polys, 7);
}

TEST(Polygon, Tricky2) {
  Polygons polys;
  polys.push_back({
      {1, 0},    //
      {3, 1},    //
      {3, 3.5},  //
      {3, 0},    //
      {3, 5},    //
      {2, 5},    //
      {3, 4},    //
      {3, 2},    //
      {3, 3},    //
      {0, 6},    //
  });
  TestPoly(polys, 8);
}

TEST(Polygon, Slit) {
  Polygons polys;
  polys.push_back({
      {27.7069321, 13.514409186},  //
      {28.664566, 10.810289467},   //
      {28.7565536, 10.818337466},  //
      {25.9535275, 19.445167570},  //
      {26.0820198, 18.928167365},  //
      {26.0820198, 18.928167364},  //
      {26.0820198, 18.928167366},  //
      {25.8192234, 18.844831567},  //
      {27.7069321, 13.514409185},  //
      {27.9789181, 13.211655684},  //
  });
  polys.push_back({
      {25.6960907, 20.237478391},  //
      {25.6563644, 20.359741292},  //
      {25.6467285, 20.361473193},  //
  });
  TestPoly(polys, 9);
}

TEST(Polygon, SharedEdge) {
  Polygons polys;
  polys.push_back({
      {0.265432119, 0.00617283491185},   //
      {0.277777791, -3.7252903e-09},     //
      {0.277777791, 0.01851851871184},   //
      {0.240740761, 0.01851851876345},   //
      {0.265432119, 0.006172839551186},  //
      {0.265432119, 0.006172839551187},  //
  });
  TestPoly(polys, 4);
}

TEST(Polygon, Precision) {
  Polygons polys;
  polys.push_back({
      {-0.98486793, -0.492948532},   //
      {-0.984859049, -0.492013603},  //
      {-0.984966695, -0.489926398},  //
      {-0.984955609, -0.490281343},  //
      {-0.985008538, -0.489676297},  //
      {-0.98491329, -0.491925418},   //
      {-0.984878719, -0.492937535},  //
  });
  TestPoly(polys, 5, 0.0001);
};

TEST(Polygon, Precision2) {
  Polygons polys;
  polys.push_back({
      {4.98093176, -0.2479388121113},   //
      {4.94630527, -0.08263990282736},  //
      {4.98092985, -0.2479388122735},   //
  });
  polys.push_back({
      {4.76215458, -0.2478484367566},  //
      {4.76215267, -0.2478604172640},  //
      {4.76215553, -0.2478604172639},  //
  });
  polys.push_back({
      {4.95041943, -0.2417418967815},  //
      {4.85906506, -0.2231211817816},  //
      {4.90268326, -0.1528855567824},  //
      {4.82208872, -0.185909457823},   //
      {4.79133606, -0.2478708772638},  //
      {4.98092985, -0.2479388122733},  //
      {4.90268326, -0.1528855567822},  //
      {4.95041943, -0.2417418967819},  //
  });
  TestPoly(polys, 8);
};

TEST(Polygon, Precision3) {
  Polygons polys;
  polys.push_back({
      {0.630340576, 1.6097908},   //
      {0.777489543, 1.58760202},  //
      {0.890084028, 1.60028839},  //
      {1.05917394, 1.65945554},   //
      {1.06027794, 1.65984178},   //
  });
  TestPoly(polys, 3, 0.00068);
};

TEST(Polygon, DegenerateRing) {
  Polygons polys;
  polys.push_back({
      {-9.82835007, -8.06539154},  //
      {-10.1291866, -7.88505363},  //
      {-10.1291866, -8.2457304},   //
  });
  polys.push_back({
      {-9.82835007, -8.06539154},  //
      {-9.82835007, -8.06539154},  //
      {-9.82835007, -8.06539154},  //
      {-10.1291866, -8.24572945},  //
      {-10.1291866, -7.88505363},  //
      {-9.82835007, -8.06539154},  //
  });
  TestPoly(polys, 9);
}

TEST(Polygon, Sweep) {
  Polygons polys;
  polys.push_back({
      {0, 0.637057483},          //
      {0, 0.637057483},          //
      {1.72745752, 4.72425699},  //
      {1.72745752, 4.72425699},  //
      {1.72745752, 4.72425699},  //
      {1.7274611, 4.72425747},   //
      {0, 0.637057483},          //
      {2.5, 4.82678747},         //
      {1.72745752, 4.72425747},  //
      {0, 0.637057483},          //
      {0, 0.637057483},          //
      {0, 0.637057483},          //
      {0, 0.637057483},          //
      {0, 0.637057483},          //
  });
  TestPoly(polys, 12);
}

TEST(Polygon, Hole) {
  Polygons polys;
  polys.push_back({
      {0.5, -0.5},    //
      {0.5, 0.5},     //
      {-0.5, 0.5},    //
      {-0.5, 0.5},    //
      {-0.5, 0.5},    //
      {-0, 0.5},      //
      {-0.25, 0.25},  //
      {0.25, -0.25},  //
      {0.5, 0},       //
      {0.5, 0},       //
      {0.5, -0.5},    //
      {0.5, -0.5},    //
      {0.5, -0.5},    //
  });
  polys.push_back({
      {0.5, 0},    //
      {-0, 0.5},   //
      {-0, 0.5},   //
      {0.5, 0.5},  //
      {0.5, 0.5},  //
      {0.5, 0.5},  //
  });
  TestPoly(polys, 19);
}

TEST(Polygon, Hole2) {
  Polygons polys;
  polys.push_back({
      {0, -21.8057232},             //
      {0.142438874, -21.3274956},   //
      {0.118176684, -21.1638756},   //
      {2.24720502, -20.7749138},    //
      {0.0947285369, -20.7749138},  //
      {0.0428545363, -19.7292175},  //
  });
  polys.push_back({
      {0.094730109, -20.7749138},  //
      {1.17382383, -20.7749138},   //
      {0.118176684, -21.1638756},  //
  });
  TestPoly(polys, 9);
}

TEST(Polygon, Hole3) {
  Polygons polys;
  polys.push_back({
      {9.42795753, 9.36543179},  //
      {9.41050148, 9.39931583},  //
      {9.39856625, 9.36543179},  //
  });
  polys.push_back({
      {9.3985672, 9.36543179},   //
      {9.39856625, 9.36543179},  //
      {9.39856625, 9.36543179},  //
      {9.39856625, 9.36543274},  //
      {9.41050148, 9.39931488},  //
      {9.41945648, 9.38193321},  //
      {9.41326141, 9.36543179},  //
  });
  TestPoly(polys, 10);
}

TEST(Polygon, Separate3) {
  Polygons polys;
  polys.push_back({
      {-3.46249032, 0},           //
      {-3.46249056, 4.95030928},  //
      {-3.93332648, 1.35438299},  //
  });
  polys.push_back({
      {-5.15814781, 4.8776412},   //
      {-5.11540651, 4.75469398},  //
      {-5.11540651, 4.87985134},  //
      {-5.11540651, 4.87985849},  //
  });
  polys.push_back({
      {-4.29695415, 4.92231846},  //
      {-4.47298813, 2.90674615},  //
      {-4.37842369, 2.634727},    //
      {-4.29695415, 4.92231846},  //
      {-4.29695415, 4.92231846},  //
      {-5.03241968, 4.88416386},  //
      {-5.03241968, 4.51597786},  //
      {-5.03241968, 4.51597786},  //
  });
  TestPoly(polys, 9);
}

TEST(Polygon, Small) {
  Polygons polys;
  polys.push_back({
      {-0.487163663, 0.00357927009},  //
      {-0.49125129, 0.244737789},     //
      {-0.491251856, 0.24427411},     //
      {-0.491260529, 0.245025411},    //
      {-0.49067378, 6.32605588e-05},  //
  });
  TestPoly(polys, 3, 0.0001);
};

TEST(Polygon, Comb) {
  Polygons polys;
  polys.push_back({
      {0.462962955, -0.4272976528},      //
      {0.5, -0.425925917},               //
      {-0.5, -0.42592591283},            //
      {-0.5, -0.462962955269},           //
      {-0.462962985, -0.461591214268},   //
      {-0.462962985, -0.42592591282},    //
      {-0.42592594, -0.42592591280},     //
      {-0.42592594, -0.460219473266},    //
      {-0.351851881, -0.45747599247},    //
      {-0.351851881, -0.42592591257},    //
      {-0.314814836, -0.42592591256},    //
      {-0.314814836, -0.456104249245},   //
      {-0.240740746, -0.453360766132},   //
      {-0.240740746, -0.42592591143},    //
      {-0.203703716, -0.42592591142},    //
      {-0.203703716, -0.451989025130},   //
      {-0.129629642, -0.449245542128},   //
      {-0.129629642, -0.42592591141},    //
      {-0.092592597, -0.42592591119},    //
      {-0.092592597, -0.447873801111},   //
      {-0.0185185187, -0.445130289109},  //
      {-0.0185185187, -0.42592591117},   //
      {0.0185185187, -0.4259259169},     //
      {0.0185185187, -0.44375854762},    //
      {0.0925925896, -0.44101506560},    //
      {0.0925925896, -0.4259259168},     //
      {0.129629627, -0.4259259152},      //
      {0.129629627, -0.43964332341},     //
      {0.203703731, -0.43689984150},     //
      {0.203703731, -0.4259259151},      //
      {0.240740761, -0.4259259149},      //
      {0.240740761, -0.435528148},       //
      {0.314814806, -0.4327846170},      //
      {0.314814806, -0.425925911},       //
      {0.351851851, -0.425925919},       //
      {0.351851851, -0.4314128768},      //
      {0.42592591, -0.4286693931},       //
      {0.42592591, -0.425925912},        //
      {0.462962955, -0.425925919},       //
  });
  TestPoly(polys, 37);
}

TEST(Polygon, Comb2) {
  Polygons polys;
  polys.push_back({
      {-0.5, -0.462962955},             //
      {-0.462962955, -0.461591214},     //
      {-0.462962955, -0.425925913},     //
      {-0.42592591, -0.425925915},      //
      {-0.42592591, -0.460219473},      //
      {-0.351851851, -0.457475998},     //
      {-0.351851851, -0.425925915},     //
      {-0.314814806, -0.425925916},     //
      {-0.314814806, -0.4561042490},    //
      {-0.240740761, -0.45336076632},   //
      {-0.240740761, -0.4259259144},    //
      {-0.203703731, -0.4259259145},    //
      {-0.203703731, -0.45198902534},   //
      {-0.129629627, -0.44924554237},   //
      {-0.129629627, -0.4259259147},    //
      {-0.0925925896, -0.4259259164},   //
      {-0.0925925896, -0.44787380155},  //
      {-0.0185185187, -0.44513028958},  //
      {-0.0185185187, -0.4259259166},   //
      {0.0185185187, -0.42592591113},   //
      {0.0185185187, -0.443758547104},  //
      {0.092592597, -0.441015065107},   //
      {0.092592597, -0.42592591116},    //
      {0.129629642, -0.42592591134},    //
      {0.129629642, -0.439643323122},   //
      {0.203703716, -0.436899841137},   //
      {0.203703716, -0.42592591138},    //
      {0.240740746, -0.42592591140},    //
      {0.240740746, -0.4355281139},     //
      {0.314814836, -0.432784617251},   //
      {0.314814836, -0.42592591252},    //
      {0.351851881, -0.42592591254},    //
      {0.351851881, -0.431412876253},   //
      {0.42592594, -0.428669393272},    //
      {0.42592594, -0.42592591273},     //
      {0.462962985, -0.42592591278},    //
      {0.462962985, -0.427297652277},   //
      {0.5, -0.42592591279},            //
      {-0.5, -0.425925912},             //
  });
  TestPoly(polys, 37);
}

TEST(Polygon, PointPoly) {
  Polygons polys;
  polys.push_back({
      {0, -15.97809792},            //
      {5.08144999, -14.267872844},  //
      {4.83870935, -14.078962343},  //
      {4.38336992, -13.749200837},  //
      {4.35483837, -13.728474638},  //
      {4.33122683, -13.71277935},   //
      {3.87096763, -13.368933730},  //
      {3.52637458, -13.13335511},   //
      {3.38709664, -13.02511889},   //
      {3.10755324, -12.82632165},   //
      {2.90322566, -12.68068413},   //
      {2.80962205, -12.62084011},   //
      {2.41935468, -12.32800489},   //
      {2.16151524, -12.15446578},   //
      {1.93548381, -11.97346316},   //
      {1.56781006, -11.70936397},   //
      {1.45161283, -11.60849956},   //
      {1.02412188, -11.27564533},   //
      {0.967741907, -11.22161294},  //
      {0.628127813, -10.92966180},  //
      {0, -10.92966183},            //
  });
  polys.push_back({
      {15, -10.9296618052},  //
      {15, -10.9296618051},  //
      {15, -10.9296618053},  //
  });
  TestPoly(polys, 20);
};

TEST(Polygon, KissingZigzag) {
  Polygons polys;
  polys.push_back({
      {37.4667358, 0},              //
      {27.8904877, -3.04520559},    //
      {27.8904877, 3.04520559},     //
      {37.4667358, 0},              //
      {36.4568138, 8.64042377},     //
      {27.8409691, 3.46886754},     //
      {26.4364243, 9.39511108},     //
      {36.4568138, 8.64042377},     //
      {33.4814987, 16.8150406},     //
      {26.2905369, 9.79593277},     //
      {23.5571651, 15.23852350},    //
      {33.4814987, 16.81504061},    //
      {28.7011852, 24.08315282},    //
      {23.322773, 15.59489543},     //
      {19.4079323, 20.26042184},    //
      {28.7011852, 24.08315285},    //
      {22.3735847, 30.05293856},    //
      {19.0976753, 20.55313687},    //
      {14.2124147, 24.19007688},    //
      {22.3735847, 30.05293859},    //
      {14.8398142, 34.40256120},    //
      {13.8430138, 24.40335081},    //
      {8.2507, 26.81563952},        //
      {14.8398142, 34.40256123},    //
      {6.50603199, 36.89752964},    //
      {7.84207535, 26.9379735},     //
      {1.84419155, 27.99556356},    //
      {6.50603199, 36.89752967},    //
      {-2.1784966, 37.40335088},    //
      {1.41836619, 28.02036489},    //
      {-4.66174126, 27.66623880},   //
      {-2.1784966, 37.40335081},    //
      {-10.7455816, 35.89273832},   //
      {-5.08180761, 27.59216883},   //
      {-10.916357, 25.84541894},    //
      {-10.7455816, 35.89273835},   //
      {-18.7333698, 32.44714366},   //
      {-11.3080206, 25.67647177},   //
      {-16.5824718, 22.63126758},   //
      {-18.7333698, 32.44714369},   //
      {-25.711235, 27.25231360},    //
      {-16.924614, 22.37655071},    //
      {-21.3546181, 18.19705772},   //
      {-25.711235, 27.25231363},    //
      {-31.3030052, 20.58830454},   //
      {-21.6287994, 17.87030415},   //
      {-24.9755325, 12.78183846},   //
      {-31.3030052, 20.58830457},   //
      {-35.2072144, 12.81438068},   //
      {-25.1669636, 12.40066729},   //
      {-27.2500057, 6.677553180},   //
      {-35.2072144, 12.81438061},   //
      {-37.213398, 4.349624632},    //
      {-27.3483734, 6.262504583},   //
      {-28.0554276, 0.2132747174},  //
      {-37.213398, 4.349624635},    //
      {-37.213398, -4.349621776},   //
      {-28.0554276, -0.213272817},  //
      {-27.3483734, -6.262502678},  //
      {-37.213398, -4.349621779},   //
      {-35.2072144, -12.81437870},  //
      {-27.2500057, -6.677552221},  //
      {-25.1669636, -12.40066622},  //
      {-35.2072144, -12.81437873},  //
      {-31.3029995, -20.58831024},  //
      {-24.9755306, -12.78184325},  //
      {-21.6287937, -17.87030796},  //
      {-31.3029995, -20.58831027},  //
      {-25.7112312, -27.25231938},  //
      {-21.3546143, -18.19706159},  //
      {-16.9246101, -22.37655450},  //
      {-25.7112312, -27.25231931},  //
      {-18.7333641, -32.44714742},  //
      {-16.5824661, -22.63126953},  //
      {-11.3080158, -25.67647364},  //
      {-18.7333641, -32.44714745},  //
      {-10.7455835, -35.89273836},  //
      {-10.9163589, -25.84541897},  //
      {-5.08180904, -27.59216888},  //
      {-10.7455835, -35.89273839},  //
      {-2.17849016, -37.40335080},  //
      {-4.66173601, -27.66623881},  //
      {1.41837108, -28.02036482},   //
      {-2.17849016, -37.40335083},  //
      {6.50602913, -36.89752964},   //
      {1.84418964, -27.99556355},   //
      {7.84207344, -26.9379736},    //
      {6.50602913, -36.89752967},   //
      {14.8398247, -34.40255748},   //
      {8.25070763, -26.81563579},   //
      {13.8430195, -24.4033470},    //
      {14.8398247, -34.40255741},   //
      {22.3735847, -30.05293852},   //
      {14.2124147, -24.19007683},   //
      {19.0976753, -20.55313684},   //
      {22.3735847, -30.05293855},   //
      {28.7011795, -24.08315856},   //
      {19.4079285, -20.26042567},   //
      {23.3227692, -15.59490118},   //
      {28.7011795, -24.08315859},   //
      {33.4815025, -16.815036800},  //
      {23.5571671, -15.238520601},  //
      {26.2905388, -9.7959299102},  //
      {33.4815025, -16.815036803},  //
      {36.4568138, -8.6404275904},  //
      {26.4364243, -9.3951129905},  //
      {27.8409691, -3.4688699206},  //
      {36.4568138, -8.6404275907},  //
  });
  TestPoly(polys, 106);
}

TEST(Polygon, Sponge) {
  Polygons polys;
  polys.push_back({
      {-0.5, -0.5},                   //
      {-0.388888896, -0.3888888963},  //
      {-0.388888896, -0.3888888964},  //
      {-0.388888896, -0.2777777916},  //
      {-0.388888896, -0.2777777917},  //
      {-0.277777791, -0.2777777910},  //
      {-0.166666657, -0.1666666721},  //
      {-0.166666672, -0.1666666722},  //
      {-0.166666672, -0.1666666723},  //
      {-0.166666672, 0.1666666726},   //
      {-0.166666672, 0.1666666727},   //
      {0.166666657, 0.16666667242},   //
      {0.277777791, 0.27777779153},   //
      {0.277777791, 0.27777779154},   //
      {0.277777791, 0.27777779155},   //
      {0.277777791, 0.38888889656},   //
      {0.277777791, 0.38888889657},   //
      {0.388888896, 0.38888889661},   //
      {0.388888896, 0.38888889660},   //
      {0.5, 0.5},                     //
      {-0.5, 0.5},                    //
  });
  polys.push_back({
      {-0.388888896, -0.0555555563},  //
      {-0.388888896, -0.0555555564},  //
      {-0.388888896, 0.0555555563},   //
      {-0.388888896, 0.0555555564},   //
      {-0.277777791, 0.0555555566},   //
      {-0.277777791, 0.0555555565},   //
      {-0.277777791, -0.0555555565},  //
      {-0.277777791, -0.0555555566},  //
  });
  polys.push_back({
      {-0.277777791, 0.2777777912},  //
      {-0.277777791, 0.2777777913},  //
      {-0.388888896, 0.2777777917},  //
      {-0.388888896, 0.2777777918},  //
      {-0.388888896, 0.3888888960},  //
      {-0.388888896, 0.3888888961},  //
      {-0.277777791, 0.3888888964},  //
      {-0.277777791, 0.3888888965},  //
  });
  polys.push_back({
      {-0.055555556, 0.2777777918},  //
      {-0.055555556, 0.2777777919},  //
      {-0.055555556, 0.3888888960},  //
      {-0.055555556, 0.3888888961},  //
      {0.055555556, 0.38888889647},  //
      {0.055555556, 0.38888889648},  //
      {0.055555556, 0.27777779146},  //
      {0.055555556, 0.27777779145},  //
  });
  TestPoly(polys, 49);
}

TEST(Polygon, Sponge2) {
  Polygons polys;
  polys.push_back({
      {0.5, -0.5},                  //
      {0.5, 0.5},                   //
      {-0.5, 0.5},                  //
      {-0.388888896, 0.388888896},  //
      {-0.388888896, 0.388888896},  //
      {-0.277777791, 0.388888896},  //
      {-0.277777791, 0.388888896},  //
      {-0.277777791, 0.388888896},  //
      {-0.277777791, 0.277777791},  //
      {-0.277777791, 0.277777791},  //
      {-0.166666657, 0.166666672},  //
      {-0.166666657, 0.166666672},  //
      {0.166666672, 0.166666672},   //
      {0.166666672, 0.166666672},   //
      {0.166666672, 0.166666672},   //
      {0.166666672, 0.166666672},   //
      {0.166666672, 0.166666672},   //
      {0.166666672, -0.166666672},  //
      {0.166666672, -0.166666672},  //
      {0.166666672, -0.166666672},  //
      {0.166666672, -0.166666672},  //
      {0.166666657, -0.166666672},  //
      {0.277777791, -0.277777791},  //
      {0.388888896, -0.277777791},  //
      {0.388888896, -0.277777791},  //
      {0.388888896, -0.277777791},  //
      {0.388888896, -0.388888896},  //
  });
  polys.push_back({
      {0.388888896, -0.055555556},  //
      {0.277777791, -0.055555556},  //
      {0.277777791, -0.055555556},  //
      {0.277777791, -0.055555556},  //
      {0.277777791, 0.055555556},   //
      {0.388888896, 0.055555556},   //
      {0.388888896, 0.055555556},   //
      {0.388888896, 0.055555556},   //
  });
  polys.push_back({
      {0.388888896, 0.277777791},  //
      {0.277777791, 0.277777791},  //
      {0.277777791, 0.277777791},  //
      {0.277777791, 0.277777791},  //
      {0.277777791, 0.388888896},  //
      {0.388888896, 0.388888896},  //
      {0.388888896, 0.388888896},  //
      {0.388888896, 0.388888896},  //
  });
  polys.push_back({
      {0.055555556, 0.277777791},   //
      {0.055555556, 0.277777791},   //
      {-0.055555556, 0.277777791},  //
      {-0.055555556, 0.277777791},  //
      {-0.055555556, 0.388888896},  //
      {-0.055555556, 0.388888896},  //
      {0.055555556, 0.388888896},   //
      {0.055555556, 0.388888896},   //
  });
  TestPoly(polys, 55);
}

TEST(Polygon, SquareHoles) {
  Polygons polys;
  polys.push_back({
      {0.388888896, -0.2777777910},  //
      {0.388888896, -0.388888896},   //
      {0.277777791, -0.388888896},   //
      {0.277777791, -0.2777777911},  //
  });
  polys.push_back({
      {0.388888896, -0.0555555564},  //
      {0.277777791, -0.0555555562},  //
      {0.277777791, 0.0555555566},   //
      {0.388888896, 0.0555555565},   //
  });
  polys.push_back({
      {0.055555556, -0.2777777915},   //
      {0.055555556, -0.3888888963},   //
      {-0.055555556, -0.3888888963},  //
      {-0.055555556, -0.2777777914},  //
  });
  polys.push_back({
      {0.388888896, 0.2777777918},  //
      {0.277777791, 0.2777777917},  //
      {0.277777791, 0.3888888960},  //
      {0.388888896, 0.3888888969},  //
  });
  polys.push_back({
      {0.166666672, 0.1666666722},    //
      {0.166666672, -0.1666666721},   //
      {-0.166666672, -0.1666666726},  //
      {-0.166666672, 0.1666666723},   //
  });
  polys.push_back({
      {0.055555556, 0.3888888965},   //
      {0.055555556, 0.2777777912},   //
      {-0.055555556, 0.2777777914},  //
      {-0.055555556, 0.3888888966},  //
  });
  polys.push_back({
      {-0.277777791, -0.2777777910},  //
      {-0.277777791, -0.3888888967},  //
      {-0.388888896, -0.3888888968},  //
      {-0.388888896, -0.2777777919},  //
  });
  polys.push_back({
      {-0.277777791, -0.0555555567},  //
      {-0.388888896, -0.0555555561},  //
      {-0.388888896, 0.0555555569},   //
      {-0.277777791, 0.0555555568},   //
  });
  polys.push_back({
      {-0.277777791, 0.3888888962},  //
      {-0.277777791, 0.2777777910},  //
      {-0.388888896, 0.2777777911},  //
      {-0.388888896, 0.3888888963},  //
  });
  polys.push_back({
      {-0.5, -0.5},  //
      {0.5, -0.5},   //
      {0.5, 0.5},    //
      {-0.5, 0.5},   //
  });
  TestPoly(polys, 56);
}

TEST(Polygon, Woodgrain1) {
  Polygons polys;
  polys.push_back({
      {72.5, -50},   //
      {-72.5, 50},   //
      {-72.5, -50},  //
  });
  polys.push_back({
      {27.7341537, -49.9853325},  //
      {27.4095287, -49.6340637},  //
      {27.9608383, -49.758522},   //
  });
  polys.push_back({
      {-1.56910598, -49.98423},    //
      {-1.58251643, -49.9838409},  //
      {-1.19169295, -48.0386696},  //
      {-1.02179492, -49.9855652},  //
  });
  TestPoly(polys, 12, 0.00145);
}

TEST(Polygon, Woodgrain2) {
  Polygons polys;
  polys.push_back({
      {22.7295628, -49.5001106},   //
      {-21.1059895, -49.9855423},  //
      {-35.0938339, 10.1798563},   //
      {-72.5, -50},                //
      {-12.7149582, -50},          //
  });
  polys.push_back({
      {-40.1850586, -49.9840584},  //
      {-40.2071075, -49.9845123},  //
      {-40.3756485, -49.9855652},  //
      {-40.0327415, -19.857235},   //
  });
  TestPoly(polys, 9, 0.00145);
}

TEST(Polygon, Separate_Quad_And_Tri) {
  Polygons polys;
  polys.push_back({{3, 0}, {3, 1}, {2, 0}});
  polys.push_back({{0.2, 0.8}, {0.8, 0.8}, {1, 1}, {0, 1}});
  TestPoly(polys, 3);
}

TEST(Polygon, Very_Branchy_With_hole) {
  Polygons polys;
  polys.push_back({
      {-12.383395, 191.627597},
      {-45.085282, 233.569954},
      {-49.061051, 241.121459},
      {-55.214156, 240.296329},
      {-59.061922, 241.234954},
      {-60.674552, 242.992235},
      {-61.063571, 242.635239},
      {-61.073658, 243.020877},
      {-61.636008, 243.147031},
      {-62.268425, 240.330262},
      {-61.609029, 240.203785},
      {-59.2187, 240.610881},
      {-55.133, 239.584},
      {-50.566424, 240.105481},
      {-45.687, 232.57},
      {-12.291, 189.141},
      {0, 170},
      {40.7437697, 229.300974},
      {55.7083522, 236.787552},
      {80.252253, 248.42422},
      {79.4563048, 248.689086},
      {56.830082, 238.344589},
      {63.6074538, 247.073547},
      {70.3643318, 251.593951},
      {76.0529064, 252.091121},
      {79.4563, 248.69},
      {75.981, 253.138},
      {69.6668222, 252.703022},
      {62.3134, 248.079},
      {54.8726126, 238.495329},
      {38.62879, 230.54576},
      {0, 180},
  });
  polys.push_back({
      {-61.065936, 242.624693},
      {-59.65022, 241.08199},
      {-61.482003, 240.77002},
  });
  TestPoly(polys, 35);
}
